(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();const lt=(n,e)=>n===e,F=Symbol("solid-proxy"),ze=Symbol("solid-track"),ue={equals:lt};let Re=qe;const B=1,he=2,Ze={owned:null,cleanups:null,context:null,owner:null};var g=null;let Pe=null,y=null,C=null,O=null,Se=0;function le(n,e){const t=y,o=g,i=n.length===0,s=e===void 0?o:e,c=i?Ze:{owned:null,cleanups:null,context:s?s.context:null,owner:s},r=i?n:()=>n(()=>L(()=>De(c)));g=c,y=null;try{return q(r,!0)}finally{y=t,g=o}}function X(n,e){e=e?Object.assign({},ue,e):ue;const t={value:n,observers:null,observerSlots:null,comparator:e.equals||void 0},o=i=>(typeof i=="function"&&(i=i(t.value)),Xe(t,i));return[Ye.bind(t),o]}function b(n,e,t){const o=Ae(n,e,!1,B);ie(o)}function be(n,e,t){Re=pt;const o=Ae(n,e,!1,B),i=Te&&ut(Te);i&&(o.suspense=i),(!t||!t.render)&&(o.user=!0),O?O.push(o):ie(o)}function z(n,e,t){t=t?Object.assign({},ue,t):ue;const o=Ae(n,e,!0,0);return o.observers=null,o.observerSlots=null,o.comparator=t.equals||void 0,ie(o),Ye.bind(o)}function de(n){return q(n,!1)}function L(n){if(y===null)return n();const e=y;y=null;try{return n()}finally{y=e}}function dt(n){be(()=>L(n))}function Me(n){return g===null||(g.cleanups===null?g.cleanups=[n]:g.cleanups.push(n)),n}function fe(){return y}function ut(n){return g&&g.context&&g.context[n.id]!==void 0?g.context[n.id]:n.defaultValue}let Te;function Ye(){if(this.sources&&this.state)if(this.state===B)ie(this);else{const n=C;C=null,q(()=>ge(this),!1),C=n}if(y){const n=this.observers?this.observers.length:0;y.sources?(y.sources.push(this),y.sourceSlots.push(n)):(y.sources=[this],y.sourceSlots=[n]),this.observers?(this.observers.push(y),this.observerSlots.push(y.sources.length-1)):(this.observers=[y],this.observerSlots=[y.sources.length-1])}return this.value}function Xe(n,e,t){let o=n.value;return(!n.comparator||!n.comparator(o,e))&&(n.value=e,n.observers&&n.observers.length&&q(()=>{for(let i=0;i<n.observers.length;i+=1){const s=n.observers[i],c=Pe&&Pe.running;c&&Pe.disposed.has(s),(c?!s.tState:!s.state)&&(s.pure?C.push(s):O.push(s),s.observers&&Ve(s)),c||(s.state=B)}if(C.length>1e6)throw C=[],new Error},!1)),e}function ie(n){if(!n.fn)return;De(n);const e=g,t=y,o=Se;y=g=n,ht(n,n.value,o),y=t,g=e}function ht(n,e,t){let o;try{o=n.fn(e)}catch(i){return n.pure&&(n.state=B,n.owned&&n.owned.forEach(De),n.owned=null),n.updatedAt=t+1,Qe(i)}(!n.updatedAt||n.updatedAt<=t)&&(n.updatedAt!=null&&"observers"in n?Xe(n,o):n.value=o,n.updatedAt=t)}function Ae(n,e,t,o=B,i){const s={fn:n,state:o,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:g,context:g?g.context:null,pure:t};return g===null||g!==Ze&&(g.owned?g.owned.push(s):g.owned=[s]),s}function pe(n){if(n.state===0)return;if(n.state===he)return ge(n);if(n.suspense&&L(n.suspense.inFallback))return n.suspense.effects.push(n);const e=[n];for(;(n=n.owner)&&(!n.updatedAt||n.updatedAt<Se);)n.state&&e.push(n);for(let t=e.length-1;t>=0;t--)if(n=e[t],n.state===B)ie(n);else if(n.state===he){const o=C;C=null,q(()=>ge(n,e[0]),!1),C=o}}function q(n,e){if(C)return n();let t=!1;e||(C=[]),O?t=!0:O=[],Se++;try{const o=n();return ft(t),o}catch(o){t||(O=null),C=null,Qe(o)}}function ft(n){if(C&&(qe(C),C=null),n)return;const e=O;O=null,e.length&&q(()=>Re(e),!1)}function qe(n){for(let e=0;e<n.length;e++)pe(n[e])}function pt(n){let e,t=0;for(e=0;e<n.length;e++){const o=n[e];o.user?n[t++]=o:pe(o)}for(e=0;e<t;e++)pe(n[e])}function ge(n,e){n.state=0;for(let t=0;t<n.sources.length;t+=1){const o=n.sources[t];if(o.sources){const i=o.state;i===B?o!==e&&(!o.updatedAt||o.updatedAt<Se)&&pe(o):i===he&&ge(o,e)}}}function Ve(n){for(let e=0;e<n.observers.length;e+=1){const t=n.observers[e];t.state||(t.state=he,t.pure?C.push(t):O.push(t),t.observers&&Ve(t))}}function De(n){let e;if(n.sources)for(;n.sources.length;){const t=n.sources.pop(),o=n.sourceSlots.pop(),i=t.observers;if(i&&i.length){const s=i.pop(),c=t.observerSlots.pop();o<i.length&&(s.sourceSlots[c]=o,i[o]=s,t.observerSlots[o]=c)}}if(n.owned){for(e=n.owned.length-1;e>=0;e--)De(n.owned[e]);n.owned=null}if(n.cleanups){for(e=n.cleanups.length-1;e>=0;e--)n.cleanups[e]();n.cleanups=null}n.state=0}function gt(n){return n instanceof Error?n:new Error(typeof n=="string"?n:"Unknown error",{cause:n})}function Qe(n,e=g){throw gt(n)}const yt=Symbol("fallback");function Ge(n){for(let e=0;e<n.length;e++)n[e]()}function vt(n,e,t={}){let o=[],i=[],s=[],c=0,r=e.length>1?[]:null;return Me(()=>Ge(s)),()=>{let a=n()||[],l,d;return a[ze],L(()=>{let f=a.length,v,M,K,ce,ae,I,$,A,U;if(f===0)c!==0&&(Ge(s),s=[],o=[],i=[],c=0,r&&(r=[])),t.fallback&&(o=[yt],i[0]=le(at=>(s[0]=at,t.fallback())),c=1);else if(c===0){for(i=new Array(f),d=0;d<f;d++)o[d]=a[d],i[d]=le(h);c=f}else{for(K=new Array(f),ce=new Array(f),r&&(ae=new Array(f)),I=0,$=Math.min(c,f);I<$&&o[I]===a[I];I++);for($=c-1,A=f-1;$>=I&&A>=I&&o[$]===a[A];$--,A--)K[A]=i[$],ce[A]=s[$],r&&(ae[A]=r[$]);for(v=new Map,M=new Array(A+1),d=A;d>=I;d--)U=a[d],l=v.get(U),M[d]=l===void 0?-1:l,v.set(U,d);for(l=I;l<=$;l++)U=o[l],d=v.get(U),d!==void 0&&d!==-1?(K[d]=i[l],ce[d]=s[l],r&&(ae[d]=r[l]),d=M[d],v.set(U,d)):s[l]();for(d=I;d<f;d++)d in K?(i[d]=K[d],s[d]=ce[d],r&&(r[d]=ae[d],r[d](d))):i[d]=le(h);i=i.slice(0,c=f),o=a.slice(0)}return i});function h(f){if(s[d]=f,r){const[v,M]=X(d);return r[d]=M,e(a[d],v)}return e(a[d])}}}function w(n,e){return L(()=>n(e||{}))}const mt=n=>`Stale read from <${n}>.`;function H(n){const e="fallback"in n&&{fallback:()=>n.fallback};return z(vt(()=>n.each,n.children,e||void 0))}function Ne(n){const e=n.keyed,t=z(()=>n.when,void 0,{equals:(o,i)=>e?o===i:!o==!i});return z(()=>{const o=t();if(o){const i=n.children;return typeof i=="function"&&i.length>0?L(()=>i(e?o:()=>{if(!L(t))throw mt("Show");return n.when})):i}return n.fallback},void 0,void 0)}function wt(n,e,t){let o=t.length,i=e.length,s=o,c=0,r=0,a=e[i-1].nextSibling,l=null;for(;c<i||r<s;){if(e[c]===t[r]){c++,r++;continue}for(;e[i-1]===t[s-1];)i--,s--;if(i===c){const d=s<o?r?t[r-1].nextSibling:t[s-r]:a;for(;r<s;)n.insertBefore(t[r++],d)}else if(s===r)for(;c<i;)(!l||!l.has(e[c]))&&e[c].remove(),c++;else if(e[c]===t[s-1]&&t[r]===e[i-1]){const d=e[--i].nextSibling;n.insertBefore(t[r++],e[c++].nextSibling),n.insertBefore(t[--s],d),e[i]=t[s]}else{if(!l){l=new Map;let h=r;for(;h<s;)l.set(t[h],h++)}const d=l.get(e[c]);if(d!=null)if(r<d&&d<s){let h=c,f=1,v;for(;++h<i&&h<s&&!((v=l.get(e[h]))==null||v!==d+f);)f++;if(f>d-r){const M=e[c];for(;r<d;)n.insertBefore(t[r++],M)}else n.replaceChild(t[r++],e[c++])}else c++;else e[c++].remove()}}}const Be="_$DX_DELEGATE";function Ct(n,e,t,o={}){let i;return le(s=>{i=s,e===document?n():N(e,n(),e.firstChild?null:void 0,t)},o.owner),()=>{i(),e.textContent=""}}function x(n,e,t){let o;const i=()=>{const c=document.createElement("template");return c.innerHTML=n,t?c.content.firstChild.firstChild:c.content.firstChild},s=e?()=>L(()=>document.importNode(o||(o=i()),!0)):()=>(o||(o=i())).cloneNode(!0);return s.cloneNode=s,s}function re(n,e=window.document){const t=e[Be]||(e[Be]=new Set);for(let o=0,i=n.length;o<i;o++){const s=n[o];t.has(s)||(t.add(s),e.addEventListener(s,St))}}function S(n,e,t){t==null?n.removeAttribute(e):n.setAttribute(e,t)}function te(n,e){e==null?n.removeAttribute("class"):n.className=e}function Je(n,e,t={}){const o=Object.keys(e||{}),i=Object.keys(t);let s,c;for(s=0,c=i.length;s<c;s++){const r=i[s];!r||r==="undefined"||e[r]||(Ke(n,r,!1),delete t[r])}for(s=0,c=o.length;s<c;s++){const r=o[s],a=!!e[r];!r||r==="undefined"||t[r]===a||!a||(Ke(n,r,!0),t[r]=a)}return t}function _e(n,e,t){return L(()=>n(e,t))}function N(n,e,t,o){if(t!==void 0&&!o&&(o=[]),typeof e!="function")return ye(n,e,o,t);b(i=>ye(n,e(),i,t),o)}function Ke(n,e,t){const o=e.trim().split(/\s+/);for(let i=0,s=o.length;i<s;i++)n.classList.toggle(o[i],t)}function St(n){const e=`$$${n.type}`;let t=n.composedPath&&n.composedPath()[0]||n.target;for(n.target!==t&&Object.defineProperty(n,"target",{configurable:!0,value:t}),Object.defineProperty(n,"currentTarget",{configurable:!0,get(){return t||document}});t;){const o=t[e];if(o&&!t.disabled){const i=t[`${e}Data`];if(i!==void 0?o.call(t,i,n):o.call(t,n),n.cancelBubble)return}t=t._$host||t.parentNode||t.host}}function ye(n,e,t,o,i){for(;typeof t=="function";)t=t();if(e===t)return t;const s=typeof e,c=o!==void 0;if(n=c&&t[0]&&t[0].parentNode||n,s==="string"||s==="number")if(s==="number"&&(e=e.toString()),c){let r=t[0];r&&r.nodeType===3?r.data=e:r=document.createTextNode(e),t=W(n,t,o,r)}else t!==""&&typeof t=="string"?t=n.firstChild.data=e:t=n.textContent=e;else if(e==null||s==="boolean")t=W(n,t,o);else{if(s==="function")return b(()=>{let r=e();for(;typeof r=="function";)r=r();t=ye(n,r,t,o)}),()=>t;if(Array.isArray(e)){const r=[],a=t&&Array.isArray(t);if(Ee(r,e,t,i))return b(()=>t=ye(n,r,t,o,!0)),()=>t;if(r.length===0){if(t=W(n,t,o),c)return t}else a?t.length===0?Fe(n,r,o):wt(n,t,r):(t&&W(n),Fe(n,r));t=r}else if(e.nodeType){if(Array.isArray(t)){if(c)return t=W(n,t,o,e);W(n,t,null,e)}else t==null||t===""||!n.firstChild?n.appendChild(e):n.replaceChild(e,n.firstChild);t=e}}return t}function Ee(n,e,t,o){let i=!1;for(let s=0,c=e.length;s<c;s++){let r=e[s],a=t&&t[s],l;if(!(r==null||r===!0||r===!1))if((l=typeof r)=="object"&&r.nodeType)n.push(r);else if(Array.isArray(r))i=Ee(n,r,a)||i;else if(l==="function")if(o){for(;typeof r=="function";)r=r();i=Ee(n,Array.isArray(r)?r:[r],Array.isArray(a)?a:[a])||i}else n.push(r),i=!0;else{const d=String(r);a&&a.nodeType===3&&a.data===d?n.push(a):n.push(document.createTextNode(d))}}return i}function Fe(n,e,t=null){for(let o=0,i=e.length;o<i;o++)n.insertBefore(e[o],t)}function W(n,e,t,o){if(t===void 0)return n.textContent="";const i=o||document.createTextNode("");if(e.length){let s=!1;for(let c=e.length-1;c>=0;c--){const r=e[c];if(i!==r){const a=r.parentNode===n;!s&&!c?a?n.replaceChild(i,r):n.insertBefore(i,t):a&&r.remove()}else s=!0}}else n.insertBefore(i,t);return[i]}const ve=Symbol("store-raw"),j=Symbol("store-node"),_=Symbol("store-has"),et=Symbol("store-self");function tt(n){let e=n[F];if(!e&&(Object.defineProperty(n,F,{value:e=new Proxy(n,Nt)}),!Array.isArray(n))){const t=Object.keys(n),o=Object.getOwnPropertyDescriptors(n);for(let i=0,s=t.length;i<s;i++){const c=t[i];o[c].get&&Object.defineProperty(n,c,{enumerable:o[c].enumerable,get:o[c].get.bind(e)})}}return e}function R(n){let e;return n!=null&&typeof n=="object"&&(n[F]||!(e=Object.getPrototypeOf(n))||e===Object.prototype||Array.isArray(n))}function Z(n,e=new Set){let t,o,i,s;if(t=n!=null&&n[ve])return t;if(!R(n)||e.has(n))return n;if(Array.isArray(n)){Object.isFrozen(n)?n=n.slice(0):e.add(n);for(let c=0,r=n.length;c<r;c++)i=n[c],(o=Z(i,e))!==i&&(n[c]=o)}else{Object.isFrozen(n)?n=Object.assign({},n):e.add(n);const c=Object.keys(n),r=Object.getOwnPropertyDescriptors(n);for(let a=0,l=c.length;a<l;a++)s=c[a],!r[s].get&&(i=n[s],(o=Z(i,e))!==i&&(n[s]=o))}return n}function me(n,e){let t=n[e];return t||Object.defineProperty(n,e,{value:t=Object.create(null)}),t}function ne(n,e,t){if(n[e])return n[e];const[o,i]=X(t,{equals:!1,internal:!0});return o.$=i,n[e]=o}function bt(n,e){const t=Reflect.getOwnPropertyDescriptor(n,e);return!t||t.get||!t.configurable||e===F||e===j||(delete t.value,delete t.writable,t.get=()=>n[F][e]),t}function nt(n){fe()&&ne(me(n,j),et)()}function Dt(n){return nt(n),Reflect.ownKeys(n)}const Nt={get(n,e,t){if(e===ve)return n;if(e===F)return t;if(e===ze)return nt(n),t;const o=me(n,j),i=o[e];let s=i?i():n[e];if(e===j||e===_||e==="__proto__")return s;if(!i){const c=Object.getOwnPropertyDescriptor(n,e);fe()&&(typeof s!="function"||n.hasOwnProperty(e))&&!(c&&c.get)&&(s=ne(o,e,s)())}return R(s)?tt(s):s},has(n,e){return e===ve||e===F||e===ze||e===j||e===_||e==="__proto__"?!0:(fe()&&ne(me(n,_),e)(),e in n)},set(){return!0},deleteProperty(){return!0},ownKeys:Dt,getOwnPropertyDescriptor:bt};function Y(n,e,t,o=!1){if(!o&&n[e]===t)return;const i=n[e],s=n.length;t===void 0?(delete n[e],n[_]&&n[_][e]&&i!==void 0&&n[_][e].$()):(n[e]=t,n[_]&&n[_][e]&&i===void 0&&n[_][e].$());let c=me(n,j),r;if((r=ne(c,e,i))&&r.$(()=>t),Array.isArray(n)&&n.length!==s){for(let a=n.length;a<s;a++)(r=c[a])&&r.$();(r=ne(c,"length",s))&&r.$(n.length)}(r=c[et])&&r.$()}function ot(n,e){const t=Object.keys(e);for(let o=0;o<t.length;o+=1){const i=t[o];Y(n,i,e[i])}}function Pt(n,e){if(typeof e=="function"&&(e=e(n)),e=Z(e),Array.isArray(e)){if(n===e)return;let t=0,o=e.length;for(;t<o;t++){const i=e[t];n[t]!==i&&Y(n,t,i)}Y(n,"length",o)}else ot(n,e)}function Q(n,e,t=[]){let o,i=n;if(e.length>1){o=e.shift();const c=typeof o,r=Array.isArray(n);if(Array.isArray(o)){for(let a=0;a<o.length;a++)Q(n,[o[a]].concat(e),t);return}else if(r&&c==="function"){for(let a=0;a<n.length;a++)o(n[a],a)&&Q(n,[a].concat(e),t);return}else if(r&&c==="object"){const{from:a=0,to:l=n.length-1,by:d=1}=o;for(let h=a;h<=l;h+=d)Q(n,[h].concat(e),t);return}else if(e.length>1){Q(n[o],e,[o].concat(t));return}i=n[o],t=[o].concat(t)}let s=e[0];typeof s=="function"&&(s=s(i,t),s===i)||o===void 0&&s==null||(s=Z(s),o===void 0||R(i)&&R(s)&&!Array.isArray(s)?ot(i,s):Y(n,o,s))}function E(...[n,e]){const t=Z(n||{}),o=Array.isArray(t),i=tt(t);function s(...c){de(()=>{o&&c.length===1?Pt(t,c[0]):Q(t,c)})}return[i,s]}const we=new WeakMap,st={get(n,e){if(e===ve)return n;const t=n[e];let o;return R(t)?we.get(t)||(we.set(t,o=new Proxy(t,st)),o):t},set(n,e,t){return Y(n,e,Z(t)),!0},deleteProperty(n,e){return Y(n,e,void 0,!0),!0}};function xe(n){return e=>{if(R(e)){let t;(t=we.get(e))||we.set(e,t=new Proxy(e,st)),n(t)}return e}}var It={equals:!1},$t=It,Ue=class{#e;constructor(n=Map){this.#e=new n}dirty(n){this.#e.get(n)?.$$()}track(n){if(!fe())return;let e=this.#e.get(n);if(e)e.n++;else{const[t,o]=X(void 0,$t);this.#e.set(n,e={$:t,$$:o,n:1})}Me(()=>{e.n--===1&&queueMicrotask(()=>e.n===0&&this.#e.delete(n))}),e.$()}},T=Symbol("track-keys"),oe=class extends Map{#e=new Ue;#t=new Ue;constructor(n){if(super(),n)for(const e of n)super.set(e[0],e[1])}has(n){return this.#e.track(n),super.has(n)}get(n){return this.#t.track(n),super.get(n)}get size(){return this.#e.track(T),super.size}*keys(){for(const n of super.keys())this.#e.track(n),yield n;this.#e.track(T)}*values(){for(const[n,e]of super.entries())this.#t.track(n),yield e;this.#e.track(T)}*entries(){for(const n of super.entries())this.#t.track(n[0]),yield n;this.#e.track(T)}set(n,e){return de(()=>{if(super.has(n)){if(super.get(n)===e)return}else this.#e.dirty(n),this.#e.dirty(T);this.#t.dirty(n),super.set(n,e)}),this}delete(n){const e=super.delete(n);return e&&de(()=>{this.#e.dirty(n),this.#e.dirty(T),this.#t.dirty(n)}),e}clear(){super.size&&de(()=>{for(const n of super.keys())this.#e.dirty(n),this.#t.dirty(n);super.clear(),this.#e.dirty(T)})}forEach(n){this.#e.track(T);for(const[e,t]of super.entries())this.#t.track(e),n(t,e,this)}[Symbol.iterator](){return this.entries()}};class u{constructor(e,t){this.x=e,this.y=t}static zero(){return new u(0,0)}static of(e,t){return new u(e,t)}static fromEvent(e){return new u(e.clientX,e.clientY)}static fromVec2(e){return new u(e.x,e.y)}copy(){return new u(this.x,this.y)}serialize(){return{x:this.x,y:this.y}}static deserialize(e){return new u(e.x,e.y)}static deserializeOrDefault(e,t=u.zero()){return e?u.deserialize(e):t}add(...e){return e.reduce((t,o)=>new u(t.x+o.x,t.y+o.y),this)}subtract(...e){return e.reduce((t,o)=>new u(t.x-o.x,t.y-o.y),this)}multiply(...e){return e.reduce((t,o)=>new u(t.x*o.x,t.y*o.y),this)}divide(...e){return e.reduce((t,o)=>new u(o.x/t.x,o.y/t.y),this)}negate(){return new u(-this.x,-this.y)}shift(e){return new u(this.x+e,this.y+e)}multiplyBy(e){return new u(this.x*e,this.y*e)}divideBy(e){return new u(this.x/e,this.y/e)}isWithinRect(e,t){return this.x>=e.x&&this.x<=e.x+t.x&&this.y>=e.y&&this.y<=e.y+t.y}distanceTo(e){return Math.hypot(this.x-e.x,this.y-e.y)}abs(){return u.of(Math.abs(this.x),Math.abs(this.y))}}const zt=x("<div>"),Et=n=>(()=>{const e=zt();return e.$$pointerup=t=>n.nodeflowData.eventStore.onPointerUpInConnector.publish({event:t,nodeId:n.nodeId,connectorId:n.connectorId}),e.$$touchstart=t=>n.nodeflowData.eventStore.onTouchStartInConnector.publish({event:t,nodeId:n.nodeId,connectorId:n.connectorId}),e.$$mousedown=t=>n.nodeflowData.eventStore.onMouseDownInConnector.publish({event:t,nodeId:n.nodeId,connectorId:n.connectorId}),_e(t=>setTimeout(()=>{if(!t)return;const o=n.nodeflowData.nodes.get(n.nodeId).connectorSections.get(n.sectionId).connectors.get(n.connectorId),i=new ResizeObserver(()=>{o.size=u.of(t.offsetWidth,t.offsetHeight)});i.observe(t),o.update({position:u.of((t?.parentElement?.offsetLeft??0)+t.offsetLeft,(t?.parentElement?.offsetTop??0)+t.offsetTop),ref:t,resizeObserver:i,size:u.of(t.offsetWidth,t.offsetHeight)})}),e),b(()=>te(e,n.connector?.css)),e})();re(["mousedown","touchstart","pointerup"]);const We=x('<svg><circle r="4" fill="none"></svg>',!1,!0),xt=x('<svg><path stroke="black" stroke-width="1" fill="transparent">'),Mt=n=>{const e=z(()=>{const{mouseData:t,curveFunctions:o}=n.nodeflowData;if(t.heldConnectors.length!==1)return;const i=t.heldConnectors[0].connector,s=i.parentNode,c=i.getCenter(),r=t.globalMousePosition(),{anchorStart:a,anchorEnd:l}=o.calculateCurveAnchors(c,r,s.getCenter(),r);return{start:c,end:r,anchorStart:a,anchorEnd:l,path:o.createDefaultCurvePath(c,r,a,l)}});return(()=>{const t=xt(),o=t.firstChild;return t.style.setProperty("z-index","2"),t.style.setProperty("position","absolute"),t.style.setProperty("width","1px"),t.style.setProperty("height","1px"),t.style.setProperty("pointer-events","none"),t.style.setProperty("overflow","visible"),N(t,w(Ne,{get when(){return n.nodeflowData.settings.debugMode},get children(){return[(()=>{const i=We();return b(s=>{const c=e()?.anchorStart.x,r=e()?.anchorStart.y,a=n.css??"";return c!==s._v$&&S(i,"cx",s._v$=c),r!==s._v$2&&S(i,"cy",s._v$2=r),a!==s._v$3&&S(i,"class",s._v$3=a),s},{_v$:void 0,_v$2:void 0,_v$3:void 0}),i})(),(()=>{const i=We();return b(s=>{const c=e()?.anchorEnd.x,r=e()?.anchorEnd.y,a=n.css??"";return c!==s._v$4&&S(i,"cx",s._v$4=c),r!==s._v$5&&S(i,"cy",s._v$5=r),a!==s._v$6&&S(i,"class",s._v$6=a),s},{_v$4:void 0,_v$5:void 0,_v$6:void 0}),i})()]}}),null),b(i=>{const s=e()?.path,c=n.css;return s!==i._v$7&&S(o,"d",i._v$7=s),c!==i._v$8&&S(o,"class",i._v$8=c),i},{_v$7:void 0,_v$8:void 0}),t})()},At=x('<svg><path stroke="black" stroke-width="1" fill="none"></svg>',!1,!0),He=x('<svg><circle r="4" fill="none"></svg>',!1,!0),_t=n=>{const e=z(()=>n.nodeflowData.nodes.get(n.sourceNodeId)),t=z(()=>n.nodeflowData.nodes.get(n.destinationNodeId)),o=z(()=>e().getConnector(n.sourceConnectorId)),i=z(()=>t().getConnector(n.destinationConnectorId)),s=z(()=>!e()||!t()?-1:o()?.destinations?.findIndex(c=>c.destinationConnector===i())??-1);return be(()=>{if(s()<0)return;const{curveFunctions:c}=n.nodeflowData,r=e().getConnector(n.sourceConnectorId),a=t().getConnector(n.destinationConnectorId),l=r.getCenter(),d=a.getCenter(),{anchorStart:h,anchorEnd:f}=c.calculateCurveAnchors(l,d,e().getCenter(),t().getCenter());o().destinations.get(s()).path={start:l,end:d,anchorStart:h,anchorEnd:f,path:c.createDefaultCurvePath(l,d,h,f)}}),[(()=>{const c=At();return c.$$pointerdown=r=>{n.nodeflowData.eventStore.onPointerDownInNodeCurve.publish({event:r,sourceConnector:o(),destinationConnector:i()})},c.style.setProperty("cursor","pointer"),c.style.setProperty("pointer-events","visibleStroke"),b(r=>{const a=o().destinations.get(s()).path?.path,l={[n.css?.normal??""]:!0,[n.css?.selected??""]:n.nodeflowData.mouseData.hasSelectedConnection(n.sourceNodeId,n.sourceConnectorId,n.destinationNodeId,n.destinationConnectorId)};return a!==r._v$&&S(c,"d",r._v$=a),r._v$2=Je(c,l,r._v$2),r},{_v$:void 0,_v$2:void 0}),c})(),w(Ne,{get when(){return n.nodeflowData.settings.debugMode},get children(){return[(()=>{const c=He();return b(r=>{const a=o().destinations.get(s()).path?.anchorStart?.x,l=o().destinations.get(s()).path?.anchorStart?.y,d=n.css?.normal??"";return a!==r._v$3&&S(c,"cx",r._v$3=a),l!==r._v$4&&S(c,"cy",r._v$4=l),d!==r._v$5&&S(c,"class",r._v$5=d),r},{_v$3:void 0,_v$4:void 0,_v$5:void 0}),c})(),(()=>{const c=He();return b(r=>{const a=o().destinations.get(s()).path?.anchorEnd?.x,l=o().destinations.get(s()).path?.anchorEnd?.y,d=n.css?.normal??"";return a!==r._v$6&&S(c,"cx",r._v$6=a),l!==r._v$7&&S(c,"cy",r._v$7=l),d!==r._v$8&&S(c,"class",r._v$8=d),r},{_v$6:void 0,_v$7:void 0,_v$8:void 0}),c})()]}})]};re(["pointerdown"]);const je=x("<div>"),kt=n=>{const e=z(()=>n.nodeflowData.nodes.get(n.nodeId)),[t,o]=X(!1);return be(()=>{const i=n.nodeflowData.mouseData.selections.at(-1);i?.type!=="node"||i.node.id!==n.nodeId||!n.nodeflowData.mouseData.pointerDown||(e().position=n.nodeflowData.mouseData.mousePosition.divideBy(n.nodeflowData.zoomLevel).subtract(n.nodeflowData.mouseData.clickStartPosition??u.zero()))}),Me(()=>{e().resizeObserver&&(e().resizeObserver.disconnect(),Array.from(e().connectorSections.values()).forEach(i=>{Array.from(i.connectors.values()).forEach(s=>{s.resizeObserver&&s.resizeObserver.disconnect()})}))}),(()=>{const i=je();return i.$$pointerup=s=>n.nodeflowData.eventStore.onPointerUpInNode.publish({event:s,nodeId:n.nodeId}),i.$$touchstart=s=>n.nodeflowData.eventStore.onTouchStartInNode.publish({event:s,nodeId:n.nodeId}),i.$$mousedown=s=>n.nodeflowData.eventStore.onMouseDownInNode.publish({event:s,nodeId:n.nodeId}),_e(s=>setTimeout(()=>{if(!s)return;const c=new ResizeObserver(()=>{e().update({size:u.of(s.clientWidth,s.clientHeight)}),Array.from(e().connectorSections.values()).forEach(a=>Array.from(a.connectors.values()).forEach(l=>{const d=l.ref;d&&(l.position=u.of((d?.parentElement?.offsetLeft??0)+d.offsetLeft,(d?.parentElement?.offsetTop??0)+d.offsetTop))}))});c.observe(s);const r=e().centered?u.of(s.clientWidth,s.clientHeight).divideBy(2):u.zero();e().update({offset:u.of(s.clientLeft,s.clientTop),ref:s,resizeObserver:c,position:e().position.subtract(r),size:u.of(s.clientWidth,s.clientHeight)}),o(!0)}),i),N(i,()=>e().display({node:e()}),null),N(i,w(H,{get each(){return Array.from(e().connectorSections.entries())},children:([s,c])=>(()=>{const r=je();return N(r,w(H,{get each(){return Array.from(c.connectors.entries())},children:([a,l])=>w(Et,{connector:l,connectorId:a,get nodeId(){return n.nodeId},sectionId:s,get nodeflowData(){return n.nodeflowData}})})),b(()=>te(r,c?.css)),r})()}),null),b(s=>{const c=`${e().position.x}px`,r=`${e().position.y}px`,a=t()?1:0,l={[e()?.css?.normal??""]:!0,[e()?.css?.selected??""]:n.nodeflowData.mouseData.hasSelectedNode(n.nodeId)};return c!==s._v$&&((s._v$=c)!=null?i.style.setProperty("left",c):i.style.removeProperty("left")),r!==s._v$2&&((s._v$2=r)!=null?i.style.setProperty("top",r):i.style.removeProperty("top")),a!==s._v$3&&((s._v$3=a)!=null?i.style.setProperty("opacity",a):i.style.removeProperty("opacity")),s._v$4=Je(i,l,s._v$4),s},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),i})()};re(["mousedown","touchstart","pointerup"]);const Ot=x('<div tabindex="0"><div><svg>'),Lt=n=>e=>(()=>{const t=Ot(),o=t.firstChild,i=o.firstChild;return t.$$touchmove=s=>n.eventStore.onTouchMoveInNodeflow.publish({event:s}),t.$$touchstart=s=>n.eventStore.onTouchStartInNodeflow.publish({event:s}),t.$$keyup=s=>n.eventStore.onKeyUpInNodeflow.publish({event:s}),t.$$keydown=s=>n.eventStore.onKeyDownInNodeflow.publish({event:s}),t.$$mousedown=s=>n.eventStore.onMouseDownInNodeflow.publish({event:s}),t.addEventListener("wheel",s=>n.eventStore.onWheelInNodeflow.publish({event:s})),t.$$pointerup=s=>n.eventStore.onPointerUpInNodeflow.publish({event:s}),t.$$mousemove=s=>n.eventStore.onMouseMoveInNodeflow.publish({event:s}),_e(s=>{new ResizeObserver(()=>{n.update({size:u.of(s.clientWidth,s.clientHeight),startPosition:u.of(s.offsetLeft,s.offsetTop)})}).observe(s)},t),t.style.setProperty("overflow","hidden"),o.style.setProperty("position","absolute"),o.style.setProperty("transform-origin","center"),o.style.setProperty("transition","scale 0.1s ease-out"),N(o,w(H,{get each(){return Array.from(n.nodes.keys())},children:s=>w(kt,{nodeId:s,nodeflowData:n})}),i),i.style.setProperty("z-index","2"),i.style.setProperty("position","absolute"),i.style.setProperty("width","1px"),i.style.setProperty("height","1px"),i.style.setProperty("pointer-events","none"),i.style.setProperty("overflow","visible"),N(i,w(H,{get each(){return Array.from(n.nodes.entries())},children:([s,c])=>w(H,{get each(){return c.getAllConnectors()},children:r=>w(H,{get each(){return r.destinations.array},children:a=>w(_t,{nodeflowData:n,sourceNodeId:s,get sourceConnectorId(){return r.id},get destinationNodeId(){return a.destinationConnector.parentSection.parentNode.id},get destinationConnectorId(){return a.destinationConnector.id},get css(){return a.css}})})})})),N(o,w(Ne,{get when(){return n.mouseData.heldConnectors.length===1},get children(){return w(Mt,{get css(){return e?.css?.newCurve},nodeflowData:n})}}),null),b(s=>{const c=e?.css?.nodeflow,r=e.height,a=e.width,l=`scale(${n.zoomLevel}) translate(${n.position.x}px, ${n.position.y}px)`;return c!==s._v$&&te(t,s._v$=c),r!==s._v$2&&((s._v$2=r)!=null?t.style.setProperty("height",r):t.style.removeProperty("height")),a!==s._v$3&&((s._v$3=a)!=null?t.style.setProperty("width",a):t.style.removeProperty("width")),l!==s._v$4&&((s._v$4=l)!=null?o.style.setProperty("transform",l):o.style.removeProperty("transform")),s},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),t})();re(["mousemove","pointerup","mousedown","keydown","keyup","touchstart","touchmove"]);class P{constructor(e){this.store=E(e??[])}get array(){return this.store[0]}get length(){return this.store[0].length}at(e){return this.store[0].at(e)}forEach(e){this.store[0].forEach(e)}filter(e){return this.store[0].filter(e)}filterInPlace(e){this.store[1](this.filter(e))}map(e){return this.store[0].map(e)}flatMap(e){return this.store[0].flatMap(e)}find(e){return this.store[0].find(e)}findIndex(e){return this.store[0].findIndex(e)}splice(e,t,...o){this.store[1](this.store[0].splice(e,t,...o))}reduce(e,t){return this.store[0].reduce(e,t)}some(e){return this.store[0].some(e)}every(e){return this.store[0].every(e)}get(e){return this.store[0][e]}set(e,t){this.store[1](e,t)}push(e){this.store[1](this.store[0].length,e)}}class D{currentChangeIndex=-1;constructor(e=-1){this.maxChanges=e,this.changes=[]}serialize(){return{changes:this.changes,currentChangeIndex:this.currentChangeIndex,maxChanges:this.maxChanges}}deserialize(e){this.changes=e.changes,this.currentChangeIndex=e.currentChangeIndex,this.maxChanges=e.maxChanges}addChange(e){this.changes=this.changes.slice(0,this.currentChangeIndex+1),this.changes.length===this.maxChanges&&this.changes.shift(),this.changes.push(e),this.currentChangeIndex=this.changes.length-1}undo(){if(this.currentChangeIndex===-1)return!1;const e=this.changes[this.currentChangeIndex].historyGroup;for(;this.currentChangeIndex>-1&&this.changes[this.currentChangeIndex].historyGroup===e;)this.changes[this.currentChangeIndex].undoChange(),this.currentChangeIndex--;return!0}redo(){if(this.currentChangeIndex===this.changes.length-1)return!1;const e=this.changes[this.currentChangeIndex+1].historyGroup;for(;this.currentChangeIndex<this.changes.length-1&&this.changes[this.currentChangeIndex+1].historyGroup===e;)this.currentChangeIndex++,this.changes[this.currentChangeIndex].applyChange();return!0}static evaluateHistoryGroup(e=!0){return typeof e=="boolean"?e?crypto.randomUUID():!1:e}}class it{constructor(e){this.nodeflowData=e}getHorizontalCurve=(e,t)=>u.of((t.x-e.x)/1.5,0);getVerticalCurve=(e,t)=>u.of(0,(t.y-e.y)/1.5);calculateCurveAnchors(e,t,o,i){const s=e.distanceTo(t)/300,c=o.add(e.subtract(o).multiplyBy(s)),r=i.add(t.subtract(i).multiplyBy(s));return{anchorStart:c,anchorEnd:r}}createDefaultCurvePath=(e,t,o,i)=>`M ${e.x} ${e.y} C ${o.x} ${o.y}, ${i.x} ${i.y}, ${t.x} ${t.y}`}class Tt{constructor(e){this.store=E(e)}get css(){return this.store[0].css}get destinationConnector(){return this.store[0].destinationConnector}get path(){return this.store[0].path}set css(e){this.store[1]({css:e})}set path(e){this.store[1]({path:e})}set destinationConnector(e){this.store[1]({destinationConnector:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}}const J=(...n)=>{const e=n[0];return n.slice(1).reduce((o,i)=>new Set([...o].filter(s=>i.has(s))),e)},ee=n=>n.size===0,k=n=>typeof n!="object"||n===null||n===void 0?n:Array.isArray(n)?n.map(k):typeof n=="object"?Object.fromEntries(Object.entries(n).map(([e,t])=>[e,k(t)])):n;class ke{constructor(e){this.store=E(e)}serialize(){return{css:this.css,hovered:this.hovered,id:this.id,position:this.position.serialize()}}serializeConnections(){return[...this.destinations.map(({destinationConnector:e,css:t})=>({sourceNodeId:this.parentNode.id,sourceConnectorId:this.id,destinationNodeId:e.parentNode.id,destinationConnectorId:e.id,css:k(t)})),...this.sources.map(({sourceConnector:e})=>({sourceNodeId:e.parentNode.id,sourceConnectorId:e.id,destinationNodeId:this.parentNode.id,destinationConnectorId:this.id,css:k(e.destinations.find(t=>t.destinationConnector.parentNode.id===this.parentNode.id)?.css)}))]}static deserialize(e,t){const o=!e.id||t.connectors.has(e.id)?t.parentNode.getNextFreeConnectorId():e.id;return new ke({css:e.css,destinations:new P,hovered:e.hovered??!1,id:o,parentSection:t,position:u.deserializeOrDefault(e.position),ref:void 0,resizeObserver:void 0,size:u.zero(),sources:new P})}get css(){return this.store[0].css}values(){return this.store[0]}get destinations(){return this.store[0].destinations}get hovered(){return this.store[0].hovered}get id(){return this.store[0].id}get parentSection(){return this.store[0].parentSection}get parentNode(){return this.store[0].parentSection.parentNode}get position(){return this.store[0].position}get ref(){return this.store[0].ref}get resizeObserver(){return this.store[0].resizeObserver}get size(){return this.store[0].size}get sources(){return this.store[0].sources}set css(e){this.store[1]({css:e})}set destinations(e){this.store[1]({destinations:e})}set hovered(e){this.store[1]({hovered:e})}set id(e){this.store[1]({id:e})}set parentSection(e){this.store[1]({parentSection:e})}set position(e){this.store[1]({position:e})}set ref(e){this.store[1]({ref:e})}set resizeObserver(e){this.store[1]({resizeObserver:e})}set size(e){this.store[1]({size:e})}set sources(e){this.store[1]({sources:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}removeIncomingConnections(){this.sources.forEach(({sourceConnector:e})=>{e.destinations.filterInPlace(({destinationConnector:t})=>t.parentNode.id!==this.id)}),this.sources=new P}removeOutgoingConnections(){this.destinations.forEach(({destinationConnector:e})=>{e.sources.filterInPlace(({sourceConnector:t})=>t.parentNode.id!==this.id)}),this.destinations=new P}getCenter(){const{position:e,offset:t}=this.parentNode;return e.add(t,this.position,this.size.divideBy(2))}}class p{constructor(){this.nodeflows=new Map,this.globalEventStore={onMouseMoveInDocument:new Ie,onPointerLeaveFromDocument:new Ie,onPointerUpInDocument:new Ie},this.setupDefaultEventHandlers()}static get(){return this.instance||(p.instance=new p),p.instance}createCanvas(...e){const t=new Le(...e);return this.nodeflows.set(e[0],t),[t,Lt(t)]}getNodeflow(e){return this.nodeflows.get(e)}removeNodeflow(e){this.nodeflows.delete(e)}clear(){this.nodeflows.clear()}hasNodeflow(e){return this.nodeflows.has(e)}setupDefaultEventHandlers(){document.onmousemove=e=>this.globalEventStore.onMouseMoveInDocument.publish({event:e}),document.onpointerleave=e=>this.globalEventStore.onPointerLeaveFromDocument.publish({event:e}),document.onpointerup=e=>this.globalEventStore.onPointerUpInDocument.publish({event:e}),this.globalEventStore.onMouseMoveInDocument.subscribeMultiple([{name:"update-mouse-position",event:({event:e})=>{this.nodeflows.forEach(t=>{t.mouseData.mousePosition=u.fromEvent(e)})}}]),this.globalEventStore.onPointerLeaveFromDocument.subscribeMultiple([{name:"reset-mouse-data",event:()=>{this.nodeflows.forEach(e=>{e.mouseData.reset()})}}]),this.globalEventStore.onPointerUpInDocument.subscribeMultiple([])}}class Gt{constructor(e,t){this.nodeflowData=e,this.store=E(t)}serialize(){return{connectors:Object.fromEntries(Array.from(this.connectors.entries()).map(([e,t])=>[e,t.serialize()])),css:this.css,id:this.id}}addConnector(e,t=!0){const o=ke.deserialize(e,this);if(this.connectors.has(o.id))return;const i=D.evaluateHistoryGroup(t);if(i){const s=o.serialize(),c=this.id,r=s.id,a=this.parentNode.id,l=this.nodeflowData.id;this.nodeflowData.changes.addChange({type:"add",source:"connector",applyChange:()=>{p.get().getNodeflow(l)?.nodes.get(a)?.addConnector(c,s,!1)},undoChange:()=>{p.get().getNodeflow(l)?.nodes.get(a)?.removeConnector(c,r,!1)},historyGroup:i})}return this.connectors.set(o.id,o),o}removeConnector(e,t=!0){if(!this.connectors.has(e))return;const o=this.connectors.get(e),i=D.evaluateHistoryGroup(t);if(i){const s=o.serialize(),c=this.id,r=s.id,a=this.parentNode.id,l=this.nodeflowData.id;this.nodeflowData.changes.addChange({type:"remove",source:"connector",applyChange:()=>{p.get().getNodeflow(l)?.nodes.get(a)?.removeConnector(c,r,!1)},undoChange:()=>{p.get().getNodeflow(l)?.nodes.get(a)?.addConnector(c,s,!1)},historyGroup:i})}this.connectors.delete(e)}get connectors(){return this.store[0].connectors}get css(){return this.store[0].css}get id(){return this.store[0].id}get parentNode(){return this.store[0].parentNode}set connectors(e){this.store[1]({connectors:e})}set css(e){this.store[1]({css:e})}set id(e){this.store[1]({id:e})}set parentNode(e){this.store[1]({parentNode:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}removeIncomingConnections(){this.connectors.forEach(e=>e.removeIncomingConnections())}removeOutgoingConnections(){this.connectors.forEach(e=>e.removeOutgoingConnections())}getSourceConnectors(){return Array.from(this.connectors.values()).flatMap(e=>e.sources.flatMap(t=>t.sourceConnector))}getDestinationConnectors(){return Array.from(this.connectors.values()).flatMap(e=>e.destinations.flatMap(t=>t.destinationConnector))}}class Bt{constructor(e){this.store=E(e)}get sourceConnector(){return this.store[0].sourceConnector}set sourceConnector(e){this.store[1]({sourceConnector:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}}class rt{subscriptions=new oe;blacklistFilters=new oe;blacklist(e,t){this.blacklistFilters.set(e,t)}unblacklist(e){this.blacklistFilters.delete(e)}unblacklistMultiple(e){e.forEach(this.unblacklist)}clearBlacklist(){this.blacklistFilters.clear()}subscribe(e,t,o=0){this.subscriptions.set(e,{name:e,event:t,priority:o})}subscribeMultiple(e){e.forEach(({name:t,event:o,priority:i})=>this.subscribe(t,o,i))}unsubscribe(e){this.subscriptions.delete(e)}unsubsribeMultiple(e){e.forEach(this.unsubscribe)}publish(e){Array.from(this.subscriptions.values()).sort((t,o)=>o.priority-t.priority).filter(({name:t,priority:o})=>!Array.from(this.blacklistFilters.values()).some(s=>s(e,t,o))).map(({event:t})=>t).forEach(t=>t(e))}clear(){this.subscriptions.clear()}get size(){return this.subscriptions.size}get isEmpty(){return this.size===0}}class m extends rt{constructor(e){super(),this.nodeflowData=e}}class Ie extends rt{}class Kt{constructor(e){this.nodeflowData=e,this.store=E({heldKeys:new Set})}get heldKeys(){return this.store[0].heldKeys}set heldKeys(e){this.store[1]({heldKeys:e})}releaseKey(e){this.store[1](xe(t=>t.heldKeys.delete(e)))}clearKeys(){this.store[1]({heldKeys:new Set})}pressKey(e){this.store[1](xe(t=>t.heldKeys.add(e)))}isActionPressed(e){return!ee(J(this.heldKeys,e))}}class Ft{constructor(e){this.nodeflowData=e,this.store=E({clickStartPosition:void 0,mousePosition:u.zero(),pointerDown:!1,selections:new P})}serialize(){const e=this.store[0].selections.map(t=>{switch(t.type){case"connector":return{connectorId:t.connector.id,nodeId:t.connector.parentNode.id,type:"connector"};case"node":return{nodeId:t.node.id,type:"node"};case"connection":return{connection:{destinationConnectorId:t.connection.destinationConnector.id,destinationNodeId:t.connection.destinationConnector.parentSection.parentNode.id,sourceConnectorId:t.connection.sourceConnector.id,sourceNodeId:t.connection.sourceConnector.parentNode.id},type:"connection"};default:return{type:"nodeflow"}}});return{clickStartPosition:this.clickStartPosition?.serialize(),selections:e}}deserialize(e){const t=e.selections.map(o=>{if(o.type==="connector"){const i=this.nodeflowData.nodes.get(o.nodeId);if(!i)return;const s=i.getConnector(o.connectorId);return s?{connector:s,type:"connector"}:void 0}else if(o.type==="node"){const i=this.nodeflowData.nodes.get(o.nodeId);return i?{node:i,type:"node"}:void 0}else if(o.type==="connection"){const i=this.nodeflowData.nodes.get(o.connection.sourceNodeId);if(!i)return;const s=i.getConnector(o.connection.sourceConnectorId);if(!s)return;const c=this.nodeflowData.nodes.get(o.connection.destinationNodeId);if(!c)return;const r=c.getConnector(o.connection.destinationConnectorId);return r?{connection:{destinationConnector:r,sourceConnector:s},type:"connection"}:void 0}else return{type:"nodeflow"}}).filter(Boolean);this.update({clickStartPosition:u.deserializeOrDefault(e.clickStartPosition),selections:new P(t)})}get clickStartPosition(){return this.store[0].clickStartPosition}get isDraggingObject(){return this.store[0].pointerDown}get selections(){return this.store[0].selections}get heldConnections(){return this.store[0].selections.filter(e=>e.type==="connection")}get heldConnectors(){return this.store[0].selections.filter(e=>e.type==="connector")}get heldNodes(){return this.store[0].selections.filter(e=>e.type==="node")}get mousePosition(){return this.store[0].mousePosition}get pointerDown(){return this.store[0].pointerDown}set clickStartPosition(e){this.store[1]({clickStartPosition:e})}set mousePosition(e){this.store[1]({mousePosition:e})}set pointerDown(e){this.store[1]({pointerDown:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}reset(e=!1){this.update({clickStartPosition:void 0,pointerDown:e,selections:new P})}selectNodeflow(){this.hasSelectedNodeflow()&&this.selections.filterInPlace(e=>e.type!=="nodeflow"),this.selections.push({type:"nodeflow"})}selectNode=(e,t,o=!0)=>{if(!this.nodeflowData.nodes.has(e))return;const i=this.nodeflowData.nodes.get(e);this.hasSelectedNode(e)&&this.selections.filterInPlace(s=>s.type!=="node"||s.node.id!==e),this.selections.push({node:i,type:"node"}),this.update({pointerDown:o,mousePosition:t,clickStartPosition:t.divideBy(this.nodeflowData.zoomLevel).subtract(this.nodeflowData.nodes.get(e).position)})};clearSelections=()=>{this.store[1]("selections",new P),this.nodeflowData.resetMovement()};startCreatingConnection=(e,t,o)=>{if(!this.nodeflowData.settings.canCreateConnections)return;const i=this.nodeflowData.nodes.get(e);if(!i)return;const s=i.getConnector(o);s&&this.update({pointerDown:!0,selections:new P([{connector:s,type:"connector"}]),mousePosition:t,clickStartPosition:t.divideBy(this.nodeflowData.zoomLevel).subtract(i.position)})};clearSelectedByType(e){this.store[0].selections.filterInPlace(t=>t.type!==e)}hasSelectedNodeflow(){return this.store[0].selections.some(e=>e.type==="nodeflow")}hasSelectedNode(e){return this.store[0].selections.some(t=>t.type==="node"&&t.node.id===e)}hasSelectedConnector(e){return this.store[0].selections.some(t=>t.type==="connector"&&t.connector.id===e)}hasSelectedConnection(e,t,o,i){return this.store[0].selections.some(s=>s.type==="connection"&&s.connection.sourceConnector.id===t&&s.connection.sourceConnector.parentNode.id===e&&s.connection.destinationConnector.id===i&&s.connection.destinationConnector.parentNode.id===o)}globalMousePosition=()=>this.mousePosition.subtract(this.nodeflowData.startPosition).divideBy(this.nodeflowData.zoomLevel).subtract(this.nodeflowData.position)}const[Ce,Ut]=X(u.of(window.innerWidth,window.innerHeight));be(()=>{const n=()=>Ut(u.of(window.innerWidth,window.innerHeight));return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)});const $e=(n,e,t)=>Math.min(Math.max(n,e),t);class Oe{constructor(e,t){this.nodeflowData=e,this.store=E(t)}get nodeflow(){return this.nodeflowData}get centered(){return this.store[0].centered}get connectorSections(){return this.store[0].connectorSections}get css(){return this.store[0].css}get customData(){return this.store[0].customData}get display(){return this.store[0].display}get id(){return this.store[0].id}get offset(){return this.store[0].offset}get position(){return this.store[0].position}get ref(){return this.store[0].ref}get resizeObserver(){return this.store[0].resizeObserver}get size(){return this.store[0].size}set centered(e){this.store[1]({centered:e})}set connectorSections(e){this.store[1]({connectorSections:e})}set css(e){this.store[1]({css:e})}set customData(e){this.store[1]({customData:e})}set display(e){this.store[1]({display:e})}set id(e){this.store[1]({id:e})}set offset(e){this.store[1]({offset:e})}set position(e){this.store[1]({position:e})}set ref(e){this.store[1]({ref:e})}set resizeObserver(e){this.store[1]({resizeObserver:e})}set size(e){this.store[1]({size:e})}update(e){this.store[1](e)}serialize(){const e=Array.from(this.connectorSections.values()).reduce((t,o)=>(t[o.id]=o.serialize(),t),{});return{centered:this.centered,connectorSections:e,css:k(this.css),customData:k(this.customData),id:this.id,display:this.display,position:this.position.serialize()}}static deserialize(e,t,o=!0){const i=t.id??e.getNextFreeNodeId(),s=new Oe(e,{centered:t.centered??!1,connectorSections:new oe,css:k(t.css)??{},customData:k(t.customData)??{},display:t.display??(()=>{}),id:i,offset:u.zero(),position:u.deserializeOrDefault(t.position),ref:void 0,resizeObserver:void 0,size:u.zero()}),c=D.evaluateHistoryGroup(o);return Object.entries(t.connectorSections??[]).forEach(([r,a])=>{s.addConnectorSection(r,a.css,c),Object.values(a.connectors).forEach(l=>{s.addConnector(r,l,c)})}),s}serializeConnections(){return Array.from(this.connectorSections.values()).flatMap(e=>Array.from(e.connectors.values()).flatMap(t=>t.serializeConnections()))}updateWithPrevious(e){this.store[1](e)}addConnectorSection(e,t,o=!0){(!e||this.connectorSections.has(e))&&(e=this.getNextFreeConnectorSectionId());const i=D.evaluateHistoryGroup(o);if(i){const c=this.nodeflowData.id,r=this.id;this.nodeflowData.changes.addChange({type:"remove",source:"connector-section",applyChange:()=>{p.get().getNodeflow(c)?.nodes.get(r)?.addConnectorSection(e,t,!1)},undoChange:()=>{p.get().getNodeflow(c)?.nodes.get(r)?.removeConnectorSection(e,!1)},historyGroup:i})}const s=new Gt(this.nodeflowData,{connectors:new oe,css:t,id:e,parentNode:this});return this.connectorSections.set(e,s),s}removeConnectorSection(e,t=!0){if(!this.connectorSections.has(e))return;const o=this.connectorSections.get(e),i=D.evaluateHistoryGroup(t);if(i){const s=this.nodeflowData.id,c=o.css,r=this.id;this.nodeflowData.changes.addChange({type:"remove",source:"connector-section",applyChange:()=>{p.get().getNodeflow(s)?.nodes.get(r)?.removeConnectorSection(e,!1)},undoChange:()=>{p.get().getNodeflow(s)?.nodes.get(r)?.addConnectorSection(e,c,!1)},historyGroup:i})}this.connectorSections.delete(e)}getConnectorCount(){return Array.from(this.connectorSections.values()).reduce((e,t)=>e+t.connectors.size,0)}addConnector(e,t,o=!0){if(this.connectorSections.has(e))return this.connectorSections.get(e).addConnector(t,o)}removeConnector(e,t,o=!0){this.connectorSections.has(e)&&this.connectorSections.get(e).removeConnector(t,o)}getConnector(e){return this.getSectionFromConnector(e)?.connectors.get(e)}getTotalConnectedInputs(e){return this.getConnector(e)?.sources.length??0}getAllConnectors(){return Array.from(this.connectorSections.values()).reduce((e,t)=>e.concat(Array.from(t.connectors.values())),[])}getNextFreeConnectorSectionId(){let e="0";for(let t=1;this.connectorSections.has(e);++t)e=t.toString();return e}getNextFreeConnectorId(){let e="0";for(let t=1;Array.from(this.connectorSections.values()).some(o=>o.connectors.has(e));++t)e=t.toString();return e}removeIncomingConnections(){this.connectorSections.forEach(e=>e.removeIncomingConnections())}removeOutgoingConnections(){this.connectorSections.forEach(e=>e.removeOutgoingConnections())}getAllSourceConnectors(){return Array.from(this.connectorSections.values()).reduce((e,t)=>e.concat(t.getSourceConnectors()),[])}getAllDestinationConnectors(){return Array.from(this.connectorSections.values()).reduce((e,t)=>e.concat(t.getDestinationConnectors()),[])}getAllSourceConnections(){return this.getAllSourceConnectors().map(e=>e.destinations.filter(o=>o.destinationConnector.parentNode.id===this.id).map(o=>({sourceNodeId:e.parentNode.id,sourceConnectorId:e.id,destinationNodeId:o.destinationConnector.parentNode.id,destinationConnectorId:o.destinationConnector.id,css:o.css}))).flat()}getAllDestinationConnections(){return this.getAllDestinationConnectors().map(e=>e.sources.filter(o=>o.sourceConnector.parentNode.id===this.id).map(o=>({sourceNodeId:o.sourceConnector.parentNode.id,sourceConnectorId:o.sourceConnector.id,destinationNodeId:e.parentNode.id,destinationConnectorId:e.id}))).flat()}getSectionFromConnector(e){return Array.from(this.connectorSections.values()).find(t=>t.connectors.get(e))}getCenter(){return this.position.add(this.offset).add(this.size.divideBy(2))}select(e){this.nodeflowData.selectNode(this.id,e)}}const V={LEFT:0,MIDDLE:1,RIGHT:2,BACK:3,FORWARD:4};class Le{static DEFAULT_SETTINGS={canAddNodes:!0,canCreateConnections:!0,canDeleteConnections:!0,canDeleteNodes:!0,canMoveNodes:!0,canPan:!0,canZoom:!0,debugMode:!1,keyboardZoomMultiplier:15,maxMovementSpeed:15,maxZoom:200,minZoom:.02,movementAcceleration:1.5,movementSlowdown:.85,zoomMultiplier:.005};keymap={MOVE_DOWN:new Set(["ArrowDown","KeyS"]),MOVE_LEFT:new Set(["ArrowLeft","KeyA"]),MOVE_RIGHT:new Set(["ArrowRight","KeyD"]),MOVE_UP:new Set(["ArrowUp","KeyW"]),SELECT_MULTIPLE:new Set(["ShiftLeft","ShiftRight"])};constructor(e,t,o){this.id=e,this.settingsStore=E({...Le.DEFAULT_SETTINGS,...t}),this.curveFunctions=o?.(this)??new it(this),this.store=E({currentMoveSpeed:u.zero(),position:u.zero(),startPosition:u.zero(),size:u.zero(),zoomLevel:1,pinchDistance:0}),this.changes=new D,this.mouseData=new Ft(this),this.keyboardData=new Kt(this),this.nodes=new oe,this.eventStore={onKeyDownInNodeflow:new m(this),onKeyUpInNodeflow:new m(this),onMouseDownInConnector:new m(this),onMouseDownInNodeflow:new m(this),onMouseDownInNode:new m(this),onMouseMoveInNodeflow:new m(this),onNodeConnected:new m(this),onNodeDataChanged:new m(this),onPointerDownInNodeCurve:new m(this),onPointerUpInConnector:new m(this),onPointerUpInNodeflow:new m(this),onPointerUpInNode:new m(this),onTouchMoveInNodeflow:new m(this),onTouchStartInConnector:new m(this),onTouchStartInNodeflow:new m(this),onTouchStartInNode:new m(this),onWheelInNodeflow:new m(this)},this.setupDefaultEventHandlers(),setInterval(()=>{const i=!ee(J(this.keyboardData.heldKeys,this.keymap.MOVE_LEFT)),s=!ee(J(this.keyboardData.heldKeys,this.keymap.MOVE_RIGHT)),c=!ee(J(this.keyboardData.heldKeys,this.keymap.MOVE_UP)),r=!ee(J(this.keyboardData.heldKeys,this.keymap.MOVE_DOWN)),a=this.mouseData.heldNodes.length>0;this.currentMoveSpeed=u.of(this.calculateDirectionalMovementAmount(i||s,this.currentMoveSpeed.x,s,i,!a),this.calculateDirectionalMovementAmount(c||r,this.currentMoveSpeed.y,r,c,!a)),!(this.currentMoveSpeed.x===0&&this.currentMoveSpeed.y===0)&&(this.settings.canPan&&!a?this.updateBackgroundPosition(this.currentMoveSpeed,!0):a&&this.settings.canMoveNodes&&this.updateHeldNodePosition(this.currentMoveSpeed.divideBy(this.zoomLevel)))},10)}serialize(){return{changes:this.changes.serialize(),connections:this.serializeConnections(),currentMoveSpeed:this.currentMoveSpeed.serialize(),mouseData:this.mouseData.serialize(),nodes:Object.fromEntries(Array.from(this.nodes.entries()).map(([e,t])=>[e,t.serialize()])),pinchDistance:this.pinchDistance,position:this.position.serialize(),size:this.size.serialize(),startPosition:this.startPosition.serialize(),zoomLevel:this.zoomLevel}}deserialize(e,t=!1){this.update({currentMoveSpeed:u.deserializeOrDefault(e.currentMoveSpeed),pinchDistance:e.pinchDistance,position:u.deserializeOrDefault(e.position),size:u.deserializeOrDefault(e.size),startPosition:u.deserializeOrDefault(e.startPosition),zoomLevel:e.zoomLevel});const o=D.evaluateHistoryGroup(t);this.nodes.clear(),Object.values(e.nodes).forEach(i=>{this.addNode(i,o)}),this.mouseData.deserialize(e.mouseData),e.connections.forEach(i=>{this.addConnection(i,o)}),this.changes.deserialize(e.changes)}serializeConnections(){return Array.from(this.nodes.values()).flatMap(e=>e.serializeConnections())}get settings(){return this.settingsStore[0]}updateSettings(e){this.settingsStore[1](e)}resetMovement=()=>{this.currentMoveSpeed=u.zero(),this.keymap.MOVE_LEFT.forEach(e=>this.keyboardData.releaseKey(e)),this.keymap.MOVE_RIGHT.forEach(e=>this.keyboardData.releaseKey(e)),this.keymap.MOVE_UP.forEach(e=>this.keyboardData.releaseKey(e)),this.keymap.MOVE_DOWN.forEach(e=>this.keyboardData.releaseKey(e))};get currentMoveSpeed(){return this.store[0].currentMoveSpeed}get position(){return this.store[0].position}get startPosition(){return this.store[0].startPosition}get size(){return this.store[0].size}get zoomLevel(){return this.store[0].zoomLevel}get pinchDistance(){return this.store[0].pinchDistance}set currentMoveSpeed(e){this.store[1]({currentMoveSpeed:e})}set position(e){this.store[1]({position:e})}set startPosition(e){this.store[1]({startPosition:e})}set size(e){this.store[1]({size:e})}set zoomLevel(e){this.store[1]({zoomLevel:e})}set pinchDistance(e){this.store[1]({pinchDistance:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}center(){const t=Ce().divideBy(2);return this.startPosition.add(t).divideBy(this.zoomLevel).subtract(this.position)}calculateDirectionalMovementAmount(e,t,o,i,s=!1){let c=t;if(e){const r=this.settings.movementAcceleration*(s?-1:1);c=$e(c+(o?r:0)-(i?r:0),-this.settings.maxMovementSpeed,this.settings.maxMovementSpeed)}else c=$e(c*this.settings.movementSlowdown,-this.settings.maxMovementSpeed,this.settings.maxMovementSpeed);return c<=.1&&c>=-.1&&(c=0),c}updateZoom=(e,t)=>{const o=this.zoomLevel;if(e===0)return;const i=Number($e(e>0?o+o*e*this.settings.zoomMultiplier:o/(1-e*this.settings.zoomMultiplier),this.settings.minZoom,this.settings.maxZoom).toFixed(4));this.mouseData.pointerDown=!1;const s=this.size,c=t.subtract(this.startPosition),r=s.multiplyBy(o),a=s.multiplyBy(i),l=c.subtract(r.divideBy(2)).divideBy(o),d=c.subtract(a.divideBy(2)).divideBy(i);this.updateWithPrevious(h=>({position:h.position.subtract(l).add(d),zoomLevel:i}))};updateBackgroundPosition(e,t=!1){!this.mouseData.hasSelectedNodeflow()||t===this.mouseData.isDraggingObject||this.updateWithPrevious(o=>({position:o.position.add(e.divideBy(this.zoomLevel))}))}addNode(e,t=!0){const o=D.evaluateHistoryGroup(t),i=Oe.deserialize(this,e,o);if(this.nodes.set(i.id,i),o){const s=i.serializeConnections(),c=i.serialize(),r=this.id;this.changes.addChange({type:"add",source:"node",applyChange:()=>{const a=p.get().getNodeflow(r);a?.addNode(c,!1),s.forEach(l=>{a?.addConnection(l,!1)})},undoChange:()=>{p.get().getNodeflow(r)?.removeNode(i.id,!1)},historyGroup:o})}return i}updateNode(e,t,o=!0){if(!this.nodes.has(e))return;const i=this.nodes.get(e),s=D.evaluateHistoryGroup(o);if(s){const c=this.nodes.get(e),r=c.serialize(),a=c.serializeConnections(),l=this.id,d=Object.entries(r).reduce((h,[f,v])=>(f in t&&Object.assign(h,{[f]:k(v)}),h),{});this.changes.addChange({type:"update",source:"node",applyChange:()=>{p.get().getNodeflow(l)?.updateNode(e,t,!1)},undoChange:()=>{const h=p.get().getNodeflow(l);h?.updateNode(e,d,!1),a.forEach(f=>{h?.addConnection(f,!1)})},historyGroup:s})}i.updateWithPrevious(xe(c=>Object.assign(c,t))),this.eventStore.onNodeDataChanged.publish({nodeId:e,data:t})}removeNode(e,t=!0){if(!this.nodes.has(e))return;this.mouseData.clearSelections();const o=D.evaluateHistoryGroup(t);if(o){const i=this.nodes.get(e),s=i.serializeConnections(),c=this.id;this.changes.addChange({type:"remove",source:"node",applyChange:()=>{p.get().getNodeflow(c)?.removeNode(e,!1)},undoChange:()=>{const r=p.get().getNodeflow(c);r?.addNode(i.serialize(),!1),s.forEach(a=>{r?.addConnection(a,!1)})},historyGroup:o})}this.removeIncomingConnections(e),this.removeOutgoingConnections(e),this.nodes.delete(e)}removeIncomingConnections(e){this.nodes.has(e)&&this.nodes.get(e).connectorSections.forEach(t=>{t.connectors.forEach(o=>{o.sources.forEach(({sourceConnector:i})=>{i.destinations.filterInPlace(({destinationConnector:s})=>s.parentNode.id!==e)}),o.sources=new P})})}removeOutgoingConnections(e){this.nodes.has(e)&&this.nodes.get(e).connectorSections.forEach(t=>{t.connectors.forEach(o=>{o.destinations.forEach(({destinationConnector:i})=>{i.sources.filterInPlace(({sourceConnector:s})=>s.parentNode.id!==e)}),o.destinations=new P})})}getAllSourceConnectors(e){return this.nodes.has(e)?this.nodes.get(e).getAllSourceConnectors():[]}getAllDestinationConnectors(e){return this.nodes.has(e)?this.nodes.get(e).getAllDestinationConnectors():[]}getAllSourceConnections(e){return this.nodes.has(e)?this.nodes.get(e).getAllSourceConnections():[]}getAllDestinationConnections(e){return this.nodes.has(e)?this.nodes.get(e).getAllDestinationConnections():[]}getNextFreeNodeId(){let e="0";for(let t=1;this.nodes.has(e);++t)e=t.toString();return e}addConnection(e,t=!0){const{sourceNodeId:o,sourceConnectorId:i,destinationNodeId:s,destinationConnectorId:c,css:r}=e;if(!this.nodes.has(o)||!this.nodes.has(s))return;const a=this.nodes.get(o),l=this.nodes.get(s),d=a.getConnector(i),h=l.getConnector(c);if(!d||!h||d.destinations.some(v=>v.destinationConnector===h))return;const f=D.evaluateHistoryGroup(t);if(f){const v=this.id;this.changes.addChange({type:"add",source:"connection",applyChange:()=>this.addConnection(e,!1),undoChange:()=>p.get().getNodeflow(v)?.removeConnection(o,i,s,c,!1),historyGroup:f})}d.destinations.push(new Tt({destinationConnector:h,css:r??{}})),h.sources.push(new Bt({sourceConnector:d}))}removeConnection(e,t,o,i,s=!0){if(!this.nodes.has(e)||!this.nodes.has(o))return;const c=this.nodes.get(e),r=this.nodes.get(o),a=c.getConnector(t),l=r.getConnector(i);if(!a||!l)return;const d=D.evaluateHistoryGroup(s);if(d){const h=a.destinations.find(K=>K.destinationConnector.parentNode.id===o)?.css,f=this.id,v=()=>{p.get().getNodeflow(f)?.addConnection({sourceNodeId:e,sourceConnectorId:t,destinationNodeId:o,destinationConnectorId:i,css:h},!1)},M=()=>{p.get().getNodeflow(f)?.removeConnection(e,t,o,i,!1)};this.changes.addChange({type:"remove",source:"connection",applyChange:M,undoChange:v,historyGroup:d})}a.destinations.filterInPlace(h=>h.destinationConnector.parentNode.id!==o),l.sources.filterInPlace(h=>h.sourceConnector.parentNode.id!==e)}updateHeldNodePosition(e){this.mouseData.heldNodes.forEach(t=>t.node.updateWithPrevious(o=>({position:o.position.add(e)})))}setupDefaultEventHandlers(){this.eventStore.onNodeConnected.subscribeMultiple([{name:"nodeflow:create-connection",event:e=>this.addConnection({sourceNodeId:e.inputNodeId,sourceConnectorId:e.inputId,destinationNodeId:e.outputNodeId,destinationConnectorId:e.outputId})},{name:"nodeflow:reset-mouse-data",event:()=>this.mouseData.reset()}]),this.eventStore.onMouseMoveInNodeflow.subscribeMultiple([{name:"nodeflow:update-background-position",event:({event:e})=>{this.updateBackgroundPosition(u.of(e.movementX,e.movementY))}}]),this.eventStore.onPointerUpInNodeflow.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>{e.stopPropagation(),e.preventDefault()}},{name:"nodeflow:reset-mouse-data",event:()=>{this.mouseData.pointerDown=!1,this.mouseData.heldConnectors.length===1&&this.mouseData.clearSelectedByType("node"),this.mouseData.clearSelectedByType("connector")}}]),this.eventStore.onTouchStartInNodeflow.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()},{name:"nodeflow:clear-held-keys",event:({event:e})=>{e.touches.length===1&&this.keyboardData.clearKeys()}},{name:"nodeflow:handle-pinch",event:({event:e})=>{const{touches:t}=e;if(t.length!==2)return;const{pageX:o,pageY:i}=e.touches[0],{pageX:s,pageY:c}=e.touches[1];this.pinchDistance=Math.hypot(o-s,i-c)}},{name:"nodeflow:update-mouse-data",event:({event:e})=>{const{touches:t}=e;if(t.length!==1)return;const o=t[0],i=u.fromEvent(o);this.mouseData.clearSelectedByType("node"),this.mouseData.update({pointerDown:!0,mousePosition:i,clickStartPosition:u.of(i.x/this.zoomLevel-this.position.x,i.y/this.zoomLevel-this.position.y)})}}]),this.eventStore.onTouchMoveInNodeflow.subscribeMultiple([{name:"nodeflow:handle-pinch",event:({event:e})=>{const{touches:t}=e;if(t.length!==2)return;const{pageX:o,pageY:i}=t[0],{pageX:s,pageY:c}=t[1],r=Math.hypot(o-s,i-c),a=u.of((o+s)/2,(i+c)/2);this.settings.canZoom&&this.updateZoom(r-this.pinchDistance,a),this.pinchDistance=r}},{name:"nodeflow:update-mouse-data",event:({event:e})=>{const{touches:t}=e;t.length===1&&this.mouseData.updateWithPrevious(o=>{const i=u.fromEvent(t[0]);return this.updateBackgroundPosition(i.subtract(o.mousePosition)),{mousePosition:i}})}}]),this.eventStore.onKeyUpInNodeflow.subscribe("nodeflow:remove-held-key",({event:e})=>this.keyboardData.releaseKey(e.code)),this.eventStore.onKeyDownInNodeflow.subscribeMultiple([{name:"nodeflow:add-held-key",event:({event:e})=>this.keyboardData.pressKey(e.code),priority:10},{name:"nodeflow:handle-controls",event:({event:e})=>{switch(e.code){case"Delete":if(this.mouseData.heldNodes.length>0&&this.settings.canDeleteNodes){const t=D.evaluateHistoryGroup();this.mouseData.heldNodes.forEach(o=>this.removeNode(o.node.id,t))}else if(this.mouseData.heldConnections.length>0&&this.settings.canDeleteConnections){const t=D.evaluateHistoryGroup();this.mouseData.heldConnections.forEach(o=>this.removeConnection(o.connection.sourceConnector.parentNode.id,o.connection.sourceConnector.id,o.connection.destinationConnector.parentSection.parentNode.id,o.connection.destinationConnector.id,t))}break;case"Escape":this.mouseData.clearSelections();break;case"Space":this.settings.debugMode&&(this.mouseData.heldNodes.length>0?console.log(this.mouseData.heldNodes):console.log(this.nodes));break;case"Equal":case"Minus":if(e.ctrlKey){if(!this.settings.canZoom)return;e.preventDefault(),this.updateZoom(this.settings.keyboardZoomMultiplier*(e.code==="Equal"?1:-1),Ce().divideBy(2))}break;case"KeyZ":if(!e.ctrlKey)break;e.preventDefault(),e.shiftKey?this.changes.redo():this.changes.undo();break}}}]),this.eventStore.onWheelInNodeflow.subscribeMultiple([{name:"nodeflow:update-zoom",event:({event:e})=>{this.settings.canZoom&&this.updateZoom(-e.deltaY,u.fromEvent(e))}},{name:"nodeflow:prevent-scroll",event:({event:e})=>{e.preventDefault()}}]),this.eventStore.onMouseDownInNodeflow.subscribeMultiple([{name:"nodeflow:reset-movement",event:({event:e})=>{e.button===V.LEFT&&this.resetMovement()}},{name:"nodeflow:reset-mouse-data",event:({event:e})=>{e.button===V.LEFT&&this.mouseData.clearSelections(),this.mouseData.selectNodeflow(),this.mouseData.update({clickStartPosition:u.of(e.clientX/this.zoomLevel-this.position.x,e.clientY/this.zoomLevel-this.position.y),pointerDown:this.settings.canPan,mousePosition:u.fromEvent(e)})}},{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()}]),this.eventStore.onMouseDownInConnector.blacklist("nodeflow:allow-pan",(e,t)=>e.event.button!==V.LEFT&&t.startsWith("nodeflow")),this.eventStore.onMouseDownInConnector.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()},{name:"nodeflow:start-creating-connection",event:({event:e,nodeId:t,connectorId:o})=>{this.mouseData.startCreatingConnection(t,u.fromEvent(e),o)}}]),this.eventStore.onTouchStartInConnector.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()},{name:"nodeflow:start-creating-connection",event:({event:e,nodeId:t,connectorId:o})=>{const{clientX:i,clientY:s}=e.touches[0];this.mouseData.startCreatingConnection(t,u.of(i,s),o)}}]),this.eventStore.onPointerUpInConnector.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>{e.preventDefault(),e.stopPropagation()},priority:2},{name:"nodeflow:connect-held-nodes",event:({event:e,nodeId:t,connectorId:o})=>{if(!this.settings.canCreateConnections)return;const i=this.mouseData.heldConnectors.at(-1)?.connector,s=i?.parentNode;!i||!s||this.eventStore.onNodeConnected.publish({outputNodeId:s.id,outputId:i.id,inputNodeId:t,inputId:o,event:e})},priority:2},{name:"nodeflow:reset-mouse-data",event:()=>{this.mouseData.pointerDown=!1},priority:1}]),this.eventStore.onMouseDownInNode.blacklist("nodeflow:allow-pan",(e,t)=>e.event.button!==V.LEFT&&t.startsWith("nodeflow")),this.eventStore.onMouseDownInNode.subscribeMultiple([{name:"nodeflow:select-node",event:({event:e,nodeId:t})=>{this.keyboardData.isActionPressed(this.keymap.SELECT_MULTIPLE)||this.mouseData.clearSelections(),this.mouseData.selectNode(t,u.fromEvent(e),this.settings.canMoveNodes)}},{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()}]),this.eventStore.onTouchStartInNode.subscribeMultiple([{name:"nodeflow:select-node",event:({event:e,nodeId:t})=>{const{clientX:o,clientY:i}=e.touches[0];this.keyboardData.isActionPressed(this.keymap.SELECT_MULTIPLE)||this.mouseData.clearSelections(),this.mouseData.selectNode(t,u.of(o,i),this.settings.canMoveNodes)}},{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()}]),this.eventStore.onPointerDownInNodeCurve.blacklist("nodeflow:allow-pan",(e,t)=>e.event.button!==V.LEFT&&t.startsWith("nodeflow")),this.eventStore.onPointerDownInNodeCurve.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>{e.preventDefault(),e.stopPropagation()},priority:1},{name:"nodeflow:update-mouse-data",event:({event:e,sourceConnector:t,destinationConnector:o})=>{this.mouseData.pointerDown=!0,this.mouseData.mousePosition=u.fromEvent(e),this.keyboardData.isActionPressed(this.keymap.SELECT_MULTIPLE)||this.mouseData.clearSelections(),this.mouseData.selections.push({type:"connection",connection:{sourceConnector:t,destinationConnector:o}})}}]),this.eventStore.onPointerUpInNode.subscribeMultiple([{name:"nodeflow:reset-mouse-data",event:()=>{this.mouseData.pointerDown=!1,this.mouseData.heldConnectors.length===1&&this.mouseData.clearSelectedByType("node"),this.mouseData.clearSelectedByType("connector")}},{name:"nodeflow:stop-propagation",event:({event:e})=>{e.stopPropagation(),e.preventDefault()}}])}selectNode(e,t){this.mouseData.selectNode(e,t??u.zero(),!1)}}const Wt="_connection_gh35w_1",Ht="_selectedConnection_gh35w_16",jt="_newConnection_gh35w_27",se={connection:Wt,selectedConnection:Ht,newConnection:jt},Rt="_node_zneqc_1",Zt="_selectedNode_zneqc_19",Yt="_inputConnector_zneqc_41",Xt="_outputConnector_zneqc_54",qt="_inputsSection_zneqc_67",Vt="_outputsSection_zneqc_78",G={node:Rt,selectedNode:Zt,inputConnector:Yt,outputConnector:Xt,inputsSection:qt,outputsSection:Vt},Qt="_nodeflow_1ic3z_1",Jt={nodeflow:Qt},en=x("<div><p></p><p>"),tn=n=>(()=>{const e=en(),t=e.firstChild,o=t.nextSibling;return e.style.setProperty("padding","1rem"),e.style.setProperty("padding-left","2rem"),N(t,()=>n.node.position.x.toFixed(2)),N(o,()=>n.node.position.y.toFixed(2)),e})(),ct=(n,e,t=!1)=>{const o=crypto.randomUUID(),i=n.addNode({css:{normal:G.node,selected:G.selectedNode},position:e,display:tn,centered:t},o),s=i.addConnectorSection("inputs",G.inputsSection,o),c=i.addConnectorSection("outputs",G.outputsSection,o),r=Math.random()*6;for(let l=0;l<r;l++)c.addConnector({css:G.outputConnector},o);const a=Math.random()*6;for(let l=0;l<a;l++)s.addConnector({css:G.inputConnector},o);return i},nn=n=>{n.eventStore.onNodeConnected.subscribe("create-connection",e=>{e.outputNodeId!==e.inputNodeId&&n.addConnection({sourceNodeId:e.outputNodeId,sourceConnectorId:e.outputId,destinationNodeId:e.inputNodeId,destinationConnectorId:e.inputId,css:{normal:se.connection,selected:se.selectedConnection}})})},on=(n,e=50)=>{for(let t=0;t<e;t++)ct(n,u.of(Math.random()*2e3,Math.random()*2e3))},sn=n=>{const e=n.nodes.size;for(let t=0;t<e;t++){const o=Math.floor(Math.random()*e),i=Math.floor(Math.random()*e);if(!n.nodes.has(o.toString())||!n.nodes.has(i.toString()))continue;const s=n.nodes.get(o.toString()),c=n.nodes.get(i.toString()),r=s.connectorSections.get("outputs").connectors,a=c.connectorSections.get("inputs").connectors,l=Array.from(r.values()),d=Array.from(a.values());if(l.length===0||d.length===0)continue;const h=l[Math.floor(Math.random()*l.length)],f=d[Math.floor(Math.random()*d.length)];o===i||c.getTotalConnectedInputs(f.toString())>0||n.addConnection({sourceNodeId:o.toString(),sourceConnectorId:h.id,destinationNodeId:i.toString(),destinationConnectorId:f.id,css:{normal:se.connection,selected:se.selectedConnection}})}};class rn extends it{calculateCurveAnchors(e,t,o,i){const s=this.getHorizontalCurve(e,t),c=e.add(s),r=t.subtract(s);return{anchorStart:c,anchorEnd:r}}}const cn=x("<div>"),an=x("<div><div><div>Generic node"),ln=()=>{const[n,e]=X(void 0),[t,o]=p.get().createCanvas("main",{},s=>new rn(s)),i=s=>{if(!n())return;e(void 0);const c=u.fromEvent(s.event),r=t.startPosition,a=t.size;if(!c.isWithinRect(r,a))return;const l=c.subtract(r).divideBy(t.zoomLevel).subtract(t.position);ct(t,l,!0)};return dt(()=>{nn(t),on(t),sn(t),p.get().globalEventStore.onPointerUpInDocument.subscribe("create-node",i)}),(()=>{const s=an(),c=s.firstChild,r=c.firstChild;return s.style.setProperty("display","flex"),s.style.setProperty("flex-direction","column-reverse"),N(s,w(o,{get css(){return{newCurve:se.newConnection,nodeflow:Jt.nodeflow}},height:"100%",width:"100%"}),c),c.style.setProperty("width","100%"),c.style.setProperty("min-height","300px"),c.style.setProperty("background-color","gray"),c.style.setProperty("opacity","0.5"),c.style.setProperty("display","flex"),c.style.setProperty("align-items","center"),c.style.setProperty("justify-content","center"),r.$$pointerdown=()=>{e("Generic node")},r.style.setProperty("width","150px"),r.style.setProperty("height","90px"),r.style.setProperty("display","flex"),r.style.setProperty("align-items","center"),r.style.setProperty("justify-content","center"),N(s,w(Ne,{get when(){return n()},get children(){const a=cn();return a.style.setProperty("position","absolute"),a.style.setProperty("width","150px"),a.style.setProperty("height","90px"),a.style.setProperty("display","flex"),a.style.setProperty("align-items","center"),a.style.setProperty("justify-content","center"),a.style.setProperty("z-index","1000"),N(a,n),b(l=>{const d=`${t.mouseData.mousePosition.x-75}px`,h=`${t.mouseData.mousePosition.y-45}px`,f=G.node;return d!==l._v$&&((l._v$=d)!=null?a.style.setProperty("left",d):a.style.removeProperty("left")),h!==l._v$2&&((l._v$2=h)!=null?a.style.setProperty("top",h):a.style.removeProperty("top")),f!==l._v$3&&te(a,l._v$3=f),l},{_v$:void 0,_v$2:void 0,_v$3:void 0}),a}}),null),b(a=>{const l=`${Ce().x}px`,d=`${Ce().y}px`,h=G.node;return l!==a._v$4&&((a._v$4=l)!=null?s.style.setProperty("width",l):s.style.removeProperty("width")),d!==a._v$5&&((a._v$5=d)!=null?s.style.setProperty("height",d):s.style.removeProperty("height")),h!==a._v$6&&te(r,a._v$6=h),a},{_v$4:void 0,_v$5:void 0,_v$6:void 0}),s})()};re(["pointerdown"]);const dn=document.getElementById("root");Ct(()=>w(ln,{}),dn);
