(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();const Ht=(t,e)=>t===e,ce=Symbol("solid-proxy"),He=Symbol("solid-track"),Pe={equals:Ht};let bt=Et;const se=1,ze=2,St={owned:null,cleanups:null,context:null,owner:null};var $=null;let Re=null,Wt=null,_=null,K=null,J=null,Ke=0;function Me(t,e){const n=_,o=$,s=t.length===0,i=e===void 0?o:e,r=s?St:{owned:null,cleanups:null,context:i?i.context:null,owner:i},a=s?t:()=>t(()=>te(()=>Ne(r)));$=r,_=null;try{return Ce(a,!0)}finally{_=n,$=o}}function de(t,e){e=e?Object.assign({},Pe,e):Pe;const n={value:t,observers:null,observerSlots:null,comparator:e.equals||void 0},o=s=>(typeof s=="function"&&(s=s(n.value)),Mt(n,s));return[It.bind(n),o]}function M(t,e,n){const o=Ze(t,e,!1,se);Ie(o)}function De(t,e,n){bt=Zt;const o=Ze(t,e,!1,se);o.user=!0,J?J.push(o):Ie(o)}function z(t,e,n){n=n?Object.assign({},Pe,n):Pe;const o=Ze(t,e,!0,0);return o.observers=null,o.observerSlots=null,o.comparator=n.equals||void 0,Ie(o),It.bind(o)}function Ee(t){return Ce(t,!1)}function te(t){if(_===null)return t();const e=_;_=null;try{return t()}finally{_=e}}function Yt(t){De(()=>te(t))}function Ve(t){return $===null||($.cleanups===null?$.cleanups=[t]:$.cleanups.push(t)),t}function Ae(){return _}function It(){if(this.sources&&this.state)if(this.state===se)Ie(this);else{const t=K;K=null,Ce(()=>Oe(this),!1),K=t}if(_){const t=this.observers?this.observers.length:0;_.sources?(_.sources.push(this),_.sourceSlots.push(t)):(_.sources=[this],_.sourceSlots=[t]),this.observers?(this.observers.push(_),this.observerSlots.push(_.sources.length-1)):(this.observers=[_],this.observerSlots=[_.sources.length-1])}return this.value}function Mt(t,e,n){let o=t.value;return(!t.comparator||!t.comparator(o,e))&&(t.value=e,t.observers&&t.observers.length&&Ce(()=>{for(let s=0;s<t.observers.length;s+=1){const i=t.observers[s],r=Re&&Re.running;r&&Re.disposed.has(i),(r?!i.tState:!i.state)&&(i.pure?K.push(i):J.push(i),i.observers&&_t(i)),r||(i.state=se)}if(K.length>1e6)throw K=[],new Error},!1)),e}function Ie(t){if(!t.fn)return;Ne(t);const e=Ke;jt(t,t.value,e)}function jt(t,e,n){let o;const s=$,i=_;_=$=t;try{o=t.fn(e)}catch(r){return t.pure&&(t.state=se,t.owned&&t.owned.forEach(Ne),t.owned=null),t.updatedAt=n+1,xt(r)}finally{_=i,$=s}(!t.updatedAt||t.updatedAt<=n)&&(t.updatedAt!=null&&"observers"in t?Mt(t,o):t.value=o,t.updatedAt=n)}function Ze(t,e,n,o=se,s){const i={fn:t,state:o,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:$,context:$?$.context:null,pure:n};return $===null||$!==St&&($.owned?$.owned.push(i):$.owned=[i]),i}function $e(t){if(t.state===0)return;if(t.state===ze)return Oe(t);if(t.suspense&&te(t.suspense.inFallback))return t.suspense.effects.push(t);const e=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<Ke);)t.state&&e.push(t);for(let n=e.length-1;n>=0;n--)if(t=e[n],t.state===se)Ie(t);else if(t.state===ze){const o=K;K=null,Ce(()=>Oe(t,e[0]),!1),K=o}}function Ce(t,e){if(K)return t();let n=!1;e||(K=[]),J?n=!0:J=[],Ke++;try{const o=t();return Vt(n),o}catch(o){n||(J=null),K=null,xt(o)}}function Vt(t){if(K&&(Et(K),K=null),t)return;const e=J;J=null,e.length&&Ce(()=>bt(e),!1)}function Et(t){for(let e=0;e<t.length;e++)$e(t[e])}function Zt(t){let e,n=0;for(e=0;e<t.length;e++){const o=t[e];o.user?t[n++]=o:$e(o)}for(e=0;e<n;e++)$e(t[e])}function Oe(t,e){t.state=0;for(let n=0;n<t.sources.length;n+=1){const o=t.sources[n];if(o.sources){const s=o.state;s===se?o!==e&&(!o.updatedAt||o.updatedAt<Ke)&&$e(o):s===ze&&Oe(o,e)}}}function _t(t){for(let e=0;e<t.observers.length;e+=1){const n=t.observers[e];n.state||(n.state=ze,n.pure?K.push(n):J.push(n),n.observers&&_t(n))}}function Ne(t){let e;if(t.sources)for(;t.sources.length;){const n=t.sources.pop(),o=t.sourceSlots.pop(),s=n.observers;if(s&&s.length){const i=s.pop(),r=n.observerSlots.pop();o<s.length&&(i.sourceSlots[r]=o,s[o]=i,n.observerSlots[o]=r)}}if(t.tOwned){for(e=t.tOwned.length-1;e>=0;e--)Ne(t.tOwned[e]);delete t.tOwned}if(t.owned){for(e=t.owned.length-1;e>=0;e--)Ne(t.owned[e]);t.owned=null}if(t.cleanups){for(e=t.cleanups.length-1;e>=0;e--)t.cleanups[e]();t.cleanups=null}t.state=0}function Xt(t){return t instanceof Error?t:new Error(typeof t=="string"?t:"Unknown error",{cause:t})}function xt(t,e=$){throw Xt(t)}const qt=Symbol("fallback");function at(t){for(let e=0;e<t.length;e++)t[e]()}function Qt(t,e,n={}){let o=[],s=[],i=[],r=0,a=e.length>1?[]:null;return Ve(()=>at(i)),()=>{let c=t()||[],d=c.length,u,l;return c[He],te(()=>{let m,g,k,A,Z,R,T,L,C;if(d===0)r!==0&&(at(i),i=[],o=[],s=[],r=0,a&&(a=[])),n.fallback&&(o=[qt],s[0]=Me(Y=>(i[0]=Y,n.fallback())),r=1);else if(r===0){for(s=new Array(d),l=0;l<d;l++)o[l]=c[l],s[l]=Me(f);r=d}else{for(k=new Array(d),A=new Array(d),a&&(Z=new Array(d)),R=0,T=Math.min(r,d);R<T&&o[R]===c[R];R++);for(T=r-1,L=d-1;T>=R&&L>=R&&o[T]===c[L];T--,L--)k[L]=s[T],A[L]=i[T],a&&(Z[L]=a[T]);for(m=new Map,g=new Array(L+1),l=L;l>=R;l--)C=c[l],u=m.get(C),g[l]=u===void 0?-1:u,m.set(C,l);for(u=R;u<=T;u++)C=o[u],l=m.get(C),l!==void 0&&l!==-1?(k[l]=s[u],A[l]=i[u],a&&(Z[l]=a[u]),l=g[l],m.set(C,l)):i[u]();for(l=R;l<d;l++)l in k?(s[l]=k[l],i[l]=A[l],a&&(a[l]=Z[l],a[l](l))):s[l]=Me(f);s=s.slice(0,r=d),o=c.slice(0)}return s});function f(m){if(i[l]=m,a){const[g,k]=de(l);return a[l]=k,e(c[l],g)}return e(c[l])}}}function w(t,e){return te(()=>t(e||{}))}const Jt=t=>`Stale read from <${t}>.`;function ae(t){const e="fallback"in t&&{fallback:()=>t.fallback};return z(Qt(()=>t.each,t.children,e||void 0))}function H(t){const e=t.keyed,n=z(()=>t.when,void 0,{equals:(o,s)=>e?o===s:!o==!s});return z(()=>{const o=n();if(o){const s=t.children;return typeof s=="function"&&s.length>0?te(()=>s(e?o:()=>{if(!te(n))throw Jt("Show");return t.when})):s}return t.fallback},void 0,void 0)}function en(t,e,n){let o=n.length,s=e.length,i=o,r=0,a=0,c=e[s-1].nextSibling,d=null;for(;r<s||a<i;){if(e[r]===n[a]){r++,a++;continue}for(;e[s-1]===n[i-1];)s--,i--;if(s===r){const u=i<o?a?n[a-1].nextSibling:n[i-a]:c;for(;a<i;)t.insertBefore(n[a++],u)}else if(i===a)for(;r<s;)(!d||!d.has(e[r]))&&e[r].remove(),r++;else if(e[r]===n[i-1]&&n[a]===e[s-1]){const u=e[--s].nextSibling;t.insertBefore(n[a++],e[r++].nextSibling),t.insertBefore(n[--i],u),e[s]=n[i]}else{if(!d){d=new Map;let l=a;for(;l<i;)d.set(n[l],l++)}const u=d.get(e[r]);if(u!=null)if(a<u&&u<i){let l=r,f=1,m;for(;++l<s&&l<i&&!((m=d.get(e[l]))==null||m!==u+f);)f++;if(f>u-a){const g=e[r];for(;a<u;)t.insertBefore(n[a++],g)}else t.replaceChild(n[a++],e[r++])}else r++;else e[r++].remove()}}}const ct="_$DX_DELEGATE";function tn(t,e,n,o={}){let s;return Me(i=>{s=i,e===document?t():b(e,t(),e.firstChild?null:void 0,n)},o.owner),()=>{s(),e.textContent=""}}function N(t,e,n){let o;const s=()=>{const r=document.createElement("template");return r.innerHTML=t,n?r.content.firstChild.firstChild:r.content.firstChild},i=e?()=>te(()=>document.importNode(o||(o=s()),!0)):()=>(o||(o=s())).cloneNode(!0);return i.cloneNode=i,i}function ie(t,e=window.document){const n=e[ct]||(e[ct]=new Set);for(let o=0,s=t.length;o<s;o++){const i=t[o];n.has(i)||(n.add(i),e.addEventListener(i,nn))}}function x(t,e,n){n==null?t.removeAttribute(e):t.setAttribute(e,n)}function S(t,e){e==null?t.removeAttribute("class"):t.className=e}function be(t,e,n={}){const o=Object.keys(e||{}),s=Object.keys(n);let i,r;for(i=0,r=s.length;i<r;i++){const a=s[i];!a||a==="undefined"||e[a]||(dt(t,a,!1),delete n[a])}for(i=0,r=o.length;i<r;i++){const a=o[i],c=!!e[a];!a||a==="undefined"||n[a]===c||!c||(dt(t,a,!0),n[a]=c)}return n}function Xe(t,e,n){return te(()=>t(e,n))}function b(t,e,n,o){if(n!==void 0&&!o&&(o=[]),typeof e!="function")return Te(t,e,o,n);M(s=>Te(t,e(),s,n),o)}function dt(t,e,n){const o=e.trim().split(/\s+/);for(let s=0,i=o.length;s<i;s++)t.classList.toggle(o[s],n)}function nn(t){let e=t.target;const n=`$$${t.type}`,o=t.target,s=t.currentTarget,i=c=>Object.defineProperty(t,"target",{configurable:!0,value:c}),r=()=>{const c=e[n];if(c&&!e.disabled){const d=e[`${n}Data`];if(d!==void 0?c.call(e,d,t):c.call(e,t),t.cancelBubble)return}return e.host&&typeof e.host!="string"&&!e.host._$host&&e.contains(t.target)&&i(e.host),!0},a=()=>{for(;r()&&(e=e._$host||e.parentNode||e.host););};if(Object.defineProperty(t,"currentTarget",{configurable:!0,get(){return e||document}}),t.composedPath){const c=t.composedPath();i(c[0]);for(let d=0;d<c.length-2&&(e=c[d],!!r());d++){if(e._$host){e=e._$host,a();break}if(e.parentNode===s)break}}else a();i(o)}function Te(t,e,n,o,s){for(;typeof n=="function";)n=n();if(e===n)return n;const i=typeof e,r=o!==void 0;if(t=r&&n[0]&&n[0].parentNode||t,i==="string"||i==="number"){if(i==="number"&&(e=e.toString(),e===n))return n;if(r){let a=n[0];a&&a.nodeType===3?a.data!==e&&(a.data=e):a=document.createTextNode(e),n=le(t,n,o,a)}else n!==""&&typeof n=="string"?n=t.firstChild.data=e:n=t.textContent=e}else if(e==null||i==="boolean")n=le(t,n,o);else{if(i==="function")return M(()=>{let a=e();for(;typeof a=="function";)a=a();n=Te(t,a,n,o)}),()=>n;if(Array.isArray(e)){const a=[],c=n&&Array.isArray(n);if(We(a,e,n,s))return M(()=>n=Te(t,a,n,o,!0)),()=>n;if(a.length===0){if(n=le(t,n,o),r)return n}else c?n.length===0?lt(t,a,o):en(t,n,a):(n&&le(t),lt(t,a));n=a}else if(e.nodeType){if(Array.isArray(n)){if(r)return n=le(t,n,o,e);le(t,n,null,e)}else n==null||n===""||!t.firstChild?t.appendChild(e):t.replaceChild(e,t.firstChild);n=e}}return n}function We(t,e,n,o){let s=!1;for(let i=0,r=e.length;i<r;i++){let a=e[i],c=n&&n[t.length],d;if(!(a==null||a===!0||a===!1))if((d=typeof a)=="object"&&a.nodeType)t.push(a);else if(Array.isArray(a))s=We(t,a,c)||s;else if(d==="function")if(o){for(;typeof a=="function";)a=a();s=We(t,Array.isArray(a)?a:[a],Array.isArray(c)?c:[c])||s}else t.push(a),s=!0;else{const u=String(a);c&&c.nodeType===3&&c.data===u?t.push(c):t.push(document.createTextNode(u))}}return s}function lt(t,e,n=null){for(let o=0,s=e.length;o<s;o++)t.insertBefore(e[o],n)}function le(t,e,n,o){if(n===void 0)return t.textContent="";const s=o||document.createTextNode("");if(e.length){let i=!1;for(let r=e.length-1;r>=0;r--){const a=e[r];if(s!==a){const c=a.parentNode===t;!i&&!r?c?t.replaceChild(s,a):t.insertBefore(s,n):c&&a.remove()}else i=!0}}else t.insertBefore(s,n);return[s]}const Fe=Symbol("store-raw"),pe=Symbol("store-node"),q=Symbol("store-has"),kt=Symbol("store-self");function Pt(t){let e=t[ce];if(!e&&(Object.defineProperty(t,ce,{value:e=new Proxy(t,rn)}),!Array.isArray(t))){const n=Object.keys(t),o=Object.getOwnPropertyDescriptors(t);for(let s=0,i=n.length;s<i;s++){const r=n[s];o[r].get&&Object.defineProperty(t,r,{enumerable:o[r].enumerable,get:o[r].get.bind(e)})}}return e}function ge(t){let e;return t!=null&&typeof t=="object"&&(t[ce]||!(e=Object.getPrototypeOf(t))||e===Object.prototype||Array.isArray(t))}function ve(t,e=new Set){let n,o,s,i;if(n=t!=null&&t[Fe])return n;if(!ge(t)||e.has(t))return t;if(Array.isArray(t)){Object.isFrozen(t)?t=t.slice(0):e.add(t);for(let r=0,a=t.length;r<a;r++)s=t[r],(o=ve(s,e))!==s&&(t[r]=o)}else{Object.isFrozen(t)?t=Object.assign({},t):e.add(t);const r=Object.keys(t),a=Object.getOwnPropertyDescriptors(t);for(let c=0,d=r.length;c<d;c++)i=r[c],!a[i].get&&(s=t[i],(o=ve(s,e))!==s&&(t[i]=o))}return t}function Le(t,e){let n=t[e];return n||Object.defineProperty(t,e,{value:n=Object.create(null)}),n}function Se(t,e,n){if(t[e])return t[e];const[o,s]=de(n,{equals:!1,internal:!0});return o.$=s,t[e]=o}function on(t,e){const n=Reflect.getOwnPropertyDescriptor(t,e);return!n||n.get||!n.configurable||e===ce||e===pe||(delete n.value,delete n.writable,n.get=()=>t[ce][e]),n}function zt(t){Ae()&&Se(Le(t,pe),kt)()}function sn(t){return zt(t),Reflect.ownKeys(t)}const rn={get(t,e,n){if(e===Fe)return t;if(e===ce)return n;if(e===He)return zt(t),n;const o=Le(t,pe),s=o[e];let i=s?s():t[e];if(e===pe||e===q||e==="__proto__")return i;if(!s){const r=Object.getOwnPropertyDescriptor(t,e);Ae()&&(typeof i!="function"||t.hasOwnProperty(e))&&!(r&&r.get)&&(i=Se(o,e,i)())}return ge(i)?Pt(i):i},has(t,e){return e===Fe||e===ce||e===He||e===pe||e===q||e==="__proto__"?!0:(Ae()&&Se(Le(t,q),e)(),e in t)},set(){return!0},deleteProperty(){return!0},ownKeys:sn,getOwnPropertyDescriptor:on};function me(t,e,n,o=!1){if(!o&&t[e]===n)return;const s=t[e],i=t.length;n===void 0?(delete t[e],t[q]&&t[q][e]&&s!==void 0&&t[q][e].$()):(t[e]=n,t[q]&&t[q][e]&&s===void 0&&t[q][e].$());let r=Le(t,pe),a;if((a=Se(r,e,s))&&a.$(()=>n),Array.isArray(t)&&t.length!==i){for(let c=t.length;c<i;c++)(a=r[c])&&a.$();(a=Se(r,"length",i))&&a.$(t.length)}(a=r[kt])&&a.$()}function At(t,e){const n=Object.keys(e);for(let o=0;o<n.length;o+=1){const s=n[o];me(t,s,e[s])}}function an(t,e){if(typeof e=="function"&&(e=e(t)),e=ve(e),Array.isArray(e)){if(t===e)return;let n=0,o=e.length;for(;n<o;n++){const s=e[n];t[n]!==s&&me(t,n,s)}me(t,"length",o)}else At(t,e)}function we(t,e,n=[]){let o,s=t;if(e.length>1){o=e.shift();const r=typeof o,a=Array.isArray(t);if(Array.isArray(o)){for(let c=0;c<o.length;c++)we(t,[o[c]].concat(e),n);return}else if(a&&r==="function"){for(let c=0;c<t.length;c++)o(t[c],c)&&we(t,[c].concat(e),n);return}else if(a&&r==="object"){const{from:c=0,to:d=t.length-1,by:u=1}=o;for(let l=c;l<=d;l+=u)we(t,[l].concat(e),n);return}else if(e.length>1){we(t[o],e,[o].concat(n));return}s=t[o],n=[o].concat(n)}let i=e[0];typeof i=="function"&&(i=i(s,n),i===s)||o===void 0&&i==null||(i=ve(i),o===void 0||ge(s)&&ge(i)&&!Array.isArray(i)?At(s,i):me(t,o,i))}function W(...[t,e]){const n=ve(t||{}),o=Array.isArray(n),s=Pt(n);function i(...r){Ee(()=>{o&&r.length===1?an(n,r[0]):we(n,r)})}return[s,i]}const Be=new WeakMap,$t={get(t,e){if(e===Fe)return t;const n=t[e];let o;return ge(n)?Be.get(n)||(Be.set(n,o=new Proxy(n,$t)),o):n},set(t,e,n){return me(t,e,ve(n)),!0},deleteProperty(t,e){return me(t,e,void 0,!0),!0}};function Ye(t){return e=>{if(ge(e)){let n;(n=Be.get(e))||Be.set(e,n=new Proxy(e,$t)),t(n)}return e}}(function(){try{if(typeof document<"u"){var t=document.createElement("style");t.appendChild(document.createTextNode("@layer nodeflow{.nodeflowConnectorSection{position:absolute;display:flex;justify-content:space-evenly;width:0;height:0;top:50%;left:50%}.nodeflowNode{position:absolute;border:1px solid black;-webkit-user-select:none;user-select:none;z-index:1;cursor:grab}.nodeflowSelectionBox{position:absolute;background-color:#0000001a;border:2px solid rgba(0,0,0,.3);border-radius:4px;pointer-events:none;z-index:10}}")),document.head.appendChild(t)}}catch(e){console.error("vite-plugin-css-injected-by-js",e)}})();var cn=Object.defineProperty,dn=(t,e,n)=>e in t?cn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,p=(t,e,n)=>(dn(t,typeof e!="symbol"?e+"":e,n),n),Ot=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)},I=(t,e,n)=>(Ot(t,e,"read from private field"),n?n.call(t):e.get(t)),je=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},ln=(t,e,n,o)=>(Ot(t,e,"write to private field"),e.set(t,n),n);class h{constructor(e,n){p(this,"x"),p(this,"y"),this.x=e,this.y=n}static zero(){return new h(0,0)}static of(e,n){return new h(e,n)}static fromEvent(e){return new h(e.clientX,e.clientY)}static fromVec2(e){return new h(e.x,e.y)}copy(){return h.fromVec2(this)}serialize(){return{x:this.x,y:this.y}}static deserialize(e){return new h(e.x,e.y)}static deserializeOrDefault(e,n=h.zero()){return e?h.deserialize(e):n}add(...e){return e.reduce((n,o)=>new h(n.x+o.x,n.y+o.y),this)}subtract(...e){return e.reduce((n,o)=>new h(n.x-o.x,n.y-o.y),this)}multiply(...e){return e.reduce((n,o)=>new h(n.x*o.x,n.y*o.y),this)}divide(...e){return e.reduce((n,o)=>new h(o.x/n.x,o.y/n.y),this)}negate(){return new h(-this.x,-this.y)}shift(e){return new h(this.x+e,this.y+e)}multiplyBy(e){return new h(this.x*e,this.y*e)}divideBy(e){return new h(this.x/e,this.y/e)}isWithinRect(e,n){return this.x>=e.x&&this.x<=e.x+n.x&&this.y>=e.y&&this.y<=e.y+n.y}distanceTo(e){return Math.hypot(this.x-e.x,this.y-e.y)}abs(){return h.of(Math.abs(this.x),Math.abs(this.y))}equals(e){return this.x===e.x&&this.y===e.y}hashCode(){return`${this.x}:${this.y}`}get magnitude(){return Math.hypot(this.x,this.y)}normalize(){const e=this.magnitude;return e===0?h.zero():new h(this.x/e,this.y/e)}}var un=N("<div>");const hn=t=>(()=>{var e=un();return e.$$pointerup=n=>t.nodeflowData.eventStore.onPointerUpInConnector.publish({event:n,nodeId:t.nodeId,connectorId:t.connectorId}),e.$$touchstart=n=>t.nodeflowData.eventStore.onTouchStartInConnector.publish({event:n,nodeId:t.nodeId,connectorId:t.connectorId}),e.$$mousedown=n=>t.nodeflowData.eventStore.onMouseDownInConnector.publish({event:n,nodeId:t.nodeId,connectorId:t.connectorId}),Xe(n=>setTimeout(()=>{var o,s;if(!n||!t.nodeflowData.nodes.has(t.nodeId))return;const i=t.nodeflowData.nodes.get(t.nodeId).connectorSections.get(t.sectionId).connectors.get(t.connectorId),r=new ResizeObserver(()=>{i.size=h.of(n.offsetWidth,n.offsetHeight)});r.observe(n),i.update({position:h.of((((o=n?.parentElement)==null?void 0:o.offsetLeft)??0)+n.offsetLeft,(((s=n?.parentElement)==null?void 0:s.offsetTop)??0)+n.offsetTop),ref:n,resizeObserver:r,size:h.of(n.offsetWidth,n.offsetHeight)})}),e),M(n=>{var o,s=(o=t.connector)==null?void 0:o.css,i=`connector-${t.connectorId}`;return s!==n.e&&S(e,n.e=s),i!==n.t&&x(e,"id",n.t=i),n},{e:void 0,t:void 0}),e})();ie(["mousedown","touchstart","pointerup"]);var ut=N("<svg><circle r=4 fill=none></svg>",!1,!0),fn=N("<svg><path stroke=black stroke-width=1 fill=transparent>");const pn=t=>{const e=z(()=>{const{mouseData:n,curveFunctions:o}=t.nodeflowData;if(n.heldConnectors.length!==1)return;const s=n.heldConnectors[0],i=s.parentNode,r=s.getCenter(),a=n.globalMousePosition(),{anchorStart:c,anchorEnd:d}=o.calculateCurveAnchors(r,a,i.getCenter(),a);return{start:r,end:a,anchorStart:c,anchorEnd:d,path:o.createDefaultCurvePath(r,a,c,d)}});return(()=>{var n=fn(),o=n.firstChild;return n.style.setProperty("z-index","2"),n.style.setProperty("position","absolute"),n.style.setProperty("width","1px"),n.style.setProperty("height","1px"),n.style.setProperty("pointer-events","none"),n.style.setProperty("overflow","visible"),b(n,w(H,{get when(){return t.nodeflowData.settings.debugMode},get children(){return[(()=>{var s=ut();return M(i=>{var r,a,c=(r=e())==null?void 0:r.anchorStart.x,d=(a=e())==null?void 0:a.anchorStart.y,u=t.css??"";return c!==i.e&&x(s,"cx",i.e=c),d!==i.t&&x(s,"cy",i.t=d),u!==i.a&&x(s,"class",i.a=u),i},{e:void 0,t:void 0,a:void 0}),s})(),(()=>{var s=ut();return M(i=>{var r,a,c=(r=e())==null?void 0:r.anchorEnd.x,d=(a=e())==null?void 0:a.anchorEnd.y,u=t.css??"";return c!==i.e&&x(s,"cx",i.e=c),d!==i.t&&x(s,"cy",i.t=d),u!==i.a&&x(s,"class",i.a=u),i},{e:void 0,t:void 0,a:void 0}),s})()]}}),null),M(s=>{var i,r=(i=e())==null?void 0:i.path,a=t.css;return r!==s.e&&x(o,"d",s.e=r),a!==s.t&&x(o,"class",s.t=a),s},{e:void 0,t:void 0}),n})()};var gn=N("<svg><path stroke=black stroke-width=1 fill=none></svg>",!1,!0),ht=N("<svg><circle r=4 fill=none></svg>",!1,!0);const vn=t=>{const e=z(()=>t.nodeflowData.nodes.get(t.sourceNodeId)),n=z(()=>t.nodeflowData.nodes.get(t.destinationNodeId)),o=z(()=>e().getConnector(t.sourceConnectorId)),s=z(()=>n().getConnector(t.destinationConnectorId)),i=z(()=>{var r,a;return!e()||!n()?-1:((a=(r=o())==null?void 0:r.destinations)==null?void 0:a.findIndex(c=>c.destinationConnector===s()))??-1});return De(()=>{if(i()<0)return;const{curveFunctions:r}=t.nodeflowData,a=e().getConnector(t.sourceConnectorId),c=n().getConnector(t.destinationConnectorId),d=a.getCenter(),u=c.getCenter(),{anchorStart:l,anchorEnd:f}=r.calculateCurveAnchors(d,u,e().getCenter(),n().getCenter());o().destinations.get(i()).path={start:d,end:u,anchorStart:l,anchorEnd:f,path:r.createDefaultCurvePath(d,u,l,f)}}),[(()=>{var r=gn();return r.$$pointerdown=a=>{t.nodeflowData.eventStore.onPointerDownInNodeCurve.publish({event:a,sourceConnector:o(),destinationConnector:s()})},r.style.setProperty("cursor","pointer"),r.style.setProperty("pointer-events","visibleStroke"),M(a=>{var c,d,u,l=(c=o().destinations.get(i()).path)==null?void 0:c.path,f={[((d=t.css)==null?void 0:d.normal)??""]:!0,[((u=t.css)==null?void 0:u.selected)??""]:t.nodeflowData.mouseData.hasSelectedConnection(t.sourceNodeId,t.sourceConnectorId,t.destinationNodeId,t.destinationConnectorId)};return l!==a.e&&x(r,"d",a.e=l),a.t=be(r,f,a.t),a},{e:void 0,t:void 0}),r})(),w(H,{get when(){return t.nodeflowData.settings.debugMode},get children(){return[(()=>{var r=ht();return M(a=>{var c,d,u,l,f,m=(d=(c=o().destinations.get(i()).path)==null?void 0:c.anchorStart)==null?void 0:d.x,g=(l=(u=o().destinations.get(i()).path)==null?void 0:u.anchorStart)==null?void 0:l.y,k=((f=t.css)==null?void 0:f.normal)??"";return m!==a.e&&x(r,"cx",a.e=m),g!==a.t&&x(r,"cy",a.t=g),k!==a.a&&x(r,"class",a.a=k),a},{e:void 0,t:void 0,a:void 0}),r})(),(()=>{var r=ht();return M(a=>{var c,d,u,l,f,m=(d=(c=o().destinations.get(i()).path)==null?void 0:c.anchorEnd)==null?void 0:d.x,g=(l=(u=o().destinations.get(i()).path)==null?void 0:u.anchorEnd)==null?void 0:l.y,k=((f=t.css)==null?void 0:f.normal)??"";return m!==a.e&&x(r,"cx",a.e=m),g!==a.t&&x(r,"cy",a.t=g),k!==a.a&&x(r,"class",a.a=k),a},{e:void 0,t:void 0,a:void 0}),r})()]}})]};ie(["pointerdown"]);var mn=N("<div class=nodeflowNode>"),Cn=N("<div>");const wn=t=>{const e=z(()=>t.nodeflowData.nodes.get(t.nodeId)),[n,o]=de(!1);return Ve(()=>{t.nodeflowData.chunking.removeNodeFromChunk(t.nodeId,e().position),e().resizeObserver&&(e().resizeObserver.disconnect(),Array.from(e().connectorSections.values()).forEach(s=>{Array.from(s.connectors.values()).forEach(i=>{i.resizeObserver&&i.resizeObserver.disconnect()})}))}),(()=>{var s=mn();return s.$$pointerup=i=>t.nodeflowData.eventStore.onPointerUpInNode.publish({event:i,nodeId:t.nodeId}),s.$$touchstart=i=>t.nodeflowData.eventStore.onTouchStartInNode.publish({event:i,nodeId:t.nodeId}),s.$$mousedown=i=>t.nodeflowData.eventStore.onMouseDownInNode.publish({event:i,nodeId:t.nodeId}),Xe(i=>setTimeout(()=>{if(!i)return;const r=new ResizeObserver(()=>{e().update({size:h.of(i.clientWidth,i.clientHeight)}),Array.from(e().connectorSections.values()).forEach(c=>Array.from(c.connectors.values()).forEach(d=>{var u,l;const f=d.ref;f&&(d.position=h.of((((u=f?.parentElement)==null?void 0:u.offsetLeft)??0)+f.offsetLeft,(((l=f?.parentElement)==null?void 0:l.offsetTop)??0)+f.offsetTop))}))});r.observe(i);const a=e().centered?h.of(i.clientWidth,i.clientHeight).divideBy(2):h.zero();e().update({offset:h.of(i.clientLeft,i.clientTop),ref:i,resizeObserver:r,position:e().position.subtract(a),size:h.of(i.clientWidth,i.clientHeight)}),o(!0)}),s),b(s,()=>e().display({node:e()}),null),b(s,w(ae,{get each(){return Array.from(e().connectorSections.entries())},children:([i,r])=>(()=>{var a=Cn();return x(a,"id",`section-${i}`),b(a,w(ae,{get each(){return Array.from(r.connectors.entries())},children:([c,d])=>w(hn,{connector:d,connectorId:c,get nodeId(){return t.nodeId},sectionId:i,get nodeflowData(){return t.nodeflowData}})})),M(c=>be(a,{[r?.css??""]:!0,nodeflowConnectorSection:!0},c)),a})()}),null),M(i=>{var r,a,c,d,u=`${e().position.x}px`,l=`${e().position.y}px`,f=n()?1:0,m=`node-${t.nodeId}`,g={[((a=(r=e())==null?void 0:r.css)==null?void 0:a.normal)??""]:!0,[((d=(c=e())==null?void 0:c.css)==null?void 0:d.selected)??""]:t.nodeflowData.mouseData.hasSelectedNode(t.nodeId)||t.nodeflowData.mouseData.selectionBox.selections.isNodeSelected(t.nodeId)};return u!==i.e&&((i.e=u)!=null?s.style.setProperty("left",u):s.style.removeProperty("left")),l!==i.t&&((i.t=l)!=null?s.style.setProperty("top",l):s.style.removeProperty("top")),f!==i.a&&((i.a=f)!=null?s.style.setProperty("opacity",f):s.style.removeProperty("opacity")),m!==i.o&&x(s,"id",i.o=m),i.i=be(s,g,i.i),i},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),s})()};ie(["mousedown","touchstart","pointerup"]);var yn=N("<div class=nodeflowSelectionBox>");const Dn=t=>{const e=z(()=>t.nodeflowData.mouseData.selectionBox.boundingBox.startPosition()),n=z(()=>t.nodeflowData.mouseData.selectionBox.boundingBox.size.abs());return(()=>{var o=yn();return M(s=>{var i=`${e().x}px`,r=`${e().y}px`,a=`${n().x}px`,c=`${n().y}px`;return i!==s.e&&((s.e=i)!=null?o.style.setProperty("left",i):o.style.removeProperty("left")),r!==s.t&&((s.t=r)!=null?o.style.setProperty("top",r):o.style.removeProperty("top")),a!==s.a&&((s.a=a)!=null?o.style.setProperty("width",a):o.style.removeProperty("width")),c!==s.o&&((s.o=c)!=null?o.style.setProperty("height",c):o.style.removeProperty("height")),s},{e:void 0,t:void 0,a:void 0,o:void 0}),o})()};var Nn=N("<div tabindex=0><div><svg>");const bn=t=>e=>(()=>{var n=Nn(),o=n.firstChild,s=o.firstChild;return n.$$touchmove=i=>t.eventStore.onTouchMoveInNodeflow.publish({event:i}),n.$$touchstart=i=>t.eventStore.onTouchStartInNodeflow.publish({event:i}),n.$$keyup=i=>t.eventStore.onKeyUpInNodeflow.publish({event:i}),n.$$keydown=i=>t.eventStore.onKeyDownInNodeflow.publish({event:i}),n.$$mousedown=i=>t.eventStore.onMouseDownInNodeflow.publish({event:i}),n.addEventListener("wheel",i=>t.eventStore.onWheelInNodeflow.publish({event:i})),n.$$pointerup=i=>t.eventStore.onPointerUpInNodeflow.publish({event:i}),n.$$mousemove=i=>t.eventStore.onMouseMoveInNodeflow.publish({event:i}),Xe(i=>{new ResizeObserver(()=>{t.update({size:h.of(i.clientWidth,i.clientHeight),startPosition:h.of(i.offsetLeft,i.offsetTop)})}).observe(i)},n),n.style.setProperty("overflow","hidden"),o.style.setProperty("position","absolute"),o.style.setProperty("transform-origin","center"),o.style.setProperty("transition","scale 0.1s ease-out"),b(o,w(ae,{get each(){return Array.from(t.nodes.keys())},children:i=>w(wn,{nodeId:i,nodeflowData:t})}),s),s.style.setProperty("z-index","2"),s.style.setProperty("position","absolute"),s.style.setProperty("width","1px"),s.style.setProperty("height","1px"),s.style.setProperty("pointer-events","none"),s.style.setProperty("overflow","visible"),b(s,w(ae,{get each(){return Array.from(t.nodes.entries())},children:([i,r])=>w(ae,{get each(){return r.getAllConnectors()},children:a=>w(ae,{get each(){return a.destinations.array},children:c=>w(vn,{nodeflowData:t,sourceNodeId:i,get sourceConnectorId(){return a.id},get destinationNodeId(){return c.destinationConnector.parentSection.parentNode.id},get destinationConnectorId(){return c.destinationConnector.id},get css(){return c.css}})})})})),b(o,w(H,{get when(){return t.mouseData.heldConnectors.length===1},get children(){return w(pn,{get css(){var i,r;return(r=(i=e?.css)==null?void 0:i.getNewCurveCss)==null?void 0:r.call(i,t.mouseData.heldConnectors.at(0))},nodeflowData:t})}}),null),b(n,w(H,{get when(){return t.mouseData.selectionBox.boundingBox},get children(){return w(Dn,{nodeflowData:t})}}),null),M(i=>{var r,a=`nodeflow-${t.id}`,c=(r=e?.css)==null?void 0:r.nodeflow,d=e.height,u=e.width,l=`scale(${t.zoomLevel}) translate(${t.position.x}px, ${t.position.y}px)`;return a!==i.e&&x(n,"id",i.e=a),c!==i.t&&S(n,i.t=c),d!==i.a&&((i.a=d)!=null?n.style.setProperty("height",d):n.style.removeProperty("height")),u!==i.o&&((i.o=u)!=null?n.style.setProperty("width",u):n.style.removeProperty("width")),l!==i.i&&((i.i=l)!=null?o.style.setProperty("transform",l):o.style.removeProperty("transform")),i},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),n})();ie(["mousemove","pointerup","mousedown","keydown","keyup","touchstart","touchmove"]);class ue{constructor(e){p(this,"store"),this.store=W(e??[])}get array(){return this.store[0]}get length(){return this.store[0].length}at(e){return this.store[0].at(e)}forEach(e){this.store[0].forEach(e)}filter(e){return this.store[0].filter(e)}filterInPlace(e){this.store[1](this.filter(e))}map(e){return this.store[0].map(e)}flatMap(e){return this.store[0].flatMap(e)}find(e){return this.store[0].find(e)}findIndex(e){return this.store[0].findIndex(e)}splice(e,n,...o){this.store[1](this.store[0].splice(e,n,...o))}reduce(e,n){return this.store[0].reduce(e,n)}some(e){return this.store[0].some(e)}every(e){return this.store[0].every(e)}get(e){return this.store[0][e]}set(e,n){this.store[1](e,n)}push(e){this.store[1](this.store[0].length,e)}}class G{constructor(e=-1){p(this,"changes"),p(this,"currentChangeIndex",-1),p(this,"maxChanges"),this.maxChanges=e,this.changes=[]}serialize(){return{changes:this.changes,currentChangeIndex:this.currentChangeIndex,maxChanges:this.maxChanges}}deserialize(e){this.changes=e.changes,this.currentChangeIndex=e.currentChangeIndex,this.maxChanges=e.maxChanges}addChange(e){this.changes=this.changes.slice(0,this.currentChangeIndex+1),this.changes.length===this.maxChanges&&this.changes.shift(),this.changes.push(e),this.currentChangeIndex=this.changes.length-1}undo(){if(this.currentChangeIndex===-1)return!1;const e=this.changes[this.currentChangeIndex].historyGroup;for(;this.currentChangeIndex>-1&&this.changes[this.currentChangeIndex].historyGroup===e;)this.changes[this.currentChangeIndex].undoChange(),this.currentChangeIndex--;return!0}redo(){if(this.currentChangeIndex===this.changes.length-1)return!1;const e=this.changes[this.currentChangeIndex+1].historyGroup;for(;this.currentChangeIndex<this.changes.length-1&&this.changes[this.currentChangeIndex+1].historyGroup===e;)this.currentChangeIndex++,this.changes[this.currentChangeIndex].applyChange();return!0}static evaluateHistoryGroup(e=!0){return typeof e=="boolean"?e?crypto.randomUUID():!1:e}}class Tt{constructor(e){p(this,"nodeflowData"),p(this,"getHorizontalCurve",(n,o)=>h.of((o.x-n.x)/1.5,0)),p(this,"getVerticalCurve",(n,o)=>h.of(0,(o.y-n.y)/1.5)),p(this,"createDefaultCurvePath",(n,o,s,i)=>`M ${n.x} ${n.y} C ${s.x} ${s.y}, ${i.x} ${i.y}, ${o.x} ${o.y}`),this.nodeflowData=e}calculateCurveAnchors(e,n,o,s){const i=e.distanceTo(n)/300,r=o.add(e.subtract(o).multiplyBy(i)),a=s.add(n.subtract(s).multiplyBy(i));return{anchorStart:r,anchorEnd:a}}}class Sn{constructor(e){p(this,"store"),this.store=W(e)}get css(){return this.store[0].css}get destinationConnector(){return this.store[0].destinationConnector}get path(){return this.store[0].path}set css(e){this.store[1]({css:e})}set path(e){this.store[1]({path:e})}set destinationConnector(e){this.store[1]({destinationConnector:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}}const ye=(...t)=>{const e=t[0];return t.slice(1).reduce((n,o)=>new Set([...n].filter(s=>o.has(s))),e)},he=t=>t.size===0,Q=t=>typeof t!="object"||t===null||t===void 0?t:Array.isArray(t)?t.map(Q):typeof t=="object"?Object.fromEntries(Object.entries(t).map(([e,n])=>[e,Q(n)])):t;class qe{constructor(e){p(this,"store"),this.store=W(e)}serialize(){return{css:this.css,hovered:this.hovered,id:this.id,position:this.position.serialize()}}serializeConnections(){return[...this.destinations.map(({destinationConnector:e,css:n})=>({sourceNodeId:this.parentNode.id,sourceConnectorId:this.id,destinationNodeId:e.parentNode.id,destinationConnectorId:e.id,css:Q(n)})),...this.sources.map(({sourceConnector:e})=>{var n;return{sourceNodeId:e.parentNode.id,sourceConnectorId:e.id,destinationNodeId:this.parentNode.id,destinationConnectorId:this.id,css:Q((n=e.destinations.find(o=>o.destinationConnector.parentNode.id===this.parentNode.id))==null?void 0:n.css)}})]}static deserialize(e,n){const o=!e.id||n.connectors.has(e.id)?n.parentNode.getNextFreeConnectorId():e.id;return new qe({css:e.css,destinations:new ue,hovered:e.hovered??!1,id:o,parentSection:n,position:h.deserializeOrDefault(e.position),ref:void 0,resizeObserver:void 0,size:h.zero(),sources:new ue})}get css(){return this.store[0].css}values(){return this.store[0]}get destinations(){return this.store[0].destinations}get hovered(){return this.store[0].hovered}get id(){return this.store[0].id}get parentSection(){return this.store[0].parentSection}get parentNode(){return this.store[0].parentSection.parentNode}get position(){return this.store[0].position}get ref(){return this.store[0].ref}get resizeObserver(){return this.store[0].resizeObserver}get size(){return this.store[0].size}get sources(){return this.store[0].sources}set css(e){this.store[1]({css:e})}set destinations(e){this.store[1]({destinations:e})}set hovered(e){this.store[1]({hovered:e})}set id(e){this.store[1]({id:e})}set parentSection(e){this.store[1]({parentSection:e})}set position(e){this.store[1]({position:e})}set ref(e){this.store[1]({ref:e})}set resizeObserver(e){this.store[1]({resizeObserver:e})}set size(e){this.store[1]({size:e})}set sources(e){this.store[1]({sources:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}removeIncomingConnections(){this.sources.forEach(({sourceConnector:e})=>{e.destinations.filterInPlace(({destinationConnector:n})=>n.parentNode.id!==this.id)}),this.sources=new ue}removeOutgoingConnections(){this.destinations.forEach(({destinationConnector:e})=>{e.sources.filterInPlace(({sourceConnector:n})=>n.parentNode.id!==this.id)}),this.destinations=new ue}getCenter(){const{position:e,offset:n}=this.parentNode;return e.add(n,this.position,this.size.divideBy(2))}}const Ft=class _e{constructor(){p(this,"nodeflows"),p(this,"globalEventStore"),this.nodeflows=new Map,this.globalEventStore={onMouseMoveInDocument:new Ue,onPointerLeaveFromDocument:new Ue,onPointerUpInDocument:new Ue},this.setupDefaultEventHandlers()}static get(){return this.instance||(_e.instance=new _e),_e.instance}createCanvas(...e){const n=new Pn(...e);return this.nodeflows.set(e[0],n),[n,bn(n)]}getNodeflow(e){return this.nodeflows.get(e)}removeNodeflow(e){this.nodeflows.delete(e)}clear(){this.nodeflows.clear()}hasNodeflow(e){return this.nodeflows.has(e)}setupDefaultEventHandlers(){document.onmousemove=e=>this.globalEventStore.onMouseMoveInDocument.publish({event:e}),document.onpointerleave=e=>this.globalEventStore.onPointerLeaveFromDocument.publish({event:e}),document.onpointerup=e=>this.globalEventStore.onPointerUpInDocument.publish({event:e}),this.globalEventStore.onMouseMoveInDocument.subscribeMultiple([{name:"update-mouse-position",event:({event:e})=>{this.nodeflows.forEach(n=>{n.mouseData.mousePosition=h.fromEvent(e)})}}]),this.globalEventStore.onPointerLeaveFromDocument.subscribeMultiple([{name:"reset-mouse-data",event:()=>{this.nodeflows.forEach(e=>{e.mouseData.reset()})}}]),this.globalEventStore.onPointerUpInDocument.subscribeMultiple([])}};p(Ft,"instance");let O=Ft;var In={equals:!1},Mn=In,ne,ft,pt=(ft=class{constructor(t=Map){je(this,ne,void 0),ln(this,ne,new t)}dirty(t){var e;(e=I(this,ne).get(t))==null||e.$$()}dirtyAll(){for(const t of I(this,ne).values())t.$$()}track(t){if(!Ae())return;let e=I(this,ne).get(t);if(e)e.n++;else{const[n,o]=de(void 0,Mn);I(this,ne).set(t,e={$:n,$$:o,n:1})}Ve(()=>{e.n--===1&&queueMicrotask(()=>e.n===0&&I(this,ne).delete(t))}),e.$()}},ne=new WeakMap,ft),oe=Symbol("track-keys"),U,X,gt,ee=(gt=class extends Map{constructor(t){if(super(),je(this,U,new pt),je(this,X,new pt),t)for(const e of t)super.set(e[0],e[1])}has(t){return I(this,U).track(t),super.has(t)}get(t){return I(this,X).track(t),super.get(t)}get size(){return I(this,U).track(oe),super.size}*keys(){for(const t of super.keys())I(this,U).track(t),yield t;I(this,U).track(oe)}*values(){for(const[t,e]of super.entries())I(this,X).track(t),yield e;I(this,U).track(oe)}*entries(){for(const t of super.entries())I(this,X).track(t[0]),yield t;I(this,U).track(oe)}set(t,e){return Ee(()=>{if(super.has(t)){if(super.get(t)===e)return}else I(this,U).dirty(t),I(this,U).dirty(oe);I(this,X).dirty(t),super.set(t,e)}),this}delete(t){const e=super.delete(t);return e&&Ee(()=>{I(this,U).dirty(t),I(this,U).dirty(oe),I(this,X).dirty(t)}),e}clear(){super.size&&Ee(()=>{for(const t of super.keys())I(this,U).dirty(t),I(this,X).dirty(t);super.clear(),I(this,U).dirty(oe)})}forEach(t){I(this,U).track(oe);for(const[e,n]of super.entries())I(this,X).track(e),t(n,e,this)}[Symbol.iterator](){return this.entries()}},U=new WeakMap,X=new WeakMap,gt);class Qe{constructor(e,n){p(this,"store"),p(this,"nodeflowData"),this.nodeflowData=e,this.store=W(n)}serialize(){return{connectors:Object.fromEntries(Array.from(this.connectors.entries()).map(([e,n])=>[e,n.serialize()])),css:this.css,id:this.id}}static deserialize(e,n,o=!0){const s=G.evaluateHistoryGroup(o),i=!e.id||n.connectorSections.has(e.id)?n.getNextFreeConnectorSectionId():e.id,r=new Qe(n.nodeflow,{connectors:new ee,css:e.css,id:i,parentNode:n});for(const[a,c]of Object.entries(e.connectors??{}))r.addConnector({...c,id:a},s);return r}addConnector(e,n=!0){const o=qe.deserialize(e,this);if(this.connectors.has(o.id))return this.connectors.get(o.id);const s=G.evaluateHistoryGroup(n);if(s){const i=o.serialize(),r=this.id,a=i.id,c=this.parentNode.id,d=this.nodeflowData.id;this.nodeflowData.changes.addChange({type:"add",source:"connector",applyChange:()=>{var u,l;(l=(u=O.get().getNodeflow(d))==null?void 0:u.nodes.get(c))==null||l.addConnector(r,i,!1)},undoChange:()=>{var u,l;(l=(u=O.get().getNodeflow(d))==null?void 0:u.nodes.get(c))==null||l.removeConnector(r,a,!1)},historyGroup:s})}return this.connectors.set(o.id,o),o}removeConnector(e,n=!0){if(!this.connectors.has(e))return;const o=this.connectors.get(e),s=G.evaluateHistoryGroup(n);if(s){const i=o.serialize(),r=this.id,a=i.id,c=this.parentNode.id,d=this.nodeflowData.id;this.nodeflowData.changes.addChange({type:"remove",source:"connector",applyChange:()=>{var u,l;(l=(u=O.get().getNodeflow(d))==null?void 0:u.nodes.get(c))==null||l.removeConnector(r,a,!1)},undoChange:()=>{var u,l;(l=(u=O.get().getNodeflow(d))==null?void 0:u.nodes.get(c))==null||l.addConnector(r,i,!1)},historyGroup:s})}this.connectors.delete(e)}get connectors(){return this.store[0].connectors}get css(){return this.store[0].css}get id(){return this.store[0].id}get parentNode(){return this.store[0].parentNode}set connectors(e){this.store[1]({connectors:e})}set css(e){this.store[1]({css:e})}set id(e){this.store[1]({id:e})}set parentNode(e){this.store[1]({parentNode:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}removeIncomingConnections(){this.connectors.forEach(e=>e.removeIncomingConnections())}removeOutgoingConnections(){this.connectors.forEach(e=>e.removeOutgoingConnections())}getSourceConnectors(){return Array.from(this.connectors.values()).flatMap(e=>e.sources.flatMap(n=>n.sourceConnector))}getDestinationConnectors(){return Array.from(this.connectors.values()).flatMap(e=>e.destinations.flatMap(n=>n.destinationConnector))}}class En{constructor(e){p(this,"store"),this.store=W(e)}get sourceConnector(){return this.store[0].sourceConnector}set sourceConnector(e){this.store[1]({sourceConnector:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}}class Lt{constructor(){p(this,"subscriptions",new ee),p(this,"blacklistFilters",new ee)}blacklist(e,n){this.blacklistFilters.set(e,n)}unblacklist(e){this.blacklistFilters.delete(e)}unblacklistMultiple(e){e.forEach(this.unblacklist)}clearBlacklist(){this.blacklistFilters.clear()}subscribe(e,n,o=0){this.subscriptions.set(e,{name:e,event:n,priority:o})}subscribeMultiple(e){e.forEach(({name:n,event:o,priority:s})=>this.subscribe(n,o,s))}unsubscribe(e){this.subscriptions.delete(e)}unsubsribeMultiple(e){e.forEach(this.unsubscribe)}publish(e){Array.from(this.subscriptions.values()).sort((n,o)=>o.priority-n.priority).filter(({name:n,priority:o})=>!Array.from(this.blacklistFilters.values()).some(s=>s(e,n,o))).map(({event:n})=>n).forEach(n=>n(e))}clear(){this.subscriptions.clear()}get size(){return this.subscriptions.size}get isEmpty(){return this.size===0}}class F extends Lt{constructor(e){super(),p(this,"nodeflowData"),this.nodeflowData=e}}class Ue extends Lt{}class _n{constructor(e){p(this,"store"),p(this,"nodeflowData"),this.nodeflowData=e,this.store=W({heldKeys:new Set})}get heldKeys(){return this.store[0].heldKeys}set heldKeys(e){this.store[1]({heldKeys:e})}releaseKey(e){this.store[1](Ye(n=>n.heldKeys.delete(e)))}clearKeys(){this.store[1]({heldKeys:new Set})}pressKey(e){this.store[1](Ye(n=>n.heldKeys.add(e)))}hasKeyPressed(e){return this.heldKeys.has(e)}isActionPressed(e){return!he(ye(this.heldKeys,e))}}var v=(t=>(t.Connector="connector",t.Node="node",t.Nodeflow="nodeflow",t.Connection="connection",t))(v||{});class P{constructor(e){p(this,"connectorsMap",new ee),p(this,"nodesMap",new ee),p(this,"connectionsMap",new ee),p(this,"nodeflowData"),p(this,"_hasSelectedNodeflow",!1),this.nodeflowData=e}static createHash(e){switch(e.type){case v.Connector:return`${e.connector.parentNode.id}-${e.connector.id}`;case v.Node:return`${e.node.id}`;case v.Connection:return`${e.connection.sourceConnector.parentNode.id}-${e.connection.sourceConnector.id}-${e.connection.destinationConnector.parentNode.id}-${e.connection.destinationConnector.id}`;default:return v.Nodeflow}}addNode(e){const n=P.createHash({node:e,type:v.Node});return this.nodesMap.set(n,e)}addConnector(e){const n=P.createHash({connector:e,type:v.Connector});return this.connectorsMap.set(n,e)}addConnection(e){const n=P.createHash(e);return this.connectionsMap.set(n,e)}addNodeflow(){return this._hasSelectedNodeflow=!0,this}add(e){switch(e.type){case v.Connector:return this.addConnector(e.connector);case v.Node:return this.addNode(e.node);case v.Connection:return this.addConnection(e);default:return this.addNodeflow()}}delete(e){const n=P.createHash(e);switch(e.type){case v.Connector:return this.connectorsMap.delete(n);case v.Node:return this.nodesMap.delete(n);case v.Connection:return this.connectionsMap.delete(n);default:return this._hasSelectedNodeflow=!1,this}}has(e){const n=P.createHash(e);switch(e.type){case v.Connector:return this.connectorsMap.has(n);case v.Node:return this.nodesMap.has(n);case v.Connection:return this.connectionsMap.has(n);default:return this._hasSelectedNodeflow}}get(e){const n=P.createHash(e);switch(e.type){case v.Connector:return this.connectorsMap.get(n);case v.Node:return this.nodesMap.get(n);case v.Connection:return this.connectionsMap.get(n);default:return this.nodeflowData}}static serialize(e){switch(e.type){case v.Connector:return{connectorId:e.connector.id,nodeId:e.connector.parentNode.id,type:v.Connector};case v.Node:return{nodeId:e.node.id,type:v.Node};case v.Connection:return{connection:{destinationConnectorId:e.connection.destinationConnector.id,destinationNodeId:e.connection.destinationConnector.parentSection.parentNode.id,sourceConnectorId:e.connection.sourceConnector.id,sourceNodeId:e.connection.sourceConnector.parentNode.id},type:v.Connection};default:return{type:v.Nodeflow}}}static deserialize(e,n){switch(e.type){case v.Connector:{const o=n.nodes.get(e.nodeId);if(!o)throw new Error("Node not found");const s=o.getConnector(e.connectorId);if(!s)throw new Error("Connector not found");return{connector:s,type:v.Connector}}case v.Node:{const o=n.nodes.get(e.nodeId);if(!o)throw new Error("Node not found");return{node:o,type:v.Node}}case v.Connection:{const o=n.nodes.get(e.connection.sourceNodeId);if(!o)throw new Error("Source node not found");const s=o.getConnector(e.connection.sourceConnectorId);if(!s)throw new Error("Source connector not found");const i=n.nodes.get(e.connection.destinationNodeId);if(!i)throw new Error("Destination node not found");const r=i.getConnector(e.connection.destinationConnectorId);if(!r)throw new Error("Destination connector not found");return{connection:{destinationConnector:r,sourceConnector:s},type:v.Connection}}default:return{type:v.Nodeflow}}}toObject(){const e={};return this.connectorsMap.forEach(n=>{e[P.createHash({connector:n,type:v.Connector})]=P.serialize({connector:n,type:v.Connector})}),this.nodesMap.forEach(n=>{e[P.createHash({node:n,type:v.Node})]=P.serialize({node:n,type:v.Node})}),this.connectionsMap.forEach(n=>{e[P.createHash(n)]=P.serialize(n)}),this._hasSelectedNodeflow&&(e[v.Nodeflow]={type:v.Nodeflow}),e}static fromObject(e,n){const o=new P(n);for(const s in e){const i=e[s];switch(i.type){case v.Connector:case v.Node:case v.Connection:o.add(P.deserialize(i,n));break;default:o._hasSelectedNodeflow=!0;break}}return o}get selectedConnectors(){return Array.from(this.connectorsMap.values())}get selectedNodes(){return Array.from(this.nodesMap.values())}get selectedNodesMap(){return this.nodesMap}get selectedConnections(){return Array.from(this.connectionsMap.values())}get selectedNodeflow(){return this._hasSelectedNodeflow}hasSelectedNodeflow(){return this._hasSelectedNodeflow}clearConnectors(){this.connectorsMap.clear()}clearNodes(){this.nodesMap.clear()}clearConnections(){this.connectionsMap.clear()}clearNodeflow(){this._hasSelectedNodeflow=!1}clear(){this.clearConnectors(),this.clearNodes(),this.clearConnections(),this.clearNodeflow()}isNodeSelected(e){return this.nodesMap.has(e)}isConnectorSelected(e,n){return this.connectorsMap.has(`${n}-${e}`)}isConnectionSelected(e,n,o,s){return this.connectionsMap.has(`${e}-${n}-${o}-${s}`)}deleteNodes(e){for(const n of this.nodesMap.values())e(n)&&this.nodesMap.delete(n.id)}deleteConnectors(e){for(const n of this.connectorsMap.values())e(n)&&this.connectorsMap.delete(`${n.parentNode.id}-${n.id}`)}deleteConnections(e){for(const n of this.connectionsMap.values())e(n)&&this.connectionsMap.delete(`${n.connection.sourceConnector.parentNode.id}-${n.connection.sourceConnector.id}-${n.connection.destinationConnector.parentNode.id}-${n.connection.destinationConnector.id}`)}get size(){return this.connectorsMap.size+this.nodesMap.size+this.connectionsMap.size+(this._hasSelectedNodeflow?1:0)}}class V{constructor(e,n,o,s){p(this,"position"),p(this,"size"),this.position=h.of(e,n),this.size=h.of(o,s)}static of(e,n){return new V(e.x,e.y,n.x,n.y)}static fromRect(e){return new V(e.position.x,e.position.y,e.size.x,e.size.y)}static fromPositions(e,n){return V.of(e,n.subtract(e))}copy(){return V.fromRect(this)}get center(){return this.position.add(this.size.divideBy(2))}intersects(e){return this.position.x<e.position.x+e.size.x&&this.position.x+this.size.x>e.position.x&&this.position.y<e.position.y+e.size.y&&this.position.y+this.size.y>e.position.y}startPosition(){return h.of(Math.min(this.position.x,this.position.x+this.size.x),Math.min(this.position.y,this.position.y+this.size.y))}endPosition(){return h.of(Math.max(this.position.x,this.position.x+this.size.x),Math.max(this.position.y,this.position.y+this.size.y))}}class vt{constructor(e){p(this,"store"),p(this,"nodeflowData"),this.nodeflowData=e,this.store=W({boundingBox:void 0,selections:new P(this.nodeflowData)})}get boundingBox(){return this.store[0].boundingBox}set boundingBox(e){if(this.store[1]({boundingBox:e}),!e){this.selections.selectedNodes.forEach(i=>{this.nodeflowData.mouseData.selections.add({type:v.Node,node:i})}),this.selections.clear();return}const n=V.of(e.position,e.size),o=V.fromPositions(this.nodeflowData.transformVec2ToCanvas(n.startPosition()),this.nodeflowData.transformVec2ToCanvas(n.endPosition())),s=this.nodeflowData.chunking.getNodesInRect(o);this.selections.clear(),s.forEach(i=>{this.selections.add({type:v.Node,node:i})})}get selections(){return this.store[0].selections}}class xn{constructor(e){p(this,"store"),p(this,"nodeflowData"),p(this,"selectNode",(n,o,s=!0)=>{if(!this.nodeflowData.nodes.has(n))return;const i=this.nodeflowData.nodes.get(n);this.hasSelectedNode(n)&&this.selections.delete({type:v.Node,node:i}),this.selections.addNode(i),this.update({pointerDown:s,mousePosition:o,clickStartPosition:o.divideBy(this.nodeflowData.zoomLevel).subtract(this.nodeflowData.nodes.get(n).position)})}),p(this,"clearSelections",()=>{this.selections.clear(),this.nodeflowData.resetMovement()}),p(this,"startCreatingConnection",(n,o,s)=>{if(!this.nodeflowData.settings.canCreateConnections)return;const i=this.nodeflowData.nodes.get(n);if(!i)return;const r=i.getConnector(s);if(!r)return;const a=new P(this.nodeflowData);a.add({connector:r,type:v.Connector}),this.update({pointerDown:!0,selections:a,mousePosition:o,clickStartPosition:o.divideBy(this.nodeflowData.zoomLevel).subtract(i.position)})}),p(this,"globalMousePosition",()=>this.nodeflowData.transformVec2ToCanvas(this.mousePosition)),this.nodeflowData=e,this.store=W({clickStartPosition:void 0,mousePosition:h.zero(),heldMouseButtons:new Set,pointerDown:!1,selections:new P(this.nodeflowData),selectionBox:new vt(this.nodeflowData)})}serialize(){var e;return{clickStartPosition:(e=this.clickStartPosition)==null?void 0:e.serialize(),selections:this.selections.toObject()}}deserialize(e){this.update({clickStartPosition:h.deserializeOrDefault(e.clickStartPosition),selections:P.fromObject(e.selections,this.nodeflowData)})}get clickStartPosition(){return this.store[0].clickStartPosition}get heldMouseButtons(){return this.store[0].heldMouseButtons}get selections(){return this.store[0].selections}get selectionBox(){return this.store[0].selectionBox}get mousePosition(){return this.store[0].mousePosition}get heldConnections(){return this.selections.selectedConnections}get heldConnectors(){return this.selections.selectedConnectors}get heldNodes(){return this.selections.selectedNodes}isHoldingButton(e){return this.heldMouseButtons.has(e)}deleteNodes(e){this.selections.deleteNodes(e)}deleteConnectors(e){this.selections.deleteConnectors(e)}deleteConnections(e){this.selections.deleteConnections(e)}set clickStartPosition(e){this.store[1]({clickStartPosition:e})}set mousePosition(e){this.store[1]({mousePosition:e})}set pointerDown(e){this.store[1]({pointerDown:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}reset(){this.update({clickStartPosition:void 0,pointerDown:!1,heldMouseButtons:new Set,selections:new P(this.nodeflowData),selectionBox:new vt(this.nodeflowData)})}selectNodeflow(){this.hasSelectedNodeflow()&&this.selections.clearNodeflow(),this.selections.addNodeflow()}hasSelectedNodeflow(){return this.selections.hasSelectedNodeflow()}hasSelectedNode(e){return this.selections.isNodeSelected(e)}hasSelectedConnector(e,n){return this.selections.isConnectorSelected(e,n)}hasSelectedConnection(e,n,o,s){return this.selections.isConnectionSelected(e,n,o,s)}}class kn{constructor(e,n=2048){p(this,"store"),p(this,"nodeflowData"),this.nodeflowData=e,this.store=W({chunkSize:n,chunks:new ee})}get chunkSize(){return this.store[0].chunkSize}set chunkSize(e){this.store[1]({chunkSize:e})}get chunks(){return this.store[0].chunks}set chunks(e){this.store[1]({chunks:e})}addNodeToChunk(e,n){const o=this.calculateChunkPosition(n).hashCode(),s=this.chunks.get(o)||new Set;s.add(e),this.chunks.set(o,s)}removeNodeFromChunk(e,n){const o=this.calculateChunkPosition(n).hashCode(),s=this.chunks.get(o);s&&(s.delete(e),this.chunks.set(o,s))}updateNodeInChunk(e,n,o){const s=this.calculateChunkPosition(n).hashCode(),i=this.calculateChunkPosition(o).hashCode();if(s==i)return;const r=this.chunks.get(s),a=this.chunks.get(i)||new Set;r&&(r.delete(e),this.chunks.set(s,r),he(r)&&this.chunks.delete(s)),a&&(a.add(e),this.chunks.set(i,a))}getChunk(e){return this.chunks.get(this.calculateChunkPosition(e).hashCode())||new Set}calculateChunkPosition(e){return h.of(Math.floor(e.x/this.chunkSize),Math.floor(e.y/this.chunkSize))}checkForCollisions(e){if(!this.nodeflowData.settings.allowCollision)return[];const n=this.nodeflowData.nodes.get(e),o=[];if(!n)return o;for(let s=-1;s<2;++s)for(let i=-1;i<2;++i){const r=this.getChunk(n.rectWithOffset.position.add(h.of(s*this.chunkSize,i*this.chunkSize)));r.size>0&&o.push(...r)}return o.filter(s=>{const i=this.nodeflowData.nodes.get(s);return i?.id==n.id?!1:i&&i.id!=n.id&&i.rectWithOffset.intersects(n.rectWithOffset)})}getNodesInRect(e){const n=[],o=e.startPosition(),s=e.endPosition(),i=this.calculateChunkPosition(o),r=this.calculateChunkPosition(s);for(let a=i.x;a<=r.x;++a)for(let c=i.y;c<=r.y;++c){const d=this.chunks.get(h.of(a,c).hashCode());d&&d.forEach(u=>{const l=this.nodeflowData.nodes.get(u);l&&e.intersects(l.rectWithOffset)&&n.push(l)})}return n}}const Ge=(t,e,n)=>Math.min(Math.max(t,e),n);class Je{constructor(e,n){p(this,"store"),p(this,"nodeflowData"),this.nodeflowData=e,this.store=W(n),this.nodeflowData.chunking.addNodeToChunk(this.id,this.getCenter()),De(()=>{const o=this.getCollidingNodes();o.length>0&&De(()=>{o.forEach(s=>{const i=this.nodeflowData.nodes.get(s);if(i){const r=i.rectWithOffset,a=this.rectWithOffset;if(r.intersects(a)){const c=r.center.subtract(a.center).magnitude,d=r.center.subtract(a.center).normalize();this.position=this.position.subtract(d.multiplyBy(c))}}})})})}get nodeflow(){return this.nodeflowData}get centered(){return this.store[0].centered}get connectorSections(){return this.store[0].connectorSections}get css(){return this.store[0].css}get customData(){return this.store[0].customData}get display(){return this.store[0].display}get id(){return this.store[0].id}get offset(){return this.store[0].offset}get position(){return this.store[0].position}get ref(){return this.store[0].ref}get resizeObserver(){return this.store[0].resizeObserver}get size(){return this.store[0].size}set centered(e){this.store[1]({centered:e})}set connectorSections(e){this.store[1]({connectorSections:e})}set css(e){this.store[1]({css:e})}set customData(e){this.store[1]({customData:e})}set display(e){this.store[1]({display:e})}set id(e){this.store[1]({id:e})}set offset(e){this.store[1]({offset:e})}set position(e){const n=this.position;this.store[1]({position:e}),this.nodeflowData.chunking.updateNodeInChunk(this.id,n,e)}set ref(e){this.store[1]({ref:e})}set resizeObserver(e){this.store[1]({resizeObserver:e})}set size(e){this.store[1]({size:e})}get sizeWithOffset(){return this.size.add(this.offset)}update(e){this.store[1](e)}serialize(){const e=Array.from(this.connectorSections.values()).reduce((n,o)=>(n[o.id]=o.serialize(),n),{});return{centered:this.centered,connectorSections:e,css:Q(this.css),customData:Q(this.customData),id:this.id,display:this.display,position:this.position.serialize()}}static deserialize(e,n,o=!0){const s=n.id??e.getNextFreeNodeId(),i=new Je(e,{centered:n.centered??!1,connectorSections:new ee,css:Q(n.css)??{},customData:Q(n.customData)??{},display:n.display??(()=>{}),id:s,offset:h.zero(),position:h.deserializeOrDefault(n.position),ref:void 0,resizeObserver:void 0,size:h.zero()}),r=G.evaluateHistoryGroup(o);return Object.entries(n.connectorSections??[]).forEach(([a,c])=>{i.addConnectorSection({css:c.css,id:a,connectors:c.connectors},r)}),i}serializeConnections(){return Array.from(this.connectorSections.values()).flatMap(e=>Array.from(e.connectors.values()).flatMap(n=>n.serializeConnections()))}updateWithPrevious(e){this.store[1](e)}addConnectorSection(e,n=!0){const o=G.evaluateHistoryGroup(n),s=Qe.deserialize(e,this,o);if(this.connectorSections.has(s.id))return this.connectorSections.get(s.id);if(o){const i=s.serialize(),r=this.nodeflowData.id,a=this.id,c=i.id;this.nodeflowData.changes.addChange({type:"remove",source:"connector-section",applyChange:()=>{var d,u;(u=(d=O.get().getNodeflow(r))==null?void 0:d.nodes.get(a))==null||u.addConnectorSection(i,!1)},undoChange:()=>{var d,u;(u=(d=O.get().getNodeflow(r))==null?void 0:d.nodes.get(a))==null||u.removeConnectorSection(c,!1)},historyGroup:o})}return this.connectorSections.set(s.id,s),s}removeConnectorSection(e,n=!0){if(!this.connectorSections.has(e))return;const o=this.connectorSections.get(e),s=G.evaluateHistoryGroup(n);if(s){const i=o.serialize(),r=this.nodeflowData.id,a=this.id;this.nodeflowData.changes.addChange({type:"remove",source:"connector-section",applyChange:()=>{var c,d;(d=(c=O.get().getNodeflow(r))==null?void 0:c.nodes.get(a))==null||d.removeConnectorSection(e,!1)},undoChange:()=>{var c,d;(d=(c=O.get().getNodeflow(r))==null?void 0:c.nodes.get(a))==null||d.addConnectorSection(i,!1)},historyGroup:s})}this.connectorSections.delete(e)}getConnectorCount(){return Array.from(this.connectorSections.values()).reduce((e,n)=>e+n.connectors.size,0)}addConnector(e,n,o=!0){if(this.connectorSections.has(e))return this.connectorSections.get(e).addConnector(n,o)}removeConnector(e,n,o=!0){this.connectorSections.has(e)&&this.connectorSections.get(e).removeConnector(n,o)}getConnector(e){var n;return(n=this.getSectionFromConnector(e))==null?void 0:n.connectors.get(e)}getTotalConnectedInputs(e){var n;return((n=this.getConnector(e))==null?void 0:n.sources.length)??0}getAllConnectors(){return Array.from(this.connectorSections.values()).reduce((e,n)=>e.concat(Array.from(n.connectors.values())),[])}getNextFreeConnectorSectionId(){let e="0";for(let n=1;this.connectorSections.has(e);++n)e=n.toString();return e}getNextFreeConnectorId(){let e="0";for(let n=1;Array.from(this.connectorSections.values()).some(o=>o.connectors.has(e));++n)e=n.toString();return e}removeIncomingConnections(){this.connectorSections.forEach(e=>e.removeIncomingConnections())}removeOutgoingConnections(){this.connectorSections.forEach(e=>e.removeOutgoingConnections())}getAllSourceConnectors(){return Array.from(this.connectorSections.values()).reduce((e,n)=>e.concat(n.getSourceConnectors()),[])}getAllDestinationConnectors(){return Array.from(this.connectorSections.values()).reduce((e,n)=>e.concat(n.getDestinationConnectors()),[])}getAllSourceConnections(){return this.getAllSourceConnectors().map(e=>e.destinations.filter(n=>n.destinationConnector.parentNode.id===this.id).map(n=>({sourceNodeId:e.parentNode.id,sourceConnectorId:e.id,destinationNodeId:n.destinationConnector.parentNode.id,destinationConnectorId:n.destinationConnector.id,css:n.css}))).flat()}getAllDestinationConnections(){return this.getAllDestinationConnectors().map(e=>e.sources.filter(n=>n.sourceConnector.parentNode.id===this.id).map(n=>({sourceNodeId:n.sourceConnector.parentNode.id,sourceConnectorId:n.sourceConnector.id,destinationNodeId:e.parentNode.id,destinationConnectorId:e.id}))).flat()}getAllSourceNodes(){return this.getAllSourceConnectors().map(e=>e.parentNode)}getAllDestinationNodes(){return this.getAllDestinationConnectors().map(e=>e.parentNode)}getSectionFromConnector(e){return Array.from(this.connectorSections.values()).find(n=>n.connectors.get(e))}getCenter(){return this.position.add(this.offset,this.size.divideBy(2))}select(e){this.nodeflowData.selectNode(this.id,e)}get rect(){return V.of(this.position,this.size)}get rectWithOffset(){return V.of(this.position.subtract(this.offset),this.size.add(this.offset.multiplyBy(2)))}getCollidingNodes(){return this.nodeflowData.chunking.checkForCollisions(this.id)}isColliding(){return this.getCollidingNodes().length>0}}var j=(t=>(t[t.LEFT=0]="LEFT",t[t.MIDDLE=1]="MIDDLE",t[t.RIGHT=2]="RIGHT",t[t.BACK=3]="BACK",t[t.FORWARD=4]="FORWARD",t))(j||{}),D=(t=>(t.ALT_LEFT="AltLeft",t.ALT_RIGHT="AltRight",t.ARROW_DOWN="ArrowDown",t.ARROW_LEFT="ArrowLeft",t.ARROW_RIGHT="ArrowRight",t.ARROW_UP="ArrowUp",t.BACKQUOTE="Backquote",t.BACKSLASH="Backslash",t.BACKSPACE="Backspace",t.BRACKET_LEFT="BracketLeft",t.BRACKET_RIGHT="BracketRight",t.CAPS_LOCK="CapsLock",t.COMMA="Comma",t.CONTEXT_MENU="ContextMenu",t.CONTROL_LEFT="ControlLeft",t.CONTROL_RIGHT="ControlRight",t.DELETE="Delete",t.DIGIT_0="Digit0",t.DIGIT_1="Digit1",t.DIGIT_2="Digit2",t.DIGIT_3="Digit3",t.DIGIT_4="Digit4",t.DIGIT_5="Digit5",t.DIGIT_6="Digit6",t.DIGIT_7="Digit7",t.DIGIT_8="Digit8",t.DIGIT_9="Digit9",t.END="End",t.ENTER="Enter",t.EQUAL="Equal",t.ESCAPE="Escape",t.F1="F1",t.F10="F10",t.F11="F11",t.F12="F12",t.F2="F2",t.F3="F3",t.F4="F4",t.F5="F5",t.F6="F6",t.F7="F7",t.F8="F8",t.F9="F9",t.HOME="Home",t.INSERT="Insert",t.KEY_A="KeyA",t.KEY_B="KeyB",t.KEY_C="KeyC",t.KEY_D="KeyD",t.KEY_E="KeyE",t.KEY_F="KeyF",t.KEY_G="KeyG",t.KEY_H="KeyH",t.KEY_I="KeyI",t.KEY_J="KeyJ",t.KEY_K="KeyK",t.KEY_L="KeyL",t.KEY_M="KeyM",t.KEY_N="KeyN",t.KEY_O="KeyO",t.KEY_P="KeyP",t.KEY_Q="KeyQ",t.KEY_R="KeyR",t.KEY_S="KeyS",t.KEY_T="KeyT",t.KEY_U="KeyU",t.KEY_V="KeyV",t.KEY_W="KeyW",t.KEY_X="KeyX",t.KEY_Y="KeyY",t.KEY_Z="KeyZ",t.META_LEFT="MetaLeft",t.META_RIGHT="MetaRight",t.MINUS="Minus",t.NUMPAD_0="Numpad0",t.NUMPAD_1="Numpad1",t.NUMPAD_2="Numpad2",t.NUMPAD_3="Numpad3",t.NUMPAD_4="Numpad4",t.NUMPAD_5="Numpad5",t.NUMPAD_6="Numpad6",t.NUMPAD_7="Numpad7",t.NUMPAD_8="Numpad8",t.NUMPAD_9="Numpad9",t.NUMPAD_ADD="NumpadAdd",t.NUMPAD_COMMA="NumpadComma",t.NUMPAD_DECIMAL="NumpadDecimal",t.NUMPAD_DIVIDE="NumpadDivide",t.NUMPAD_ENTER="NumpadEnter",t.NUMPAD_EQUAL="NumpadEqual",t.NUMPAD_MULTIPLY="NumpadMultiply",t.NUMPAD_SUBTRACT="NumpadSubtract",t.NUM_LOCK="NumLock",t.PAGE_DOWN="PageDown",t.PAGE_UP="PageUp",t.PERIOD="Period",t.QUOTE="Quote",t.SCROLL_LOCK="ScrollLock",t.SEMICOLON="Semicolon",t.SHIFT_LEFT="ShiftLeft",t.SHIFT_RIGHT="ShiftRight",t.SLASH="Slash",t.SPACE="Space",t.TAB="Tab",t))(D||{});const Bt=class Kt{constructor(e,n={},o){p(this,"store"),p(this,"changes"),p(this,"mouseData"),p(this,"keyboardData"),p(this,"curveFunctions"),p(this,"settingsStore"),p(this,"nodes"),p(this,"eventStore"),p(this,"chunking"),p(this,"id"),p(this,"keymap",{MOVE_DOWN:new Set([D.ARROW_DOWN,D.KEY_S]),MOVE_LEFT:new Set([D.ARROW_LEFT,D.KEY_A]),MOVE_RIGHT:new Set([D.ARROW_RIGHT,D.KEY_D]),MOVE_UP:new Set([D.ARROW_UP,D.KEY_W]),SELECT_MULTIPLE:new Set([D.CONTROL_LEFT,D.CONTROL_RIGHT]),CREATE_SELECTION_BOX:new Set([D.SHIFT_LEFT,D.SHIFT_RIGHT])}),p(this,"resetMovement",()=>{this.currentMoveSpeed=h.zero(),this.keymap.MOVE_LEFT.forEach(s=>this.keyboardData.releaseKey(s)),this.keymap.MOVE_RIGHT.forEach(s=>this.keyboardData.releaseKey(s)),this.keymap.MOVE_UP.forEach(s=>this.keyboardData.releaseKey(s)),this.keymap.MOVE_DOWN.forEach(s=>this.keyboardData.releaseKey(s))}),p(this,"updateZoom",(s,i)=>{const r=this.zoomLevel;if(s===0)return;const a=Number(Ge(s>0?r+r*s*this.settings.zoomMultiplier:r/(1-s*this.settings.zoomMultiplier),this.settings.minZoom,this.settings.maxZoom).toFixed(4));this.mouseData.pointerDown=!1;const c=this.size,d=i.subtract(this.startPosition),u=c.multiplyBy(r),l=c.multiplyBy(a),f=d.subtract(u.divideBy(2)).divideBy(r),m=d.subtract(l.divideBy(2)).divideBy(a);this.updateWithPrevious(g=>({position:g.position.subtract(f).add(m),zoomLevel:a}))}),this.id=e,this.settingsStore=W({...Kt.DEFAULT_SETTINGS,...n}),this.curveFunctions=o?.(this)??new Tt(this),this.store=W({currentMoveSpeed:h.zero(),position:h.zero(),startPosition:h.zero(),size:h.zero(),zoomLevel:1,pinchDistance:0,intervalId:void 0}),this.changes=new G,this.mouseData=new xn(this),this.keyboardData=new _n(this),this.nodes=new ee,this.chunking=new kn(this),this.eventStore={onKeyDownInNodeflow:new F(this),onKeyUpInNodeflow:new F(this),onMouseDownInConnector:new F(this),onMouseDownInNode:new F(this),onMouseDownInNodeflow:new F(this),onMouseMoveInNodeflow:new F(this),onNodeConnected:new F(this),onNodeDataChanged:new F(this),onPointerDownInNodeCurve:new F(this),onPointerUpInConnector:new F(this),onPointerUpInNode:new F(this),onPointerUpInNodeflow:new F(this),onTouchMoveInNodeflow:new F(this),onTouchStartInConnector:new F(this),onTouchStartInNode:new F(this),onTouchStartInNodeflow:new F(this),onWheelInNodeflow:new F(this)},this.setupDefaultEventHandlers()}handleMovement(){const e=!he(ye(this.keyboardData.heldKeys,this.keymap.MOVE_LEFT)),n=!he(ye(this.keyboardData.heldKeys,this.keymap.MOVE_RIGHT)),o=!he(ye(this.keyboardData.heldKeys,this.keymap.MOVE_UP)),s=!he(ye(this.keyboardData.heldKeys,this.keymap.MOVE_DOWN)),i=this.mouseData.heldNodes.length>0;this.currentMoveSpeed=h.of(this.calculateDirectionalMovementAmount(e||n,this.currentMoveSpeed.x,n,e,!i),this.calculateDirectionalMovementAmount(o||s,this.currentMoveSpeed.y,s,o,!i)),!(this.currentMoveSpeed.x===0&&this.currentMoveSpeed.y===0)&&(i?this.updateHeldNodePosition(this.currentMoveSpeed.divideBy(this.zoomLevel)):this.updateBackgroundPosition(this.currentMoveSpeed,!0))}serialize(){return{changes:this.changes.serialize(),connections:this.serializeConnections(),currentMoveSpeed:this.currentMoveSpeed.serialize(),mouseData:this.mouseData.serialize(),nodes:Object.fromEntries(Array.from(this.nodes.entries()).map(([e,n])=>[e,n.serialize()])),pinchDistance:this.pinchDistance,position:this.position.serialize(),size:this.size.serialize(),startPosition:this.startPosition.serialize(),zoomLevel:this.zoomLevel}}deserialize(e,n=!1){this.update({currentMoveSpeed:h.deserializeOrDefault(e.currentMoveSpeed),pinchDistance:e.pinchDistance,position:h.deserializeOrDefault(e.position),size:h.deserializeOrDefault(e.size),startPosition:h.deserializeOrDefault(e.startPosition),zoomLevel:e.zoomLevel});const o=G.evaluateHistoryGroup(n);this.nodes.clear(),Object.values(e.nodes).forEach(s=>{this.addNode(s,o)}),this.mouseData.deserialize(e.mouseData),e.connections.forEach(s=>{this.addConnection(s,o)}),this.changes.deserialize(e.changes)}serializeConnections(){return Array.from(this.nodes.values()).flatMap(e=>e.serializeConnections())}get settings(){return this.settingsStore[0]}updateSettings(e){this.settingsStore[1](e)}get currentMoveSpeed(){return this.store[0].currentMoveSpeed}get position(){return this.store[0].position}get startPosition(){return this.store[0].startPosition}get size(){return this.store[0].size}get zoomLevel(){return this.store[0].zoomLevel}get pinchDistance(){return this.store[0].pinchDistance}get intervalId(){return this.store[0].intervalId}set currentMoveSpeed(e){this.store[1]({currentMoveSpeed:e})}set position(e){this.store[1]({position:e})}set startPosition(e){this.store[1]({startPosition:e})}set size(e){this.store[1]({size:e})}set zoomLevel(e){this.store[1]({zoomLevel:e})}set pinchDistance(e){this.store[1]({pinchDistance:e})}set intervalId(e){this.store[1]({intervalId:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}center(){const e=this.size.divideBy(2);return this.startPosition.add(e).divideBy(this.zoomLevel).subtract(this.position)}calculateDirectionalMovementAmount(e,n,o,s,i=!1){let r=n;if(e){const a=this.settings.movementAcceleration*(i?-1:1);r=Ge(r+(o?a:0)-(s?a:0),-this.settings.maxMovementSpeed,this.settings.maxMovementSpeed)}else r=Ge(r*this.settings.movementDeceleration,-this.settings.maxMovementSpeed,this.settings.maxMovementSpeed);return Math.abs(r)<.1&&(r=0),r}updateBackgroundPosition(e,n=!1){!this.settings.canPan||!this.mouseData.hasSelectedNodeflow()||n===(this.mouseData.isHoldingButton(j.MIDDLE)||this.mouseData.isHoldingButton(j.LEFT))||this.mouseData.selectionBox.boundingBox||this.updateWithPrevious(o=>({position:o.position.add(e.divideBy(this.zoomLevel))}))}addNode(e,n=!0){const o=G.evaluateHistoryGroup(n),s=Je.deserialize(this,e,o);if(this.nodes.set(s.id,s),o){const i=s.serializeConnections(),r=s.serialize(),a=this.id;this.changes.addChange({type:"add",source:"node",applyChange:()=>{const c=O.get().getNodeflow(a);c?.addNode(r,!1),i.forEach(d=>{c?.addConnection(d,!1)})},undoChange:()=>{var c;(c=O.get().getNodeflow(a))==null||c.removeNode(s.id,!1)},historyGroup:o})}return s}updateNode(e,n,o=!0){if(!this.nodes.has(e))return;const s=this.nodes.get(e),i=G.evaluateHistoryGroup(o);if(i){const r=this.nodes.get(e),a=r.serialize(),c=r.serializeConnections(),d=this.id,u=Object.entries(a).reduce((l,[f,m])=>(f in n&&Object.assign(l,{[f]:Q(m)}),l),{});this.changes.addChange({type:"update",source:"node",applyChange:()=>{var l;(l=O.get().getNodeflow(d))==null||l.updateNode(e,n,!1)},undoChange:()=>{const l=O.get().getNodeflow(d);l?.updateNode(e,u,!1),c.forEach(f=>{l?.addConnection(f,!1)})},historyGroup:i})}s.updateWithPrevious(Ye(r=>Object.assign(r,n))),this.eventStore.onNodeDataChanged.publish({nodeId:e,data:n})}removeNode(e,n=!0){if(!this.nodes.has(e))return;this.mouseData.selections.deleteNodes(s=>s.id===e);const o=G.evaluateHistoryGroup(n);if(o){const s=this.nodes.get(e),i=s.serializeConnections(),r=this.id;this.changes.addChange({type:"remove",source:"node",applyChange:()=>{var a;(a=O.get().getNodeflow(r))==null||a.removeNode(e,!1)},undoChange:()=>{const a=O.get().getNodeflow(r);a?.addNode(s.serialize(),!1),i.forEach(c=>{a?.addConnection(c,!1)})},historyGroup:o})}this.removeIncomingConnections(e),this.removeOutgoingConnections(e),this.nodes.delete(e)}removeIncomingConnections(e){this.nodes.has(e)&&this.nodes.get(e).connectorSections.forEach(n=>{n.connectors.forEach(o=>{o.sources.forEach(({sourceConnector:s})=>{s.destinations.filterInPlace(({destinationConnector:i})=>i.parentNode.id!==e)}),o.sources=new ue})})}removeOutgoingConnections(e){this.nodes.has(e)&&this.nodes.get(e).connectorSections.forEach(n=>{n.connectors.forEach(o=>{o.destinations.forEach(({destinationConnector:s})=>{s.sources.filterInPlace(({sourceConnector:i})=>i.parentNode.id!==e)}),o.destinations=new ue})})}getAllSourceConnectors(e){return this.nodes.has(e)?this.nodes.get(e).getAllSourceConnectors():[]}getAllDestinationConnectors(e){return this.nodes.has(e)?this.nodes.get(e).getAllDestinationConnectors():[]}getAllSourceConnections(e){return this.nodes.has(e)?this.nodes.get(e).getAllSourceConnections():[]}getAllDestinationConnections(e){return this.nodes.has(e)?this.nodes.get(e).getAllDestinationConnections():[]}getNextFreeNodeId(){let e="0";for(let n=1;this.nodes.has(e);++n)e=n.toString();return e}addConnection(e,n=!0){const{sourceNodeId:o,sourceConnectorId:s,destinationNodeId:i,destinationConnectorId:r,css:a}=e;if(!this.nodes.has(o)||!this.nodes.has(i))return;const c=this.nodes.get(o),d=this.nodes.get(i),u=c.getConnector(s),l=d.getConnector(r);if(!u||!l||u.destinations.some(m=>m.destinationConnector===l))return;const f=G.evaluateHistoryGroup(n);if(f){const m=this.id;this.changes.addChange({type:"add",source:"connection",applyChange:()=>this.addConnection(e,!1),undoChange:()=>{var g;return(g=O.get().getNodeflow(m))==null?void 0:g.removeConnection(o,s,i,r,!1)},historyGroup:f})}u.destinations.push(new Sn({destinationConnector:l,css:a??{}})),l.sources.push(new En({sourceConnector:u}))}removeConnection(e,n,o,s,i=!0){var r;if(!this.nodes.has(e)||!this.nodes.has(o))return;const a=this.nodes.get(e),c=this.nodes.get(o),d=a.getConnector(n),u=c.getConnector(s);if(!d||!u)return;const l=G.evaluateHistoryGroup(i);if(l){const f=(r=d.destinations.find(A=>A.destinationConnector.parentNode.id===o))==null?void 0:r.css,m=this.id,g=()=>{var A;(A=O.get().getNodeflow(m))==null||A.addConnection({sourceNodeId:e,sourceConnectorId:n,destinationNodeId:o,destinationConnectorId:s,css:f},!1)},k=()=>{var A;(A=O.get().getNodeflow(m))==null||A.removeConnection(e,n,o,s,!1)};this.changes.addChange({type:"remove",source:"connection",applyChange:k,undoChange:g,historyGroup:l})}d.destinations.filterInPlace(f=>f.destinationConnector.parentNode.id!==o),u.sources.filterInPlace(f=>f.sourceConnector.parentNode.id!==e)}updateHeldNodePosition(e){!this.settings.canMoveNodes||this.mouseData.selectionBox.boundingBox||this.mouseData.heldNodes.forEach(n=>n.position=n.position.add(e))}setHeldNodePosition(e){!this.settings.canMoveNodes||this.mouseData.selectionBox.boundingBox||this.mouseData.heldNodes.forEach(n=>n.position=e)}setupDefaultEventHandlers(){this.eventStore.onNodeConnected.subscribeMultiple([{name:"nodeflow:create-connection",event:e=>this.addConnection({sourceNodeId:e.inputNodeId,sourceConnectorId:e.inputId,destinationNodeId:e.outputNodeId,destinationConnectorId:e.outputId})},{name:"nodeflow:reset-mouse-data",event:()=>this.mouseData.reset()}]),this.eventStore.onMouseMoveInNodeflow.subscribeMultiple([{name:"nodeflow:drag-node",event:({event:e})=>{this.mouseData.heldNodes.length===0||!this.mouseData.pointerDown&&!this.mouseData.isHoldingButton(j.LEFT)||this.mouseData.selectionBox.boundingBox||this.updateHeldNodePosition(h.of(e.movementX,e.movementY).divideBy(this.zoomLevel))}},{name:"nodeflow:update-background-position",event:({event:e})=>{const n=this.mouseData.heldNodes.length>0&&(this.mouseData.pointerDown||this.mouseData.isHoldingButton(j.LEFT));this.mouseData.selectionBox.boundingBox||n||this.updateBackgroundPosition(h.of(e.movementX,e.movementY))}},{name:"nodeflow:expand-selection-box",event:({event:e})=>{this.mouseData.selectionBox.boundingBox&&(this.mouseData.selectionBox.boundingBox=V.of(this.mouseData.selectionBox.boundingBox.position,this.mouseData.selectionBox.boundingBox.position.subtract(h.fromEvent(e)).negate()))}}]),this.eventStore.onPointerUpInNodeflow.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>{e.stopPropagation(),e.preventDefault()}},{name:"nodeflow:reset-mouse-data",event:({event:e})=>{this.mouseData.pointerDown=!1,this.mouseData.selectionBox.boundingBox=void 0,this.mouseData.heldMouseButtons.delete(e.button),this.mouseData.heldConnectors.length===1&&this.mouseData.selections.clearNodes(),this.mouseData.selections.clearConnectors()}}]),this.eventStore.onTouchStartInNodeflow.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()},{name:"nodeflow:clear-held-keys",event:({event:e})=>{e.touches.length===1&&this.keyboardData.clearKeys()}},{name:"nodeflow:handle-pinch",event:({event:e})=>{const{touches:n}=e;if(n.length!==2)return;const{pageX:o,pageY:s}=e.touches[0],{pageX:i,pageY:r}=e.touches[1];this.pinchDistance=Math.hypot(o-i,s-r)}},{name:"nodeflow:update-mouse-data",event:({event:e})=>{const{touches:n}=e;if(n.length!==1)return;const o=n[0],s=h.fromEvent(o);this.mouseData.selections.clearNodes(),this.mouseData.update({pointerDown:!0,mousePosition:s,clickStartPosition:h.of(s.x/this.zoomLevel-this.position.x,s.y/this.zoomLevel-this.position.y)})}}]),this.eventStore.onTouchMoveInNodeflow.subscribeMultiple([{name:"nodeflow:handle-pinch",event:({event:e})=>{const{touches:n}=e;if(n.length!==2)return;const{pageX:o,pageY:s}=n[0],{pageX:i,pageY:r}=n[1],a=Math.hypot(o-i,s-r),c=h.of((o+i)/2,(s+r)/2);this.settings.canZoom&&this.updateZoom(a-this.pinchDistance,c),this.pinchDistance=a}},{name:"nodeflow:update-mouse-data",event:({event:e})=>{const{touches:n}=e;n.length===1&&this.mouseData.updateWithPrevious(o=>{const s=h.fromEvent(n[0]);return this.updateBackgroundPosition(s.subtract(o.mousePosition)),{mousePosition:s}})}}]),this.eventStore.onKeyUpInNodeflow.subscribeMultiple([{name:"nodeflow:remove-held-key",event:({event:e})=>this.keyboardData.releaseKey(e.code)}]),this.eventStore.onKeyDownInNodeflow.subscribeMultiple([{name:"nodeflow:add-held-key",event:({event:e})=>this.keyboardData.pressKey(e.code),priority:10},{name:"nodeflow:handle-controls",event:({event:e})=>{switch(e.code){case D.DELETE:if(this.mouseData.heldNodes.length>0&&this.settings.canDeleteNodes){const n=G.evaluateHistoryGroup();this.mouseData.heldNodes.forEach(o=>this.removeNode(o.id,n))}else if(this.mouseData.heldConnections.length>0&&this.settings.canDeleteConnections){const n=G.evaluateHistoryGroup();this.mouseData.heldConnections.forEach(o=>this.removeConnection(o.connection.sourceConnector.parentNode.id,o.connection.sourceConnector.id,o.connection.destinationConnector.parentSection.parentNode.id,o.connection.destinationConnector.id,n))}break;case D.ESCAPE:this.mouseData.clearSelections();break;case D.SPACE:this.settings.debugMode&&(this.mouseData.selections.size>0?console.log(this.mouseData.selections):console.log(this.nodes));break;case D.EQUAL:case D.MINUS:if(e.ctrlKey){if(!this.settings.canZoom)return;e.preventDefault(),this.updateZoom(this.settings.keyboardZoomMultiplier*(e.code===D.EQUAL?1:-1),this.size.divideBy(2))}break;case D.KEY_Z:if(!e.ctrlKey)break;e.preventDefault(),e.shiftKey?this.changes.redo():this.changes.undo();break;case D.KEY_A:case D.KEY_S:case D.KEY_D:case D.KEY_W:case D.ARROW_UP:case D.ARROW_DOWN:case D.ARROW_LEFT:case D.ARROW_RIGHT:this.intervalId||(this.intervalId=setInterval(()=>this.handleMovement(),10))}}}]),this.eventStore.onWheelInNodeflow.subscribeMultiple([{name:"nodeflow:update-zoom",event:({event:e})=>{this.settings.canZoom&&this.updateZoom(-e.deltaY,h.fromEvent(e))}},{name:"nodeflow:prevent-scroll",event:({event:e})=>{e.preventDefault()}}]),this.eventStore.onMouseDownInNodeflow.subscribeMultiple([{name:"nodeflow:reset-movement",event:({event:e})=>{e.button===j.LEFT&&this.resetMovement()}},{name:"nodeflow:reset-mouse-data",event:({event:e})=>{e.button===j.LEFT&&this.mouseData.clearSelections(),this.mouseData.selectNodeflow(),this.mouseData.heldMouseButtons.add(e.button),this.mouseData.update({clickStartPosition:h.of(e.clientX/this.zoomLevel-this.position.x,e.clientY/this.zoomLevel-this.position.y),mousePosition:h.fromEvent(e)})}},{name:"nodeflow:create-selection-box",event:({event:e})=>{e.button!==j.LEFT||!this.keyboardData.isActionPressed(this.keymap.CREATE_SELECTION_BOX)||(this.mouseData.selectionBox.boundingBox=V.of(h.fromEvent(e),h.zero()))}},{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()}]),this.eventStore.onMouseDownInConnector.blacklist("nodeflow:allow-pan",(e,n)=>e.event.button!==j.LEFT&&n.startsWith("nodeflow")),this.eventStore.onMouseDownInConnector.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()},{name:"nodeflow:handle-click",event:({event:e})=>{this.mouseData.heldMouseButtons.add(e.button)}},{name:"nodeflow:start-creating-connection",event:({event:e,nodeId:n,connectorId:o})=>{this.mouseData.startCreatingConnection(n,h.fromEvent(e),o)}}]),this.eventStore.onTouchStartInConnector.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()},{name:"nodeflow:start-creating-connection",event:({event:e,nodeId:n,connectorId:o})=>{const{clientX:s,clientY:i}=e.touches[0];this.mouseData.startCreatingConnection(n,h.of(s,i),o)}}]),this.eventStore.onPointerUpInConnector.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>{e.preventDefault(),e.stopPropagation()},priority:2},{name:"nodeflow:connect-held-nodes",event:({event:e,nodeId:n,connectorId:o})=>{if(!this.settings.canCreateConnections||this.mouseData.heldConnectors.length!==1)return;const s=this.mouseData.heldConnectors[0],i=s?.parentNode;!s||!i||this.eventStore.onNodeConnected.publish({outputNodeId:i.id,outputId:s.id,inputNodeId:n,inputId:o,event:e})},priority:2},{name:"nodeflow:reset-mouse-data",event:()=>{this.mouseData.pointerDown=!1},priority:1}]),this.eventStore.onMouseDownInNode.blacklist("nodeflow:allow-pan",(e,n)=>e.event.button!==j.LEFT&&n.startsWith("nodeflow")),this.eventStore.onMouseDownInNode.subscribeMultiple([{name:"nodeflow:select-node",event:({event:e,nodeId:n})=>{this.keyboardData.isActionPressed(this.keymap.SELECT_MULTIPLE)||this.mouseData.clearSelections(),this.mouseData.selectNode(n,h.fromEvent(e),this.settings.canMoveNodes)}},{name:"nodeflow:handle-click",event:({event:e})=>{this.mouseData.heldMouseButtons.add(e.button)}},{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()}]),this.eventStore.onTouchStartInNode.subscribeMultiple([{name:"nodeflow:select-node",event:({event:e,nodeId:n})=>{const{clientX:o,clientY:s}=e.touches[0];this.keyboardData.isActionPressed(this.keymap.SELECT_MULTIPLE)||this.mouseData.clearSelections(),this.mouseData.selectNode(n,h.of(o,s),this.settings.canMoveNodes)}},{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()}]),this.eventStore.onPointerDownInNodeCurve.blacklist("nodeflow:allow-pan",(e,n)=>e.event.button!==j.LEFT&&n.startsWith("nodeflow")),this.eventStore.onPointerDownInNodeCurve.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>{e.preventDefault(),e.stopPropagation()},priority:1},{name:"nodeflow:handle-click",event:({event:e})=>{this.mouseData.heldMouseButtons.add(e.button)}},{name:"nodeflow:update-mouse-data",event:({event:e,sourceConnector:n,destinationConnector:o})=>{this.mouseData.pointerDown=!0,this.mouseData.mousePosition=h.fromEvent(e),this.keyboardData.isActionPressed(this.keymap.SELECT_MULTIPLE)||this.mouseData.clearSelections(),this.mouseData.selections.add({type:v.Connection,connection:{sourceConnector:n,destinationConnector:o}})}}]),this.eventStore.onPointerUpInNode.subscribeMultiple([{name:"nodeflow:reset-mouse-data",event:()=>{this.mouseData.pointerDown=!1,this.mouseData.heldConnectors.length===1&&this.mouseData.selections.clearNodes(),this.mouseData.selections.clearConnectors()}}])}selectNode(e,n){this.mouseData.selectNode(e,n??h.zero(),!1)}transformVec2ToCanvas(e){return e.subtract(this.startPosition).divideBy(this.zoomLevel).subtract(this.position)}};p(Bt,"DEFAULT_SETTINGS",{allowCollision:!1,canAddNodes:!0,canCreateConnections:!0,canDeleteConnections:!0,canDeleteNodes:!0,canMoveNodes:!0,canPan:!0,canZoom:!0,debugMode:!1,keyboardZoomMultiplier:15,maxMovementSpeed:15,maxZoom:200,minZoom:.02,movementAcceleration:1.5,movementDeceleration:.85,zoomMultiplier:.005});let Pn=Bt;const[mt,zn]=de(h.of(window.innerWidth,window.innerHeight));De(()=>{const t=()=>zn(h.of(window.innerWidth,window.innerHeight));return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)});const An="_fatherCurve_sfc2k_1",$n="_motherCurve_sfc2k_11",On="_selectedFatherCurve_sfc2k_21",Tn="_selectedMotherCurve_sfc2k_28",Fn="_newFatherCurve_sfc2k_35",Ln="_newMotherCurve_sfc2k_42",fe={fatherCurve:An,motherCurve:$n,selectedFatherCurve:On,selectedMotherCurve:Tn,newFatherCurve:Fn,newMotherCurve:Ln},Bn="_nodeflow_1mhat_1",Kn={nodeflow:Bn},Rn="_femaleNode_ch6ac_1",Un="_maleNode_ch6ac_21",Gn="_selectedMaleNode_ch6ac_41",Hn="_selectedFemaleNode_ch6ac_60",Wn="_inputConnector_ch6ac_79",Yn="_maleOutputConnector_ch6ac_94",jn="_femaleOutputConnector_ch6ac_110",Vn="_inputsSection_ch6ac_126",Zn="_outputsSection_ch6ac_135",Xn="_nodeFont_ch6ac_144",B={femaleNode:Rn,maleNode:Un,selectedMaleNode:Gn,selectedFemaleNode:Hn,inputConnector:Wn,maleOutputConnector:Yn,femaleOutputConnector:jn,inputsSection:Vn,outputsSection:Zn,nodeFont:Xn};var qn=N("<p>");const Qn=t=>(()=>{var e=qn();return b(e,()=>t.node.customData?.name),M(()=>S(e,B.nodeFont)),e})(),Rt=async t=>await(await fetch(`https://randomuser.me/api/?inc=gender,name&noinfo&results=${t}`)).json().then(n=>n.results).then(n=>n.map(o=>({gender:o.gender==="female"?"F":"M",name:o.name.first+" "+o.name.last}))),xe=t=>({normal:t=="M"?fe.fatherCurve:fe.motherCurve,selected:t=="M"?fe.selectedFatherCurve:fe.selectedMotherCurve}),et=(t,e,n)=>{const o=t,s=y.addNode({css:{normal:e==="M"?B.maleNode:B.femaleNode,selected:e==="M"?B.selectedMaleNode:B.selectedFemaleNode},position:n,customData:{gender:e,name:t},display:Qn,centered:!0},o),i=s.addConnectorSection({id:"inputs",css:B.inputsSection},o);return s.addConnectorSection({id:"outputs",css:B.outputsSection},o).addConnector({id:"O",css:e==="M"?B.maleOutputConnector:B.femaleOutputConnector},o),i.addConnector({id:"I",css:B.inputConnector},o),s},Jn=async(t=50)=>{const e=await Rt(t);for(const n of e)et(n.name,n.gender,h.of((Math.random()*2-1)*2e3,(Math.random()*2-1)*2e3))},eo=()=>{y.eventStore.onPointerUpInConnector.blacklist("familytree-app:prevent-connections-to-parent-connectors",({connectorId:t},e)=>t==="O"&&e==="nodeflow:connect-held-nodes"),y.eventStore.onTouchStartInConnector.blacklist("familytree-app:prevent-connections-from-parent-connectors",({connectorId:t})=>t==="I"),y.eventStore.onMouseDownInConnector.blacklist("familytree-app:prevent-connections-from-parent-connectors",({connectorId:t})=>t==="I"),y.eventStore.onPointerUpInNodeflow.subscribe("familytree-app:spawn-new-node",()=>{const t=y.mouseData.heldConnectors;if(t.length!==1)return;const e=t[0].parentNode,n=y.mouseData.globalMousePosition();Rt(1).then(o=>{const s=et(o[0].name,o[0].gender,n);y.addConnection({sourceNodeId:e.id,sourceConnectorId:"O",destinationNodeId:s.id,destinationConnectorId:"I",css:xe(e.customData.gender)})})},1),y.eventStore.onNodeConnected.subscribe("nodeflow:create-connection",({outputNodeId:t,inputNodeId:e})=>{if(t===e)return;const n=y.nodes.get(t),s=y.nodes.get(e).getConnector("I")?.sources;s?.length===2||s?.some(i=>i.sourceConnector.parentNode.customData.gender===n.customData.gender)||y.addConnection({sourceNodeId:t,sourceConnectorId:"O",destinationNodeId:e,destinationConnectorId:"I",css:xe(n.customData.gender)})}),y.eventStore.onPointerUpInNode.subscribe("nodeflow:create-connection",({nodeId:t})=>{const e=y.nodes.get(t);if(!e||y.mouseData.heldConnectors.length!==1)return;const n=y.mouseData.heldConnectors[0].parentSection.parentNode;if(t===n.id)return;const o=e.getConnector("I")?.sources;o?.length===2||o?.some(s=>s.sourceConnector.parentNode.customData.gender===n.customData.gender)||y.addConnection({sourceNodeId:n.id,sourceConnectorId:"O",destinationNodeId:t,destinationConnectorId:"I",css:xe(n.customData.gender)})},2)},to=()=>{const t=y.nodes.size;for(let e=0;e<t;e++){const n=Math.floor(Math.random()*t),o=Math.floor(Math.random()*t);if(!y.nodes.has(n.toString())||!y.nodes.has(o.toString()))continue;const s=y.nodes.get(n.toString()),i=y.nodes.get(o.toString()),r=s.customData.gender,a=i.getConnector("I")?.sources;n===o||a?.length===2||a?.some(c=>c.sourceConnector.parentNode.customData.gender===r)||y.addConnection({sourceNodeId:n.toString(),sourceConnectorId:"O",destinationNodeId:o.toString(),destinationConnectorId:"I",css:xe(s.customData.gender)})}},Ct=t=>t?t.trim().replace(/\s+/g," "):"",no="_sidebar_o4wha_1",oo="_sidebarContent_o4wha_100",ke={"sidebar-container":"_sidebar-container_o4wha_1","sidebar-container-closed":"_sidebar-container-closed_o4wha_27",sidebar:no,"sidebar-toggle":"_sidebar-toggle_o4wha_52","sidebar-toggle-closed":"_sidebar-toggle-closed_o4wha_77",sidebarContent:oo},so="data:image/svg+xml,%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3c!--%20Credits:%20https://www.svgrepo.com/svg/218171/right-arrow-next%20--%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Transformed%20by:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20fill='%23cbc6c1'%20height='256px'%20width='256px'%20version='1.1'%20id='Layer_1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20viewBox='-24.6%20-24.6%20541.20%20541.20'%20xml:space='preserve'%20stroke='%23cbc6c1'%20stroke-width='0.0049200400000000005'%3e%3cg%20id='SVGRepo_bgCarrier'%20stroke-width='0'/%3e%3cg%20id='SVGRepo_tracerCarrier'%20stroke-linecap='round'%20stroke-linejoin='round'%20stroke='%23595757'%20stroke-width='49.2004'%3e%3cg%3e%3cg%3e%3cpath%20d='M382.678,226.804L163.73,7.86C158.666,2.792,151.906,0,144.698,0s-13.968,2.792-19.032,7.86l-16.124,16.12%20c-10.492,10.504-10.492,27.576,0,38.064L293.398,245.9l-184.06,184.06c-5.064,5.068-7.86,11.824-7.86,19.028%20c0,7.212,2.796,13.968,7.86,19.04l16.124,16.116c5.068,5.068,11.824,7.86,19.032,7.86s13.968-2.792,19.032-7.86L382.678,265%20c5.076-5.084,7.864-11.872,7.848-19.088C390.542,238.668,387.754,231.884,382.678,226.804z'/%3e%3c/g%3e%3c/g%3e%3c/g%3e%3cg%20id='SVGRepo_iconCarrier'%3e%3cg%3e%3cg%3e%3cpath%20d='M382.678,226.804L163.73,7.86C158.666,2.792,151.906,0,144.698,0s-13.968,2.792-19.032,7.86l-16.124,16.12%20c-10.492,10.504-10.492,27.576,0,38.064L293.398,245.9l-184.06,184.06c-5.064,5.068-7.86,11.824-7.86,19.028%20c0,7.212,2.796,13.968,7.86,19.04l16.124,16.116c5.068,5.068,11.824,7.86,19.032,7.86s13.968-2.792,19.032-7.86L382.678,265%20c5.076-5.084,7.864-11.872,7.848-19.088C390.542,238.668,387.754,231.884,382.678,226.804z'/%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/svg%3e";var io=N('<div><div></div><img alt="Toggle sidebar">');const ro=t=>{const[e,n]=de(!1);return(()=>{var o=io(),s=o.firstChild,i=s.nextSibling;return b(s,()=>t.children),i.$$click=()=>n(!e()),x(i,"src",so),x(i,"draggable",!1),M(r=>{var a=ke[e()?"sidebar-container":"sidebar-container-closed"],c=ke.sidebar,d=ke[e()?"sidebar-toggle":"sidebar-toggle-closed"];return a!==r.e&&S(o,r.e=a),c!==r.t&&S(s,r.t=c),d!==r.a&&S(i,r.a=d),r},{e:void 0,t:void 0,a:void 0}),o})()};ie(["click"]);const ao="_formButtonContainer_y6wad_1",co="_displayContainer_y6wad_9",lo="_fieldDisplayContainer_y6wad_37",uo="_femaleFont_y6wad_57",ho="_maleFont_y6wad_61",fo="_radioInputFemale_y6wad_65",po="_radioInputMale_y6wad_127",go="_horizontalRadioInput_y6wad_189",vo="_horizontalRadioContainer_y6wad_196",mo="_parentDisplayContainer_y6wad_204",Co="_parentDisplay_y6wad_204",wo="_invalidParent_y6wad_231",yo="_validMother_y6wad_235",Do="_validFather_y6wad_244",No="_childrenDisplayContainer_y6wad_253",bo="_childrenDisplayWindow_y6wad_280",So="_child_y6wad_253",E={formButtonContainer:ao,displayContainer:co,fieldDisplayContainer:lo,femaleFont:uo,maleFont:ho,radioInputFemale:fo,radioInputMale:po,horizontalRadioInput:go,horizontalRadioContainer:vo,parentDisplayContainer:mo,parentDisplay:Co,invalidParent:wo,validMother:yo,validFather:Do,childrenDisplayContainer:No,childrenDisplayWindow:bo,child:So};var Io=N("<div>"),Mo=N("<div><h2>Selected Node</h2><div><p>Name</p><p></p></div><div><p>Gender</p><p></p></div><div><div><p>Mother</p><p></p></div><div><p>Father</p><p></p></div></div><div><p>Children"),Eo=N("<p>None"),_o=N("<p>");const xo=t=>{const e=z(()=>t.nodeData.getAllSourceConnectors().map(i=>i.parentNode)),n=z(()=>e().find(i=>i.customData.gender==="F")),o=z(()=>e().find(i=>i.customData.gender==="M")),s=z(()=>t.nodeData.getAllDestinationConnectors().map(i=>i.parentNode).sort((i,r)=>i.customData.name.localeCompare(r.customData.name)));return(()=>{var i=Mo(),r=i.firstChild,a=r.nextSibling,c=a.firstChild,d=c.nextSibling,u=a.nextSibling,l=u.firstChild,f=l.nextSibling,m=u.nextSibling,g=m.firstChild,k=g.firstChild,A=k.nextSibling,Z=g.nextSibling,R=Z.firstChild,T=R.nextSibling,L=m.nextSibling;return L.firstChild,b(d,()=>t.nodeData.customData.name),b(f,()=>t.nodeData.customData.gender==="F"?"Female":"Male"),A.$$click=()=>{n()?.nodeflow.mouseData.clearSelections(),n()?.select()},b(A,()=>n()?.customData.name||"Unknown"),T.$$click=()=>{o()?.nodeflow.mouseData.clearSelections(),o()?.select()},b(T,()=>o()?.customData.name||"Unknown"),b(L,w(H,{get when(){return s()?.length>0},get fallback(){return Eo()},get children(){var C=Io();return b(C,w(ae,{get each(){return s()},children:Y=>(()=>{var re=_o();return re.$$click=()=>{Y.nodeflow.mouseData.clearSelections(),Y.select()},b(re,()=>Y.customData.name),M(()=>S(re,E.child)),re})()})),M(()=>S(C,E.childrenDisplayWindow)),C}}),null),M(C=>{var Y=E.displayContainer,re=E.fieldDisplayContainer,tt=E.fieldDisplayContainer,nt=E[t.nodeData.customData.gender==="F"?"femaleFont":"maleFont"],ot=E.parentDisplayContainer,st=E.parentDisplay,Ut={[E.validMother]:!!n(),[E.invalidParent]:!n()},it=E.parentDisplay,Gt={[E.validFather]:!!o(),[E.invalidParent]:!o()},rt=E.childrenDisplayContainer;return Y!==C.e&&S(i,C.e=Y),re!==C.t&&S(a,C.t=re),tt!==C.a&&S(u,C.a=tt),nt!==C.o&&S(f,C.o=nt),ot!==C.i&&S(m,C.i=ot),st!==C.n&&S(g,C.n=st),C.s=be(A,Ut,C.s),it!==C.h&&S(Z,C.h=it),C.r=be(T,Gt,C.r),rt!==C.d&&S(L,C.d=rt),C},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0}),i})()};ie(["click"]);var ko=N("<button>Add"),wt=N("<button>Save"),yt=N("<button>Cancel"),Po=N("<button>Edit"),Dt=N("<button>Delete"),zo=N("<div>");const Nt=t=>(()=>{var e=ko();return e.$$click=()=>t.onClick(),e})(),Ao=t=>{const e=()=>t.setFormData({name:""}),n=()=>t.setFormData(void 0),o=()=>t.setFormData({...t.nodeData}),s=()=>{y.removeNode(t.formData.id),t.setFormData(void 0)},i=()=>y.removeNode(t.nodeData.id),r=()=>{if(!t.formData?.name||!t.formData?.gender)return;const c=et(Ct(t.formData.name),t.formData.gender,y.center());y.mouseData.clearSelections(),c.select(c.getCenter()),t.setFormData(void 0)},a=()=>{const c=t.formData.id,d=y.nodes.get(c);if(d===void 0){t.setFormData(void 0);return}const u=d.customData,l=Object.fromEntries(Object.entries(t.formData).map(([m,g])=>[m,typeof g=="string"?Ct(g):g]).filter(([m,g])=>m!=="id"&&!!g&&g!==u[m]));if(Object.keys(l).length===0){t.setFormData(void 0);return}const f={customData:{...u,...l}};"gender"in l&&Object.assign(f,{css:{normal:l.gender==="M"?B.maleNode:B.femaleNode,selected:l.gender==="M"?B.selectedMaleNode:B.selectedFemaleNode}}),y.updateNode(c,f),t.setFormData(void 0),"gender"in l&&(d.getConnector("O").css=l.gender==="M"?B.maleOutputConnector:B.femaleOutputConnector,y.removeOutgoingConnections(c))};return(()=>{var c=zo();return b(c,w(H,{get when(){return t.mode==="empty"},get children(){return w(Nt,{onClick:e})}}),null),b(c,w(H,{get when(){return t.mode==="add"},get children(){return[(()=>{var d=wt();return d.$$click=r,d})(),(()=>{var d=yt();return d.$$click=n,d})()]}}),null),b(c,w(H,{get when(){return t.mode==="view"},get children(){return[w(Nt,{onClick:e}),(()=>{var d=Po();return d.$$click=o,d})(),(()=>{var d=Dt();return d.$$click=i,d})()]}}),null),b(c,w(H,{get when(){return t.mode==="edit"},get children(){return[(()=>{var d=wt();return d.$$click=a,d})(),(()=>{var d=yt();return d.$$click=n,d})(),(()=>{var d=Dt();return d.$$click=s,d})()]}}),null),M(()=>S(c,E.formButtonContainer)),c})()};ie(["click"]);var $o=N('<svg fill=#0078ea height=256px width=256px version=1.1 id=Capa_1 xmlns=http://www.w3.org/2000/svg viewBox="-30.6 -30.6 673.20 673.20"stroke=#0078ea><g id=SVGRepo_bgCarrier stroke-width=0></g><g id=SVGRepo_tracerCarrier stroke-linecap=round stroke-linejoin=round stroke=#080808 stroke-width=36.71988><g><path d="M569.569,0H413.755c-23.403,0-42.377,18.973-42.377,42.375s18.973,42.375,42.377,42.375h53.51L348.501,203.513 c-36.655-24.899-79.878-38.296-125.165-38.296c-59.67,0-115.768,23.237-157.961,65.429c-87.098,87.102-87.098,228.824,0,315.922 c42.193,42.193,98.291,65.431,157.961,65.431s115.768-23.237,157.961-65.431c76.855-76.855,85.878-196.233,27.101-283.094 l118.797-118.795v53.51c0,23.403,18.973,42.375,42.375,42.375c23.405,0,42.375-18.973,42.375-42.375V42.375 C611.945,18.973,592.972,0,569.569,0z M321.369,486.64c-26.186,26.186-61.001,40.607-98.032,40.607s-71.846-14.421-98.032-40.607 c-54.054-54.056-54.054-142.009,0-196.066c26.186-26.186,61.001-40.605,98.032-40.605s71.848,14.421,98.032,40.605 C375.422,344.632,375.422,432.587,321.369,486.64z"></path></g></g><g id=SVGRepo_iconCarrier><g><path d="M569.569,0H413.755c-23.403,0-42.377,18.973-42.377,42.375s18.973,42.375,42.377,42.375h53.51L348.501,203.513 c-36.655-24.899-79.878-38.296-125.165-38.296c-59.67,0-115.768,23.237-157.961,65.429c-87.098,87.102-87.098,228.824,0,315.922 c42.193,42.193,98.291,65.431,157.961,65.431s115.768-23.237,157.961-65.431c76.855-76.855,85.878-196.233,27.101-283.094 l118.797-118.795v53.51c0,23.403,18.973,42.375,42.375,42.375c23.405,0,42.375-18.973,42.375-42.375V42.375 C611.945,18.973,592.972,0,569.569,0z M321.369,486.64c-26.186,26.186-61.001,40.607-98.032,40.607s-71.846-14.421-98.032-40.607 c-54.054-54.056-54.054-142.009,0-196.066c26.186-26.186,61.001-40.605,98.032-40.605s71.848,14.421,98.032,40.605 C375.422,344.632,375.422,432.587,321.369,486.64z">');const Oo=()=>$o();var To=N('<svg fill=#ea0078 height=256px width=256px version=1.1 id=Capa_1 xmlns=http://www.w3.org/2000/svg viewBox="-23.86 -23.86 524.86 524.86"stroke=#cb3283 stroke-width=0.00477141><g id=SVGRepo_bgCarrier stroke-width=0></g><g id=SVGRepo_tracerCarrier stroke-linecap=round stroke-linejoin=round stroke=#080808 stroke-width=28.62846><g><path d="M326.711,341.99h-64.628v-64.634c0-0.686-0.142-1.323-0.213-1.997c65.409-11.119,115.378-68.161,115.378-136.681 C377.249,62.208,315.044,0,238.571,0C162.103,0,99.892,62.208,99.892,138.678c0,68.521,49.973,125.562,115.375,136.681 c-0.059,0.674-0.204,1.312-0.204,1.997v64.634h-64.631c-12.983,0-23.501,10.527-23.501,23.502c0,12.98,10.518,23.507,23.501,23.507 h64.637v64.64c0,12.98,10.524,23.502,23.501,23.502c12.979,0,23.513-10.527,23.513-23.502v-64.64h64.628 c12.986,0,23.508-10.526,23.508-23.507C350.219,352.518,339.698,341.99,326.711,341.99z M146.904,138.678 c0-50.546,41.121-91.673,91.667-91.673c50.549,0,91.676,41.122,91.676,91.673s-41.127,91.667-91.676,91.667 C188.031,230.346,146.904,189.224,146.904,138.678z"></path></g></g><g id=SVGRepo_iconCarrier><g><path d="M326.711,341.99h-64.628v-64.634c0-0.686-0.142-1.323-0.213-1.997c65.409-11.119,115.378-68.161,115.378-136.681 C377.249,62.208,315.044,0,238.571,0C162.103,0,99.892,62.208,99.892,138.678c0,68.521,49.973,125.562,115.375,136.681 c-0.059,0.674-0.204,1.312-0.204,1.997v64.634h-64.631c-12.983,0-23.501,10.527-23.501,23.502c0,12.98,10.518,23.507,23.501,23.507 h64.637v64.64c0,12.98,10.524,23.502,23.501,23.502c12.979,0,23.513-10.527,23.513-23.502v-64.64h64.628 c12.986,0,23.508-10.526,23.508-23.507C350.219,352.518,339.698,341.99,326.711,341.99z M146.904,138.678 c0-50.546,41.121-91.673,91.667-91.673c50.549,0,91.676,41.122,91.676,91.673s-41.127,91.667-91.676,91.667 C188.031,230.346,146.904,189.224,146.904,138.678z">');const Fo=()=>To();var Lo=N("<h2>Update Node"),Bo=N("<div><div><p>Name</p><input type=text name=lname placeholder=Name></div><div><p>Gender</p><div><div><input type=radio id=male name=gender value=M><label for=male>Male</label></div><div><input type=radio id=female name=gender value=M><label for=female>Female"),Ko=N("<h2>Create Node");const Ro=t=>(()=>{var e=Bo(),n=e.firstChild,o=n.firstChild,s=o.nextSibling,i=n.nextSibling,r=i.firstChild,a=r.nextSibling,c=a.firstChild,d=c.firstChild,u=d.nextSibling,l=c.nextSibling,f=l.firstChild,m=f.nextSibling;return b(e,w(H,{get when(){return t.formData.id},get fallback(){return Ko()},get children(){return Lo()}}),n),s.$$input=g=>t.updateFormData({name:g.target.value}),d.addEventListener("change",()=>t.updateFormData({gender:"M"})),b(c,w(Oo,{}),u),f.addEventListener("change",()=>t.updateFormData({gender:"F"})),b(l,w(Fo,{}),m),M(g=>{var k=E.displayContainer,A=E.fieldDisplayContainer,Z=E.fieldDisplayContainer,R=E.horizontalRadioContainer,T=E.horizontalRadioInput,L=E.radioInputMale,C=E.horizontalRadioInput,Y=E.radioInputFemale;return k!==g.e&&S(e,g.e=k),A!==g.t&&S(n,g.t=A),Z!==g.a&&S(i,g.a=Z),R!==g.o&&S(a,g.o=R),T!==g.i&&S(c,g.i=T),L!==g.n&&S(d,g.n=L),C!==g.s&&S(l,g.s=C),Y!==g.h&&S(f,g.h=Y),g},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),M(()=>s.value=t.formData.name),M(()=>d.checked=t.formData.gender==="M"),M(()=>f.checked=t.formData.gender==="F"),e})();ie(["input"]);var Uo=N("<div><h1>Family Tree"),Go=N("<h2>No Node Selected");const Ho=()=>{const[t,e]=de(void 0),n=z(()=>y.mouseData.selections.selectedNodesMap.values().next().value),o=z(()=>{const r=n();if(r)return{...r.customData,id:r.id}}),s=z(()=>t()!==void 0||o()!==void 0),i=z(()=>{if(!s())return"empty";const r=t();return r!==void 0?r.id?"edit":"add":"view"});return(()=>{var r=Uo();return r.firstChild,b(r,w(H,{get when(){return s()},get fallback(){return Go()},get children(){return w(H,{get when(){return t()!==void 0},get fallback(){return w(xo,{get nodeData(){return n()}})},get children(){return w(Ro,{get formData(){return t()},updateFormData:a=>e({...t(),...a})})}})}}),null),b(r,w(Ao,{get mode(){return i()},setFormData:e,get nodeData(){return o()},get formData(){return t()}}),null),M(()=>S(r,ke.sidebarContent)),r})()},Wo={MAIN_NODEFLOW:"main-nodeflow"};class Yo extends Tt{calculateCurveAnchors(e,n,o,s){const i=this.getVerticalCurve(e,n),r=e.add(i),a=n.subtract(i);return{anchorStart:r,anchorEnd:a}}}const[y,jo]=O.get().createCanvas(Wo.MAIN_NODEFLOW,{},t=>new Yo(t)),Vo=()=>{Yt(()=>{eo(),Jn().then(()=>to())});const t=e=>{if(e)return e.parentNode.customData.gender==="M"?fe.newFatherCurve:fe.newMotherCurve};return[w(jo,{get css(){return{getNewCurveCss:t,nodeflow:Kn.nodeflow}},get width(){return`${mt().x}px`},get height(){return`${mt().y}px`}}),w(ro,{get children(){return w(Ho,{})}})]},Zo=document.getElementById("root");tn(()=>w(Vo,{}),Zo);
