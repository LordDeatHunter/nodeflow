(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function o(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=o(i);fetch(i.href,s)}})();let wt=St;const Q=1,De=2,Ct={owned:null,cleanups:null,context:null,owner:null};var z=null;let Ue=null,Vt=null,B=null,E=null,G=null,We=0;function Zt(t,e){const o=B,n=z,i=t.length===0,s=e===void 0?n:e,c=i?Ct:{owned:null,cleanups:null,context:s?s.context:null,owner:s},r=i?t:()=>t(()=>je(()=>pe(c)));z=c,B=null;try{return Fe(r,!0)}finally{B=o,z=n}}function Ie(t,e,o){const n=bt(t,e,!1,Q);tt(n)}function Xt(t,e,o){wt=Jt;const n=bt(t,e,!1,Q);n.user=!0,G?G.push(n):tt(n)}function je(t){if(B===null)return t();const e=B;B=null;try{return t()}finally{B=e}}function Yt(t){Xt(()=>je(t))}function qt(t,e,o){let n=t.value;return(!t.comparator||!t.comparator(n,e))&&(t.value=e,t.observers&&t.observers.length&&Fe(()=>{for(let i=0;i<t.observers.length;i+=1){const s=t.observers[i],c=Ue&&Ue.running;c&&Ue.disposed.has(s),(c?!s.tState:!s.state)&&(s.pure?E.push(s):G.push(s),s.observers&&Dt(s)),c||(s.state=Q)}if(E.length>1e6)throw E=[],new Error},!1)),e}function tt(t){if(!t.fn)return;pe(t);const e=We;_t(t,t.value,e)}function _t(t,e,o){let n;const i=z,s=B;B=z=t;try{n=t.fn(e)}catch(c){return t.pure&&(t.state=Q,t.owned&&t.owned.forEach(pe),t.owned=null),t.updatedAt=o+1,It(c)}finally{B=s,z=i}(!t.updatedAt||t.updatedAt<=o)&&(t.updatedAt!=null&&"observers"in t?qt(t,n):t.value=n,t.updatedAt=o)}function bt(t,e,o,n=Q,i){const s={fn:t,state:n,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:z,context:z?z.context:null,pure:o};return z===null||z!==Ct&&(z.owned?z.owned.push(s):z.owned=[s]),s}function Ne(t){if(t.state===0)return;if(t.state===De)return Xe(t);if(t.suspense&&je(t.suspense.inFallback))return t.suspense.effects.push(t);const e=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<We);)t.state&&e.push(t);for(let o=e.length-1;o>=0;o--)if(t=e[o],t.state===Q)tt(t);else if(t.state===De){const n=E;E=null,Fe(()=>Xe(t,e[0]),!1),E=n}}function Fe(t,e){if(E)return t();let o=!1;e||(E=[]),G?o=!0:G=[],We++;try{const n=t();return Qt(o),n}catch(n){o||(G=null),E=null,It(n)}}function Qt(t){if(E&&(St(E),E=null),t)return;const e=G;G=null,e.length&&Fe(()=>wt(e),!1)}function St(t){for(let e=0;e<t.length;e++)Ne(t[e])}function Jt(t){let e,o=0;for(e=0;e<t.length;e++){const n=t[e];n.user?t[o++]=n:Ne(n)}for(e=0;e<o;e++)Ne(t[e])}function Xe(t,e){t.state=0;for(let o=0;o<t.sources.length;o+=1){const n=t.sources[o];if(n.sources){const i=n.state;i===Q?n!==e&&(!n.updatedAt||n.updatedAt<We)&&Ne(n):i===De&&Xe(n,e)}}}function Dt(t){for(let e=0;e<t.observers.length;e+=1){const o=t.observers[e];o.state||(o.state=De,o.pure?E.push(o):G.push(o),o.observers&&Dt(o))}}function pe(t){let e;if(t.sources)for(;t.sources.length;){const o=t.sources.pop(),n=t.sourceSlots.pop(),i=o.observers;if(i&&i.length){const s=i.pop(),c=o.observerSlots.pop();n<i.length&&(s.sourceSlots[c]=n,i[n]=s,o.observerSlots[n]=c)}}if(t.tOwned){for(e=t.tOwned.length-1;e>=0;e--)pe(t.tOwned[e]);delete t.tOwned}if(t.owned){for(e=t.owned.length-1;e>=0;e--)pe(t.owned[e]);t.owned=null}if(t.cleanups){for(e=t.cleanups.length-1;e>=0;e--)t.cleanups[e]();t.cleanups=null}t.state=0}function eo(t){return t instanceof Error?t:new Error(typeof t=="string"?t:"Unknown error",{cause:t})}function It(t,e=z){throw eo(t)}function Nt(t,e){return je(()=>t(e||{}))}function to(t,e,o){let n=o.length,i=e.length,s=n,c=0,r=0,a=e[i-1].nextSibling,d=null;for(;c<i||r<s;){if(e[c]===o[r]){c++,r++;continue}for(;e[i-1]===o[s-1];)i--,s--;if(i===c){const u=s<n?r?o[r-1].nextSibling:o[s-r]:a;for(;r<s;)t.insertBefore(o[r++],u)}else if(s===r)for(;c<i;)(!d||!d.has(e[c]))&&e[c].remove(),c++;else if(e[c]===o[s-1]&&o[r]===e[i-1]){const u=e[--i].nextSibling;t.insertBefore(o[r++],e[c++].nextSibling),t.insertBefore(o[--s],u),e[i]=o[s]}else{if(!d){d=new Map;let l=r;for(;l<s;)d.set(o[l],l++)}const u=d.get(e[c]);if(u!=null)if(r<u&&u<s){let l=c,f=1,g;for(;++l<i&&l<s&&!((g=d.get(e[l]))==null||g!==u+f);)f++;if(f>u-r){const y=e[c];for(;r<u;)t.insertBefore(o[r++],y)}else t.replaceChild(o[r++],e[c++])}else c++;else e[c++].remove()}}}function oo(t,e,o,n={}){let i;return Zt(s=>{i=s,e===document?t():Pe(e,t(),e.firstChild?null:void 0,o)},n.owner),()=>{i(),e.textContent=""}}function Pt(t,e,o){let n;const i=()=>{const c=document.createElement("template");return c.innerHTML=t,c.content.firstChild},s=()=>(n||(n=i())).cloneNode(!0);return s.cloneNode=s,s}function Pe(t,e,o,n){if(o!==void 0&&!n&&(n=[]),typeof e!="function")return ze(t,e,n,o);Ie(i=>ze(t,e(),i,o),n)}function ze(t,e,o,n,i){for(;typeof o=="function";)o=o();if(e===o)return o;const s=typeof e,c=n!==void 0;if(t=c&&o[0]&&o[0].parentNode||t,s==="string"||s==="number"){if(s==="number"&&(e=e.toString(),e===o))return o;if(c){let r=o[0];r&&r.nodeType===3?r.data!==e&&(r.data=e):r=document.createTextNode(e),o=ee(t,o,n,r)}else o!==""&&typeof o=="string"?o=t.firstChild.data=e:o=t.textContent=e}else if(e==null||s==="boolean")o=ee(t,o,n);else{if(s==="function")return Ie(()=>{let r=e();for(;typeof r=="function";)r=r();o=ze(t,r,o,n)}),()=>o;if(Array.isArray(e)){const r=[],a=o&&Array.isArray(o);if(Ye(r,e,o,i))return Ie(()=>o=ze(t,r,o,n,!0)),()=>o;if(r.length===0){if(o=ee(t,o,n),c)return o}else a?o.length===0?lt(t,r,n):to(t,o,r):(o&&ee(t),lt(t,r));o=r}else if(e.nodeType){if(Array.isArray(o)){if(c)return o=ee(t,o,n,e);ee(t,o,null,e)}else o==null||o===""||!t.firstChild?t.appendChild(e):t.replaceChild(e,t.firstChild);o=e}}return o}function Ye(t,e,o,n){let i=!1;for(let s=0,c=e.length;s<c;s++){let r=e[s],a=o&&o[t.length],d;if(!(r==null||r===!0||r===!1))if((d=typeof r)=="object"&&r.nodeType)t.push(r);else if(Array.isArray(r))i=Ye(t,r,a)||i;else if(d==="function")if(n){for(;typeof r=="function";)r=r();i=Ye(t,Array.isArray(r)?r:[r],Array.isArray(a)?a:[a])||i}else t.push(r),i=!0;else{const u=String(r);a&&a.nodeType===3&&a.data===u?t.push(a):t.push(document.createTextNode(u))}}return i}function lt(t,e,o=null){for(let n=0,i=e.length;n<i;n++)t.insertBefore(e[n],o)}function ee(t,e,o,n){if(o===void 0)return t.textContent="";const i=n||document.createTextNode("");if(e.length){let s=!1;for(let c=e.length-1;c>=0;c--){const r=e[c];if(i!==r){const a=r.parentNode===t;!s&&!c?a?t.replaceChild(i,r):t.insertBefore(i,o):a&&r.remove()}else s=!0}}else t.insertBefore(i,o);return[i]}(function(){try{if(typeof document<"u"){var t=document.createElement("style");t.appendChild(document.createTextNode("@layer nodeflow{.nodeflowConnectorSection{position:absolute;display:flex;justify-content:space-evenly;width:0;height:0;top:50%;left:50%}.nodeflowNode{position:absolute;border:1px solid black;-webkit-user-select:none;user-select:none;z-index:1;cursor:grab}}")),document.head.appendChild(t)}}catch(e){console.error("vite-plugin-css-injected-by-js",e)}})();var no=Object.defineProperty,so=(t,e,o)=>e in t?no(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,p=(t,e,o)=>(so(t,typeof e!="symbol"?e+"":e,o),o),zt=(t,e,o)=>{if(!e.has(t))throw TypeError("Cannot "+o)},v=(t,e,o)=>(zt(t,e,"read from private field"),o?o.call(t):e.get(t)),qe=(t,e,o)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,o)},io=(t,e,o,n)=>(zt(t,e,"write to private field"),e.set(t,o),o);const ro=(t,e)=>t===e,_=Symbol("solid-proxy"),_e=Symbol("solid-track"),xe={equals:ro};let xt=At;const Z=1,ke=2,kt={owned:null,cleanups:null,context:null,owner:null};var w=null;let He=null,m=null,D=null,U=null,Ke=0;function Re(t,e){const o=m,n=w,i=t.length===0,s=n,c=i?kt:{owned:null,cleanups:null,context:s?s.context:null,owner:s},r=i?t:()=>t(()=>V(()=>ve(c)));w=c,m=null;try{return de(r,!0)}finally{m=o,w=n}}function me(t,e){e=e?Object.assign({},xe,e):xe;const o={value:t,observers:null,observerSlots:null,comparator:e.equals||void 0},n=i=>(typeof i=="function"&&(i=i(o.value)),Mt(o,i));return[Et.bind(o),n]}function x(t,e,o){const n=nt(t,e,!1,Z);we(n)}function ge(t,e,o){xt=lo;const n=nt(t,e,!1,Z);n.user=!0,U?U.push(n):we(n)}function L(t,e,o){o=o?Object.assign({},xe,o):xe;const n=nt(t,e,!0,0);return n.observers=null,n.observerSlots=null,n.comparator=o.equals||void 0,we(n),Et.bind(n)}function be(t){return de(t,!1)}function V(t){if(m===null)return t();const e=m;m=null;try{return t()}finally{m=e}}function ot(t){return w===null||(w.cleanups===null?w.cleanups=[t]:w.cleanups.push(t)),t}function Ee(){return m}function Et(){if(this.sources&&this.state)if(this.state===Z)we(this);else{const t=D;D=null,de(()=>Ae(this),!1),D=t}if(m){const t=this.observers?this.observers.length:0;m.sources?(m.sources.push(this),m.sourceSlots.push(t)):(m.sources=[this],m.sourceSlots=[t]),this.observers?(this.observers.push(m),this.observerSlots.push(m.sources.length-1)):(this.observers=[m],this.observerSlots=[m.sources.length-1])}return this.value}function Mt(t,e,o){let n=t.value;return(!t.comparator||!t.comparator(n,e))&&(t.value=e,t.observers&&t.observers.length&&de(()=>{for(let i=0;i<t.observers.length;i+=1){const s=t.observers[i],c=He&&He.running;c&&He.disposed.has(s),(c?!s.tState:!s.state)&&(s.pure?D.push(s):U.push(s),s.observers&&Ot(s)),c||(s.state=Z)}if(D.length>1e6)throw D=[],new Error},!1)),e}function we(t){if(!t.fn)return;ve(t);const e=Ke;co(t,t.value,e)}function co(t,e,o){let n;const i=w,s=m;m=w=t;try{n=t.fn(e)}catch(c){return t.pure&&(t.state=Z,t.owned&&t.owned.forEach(ve),t.owned=null),t.updatedAt=o+1,Tt(c)}finally{m=s,w=i}(!t.updatedAt||t.updatedAt<=o)&&(t.updatedAt!=null&&"observers"in t?Mt(t,n):t.value=n,t.updatedAt=o)}function nt(t,e,o,n=Z,i){const s={fn:t,state:n,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:w,context:w?w.context:null,pure:o};return w===null||w!==kt&&(w.owned?w.owned.push(s):w.owned=[s]),s}function Me(t){if(t.state===0)return;if(t.state===ke)return Ae(t);if(t.suspense&&V(t.suspense.inFallback))return t.suspense.effects.push(t);const e=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<Ke);)t.state&&e.push(t);for(let o=e.length-1;o>=0;o--)if(t=e[o],t.state===Z)we(t);else if(t.state===ke){const n=D;D=null,de(()=>Ae(t,e[0]),!1),D=n}}function de(t,e){if(D)return t();let o=!1;e||(D=[]),U?o=!0:U=[],Ke++;try{const n=t();return ao(o),n}catch(n){o||(U=null),D=null,Tt(n)}}function ao(t){if(D&&(At(D),D=null),t)return;const e=U;U=null,e.length&&de(()=>xt(e),!1)}function At(t){for(let e=0;e<t.length;e++)Me(t[e])}function lo(t){let e,o=0;for(e=0;e<t.length;e++){const n=t[e];n.user?t[o++]=n:Me(n)}for(e=0;e<o;e++)Me(t[e])}function Ae(t,e){t.state=0;for(let o=0;o<t.sources.length;o+=1){const n=t.sources[o];if(n.sources){const i=n.state;i===Z?n!==e&&(!n.updatedAt||n.updatedAt<Ke)&&Me(n):i===ke&&Ae(n,e)}}}function Ot(t){for(let e=0;e<t.observers.length;e+=1){const o=t.observers[e];o.state||(o.state=ke,o.pure?D.push(o):U.push(o),o.observers&&Ot(o))}}function ve(t){let e;if(t.sources)for(;t.sources.length;){const o=t.sources.pop(),n=t.sourceSlots.pop(),i=o.observers;if(i&&i.length){const s=i.pop(),c=o.observerSlots.pop();n<i.length&&(s.sourceSlots[c]=n,i[n]=s,o.observerSlots[n]=c)}}if(t.tOwned){for(e=t.tOwned.length-1;e>=0;e--)ve(t.tOwned[e]);delete t.tOwned}if(t.owned){for(e=t.owned.length-1;e>=0;e--)ve(t.owned[e]);t.owned=null}if(t.cleanups){for(e=t.cleanups.length-1;e>=0;e--)t.cleanups[e]();t.cleanups=null}t.state=0}function uo(t){return t instanceof Error?t:new Error(typeof t=="string"?t:"Unknown error",{cause:t})}function Tt(t,e=w){throw uo(t)}const ho=Symbol("fallback");function dt(t){for(let e=0;e<t.length;e++)t[e]()}function fo(t,e,o={}){let n=[],i=[],s=[],c=0,r=e.length>1?[]:null;return ot(()=>dt(s)),()=>{let a=t()||[],d=a.length,u,l;return a[_e],V(()=>{let g,y,I,M,Ce,T,$,W,J;if(d===0)c!==0&&(dt(s),s=[],n=[],i=[],c=0,r&&(r=[])),o.fallback&&(n=[ho],i[0]=Re(Rt=>(s[0]=Rt,o.fallback())),c=1);else if(c===0){for(i=new Array(d),l=0;l<d;l++)n[l]=a[l],i[l]=Re(f);c=d}else{for(I=new Array(d),M=new Array(d),r&&(Ce=new Array(d)),T=0,$=Math.min(c,d);T<$&&n[T]===a[T];T++);for($=c-1,W=d-1;$>=T&&W>=T&&n[$]===a[W];$--,W--)I[W]=i[$],M[W]=s[$],r&&(Ce[W]=r[$]);for(g=new Map,y=new Array(W+1),l=W;l>=T;l--)J=a[l],u=g.get(J),y[l]=u===void 0?-1:u,g.set(J,l);for(u=T;u<=$;u++)J=n[u],l=g.get(J),l!==void 0&&l!==-1?(I[l]=i[u],M[l]=s[u],r&&(Ce[l]=r[u]),l=y[l],g.set(J,l)):s[u]();for(l=T;l<d;l++)l in I?(i[l]=I[l],s[l]=M[l],r&&(r[l]=Ce[l],r[l](l))):i[l]=Re(f);i=i.slice(0,c=d),n=a.slice(0)}return i});function f(g){if(s[l]=g,r){const[y,I]=me(l);return r[l]=I,e(a[l],y)}return e(a[l])}}}function k(t,e){return V(()=>t(e||{}))}const po=t=>`Stale read from <${t}>.`;function oe(t){const e="fallback"in t&&{fallback:()=>t.fallback};return L(fo(()=>t.each,t.children,e||void 0))}function st(t){const e=t.keyed,o=L(()=>t.when,void 0,{equals:(n,i)=>e?n===i:!n==!i});return L(()=>{const n=o();if(n){const i=t.children;return typeof i=="function"&&i.length>0?V(()=>i(e?n:()=>{if(!V(o))throw po("Show");return t.when})):i}return t.fallback},void 0,void 0)}function go(t,e,o){let n=o.length,i=e.length,s=n,c=0,r=0,a=e[i-1].nextSibling,d=null;for(;c<i||r<s;){if(e[c]===o[r]){c++,r++;continue}for(;e[i-1]===o[s-1];)i--,s--;if(i===c){const u=s<n?r?o[r-1].nextSibling:o[s-r]:a;for(;r<s;)t.insertBefore(o[r++],u)}else if(s===r)for(;c<i;)(!d||!d.has(e[c]))&&e[c].remove(),c++;else if(e[c]===o[s-1]&&o[r]===e[i-1]){const u=e[--i].nextSibling;t.insertBefore(o[r++],e[c++].nextSibling),t.insertBefore(o[--s],u),e[i]=o[s]}else{if(!d){d=new Map;let l=r;for(;l<s;)d.set(o[l],l++)}const u=d.get(e[c]);if(u!=null)if(r<u&&u<s){let l=c,f=1,g;for(;++l<i&&l<s&&!((g=d.get(e[l]))==null||g!==u+f);)f++;if(f>u-r){const y=e[c];for(;r<u;)t.insertBefore(o[r++],y)}else t.replaceChild(o[r++],e[c++])}else c++;else e[c++].remove()}}}const ut="_$DX_DELEGATE";function X(t,e,o){let n;const i=()=>{const c=document.createElement("template");return c.innerHTML=t,o?c.content.firstChild.firstChild:c.content.firstChild},s=e?()=>V(()=>document.importNode(n||(n=i()),!0)):()=>(n||(n=i())).cloneNode(!0);return s.cloneNode=s,s}function Ge(t,e=window.document){const o=e[ut]||(e[ut]=new Set);for(let n=0,i=t.length;n<i;n++){const s=t[n];o.has(s)||(o.add(s),e.addEventListener(s,vo))}}function C(t,e,o){o==null?t.removeAttribute(e):t.setAttribute(e,o)}function $t(t,e){e==null?t.removeAttribute("class"):t.className=e}function Qe(t,e,o={}){const n=Object.keys(e||{}),i=Object.keys(o);let s,c;for(s=0,c=i.length;s<c;s++){const r=i[s];!r||r==="undefined"||e[r]||(ht(t,r,!1),delete o[r])}for(s=0,c=n.length;s<c;s++){const r=n[s],a=!!e[r];!r||r==="undefined"||o[r]===a||!a||(ht(t,r,!0),o[r]=a)}return o}function it(t,e,o){return V(()=>t(e,o))}function q(t,e,o,n){if(o!==void 0&&!n&&(n=[]),typeof e!="function")return Oe(t,e,n,o);x(i=>Oe(t,e(),i,o),n)}function ht(t,e,o){const n=e.trim().split(/\s+/);for(let i=0,s=n.length;i<s;i++)t.classList.toggle(n[i],o)}function vo(t){let e=t.target;const o=`$$${t.type}`,n=t.target,i=t.currentTarget,s=a=>Object.defineProperty(t,"target",{configurable:!0,value:a}),c=()=>{const a=e[o];if(a&&!e.disabled){const d=e[`${o}Data`];if(d!==void 0?a.call(e,d,t):a.call(e,t),t.cancelBubble)return}return e.host&&typeof e.host!="string"&&!e.host._$host&&e.contains(t.target)&&s(e.host),!0},r=()=>{for(;c()&&(e=e._$host||e.parentNode||e.host););};if(Object.defineProperty(t,"currentTarget",{configurable:!0,get(){return e||document}}),t.composedPath){const a=t.composedPath();s(a[0]);for(let d=0;d<a.length-2&&(e=a[d],!!c());d++){if(e._$host){e=e._$host,r();break}if(e.parentNode===i)break}}else r();s(n)}function Oe(t,e,o,n,i){for(;typeof o=="function";)o=o();if(e===o)return o;const s=typeof e,c=n!==void 0;if(t=c&&o[0]&&o[0].parentNode||t,s==="string"||s==="number"){if(s==="number"&&(e=e.toString(),e===o))return o;if(c){let r=o[0];r&&r.nodeType===3?r.data!==e&&(r.data=e):r=document.createTextNode(e),o=te(t,o,n,r)}else o!==""&&typeof o=="string"?o=t.firstChild.data=e:o=t.textContent=e}else if(e==null||s==="boolean")o=te(t,o,n);else{if(s==="function")return x(()=>{let r=e();for(;typeof r=="function";)r=r();o=Oe(t,r,o,n)}),()=>o;if(Array.isArray(e)){const r=[],a=o&&Array.isArray(o);if(Je(r,e,o,i))return x(()=>o=Oe(t,r,o,n,!0)),()=>o;if(r.length===0){if(o=te(t,o,n),c)return o}else a?o.length===0?ft(t,r,n):go(t,o,r):(o&&te(t),ft(t,r));o=r}else if(e.nodeType){if(Array.isArray(o)){if(c)return o=te(t,o,n,e);te(t,o,null,e)}else o==null||o===""||!t.firstChild?t.appendChild(e):t.replaceChild(e,t.firstChild);o=e}}return o}function Je(t,e,o,n){let i=!1;for(let s=0,c=e.length;s<c;s++){let r=e[s],a=o&&o[t.length],d;if(!(r==null||r===!0||r===!1))if((d=typeof r)=="object"&&r.nodeType)t.push(r);else if(Array.isArray(r))i=Je(t,r,a)||i;else if(d==="function")if(n){for(;typeof r=="function";)r=r();i=Je(t,Array.isArray(r)?r:[r],Array.isArray(a)?a:[a])||i}else t.push(r),i=!0;else{const u=String(r);a&&a.nodeType===3&&a.data===u?t.push(a):t.push(document.createTextNode(u))}}return i}function ft(t,e,o=null){for(let n=0,i=e.length;n<i;n++)t.insertBefore(e[n],o)}function te(t,e,o,n){if(o===void 0)return t.textContent="";const i=n||document.createTextNode("");if(e.length){let s=!1;for(let c=e.length-1;c>=0;c--){const r=e[c];if(i!==r){const a=r.parentNode===t;!s&&!c?a?t.replaceChild(i,r):t.insertBefore(i,o):a&&r.remove()}else s=!0}}else t.insertBefore(i,o);return[i]}class h{constructor(e,o){p(this,"x"),p(this,"y"),this.x=e,this.y=o}static zero(){return new h(0,0)}static of(e,o){return new h(e,o)}static fromEvent(e){return new h(e.clientX,e.clientY)}static fromVec2(e){return new h(e.x,e.y)}copy(){return h.fromVec2(this)}serialize(){return{x:this.x,y:this.y}}static deserialize(e){return new h(e.x,e.y)}static deserializeOrDefault(e,o=h.zero()){return e?h.deserialize(e):o}add(...e){return e.reduce((o,n)=>new h(o.x+n.x,o.y+n.y),this)}subtract(...e){return e.reduce((o,n)=>new h(o.x-n.x,o.y-n.y),this)}multiply(...e){return e.reduce((o,n)=>new h(o.x*n.x,o.y*n.y),this)}divide(...e){return e.reduce((o,n)=>new h(n.x/o.x,n.y/o.y),this)}negate(){return new h(-this.x,-this.y)}shift(e){return new h(this.x+e,this.y+e)}multiplyBy(e){return new h(this.x*e,this.y*e)}divideBy(e){return new h(this.x/e,this.y/e)}isWithinRect(e,o){return this.x>=e.x&&this.x<=e.x+o.x&&this.y>=e.y&&this.y<=e.y+o.y}distanceTo(e){return Math.hypot(this.x-e.x,this.y-e.y)}abs(){return h.of(Math.abs(this.x),Math.abs(this.y))}equals(e){return this.x===e.x&&this.y===e.y}hashCode(){return`${this.x}:${this.y}`}get magnitude(){return Math.hypot(this.x,this.y)}normalize(){const e=this.magnitude;return new h(this.x/e,this.y/e)}}var yo=X("<div>");const mo=t=>(()=>{var e=yo();return e.$$pointerup=o=>t.nodeflowData.eventStore.onPointerUpInConnector.publish({event:o,nodeId:t.nodeId,connectorId:t.connectorId}),e.$$touchstart=o=>t.nodeflowData.eventStore.onTouchStartInConnector.publish({event:o,nodeId:t.nodeId,connectorId:t.connectorId}),e.$$mousedown=o=>t.nodeflowData.eventStore.onMouseDownInConnector.publish({event:o,nodeId:t.nodeId,connectorId:t.connectorId}),it(o=>setTimeout(()=>{var n,i;if(!o)return;const s=t.nodeflowData.nodes.get(t.nodeId).connectorSections.get(t.sectionId).connectors.get(t.connectorId),c=new ResizeObserver(()=>{s.size=h.of(o.offsetWidth,o.offsetHeight)});c.observe(o),s.update({position:h.of((((n=o?.parentElement)==null?void 0:n.offsetLeft)??0)+o.offsetLeft,(((i=o?.parentElement)==null?void 0:i.offsetTop)??0)+o.offsetTop),ref:o,resizeObserver:c,size:h.of(o.offsetWidth,o.offsetHeight)})}),e),x(o=>{var n,i=(n=t.connector)==null?void 0:n.css,s=`connector-${t.connectorId}`;return i!==o.e&&$t(e,o.e=i),s!==o.t&&C(e,"id",o.t=s),o},{e:void 0,t:void 0}),e})();Ge(["mousedown","touchstart","pointerup"]);var pt=X("<svg><circle r=4 fill=none></svg>",!1,!0),wo=X("<svg><path stroke=black stroke-width=1 fill=transparent>");const Co=t=>{const e=L(()=>{const{mouseData:o,curveFunctions:n}=t.nodeflowData;if(o.heldConnectors.length!==1)return;const i=o.heldConnectors[0].connector,s=i.parentNode,c=i.getCenter(),r=o.globalMousePosition(),{anchorStart:a,anchorEnd:d}=n.calculateCurveAnchors(c,r,s.getCenter(),r);return{start:c,end:r,anchorStart:a,anchorEnd:d,path:n.createDefaultCurvePath(c,r,a,d)}});return(()=>{var o=wo(),n=o.firstChild;return o.style.setProperty("z-index","2"),o.style.setProperty("position","absolute"),o.style.setProperty("width","1px"),o.style.setProperty("height","1px"),o.style.setProperty("pointer-events","none"),o.style.setProperty("overflow","visible"),q(o,k(st,{get when(){return t.nodeflowData.settings.debugMode},get children(){return[(()=>{var i=pt();return x(s=>{var c,r,a=(c=e())==null?void 0:c.anchorStart.x,d=(r=e())==null?void 0:r.anchorStart.y,u=t.css??"";return a!==s.e&&C(i,"cx",s.e=a),d!==s.t&&C(i,"cy",s.t=d),u!==s.a&&C(i,"class",s.a=u),s},{e:void 0,t:void 0,a:void 0}),i})(),(()=>{var i=pt();return x(s=>{var c,r,a=(c=e())==null?void 0:c.anchorEnd.x,d=(r=e())==null?void 0:r.anchorEnd.y,u=t.css??"";return a!==s.e&&C(i,"cx",s.e=a),d!==s.t&&C(i,"cy",s.t=d),u!==s.a&&C(i,"class",s.a=u),s},{e:void 0,t:void 0,a:void 0}),i})()]}}),null),x(i=>{var s,c=(s=e())==null?void 0:s.path,r=t.css;return c!==i.e&&C(n,"d",i.e=c),r!==i.t&&C(n,"class",i.t=r),i},{e:void 0,t:void 0}),o})()};var bo=X("<svg><path stroke=black stroke-width=1 fill=none></svg>",!1,!0),gt=X("<svg><circle r=4 fill=none></svg>",!1,!0);const So=t=>{const e=L(()=>t.nodeflowData.nodes.get(t.sourceNodeId)),o=L(()=>t.nodeflowData.nodes.get(t.destinationNodeId)),n=L(()=>e().getConnector(t.sourceConnectorId)),i=L(()=>o().getConnector(t.destinationConnectorId)),s=L(()=>{var c,r;return!e()||!o()?-1:((r=(c=n())==null?void 0:c.destinations)==null?void 0:r.findIndex(a=>a.destinationConnector===i()))??-1});return ge(()=>{if(s()<0)return;const{curveFunctions:c}=t.nodeflowData,r=e().getConnector(t.sourceConnectorId),a=o().getConnector(t.destinationConnectorId),d=r.getCenter(),u=a.getCenter(),{anchorStart:l,anchorEnd:f}=c.calculateCurveAnchors(d,u,e().getCenter(),o().getCenter());n().destinations.get(s()).path={start:d,end:u,anchorStart:l,anchorEnd:f,path:c.createDefaultCurvePath(d,u,l,f)}}),[(()=>{var c=bo();return c.$$pointerdown=r=>{t.nodeflowData.eventStore.onPointerDownInNodeCurve.publish({event:r,sourceConnector:n(),destinationConnector:i()})},c.style.setProperty("cursor","pointer"),c.style.setProperty("pointer-events","visibleStroke"),x(r=>{var a,d,u,l=(a=n().destinations.get(s()).path)==null?void 0:a.path,f={[((d=t.css)==null?void 0:d.normal)??""]:!0,[((u=t.css)==null?void 0:u.selected)??""]:t.nodeflowData.mouseData.hasSelectedConnection(t.sourceNodeId,t.sourceConnectorId,t.destinationNodeId,t.destinationConnectorId)};return l!==r.e&&C(c,"d",r.e=l),r.t=Qe(c,f,r.t),r},{e:void 0,t:void 0}),c})(),k(st,{get when(){return t.nodeflowData.settings.debugMode},get children(){return[(()=>{var c=gt();return x(r=>{var a,d,u,l,f,g=(d=(a=n().destinations.get(s()).path)==null?void 0:a.anchorStart)==null?void 0:d.x,y=(l=(u=n().destinations.get(s()).path)==null?void 0:u.anchorStart)==null?void 0:l.y,I=((f=t.css)==null?void 0:f.normal)??"";return g!==r.e&&C(c,"cx",r.e=g),y!==r.t&&C(c,"cy",r.t=y),I!==r.a&&C(c,"class",r.a=I),r},{e:void 0,t:void 0,a:void 0}),c})(),(()=>{var c=gt();return x(r=>{var a,d,u,l,f,g=(d=(a=n().destinations.get(s()).path)==null?void 0:a.anchorEnd)==null?void 0:d.x,y=(l=(u=n().destinations.get(s()).path)==null?void 0:u.anchorEnd)==null?void 0:l.y,I=((f=t.css)==null?void 0:f.normal)??"";return g!==r.e&&C(c,"cx",r.e=g),y!==r.t&&C(c,"cy",r.t=y),I!==r.a&&C(c,"class",r.a=I),r},{e:void 0,t:void 0,a:void 0}),c})()]}})]};Ge(["pointerdown"]);var Do=X("<div class=nodeflowNode>"),Io=X("<div>");const No=t=>{const e=L(()=>t.nodeflowData.nodes.get(t.nodeId)),[o,n]=me(!1);return x(()=>{const i=t.nodeflowData.mouseData.selections.at(-1);i?.type!=="node"||i.node.id!==t.nodeId||!t.nodeflowData.mouseData.pointerDown||e().updateWithPrevious(s=>{const c=t.nodeflowData.mouseData.mousePosition.divideBy(t.nodeflowData.zoomLevel).subtract(t.nodeflowData.mouseData.clickStartPosition??h.zero());return t.nodeflowData.chunking.updateNodeInChunk(t.nodeId,s.position,c),{position:c}})}),ot(()=>{t.nodeflowData.chunking.removeNodeFromChunk(t.nodeId,e().position),e().resizeObserver&&(e().resizeObserver.disconnect(),Array.from(e().connectorSections.values()).forEach(i=>{Array.from(i.connectors.values()).forEach(s=>{s.resizeObserver&&s.resizeObserver.disconnect()})}))}),(()=>{var i=Do();return i.$$pointerup=s=>t.nodeflowData.eventStore.onPointerUpInNode.publish({event:s,nodeId:t.nodeId}),i.$$touchstart=s=>t.nodeflowData.eventStore.onTouchStartInNode.publish({event:s,nodeId:t.nodeId}),i.$$mousedown=s=>t.nodeflowData.eventStore.onMouseDownInNode.publish({event:s,nodeId:t.nodeId}),it(s=>setTimeout(()=>{if(!s)return;const c=new ResizeObserver(()=>{e().update({size:h.of(s.clientWidth,s.clientHeight)}),Array.from(e().connectorSections.values()).forEach(a=>Array.from(a.connectors.values()).forEach(d=>{var u,l;const f=d.ref;f&&(d.position=h.of((((u=f?.parentElement)==null?void 0:u.offsetLeft)??0)+f.offsetLeft,(((l=f?.parentElement)==null?void 0:l.offsetTop)??0)+f.offsetTop))}))});c.observe(s);const r=e().centered?h.of(s.clientWidth,s.clientHeight).divideBy(2):h.zero();e().update({offset:h.of(s.clientLeft,s.clientTop),ref:s,resizeObserver:c,position:e().position.subtract(r),size:h.of(s.clientWidth,s.clientHeight)}),n(!0)}),i),q(i,()=>e().display({node:e()}),null),q(i,k(oe,{get each(){return Array.from(e().connectorSections.entries())},children:([s,c])=>(()=>{var r=Io();return C(r,"id",`section-${s}`),q(r,k(oe,{get each(){return Array.from(c.connectors.entries())},children:([a,d])=>k(mo,{connector:d,connectorId:a,get nodeId(){return t.nodeId},sectionId:s,get nodeflowData(){return t.nodeflowData}})})),x(a=>Qe(r,{[c?.css??""]:!0,nodeflowConnectorSection:!0},a)),r})()}),null),x(s=>{var c,r,a,d,u=`${e().position.x}px`,l=`${e().position.y}px`,f=o()?1:0,g=`node-${t.nodeId}`,y={[((r=(c=e())==null?void 0:c.css)==null?void 0:r.normal)??""]:!0,[((d=(a=e())==null?void 0:a.css)==null?void 0:d.selected)??""]:t.nodeflowData.mouseData.hasSelectedNode(t.nodeId)};return u!==s.e&&((s.e=u)!=null?i.style.setProperty("left",u):i.style.removeProperty("left")),l!==s.t&&((s.t=l)!=null?i.style.setProperty("top",l):i.style.removeProperty("top")),f!==s.a&&((s.a=f)!=null?i.style.setProperty("opacity",f):i.style.removeProperty("opacity")),g!==s.o&&C(i,"id",s.o=g),s.i=Qe(i,y,s.i),s},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),i})()};Ge(["mousedown","touchstart","pointerup"]);var Po=X("<div tabindex=0><div><svg>");const zo=t=>e=>(()=>{var o=Po(),n=o.firstChild,i=n.firstChild;return o.$$touchmove=s=>t.eventStore.onTouchMoveInNodeflow.publish({event:s}),o.$$touchstart=s=>t.eventStore.onTouchStartInNodeflow.publish({event:s}),o.$$keyup=s=>t.eventStore.onKeyUpInNodeflow.publish({event:s}),o.$$keydown=s=>t.eventStore.onKeyDownInNodeflow.publish({event:s}),o.$$mousedown=s=>t.eventStore.onMouseDownInNodeflow.publish({event:s}),o.addEventListener("wheel",s=>t.eventStore.onWheelInNodeflow.publish({event:s})),o.$$pointerup=s=>t.eventStore.onPointerUpInNodeflow.publish({event:s}),o.$$mousemove=s=>t.eventStore.onMouseMoveInNodeflow.publish({event:s}),it(s=>{new ResizeObserver(()=>{t.update({size:h.of(s.clientWidth,s.clientHeight),startPosition:h.of(s.offsetLeft,s.offsetTop)})}).observe(s)},o),o.style.setProperty("overflow","hidden"),n.style.setProperty("position","absolute"),n.style.setProperty("transform-origin","center"),n.style.setProperty("transition","scale 0.1s ease-out"),q(n,k(oe,{get each(){return Array.from(t.nodes.keys())},children:s=>k(No,{nodeId:s,nodeflowData:t})}),i),i.style.setProperty("z-index","2"),i.style.setProperty("position","absolute"),i.style.setProperty("width","1px"),i.style.setProperty("height","1px"),i.style.setProperty("pointer-events","none"),i.style.setProperty("overflow","visible"),q(i,k(oe,{get each(){return Array.from(t.nodes.entries())},children:([s,c])=>k(oe,{get each(){return c.getAllConnectors()},children:r=>k(oe,{get each(){return r.destinations.array},children:a=>k(So,{nodeflowData:t,sourceNodeId:s,get sourceConnectorId(){return r.id},get destinationNodeId(){return a.destinationConnector.parentSection.parentNode.id},get destinationConnectorId(){return a.destinationConnector.id},get css(){return a.css}})})})})),q(n,k(st,{get when(){return t.mouseData.heldConnectors.length===1},get children(){return k(Co,{get css(){var s;return(s=e?.css)==null?void 0:s.newCurve},nodeflowData:t})}}),null),x(s=>{var c,r=`nodeflow-${t.id}`,a=(c=e?.css)==null?void 0:c.nodeflow,d=e.height,u=e.width,l=`scale(${t.zoomLevel}) translate(${t.position.x}px, ${t.position.y}px)`;return r!==s.e&&C(o,"id",s.e=r),a!==s.t&&$t(o,s.t=a),d!==s.a&&((s.a=d)!=null?o.style.setProperty("height",d):o.style.removeProperty("height")),u!==s.o&&((s.o=u)!=null?o.style.setProperty("width",u):o.style.removeProperty("width")),l!==s.i&&((s.i=l)!=null?n.style.setProperty("transform",l):n.style.removeProperty("transform")),s},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),o})();Ge(["mousemove","pointerup","mousedown","keydown","keyup","touchstart","touchmove"]);const Te=Symbol("store-raw"),se=Symbol("store-node"),F=Symbol("store-has"),Lt=Symbol("store-self");function Bt(t){let e=t[_];if(!e&&(Object.defineProperty(t,_,{value:e=new Proxy(t,Eo)}),!Array.isArray(t))){const o=Object.keys(t),n=Object.getOwnPropertyDescriptors(t);for(let i=0,s=o.length;i<s;i++){const c=o[i];n[c].get&&Object.defineProperty(t,c,{enumerable:n[c].enumerable,get:n[c].get.bind(e)})}}return e}function re(t){let e;return t!=null&&typeof t=="object"&&(t[_]||!(e=Object.getPrototypeOf(t))||e===Object.prototype||Array.isArray(t))}function ce(t,e=new Set){let o,n,i,s;if(o=t!=null&&t[Te])return o;if(!re(t)||e.has(t))return t;if(Array.isArray(t)){Object.isFrozen(t)?t=t.slice(0):e.add(t);for(let c=0,r=t.length;c<r;c++)i=t[c],(n=ce(i,e))!==i&&(t[c]=n)}else{Object.isFrozen(t)?t=Object.assign({},t):e.add(t);const c=Object.keys(t),r=Object.getOwnPropertyDescriptors(t);for(let a=0,d=c.length;a<d;a++)s=c[a],!r[s].get&&(i=t[s],(n=ce(i,e))!==i&&(t[s]=n))}return t}function $e(t,e){let o=t[e];return o||Object.defineProperty(t,e,{value:o=Object.create(null)}),o}function ye(t,e,o){if(t[e])return t[e];const[n,i]=me(o,{equals:!1,internal:!0});return n.$=i,t[e]=n}function xo(t,e){const o=Reflect.getOwnPropertyDescriptor(t,e);return!o||o.get||!o.configurable||e===_||e===se||(delete o.value,delete o.writable,o.get=()=>t[_][e]),o}function Wt(t){Ee()&&ye($e(t,se),Lt)()}function ko(t){return Wt(t),Reflect.ownKeys(t)}const Eo={get(t,e,o){if(e===Te)return t;if(e===_)return o;if(e===_e)return Wt(t),o;const n=$e(t,se),i=n[e];let s=i?i():t[e];if(e===se||e===F||e==="__proto__")return s;if(!i){const c=Object.getOwnPropertyDescriptor(t,e);Ee()&&(typeof s!="function"||t.hasOwnProperty(e))&&!(c&&c.get)&&(s=ye(n,e,s)())}return re(s)?Bt(s):s},has(t,e){return e===Te||e===_||e===_e||e===se||e===F||e==="__proto__"?!0:(Ee()&&ye($e(t,F),e)(),e in t)},set(){return!0},deleteProperty(){return!0},ownKeys:ko,getOwnPropertyDescriptor:xo};function ae(t,e,o,n=!1){if(!n&&t[e]===o)return;const i=t[e],s=t.length;o===void 0?(delete t[e],t[F]&&t[F][e]&&i!==void 0&&t[F][e].$()):(t[e]=o,t[F]&&t[F][e]&&i===void 0&&t[F][e].$());let c=$e(t,se),r;if((r=ye(c,e,i))&&r.$(()=>o),Array.isArray(t)&&t.length!==s){for(let a=t.length;a<s;a++)(r=c[a])&&r.$();(r=ye(c,"length",s))&&r.$(t.length)}(r=c[Lt])&&r.$()}function jt(t,e){const o=Object.keys(e);for(let n=0;n<o.length;n+=1){const i=o[n];ae(t,i,e[i])}}function Mo(t,e){if(typeof e=="function"&&(e=e(t)),e=ce(e),Array.isArray(e)){if(t===e)return;let o=0,n=e.length;for(;o<n;o++){const i=e[o];t[o]!==i&&ae(t,o,i)}ae(t,"length",n)}else jt(t,e)}function he(t,e,o=[]){let n,i=t;if(e.length>1){n=e.shift();const c=typeof n,r=Array.isArray(t);if(Array.isArray(n)){for(let a=0;a<n.length;a++)he(t,[n[a]].concat(e),o);return}else if(r&&c==="function"){for(let a=0;a<t.length;a++)n(t[a],a)&&he(t,[a].concat(e),o);return}else if(r&&c==="object"){const{from:a=0,to:d=t.length-1,by:u=1}=n;for(let l=a;l<=d;l+=u)he(t,[l].concat(e),o);return}else if(e.length>1){he(t[n],e,[n].concat(o));return}i=t[n],o=[n].concat(o)}let s=e[0];typeof s=="function"&&(s=s(i,o),s===i)||n===void 0&&s==null||(s=ce(s),n===void 0||re(i)&&re(s)&&!Array.isArray(s)?jt(i,s):ae(t,n,s))}function O(...[t,e]){const o=ce(t||{}),n=Array.isArray(o),i=Bt(o);function s(...c){be(()=>{n&&c.length===1?Mo(o,c[0]):he(o,c)})}return[i,s]}const Le=new WeakMap,Ft={get(t,e){if(e===Te)return t;const o=t[e];let n;return re(o)?Le.get(o)||(Le.set(o,n=new Proxy(o,Ft)),n):o},set(t,e,o){return ae(t,e,ce(o)),!0},deleteProperty(t,e){return ae(t,e,void 0,!0),!0}};function et(t){return e=>{if(re(e)){let o;(o=Le.get(e))||Le.set(e,o=new Proxy(e,Ft)),t(o)}return e}}class A{constructor(e){p(this,"store"),this.store=O(e??[])}get array(){return this.store[0]}get length(){return this.store[0].length}at(e){return this.store[0].at(e)}forEach(e){this.store[0].forEach(e)}filter(e){return this.store[0].filter(e)}filterInPlace(e){this.store[1](this.filter(e))}map(e){return this.store[0].map(e)}flatMap(e){return this.store[0].flatMap(e)}find(e){return this.store[0].find(e)}findIndex(e){return this.store[0].findIndex(e)}splice(e,o,...n){this.store[1](this.store[0].splice(e,o,...n))}reduce(e,o){return this.store[0].reduce(e,o)}some(e){return this.store[0].some(e)}every(e){return this.store[0].every(e)}get(e){return this.store[0][e]}set(e,o){this.store[1](e,o)}push(e){this.store[1](this.store[0].length,e)}}class P{constructor(e=-1){p(this,"changes"),p(this,"currentChangeIndex",-1),p(this,"maxChanges"),this.maxChanges=e,this.changes=[]}serialize(){return{changes:this.changes,currentChangeIndex:this.currentChangeIndex,maxChanges:this.maxChanges}}deserialize(e){this.changes=e.changes,this.currentChangeIndex=e.currentChangeIndex,this.maxChanges=e.maxChanges}addChange(e){this.changes=this.changes.slice(0,this.currentChangeIndex+1),this.changes.length===this.maxChanges&&this.changes.shift(),this.changes.push(e),this.currentChangeIndex=this.changes.length-1}undo(){if(this.currentChangeIndex===-1)return!1;const e=this.changes[this.currentChangeIndex].historyGroup;for(;this.currentChangeIndex>-1&&this.changes[this.currentChangeIndex].historyGroup===e;)this.changes[this.currentChangeIndex].undoChange(),this.currentChangeIndex--;return!0}redo(){if(this.currentChangeIndex===this.changes.length-1)return!1;const e=this.changes[this.currentChangeIndex+1].historyGroup;for(;this.currentChangeIndex<this.changes.length-1&&this.changes[this.currentChangeIndex+1].historyGroup===e;)this.currentChangeIndex++,this.changes[this.currentChangeIndex].applyChange();return!0}static evaluateHistoryGroup(e=!0){return typeof e=="boolean"?e?crypto.randomUUID():!1:e}}class Ao{constructor(e){p(this,"nodeflowData"),p(this,"getHorizontalCurve",(o,n)=>h.of((n.x-o.x)/1.5,0)),p(this,"getVerticalCurve",(o,n)=>h.of(0,(n.y-o.y)/1.5)),p(this,"createDefaultCurvePath",(o,n,i,s)=>`M ${o.x} ${o.y} C ${i.x} ${i.y}, ${s.x} ${s.y}, ${n.x} ${n.y}`),this.nodeflowData=e}calculateCurveAnchors(e,o,n,i){const s=e.distanceTo(o)/300,c=n.add(e.subtract(n).multiplyBy(s)),r=i.add(o.subtract(i).multiplyBy(s));return{anchorStart:c,anchorEnd:r}}}class Oo{constructor(e){p(this,"store"),this.store=O(e)}get css(){return this.store[0].css}get destinationConnector(){return this.store[0].destinationConnector}get path(){return this.store[0].path}set css(e){this.store[1]({css:e})}set path(e){this.store[1]({path:e})}set destinationConnector(e){this.store[1]({destinationConnector:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}}const fe=(...t)=>{const e=t[0];return t.slice(1).reduce((o,n)=>new Set([...o].filter(i=>n.has(i))),e)},ne=t=>t.size===0,K=t=>typeof t!="object"||t===null||t===void 0?t:Array.isArray(t)?t.map(K):typeof t=="object"?Object.fromEntries(Object.entries(t).map(([e,o])=>[e,K(o)])):t;class rt{constructor(e){p(this,"store"),this.store=O(e)}serialize(){return{css:this.css,hovered:this.hovered,id:this.id,position:this.position.serialize()}}serializeConnections(){return[...this.destinations.map(({destinationConnector:e,css:o})=>({sourceNodeId:this.parentNode.id,sourceConnectorId:this.id,destinationNodeId:e.parentNode.id,destinationConnectorId:e.id,css:K(o)})),...this.sources.map(({sourceConnector:e})=>{var o;return{sourceNodeId:e.parentNode.id,sourceConnectorId:e.id,destinationNodeId:this.parentNode.id,destinationConnectorId:this.id,css:K((o=e.destinations.find(n=>n.destinationConnector.parentNode.id===this.parentNode.id))==null?void 0:o.css)}})]}static deserialize(e,o){const n=!e.id||o.connectors.has(e.id)?o.parentNode.getNextFreeConnectorId():e.id;return new rt({css:e.css,destinations:new A,hovered:e.hovered??!1,id:n,parentSection:o,position:h.deserializeOrDefault(e.position),ref:void 0,resizeObserver:void 0,size:h.zero(),sources:new A})}get css(){return this.store[0].css}values(){return this.store[0]}get destinations(){return this.store[0].destinations}get hovered(){return this.store[0].hovered}get id(){return this.store[0].id}get parentSection(){return this.store[0].parentSection}get parentNode(){return this.store[0].parentSection.parentNode}get position(){return this.store[0].position}get ref(){return this.store[0].ref}get resizeObserver(){return this.store[0].resizeObserver}get size(){return this.store[0].size}get sources(){return this.store[0].sources}set css(e){this.store[1]({css:e})}set destinations(e){this.store[1]({destinations:e})}set hovered(e){this.store[1]({hovered:e})}set id(e){this.store[1]({id:e})}set parentSection(e){this.store[1]({parentSection:e})}set position(e){this.store[1]({position:e})}set ref(e){this.store[1]({ref:e})}set resizeObserver(e){this.store[1]({resizeObserver:e})}set size(e){this.store[1]({size:e})}set sources(e){this.store[1]({sources:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}removeIncomingConnections(){this.sources.forEach(({sourceConnector:e})=>{e.destinations.filterInPlace(({destinationConnector:o})=>o.parentNode.id!==this.id)}),this.sources=new A}removeOutgoingConnections(){this.destinations.forEach(({destinationConnector:e})=>{e.sources.filterInPlace(({sourceConnector:o})=>o.parentNode.id!==this.id)}),this.destinations=new A}getCenter(){const{position:e,offset:o}=this.parentNode;return e.add(o,this.position,this.size.divideBy(2))}}const Kt=class Se{constructor(){p(this,"nodeflows"),p(this,"globalEventStore"),this.nodeflows=new Map,this.globalEventStore={onMouseMoveInDocument:new Ve,onPointerLeaveFromDocument:new Ve,onPointerUpInDocument:new Ve},this.setupDefaultEventHandlers()}static get(){return this.instance||(Se.instance=new Se),Se.instance}createCanvas(...e){const o=new Ko(...e);return this.nodeflows.set(e[0],o),[o,zo(o)]}getNodeflow(e){return this.nodeflows.get(e)}removeNodeflow(e){this.nodeflows.delete(e)}clear(){this.nodeflows.clear()}hasNodeflow(e){return this.nodeflows.has(e)}setupDefaultEventHandlers(){document.onmousemove=e=>this.globalEventStore.onMouseMoveInDocument.publish({event:e}),document.onpointerleave=e=>this.globalEventStore.onPointerLeaveFromDocument.publish({event:e}),document.onpointerup=e=>this.globalEventStore.onPointerUpInDocument.publish({event:e}),this.globalEventStore.onMouseMoveInDocument.subscribeMultiple([{name:"update-mouse-position",event:({event:e})=>{this.nodeflows.forEach(o=>{o.mouseData.mousePosition=h.fromEvent(e)})}}]),this.globalEventStore.onPointerLeaveFromDocument.subscribeMultiple([{name:"reset-mouse-data",event:()=>{this.nodeflows.forEach(e=>{e.mouseData.reset()})}}]),this.globalEventStore.onPointerUpInDocument.subscribeMultiple([])}};p(Kt,"instance");let b=Kt;var To={equals:!1},$o=To,H,vt,yt=(vt=class{constructor(t=Map){qe(this,H,void 0),io(this,H,new t)}dirty(t){var e;(e=v(this,H).get(t))==null||e.$$()}dirtyAll(){for(const t of v(this,H).values())t.$$()}track(t){if(!Ee())return;let e=v(this,H).get(t);if(e)e.n++;else{const[o,n]=me(void 0,$o);v(this,H).set(t,e={$:o,$$:n,n:1})}ot(()=>{e.n--===1&&queueMicrotask(()=>e.n===0&&v(this,H).delete(t))}),e.$()}},H=new WeakMap,vt),R=Symbol("track-keys"),N,j,mt,le=(mt=class extends Map{constructor(t){if(super(),qe(this,N,new yt),qe(this,j,new yt),t)for(const e of t)super.set(e[0],e[1])}has(t){return v(this,N).track(t),super.has(t)}get(t){return v(this,j).track(t),super.get(t)}get size(){return v(this,N).track(R),super.size}*keys(){for(const t of super.keys())v(this,N).track(t),yield t;v(this,N).track(R)}*values(){for(const[t,e]of super.entries())v(this,j).track(t),yield e;v(this,N).track(R)}*entries(){for(const t of super.entries())v(this,j).track(t[0]),yield t;v(this,N).track(R)}set(t,e){return be(()=>{if(super.has(t)){if(super.get(t)===e)return}else v(this,N).dirty(t),v(this,N).dirty(R);v(this,j).dirty(t),super.set(t,e)}),this}delete(t){const e=super.delete(t);return e&&be(()=>{v(this,N).dirty(t),v(this,N).dirty(R),v(this,j).dirty(t)}),e}clear(){super.size&&be(()=>{for(const t of super.keys())v(this,N).dirty(t),v(this,j).dirty(t);super.clear(),v(this,N).dirty(R)})}forEach(t){v(this,N).track(R);for(const[e,o]of super.entries())v(this,j).track(e),t(o,e,this)}[Symbol.iterator](){return this.entries()}},N=new WeakMap,j=new WeakMap,mt);class ct{constructor(e,o){p(this,"store"),p(this,"nodeflowData"),this.nodeflowData=e,this.store=O(o)}serialize(){return{connectors:Object.fromEntries(Array.from(this.connectors.entries()).map(([e,o])=>[e,o.serialize()])),css:this.css,id:this.id}}static deserialize(e,o,n=!0){const i=P.evaluateHistoryGroup(n),s=!e.id||o.connectorSections.has(e.id)?o.getNextFreeConnectorSectionId():e.id,c=new ct(o.nodeflow,{connectors:new le,css:e.css,id:s,parentNode:o});for(const[r,a]of Object.entries(e.connectors??{}))c.addConnector({...a,id:r},i);return c}addConnector(e,o=!0){const n=rt.deserialize(e,this);if(this.connectors.has(n.id))return this.connectors.get(n.id);const i=P.evaluateHistoryGroup(o);if(i){const s=n.serialize(),c=this.id,r=s.id,a=this.parentNode.id,d=this.nodeflowData.id;this.nodeflowData.changes.addChange({type:"add",source:"connector",applyChange:()=>{var u,l;(l=(u=b.get().getNodeflow(d))==null?void 0:u.nodes.get(a))==null||l.addConnector(c,s,!1)},undoChange:()=>{var u,l;(l=(u=b.get().getNodeflow(d))==null?void 0:u.nodes.get(a))==null||l.removeConnector(c,r,!1)},historyGroup:i})}return this.connectors.set(n.id,n),n}removeConnector(e,o=!0){if(!this.connectors.has(e))return;const n=this.connectors.get(e),i=P.evaluateHistoryGroup(o);if(i){const s=n.serialize(),c=this.id,r=s.id,a=this.parentNode.id,d=this.nodeflowData.id;this.nodeflowData.changes.addChange({type:"remove",source:"connector",applyChange:()=>{var u,l;(l=(u=b.get().getNodeflow(d))==null?void 0:u.nodes.get(a))==null||l.removeConnector(c,r,!1)},undoChange:()=>{var u,l;(l=(u=b.get().getNodeflow(d))==null?void 0:u.nodes.get(a))==null||l.addConnector(c,s,!1)},historyGroup:i})}this.connectors.delete(e)}get connectors(){return this.store[0].connectors}get css(){return this.store[0].css}get id(){return this.store[0].id}get parentNode(){return this.store[0].parentNode}set connectors(e){this.store[1]({connectors:e})}set css(e){this.store[1]({css:e})}set id(e){this.store[1]({id:e})}set parentNode(e){this.store[1]({parentNode:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}removeIncomingConnections(){this.connectors.forEach(e=>e.removeIncomingConnections())}removeOutgoingConnections(){this.connectors.forEach(e=>e.removeOutgoingConnections())}getSourceConnectors(){return Array.from(this.connectors.values()).flatMap(e=>e.sources.flatMap(o=>o.sourceConnector))}getDestinationConnectors(){return Array.from(this.connectors.values()).flatMap(e=>e.destinations.flatMap(o=>o.destinationConnector))}}class Lo{constructor(e){p(this,"store"),this.store=O(e)}get sourceConnector(){return this.store[0].sourceConnector}set sourceConnector(e){this.store[1]({sourceConnector:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}}class Gt{constructor(){p(this,"subscriptions",new le),p(this,"blacklistFilters",new le)}blacklist(e,o){this.blacklistFilters.set(e,o)}unblacklist(e){this.blacklistFilters.delete(e)}unblacklistMultiple(e){e.forEach(this.unblacklist)}clearBlacklist(){this.blacklistFilters.clear()}subscribe(e,o,n=0){this.subscriptions.set(e,{name:e,event:o,priority:n})}subscribeMultiple(e){e.forEach(({name:o,event:n,priority:i})=>this.subscribe(o,n,i))}unsubscribe(e){this.subscriptions.delete(e)}unsubsribeMultiple(e){e.forEach(this.unsubscribe)}publish(e){Array.from(this.subscriptions.values()).sort((o,n)=>n.priority-o.priority).filter(({name:o,priority:n})=>!Array.from(this.blacklistFilters.values()).some(i=>i(e,o,n))).map(({event:o})=>o).forEach(o=>o(e))}clear(){this.subscriptions.clear()}get size(){return this.subscriptions.size}get isEmpty(){return this.size===0}}class S extends Gt{constructor(e){super(),p(this,"nodeflowData"),this.nodeflowData=e}}class Ve extends Gt{}class Bo{constructor(e){p(this,"store"),p(this,"nodeflowData"),this.nodeflowData=e,this.store=O({heldKeys:new Set})}get heldKeys(){return this.store[0].heldKeys}set heldKeys(e){this.store[1]({heldKeys:e})}releaseKey(e){this.store[1](et(o=>o.heldKeys.delete(e)))}clearKeys(){this.store[1]({heldKeys:new Set})}pressKey(e){this.store[1](et(o=>o.heldKeys.add(e)))}isActionPressed(e){return!ne(fe(this.heldKeys,e))}}class Wo{constructor(e){p(this,"store"),p(this,"nodeflowData"),p(this,"selectNode",(o,n,i=!0)=>{if(!this.nodeflowData.nodes.has(o))return;const s=this.nodeflowData.nodes.get(o);this.hasSelectedNode(o)&&this.selections.filterInPlace(c=>c.type!=="node"||c.node.id!==o),this.selections.push({node:s,type:"node"}),this.update({pointerDown:i,mousePosition:n,clickStartPosition:n.divideBy(this.nodeflowData.zoomLevel).subtract(this.nodeflowData.nodes.get(o).position)})}),p(this,"clearSelections",()=>{this.store[1]("selections",new A),this.nodeflowData.resetMovement()}),p(this,"startCreatingConnection",(o,n,i)=>{if(!this.nodeflowData.settings.canCreateConnections)return;const s=this.nodeflowData.nodes.get(o);if(!s)return;const c=s.getConnector(i);c&&this.update({pointerDown:!0,selections:new A([{connector:c,type:"connector"}]),mousePosition:n,clickStartPosition:n.divideBy(this.nodeflowData.zoomLevel).subtract(s.position)})}),p(this,"globalMousePosition",()=>this.mousePosition.subtract(this.nodeflowData.startPosition).divideBy(this.nodeflowData.zoomLevel).subtract(this.nodeflowData.position)),this.nodeflowData=e,this.store=O({clickStartPosition:void 0,mousePosition:h.zero(),pointerDown:!1,selections:new A})}serialize(){var e;const o=this.store[0].selections.map(n=>{switch(n.type){case"connector":return{connectorId:n.connector.id,nodeId:n.connector.parentNode.id,type:"connector"};case"node":return{nodeId:n.node.id,type:"node"};case"connection":return{connection:{destinationConnectorId:n.connection.destinationConnector.id,destinationNodeId:n.connection.destinationConnector.parentSection.parentNode.id,sourceConnectorId:n.connection.sourceConnector.id,sourceNodeId:n.connection.sourceConnector.parentNode.id},type:"connection"};default:return{type:"nodeflow"}}});return{clickStartPosition:(e=this.clickStartPosition)==null?void 0:e.serialize(),selections:o}}deserialize(e){const o=e.selections.map(n=>{if(n.type==="connector"){const i=this.nodeflowData.nodes.get(n.nodeId);if(!i)return;const s=i.getConnector(n.connectorId);return s?{connector:s,type:"connector"}:void 0}else if(n.type==="node"){const i=this.nodeflowData.nodes.get(n.nodeId);return i?{node:i,type:"node"}:void 0}else if(n.type==="connection"){const i=this.nodeflowData.nodes.get(n.connection.sourceNodeId);if(!i)return;const s=i.getConnector(n.connection.sourceConnectorId);if(!s)return;const c=this.nodeflowData.nodes.get(n.connection.destinationNodeId);if(!c)return;const r=c.getConnector(n.connection.destinationConnectorId);return r?{connection:{destinationConnector:r,sourceConnector:s},type:"connection"}:void 0}else return{type:"nodeflow"}}).filter(Boolean);this.update({clickStartPosition:h.deserializeOrDefault(e.clickStartPosition),selections:new A(o)})}get clickStartPosition(){return this.store[0].clickStartPosition}get isDraggingObject(){return this.store[0].pointerDown}get selections(){return this.store[0].selections}get heldConnections(){return this.store[0].selections.filter(e=>e.type==="connection")}get heldConnectors(){return this.store[0].selections.filter(e=>e.type==="connector")}get heldNodes(){return this.store[0].selections.filter(e=>e.type==="node")}filterSelections(e){this.selections.filterInPlace(e)}get mousePosition(){return this.store[0].mousePosition}get pointerDown(){return this.store[0].pointerDown}set clickStartPosition(e){this.store[1]({clickStartPosition:e})}set mousePosition(e){this.store[1]({mousePosition:e})}set pointerDown(e){this.store[1]({pointerDown:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}reset(e=!1){this.update({clickStartPosition:void 0,pointerDown:e,selections:new A})}selectNodeflow(){this.hasSelectedNodeflow()&&this.selections.filterInPlace(e=>e.type!=="nodeflow"),this.selections.push({type:"nodeflow"})}clearSelectedByType(e){this.store[0].selections.filterInPlace(o=>o.type!==e)}hasSelectedNodeflow(){return this.store[0].selections.some(e=>e.type==="nodeflow")}hasSelectedNode(e){return this.store[0].selections.some(o=>o.type==="node"&&o.node.id===e)}hasSelectedConnector(e){return this.store[0].selections.some(o=>o.type==="connector"&&o.connector.id===e)}hasSelectedConnection(e,o,n,i){return this.store[0].selections.some(s=>s.type==="connection"&&s.connection.sourceConnector.id===o&&s.connection.sourceConnector.parentNode.id===e&&s.connection.destinationConnector.id===i&&s.connection.destinationConnector.parentNode.id===n)}}class jo{constructor(e,o=2048){p(this,"store"),p(this,"nodeflowData"),this.nodeflowData=e,this.store=O({chunkSize:o,chunks:new le})}get chunkSize(){return this.store[0].chunkSize}set chunkSize(e){this.store[1]({chunkSize:e})}get chunks(){return this.store[0].chunks}set chunks(e){this.store[1]({chunks:e})}addNodeToChunk(e,o){const n=this.calculateChunkPosition(o),i=this.chunks.get(n)||new Set;i.add(e),this.chunks.set(n,i)}removeNodeFromChunk(e,o){const n=this.calculateChunkPosition(o),i=this.chunks.get(n);i&&(i.delete(e),this.chunks.set(n,i))}updateNodeInChunk(e,o,n){const i=this.calculateChunkPosition(o),s=this.calculateChunkPosition(n);i!=s&&ge(()=>{const c=this.chunks.get(i),r=this.chunks.get(s)||new Set;c&&(c.delete(e),this.chunks.set(i,c),ne(c)&&this.chunks.delete(i)),r&&(r.add(e),this.chunks.set(s,r))})}getChunk(e){return this.chunks.get(this.calculateChunkPosition(e))||new Set}calculateChunkPosition(e){return h.of(Math.floor(e.x/this.chunkSize),Math.floor(e.y/this.chunkSize)).hashCode()}checkForCollisions(e){if(!this.nodeflowData.settings.allowCollision)return[];const o=this.nodeflowData.nodes.get(e),n=[];if(!o)return n;for(let i=-1;i<2;++i)for(let s=-1;s<2;++s){const c=this.getChunk(o.rectWithOffset.position.add(h.of(i*this.chunkSize,s*this.chunkSize)));c.size>0&&n.push(...c)}return n.filter(i=>{const s=this.nodeflowData.nodes.get(i);return s?.id==o.id?!1:s&&s.id!=o.id&&s.rectWithOffset.intersects(o.rectWithOffset)})}}const[Be,Fo]=me(h.of(window.innerWidth,window.innerHeight));ge(()=>{const t=()=>Fo(h.of(window.innerWidth,window.innerHeight));return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)});const Ze=(t,e,o)=>Math.min(Math.max(t,e),o);class ie{constructor(e,o,n,i){p(this,"position"),p(this,"size"),this.position=h.of(e,o),this.size=h.of(n,i)}static of(e,o){return new ie(e.x,e.y,o.x,o.y)}static fromRect(e){return new ie(e.position.x,e.position.y,e.size.x,e.size.y)}copy(){return ie.fromRect(this)}get center(){return this.position.add(this.size.divideBy(2))}intersects(e){return this.position.x<e.position.x+e.size.x&&this.position.x+this.size.x>e.position.x&&this.position.y<e.position.y+e.size.y&&this.position.y+this.size.y>e.position.y}}class at{constructor(e,o){p(this,"store"),p(this,"nodeflowData"),this.nodeflowData=e,this.store=O(o),this.nodeflowData.chunking.addNodeToChunk(this.id,this.getCenter()),ge(()=>{const n=this.getCollidingNodes();n.length>0&&ge(()=>{n.forEach(i=>{const s=this.nodeflowData.nodes.get(i);if(s){const c=s.rectWithOffset,r=this.rectWithOffset;if(c.intersects(r)){const a=c.center.subtract(r.center).magnitude,d=c.center.subtract(r.center).normalize();this.position=this.position.subtract(d.multiplyBy(a))}}})})})}get nodeflow(){return this.nodeflowData}get centered(){return this.store[0].centered}get connectorSections(){return this.store[0].connectorSections}get css(){return this.store[0].css}get customData(){return this.store[0].customData}get display(){return this.store[0].display}get id(){return this.store[0].id}get offset(){return this.store[0].offset}get position(){return this.store[0].position}get ref(){return this.store[0].ref}get resizeObserver(){return this.store[0].resizeObserver}get size(){return this.store[0].size}set centered(e){this.store[1]({centered:e})}set connectorSections(e){this.store[1]({connectorSections:e})}set css(e){this.store[1]({css:e})}set customData(e){this.store[1]({customData:e})}set display(e){this.store[1]({display:e})}set id(e){this.store[1]({id:e})}set offset(e){this.store[1]({offset:e})}set position(e){this.store[1]({position:e})}set ref(e){this.store[1]({ref:e})}set resizeObserver(e){this.store[1]({resizeObserver:e})}set size(e){this.store[1]({size:e})}get sizeWithOffset(){return this.size.add(this.offset)}update(e){this.store[1](e)}serialize(){const e=Array.from(this.connectorSections.values()).reduce((o,n)=>(o[n.id]=n.serialize(),o),{});return{centered:this.centered,connectorSections:e,css:K(this.css),customData:K(this.customData),id:this.id,display:this.display,position:this.position.serialize()}}static deserialize(e,o,n=!0){const i=o.id??e.getNextFreeNodeId(),s=new at(e,{centered:o.centered??!1,connectorSections:new le,css:K(o.css)??{},customData:K(o.customData)??{},display:o.display??(()=>{}),id:i,offset:h.zero(),position:h.deserializeOrDefault(o.position),ref:void 0,resizeObserver:void 0,size:h.zero()}),c=P.evaluateHistoryGroup(n);return Object.entries(o.connectorSections??[]).forEach(([r,a])=>{s.addConnectorSection({css:a.css,id:r,connectors:a.connectors},c)}),s}serializeConnections(){return Array.from(this.connectorSections.values()).flatMap(e=>Array.from(e.connectors.values()).flatMap(o=>o.serializeConnections()))}updateWithPrevious(e){this.store[1](e)}addConnectorSection(e,o=!0){const n=P.evaluateHistoryGroup(o),i=ct.deserialize(e,this,n);if(this.connectorSections.has(i.id))return this.connectorSections.get(i.id);if(n){const s=i.serialize(),c=this.nodeflowData.id,r=this.id,a=s.id;this.nodeflowData.changes.addChange({type:"remove",source:"connector-section",applyChange:()=>{var d,u;(u=(d=b.get().getNodeflow(c))==null?void 0:d.nodes.get(r))==null||u.addConnectorSection(s,!1)},undoChange:()=>{var d,u;(u=(d=b.get().getNodeflow(c))==null?void 0:d.nodes.get(r))==null||u.removeConnectorSection(a,!1)},historyGroup:n})}return this.connectorSections.set(i.id,i),i}removeConnectorSection(e,o=!0){if(!this.connectorSections.has(e))return;const n=this.connectorSections.get(e),i=P.evaluateHistoryGroup(o);if(i){const s=n.serialize(),c=this.nodeflowData.id,r=this.id;this.nodeflowData.changes.addChange({type:"remove",source:"connector-section",applyChange:()=>{var a,d;(d=(a=b.get().getNodeflow(c))==null?void 0:a.nodes.get(r))==null||d.removeConnectorSection(e,!1)},undoChange:()=>{var a,d;(d=(a=b.get().getNodeflow(c))==null?void 0:a.nodes.get(r))==null||d.addConnectorSection(s,!1)},historyGroup:i})}this.connectorSections.delete(e)}getConnectorCount(){return Array.from(this.connectorSections.values()).reduce((e,o)=>e+o.connectors.size,0)}addConnector(e,o,n=!0){if(this.connectorSections.has(e))return this.connectorSections.get(e).addConnector(o,n)}removeConnector(e,o,n=!0){this.connectorSections.has(e)&&this.connectorSections.get(e).removeConnector(o,n)}getConnector(e){var o;return(o=this.getSectionFromConnector(e))==null?void 0:o.connectors.get(e)}getTotalConnectedInputs(e){var o;return((o=this.getConnector(e))==null?void 0:o.sources.length)??0}getAllConnectors(){return Array.from(this.connectorSections.values()).reduce((e,o)=>e.concat(Array.from(o.connectors.values())),[])}getNextFreeConnectorSectionId(){let e="0";for(let o=1;this.connectorSections.has(e);++o)e=o.toString();return e}getNextFreeConnectorId(){let e="0";for(let o=1;Array.from(this.connectorSections.values()).some(n=>n.connectors.has(e));++o)e=o.toString();return e}removeIncomingConnections(){this.connectorSections.forEach(e=>e.removeIncomingConnections())}removeOutgoingConnections(){this.connectorSections.forEach(e=>e.removeOutgoingConnections())}getAllSourceConnectors(){return Array.from(this.connectorSections.values()).reduce((e,o)=>e.concat(o.getSourceConnectors()),[])}getAllDestinationConnectors(){return Array.from(this.connectorSections.values()).reduce((e,o)=>e.concat(o.getDestinationConnectors()),[])}getAllSourceConnections(){return this.getAllSourceConnectors().map(e=>e.destinations.filter(o=>o.destinationConnector.parentNode.id===this.id).map(o=>({sourceNodeId:e.parentNode.id,sourceConnectorId:e.id,destinationNodeId:o.destinationConnector.parentNode.id,destinationConnectorId:o.destinationConnector.id,css:o.css}))).flat()}getAllDestinationConnections(){return this.getAllDestinationConnectors().map(e=>e.sources.filter(o=>o.sourceConnector.parentNode.id===this.id).map(o=>({sourceNodeId:o.sourceConnector.parentNode.id,sourceConnectorId:o.sourceConnector.id,destinationNodeId:e.parentNode.id,destinationConnectorId:e.id}))).flat()}getAllSourceNodes(){return this.getAllSourceConnectors().map(e=>e.parentNode)}getAllDestinationNodes(){return this.getAllDestinationConnectors().map(e=>e.parentNode)}getSectionFromConnector(e){return Array.from(this.connectorSections.values()).find(o=>o.connectors.get(e))}getCenter(){return this.position.add(this.offset,this.size.divideBy(2))}select(e){this.nodeflowData.selectNode(this.id,e)}get rect(){return ie.of(this.position,this.size)}get rectWithOffset(){return ie.of(this.position.subtract(this.offset),this.size.add(this.offset.multiplyBy(2)))}getCollidingNodes(){return this.nodeflowData.chunking.checkForCollisions(this.id)}isColliding(){return this.getCollidingNodes().length>0}}const ue={LEFT:0,MIDDLE:1,RIGHT:2,BACK:3,FORWARD:4},Ut=class Ht{constructor(e,o={},n){p(this,"store"),p(this,"changes"),p(this,"mouseData"),p(this,"keyboardData"),p(this,"curveFunctions"),p(this,"settingsStore"),p(this,"nodes"),p(this,"eventStore"),p(this,"chunking"),p(this,"id"),p(this,"keymap",{MOVE_DOWN:new Set(["ArrowDown","KeyS"]),MOVE_LEFT:new Set(["ArrowLeft","KeyA"]),MOVE_RIGHT:new Set(["ArrowRight","KeyD"]),MOVE_UP:new Set(["ArrowUp","KeyW"]),SELECT_MULTIPLE:new Set(["ShiftLeft","ShiftRight"])}),p(this,"resetMovement",()=>{this.currentMoveSpeed=h.zero(),this.keymap.MOVE_LEFT.forEach(i=>this.keyboardData.releaseKey(i)),this.keymap.MOVE_RIGHT.forEach(i=>this.keyboardData.releaseKey(i)),this.keymap.MOVE_UP.forEach(i=>this.keyboardData.releaseKey(i)),this.keymap.MOVE_DOWN.forEach(i=>this.keyboardData.releaseKey(i))}),p(this,"updateZoom",(i,s)=>{const c=this.zoomLevel;if(i===0)return;const r=Number(Ze(i>0?c+c*i*this.settings.zoomMultiplier:c/(1-i*this.settings.zoomMultiplier),this.settings.minZoom,this.settings.maxZoom).toFixed(4));this.mouseData.pointerDown=!1;const a=this.size,d=s.subtract(this.startPosition),u=a.multiplyBy(c),l=a.multiplyBy(r),f=d.subtract(u.divideBy(2)).divideBy(c),g=d.subtract(l.divideBy(2)).divideBy(r);this.updateWithPrevious(y=>({position:y.position.subtract(f).add(g),zoomLevel:r}))}),this.id=e,this.settingsStore=O({...Ht.DEFAULT_SETTINGS,...o}),this.curveFunctions=n?.(this)??new Ao(this),this.store=O({currentMoveSpeed:h.zero(),position:h.zero(),startPosition:h.zero(),size:h.zero(),zoomLevel:1,pinchDistance:0}),this.changes=new P,this.mouseData=new Wo(this),this.keyboardData=new Bo(this),this.nodes=new le,this.chunking=new jo(this),this.eventStore={onKeyDownInNodeflow:new S(this),onKeyUpInNodeflow:new S(this),onMouseDownInConnector:new S(this),onMouseDownInNodeflow:new S(this),onMouseDownInNode:new S(this),onMouseMoveInNodeflow:new S(this),onNodeConnected:new S(this),onNodeDataChanged:new S(this),onPointerDownInNodeCurve:new S(this),onPointerUpInConnector:new S(this),onPointerUpInNodeflow:new S(this),onPointerUpInNode:new S(this),onTouchMoveInNodeflow:new S(this),onTouchStartInConnector:new S(this),onTouchStartInNodeflow:new S(this),onTouchStartInNode:new S(this),onWheelInNodeflow:new S(this)},this.setupDefaultEventHandlers(),setInterval(()=>{const i=!ne(fe(this.keyboardData.heldKeys,this.keymap.MOVE_LEFT)),s=!ne(fe(this.keyboardData.heldKeys,this.keymap.MOVE_RIGHT)),c=!ne(fe(this.keyboardData.heldKeys,this.keymap.MOVE_UP)),r=!ne(fe(this.keyboardData.heldKeys,this.keymap.MOVE_DOWN)),a=this.mouseData.heldNodes.length>0;this.currentMoveSpeed=h.of(this.calculateDirectionalMovementAmount(i||s,this.currentMoveSpeed.x,s,i,!a),this.calculateDirectionalMovementAmount(c||r,this.currentMoveSpeed.y,r,c,!a)),!(this.currentMoveSpeed.x===0&&this.currentMoveSpeed.y===0)&&(this.settings.canPan&&!a?this.updateBackgroundPosition(this.currentMoveSpeed,!0):a&&this.settings.canMoveNodes&&this.updateHeldNodePosition(this.currentMoveSpeed.divideBy(this.zoomLevel)))},10)}serialize(){return{changes:this.changes.serialize(),connections:this.serializeConnections(),currentMoveSpeed:this.currentMoveSpeed.serialize(),mouseData:this.mouseData.serialize(),nodes:Object.fromEntries(Array.from(this.nodes.entries()).map(([e,o])=>[e,o.serialize()])),pinchDistance:this.pinchDistance,position:this.position.serialize(),size:this.size.serialize(),startPosition:this.startPosition.serialize(),zoomLevel:this.zoomLevel}}deserialize(e,o=!1){this.update({currentMoveSpeed:h.deserializeOrDefault(e.currentMoveSpeed),pinchDistance:e.pinchDistance,position:h.deserializeOrDefault(e.position),size:h.deserializeOrDefault(e.size),startPosition:h.deserializeOrDefault(e.startPosition),zoomLevel:e.zoomLevel});const n=P.evaluateHistoryGroup(o);this.nodes.clear(),Object.values(e.nodes).forEach(i=>{this.addNode(i,n)}),this.mouseData.deserialize(e.mouseData),e.connections.forEach(i=>{this.addConnection(i,n)}),this.changes.deserialize(e.changes)}serializeConnections(){return Array.from(this.nodes.values()).flatMap(e=>e.serializeConnections())}get settings(){return this.settingsStore[0]}updateSettings(e){this.settingsStore[1](e)}get currentMoveSpeed(){return this.store[0].currentMoveSpeed}get position(){return this.store[0].position}get startPosition(){return this.store[0].startPosition}get size(){return this.store[0].size}get zoomLevel(){return this.store[0].zoomLevel}get pinchDistance(){return this.store[0].pinchDistance}set currentMoveSpeed(e){this.store[1]({currentMoveSpeed:e})}set position(e){this.store[1]({position:e})}set startPosition(e){this.store[1]({startPosition:e})}set size(e){this.store[1]({size:e})}set zoomLevel(e){this.store[1]({zoomLevel:e})}set pinchDistance(e){this.store[1]({pinchDistance:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}center(){const e=Be().divideBy(2);return this.startPosition.add(e).divideBy(this.zoomLevel).subtract(this.position)}calculateDirectionalMovementAmount(e,o,n,i,s=!1){let c=o;if(e){const r=this.settings.movementAcceleration*(s?-1:1);c=Ze(c+(n?r:0)-(i?r:0),-this.settings.maxMovementSpeed,this.settings.maxMovementSpeed)}else c=Ze(c*this.settings.movementDeceleration,-this.settings.maxMovementSpeed,this.settings.maxMovementSpeed);return c<=.1&&c>=-.1&&(c=0),c}updateBackgroundPosition(e,o=!1){!this.mouseData.hasSelectedNodeflow()||o===this.mouseData.isDraggingObject||this.updateWithPrevious(n=>({position:n.position.add(e.divideBy(this.zoomLevel))}))}addNode(e,o=!0){const n=P.evaluateHistoryGroup(o),i=at.deserialize(this,e,n);if(this.nodes.set(i.id,i),n){const s=i.serializeConnections(),c=i.serialize(),r=this.id;this.changes.addChange({type:"add",source:"node",applyChange:()=>{const a=b.get().getNodeflow(r);a?.addNode(c,!1),s.forEach(d=>{a?.addConnection(d,!1)})},undoChange:()=>{var a;(a=b.get().getNodeflow(r))==null||a.removeNode(i.id,!1)},historyGroup:n})}return i}updateNode(e,o,n=!0){if(!this.nodes.has(e))return;const i=this.nodes.get(e),s=P.evaluateHistoryGroup(n);if(s){const c=this.nodes.get(e),r=c.serialize(),a=c.serializeConnections(),d=this.id,u=Object.entries(r).reduce((l,[f,g])=>(f in o&&Object.assign(l,{[f]:K(g)}),l),{});this.changes.addChange({type:"update",source:"node",applyChange:()=>{var l;(l=b.get().getNodeflow(d))==null||l.updateNode(e,o,!1)},undoChange:()=>{const l=b.get().getNodeflow(d);l?.updateNode(e,u,!1),a.forEach(f=>{l?.addConnection(f,!1)})},historyGroup:s})}i.updateWithPrevious(et(c=>Object.assign(c,o))),this.eventStore.onNodeDataChanged.publish({nodeId:e,data:o})}removeNode(e,o=!0){if(!this.nodes.has(e))return;this.mouseData.filterSelections(i=>i.type!=="node"||i.node.id!==e);const n=P.evaluateHistoryGroup(o);if(n){const i=this.nodes.get(e),s=i.serializeConnections(),c=this.id;this.changes.addChange({type:"remove",source:"node",applyChange:()=>{var r;(r=b.get().getNodeflow(c))==null||r.removeNode(e,!1)},undoChange:()=>{const r=b.get().getNodeflow(c);r?.addNode(i.serialize(),!1),s.forEach(a=>{r?.addConnection(a,!1)})},historyGroup:n})}this.removeIncomingConnections(e),this.removeOutgoingConnections(e),this.nodes.delete(e)}removeIncomingConnections(e){this.nodes.has(e)&&this.nodes.get(e).connectorSections.forEach(o=>{o.connectors.forEach(n=>{n.sources.forEach(({sourceConnector:i})=>{i.destinations.filterInPlace(({destinationConnector:s})=>s.parentNode.id!==e)}),n.sources=new A})})}removeOutgoingConnections(e){this.nodes.has(e)&&this.nodes.get(e).connectorSections.forEach(o=>{o.connectors.forEach(n=>{n.destinations.forEach(({destinationConnector:i})=>{i.sources.filterInPlace(({sourceConnector:s})=>s.parentNode.id!==e)}),n.destinations=new A})})}getAllSourceConnectors(e){return this.nodes.has(e)?this.nodes.get(e).getAllSourceConnectors():[]}getAllDestinationConnectors(e){return this.nodes.has(e)?this.nodes.get(e).getAllDestinationConnectors():[]}getAllSourceConnections(e){return this.nodes.has(e)?this.nodes.get(e).getAllSourceConnections():[]}getAllDestinationConnections(e){return this.nodes.has(e)?this.nodes.get(e).getAllDestinationConnections():[]}getNextFreeNodeId(){let e="0";for(let o=1;this.nodes.has(e);++o)e=o.toString();return e}addConnection(e,o=!0){const{sourceNodeId:n,sourceConnectorId:i,destinationNodeId:s,destinationConnectorId:c,css:r}=e;if(!this.nodes.has(n)||!this.nodes.has(s))return;const a=this.nodes.get(n),d=this.nodes.get(s),u=a.getConnector(i),l=d.getConnector(c);if(!u||!l||u.destinations.some(g=>g.destinationConnector===l))return;const f=P.evaluateHistoryGroup(o);if(f){const g=this.id;this.changes.addChange({type:"add",source:"connection",applyChange:()=>this.addConnection(e,!1),undoChange:()=>{var y;return(y=b.get().getNodeflow(g))==null?void 0:y.removeConnection(n,i,s,c,!1)},historyGroup:f})}u.destinations.push(new Oo({destinationConnector:l,css:r??{}})),l.sources.push(new Lo({sourceConnector:u}))}removeConnection(e,o,n,i,s=!0){var c;if(!this.nodes.has(e)||!this.nodes.has(n))return;const r=this.nodes.get(e),a=this.nodes.get(n),d=r.getConnector(o),u=a.getConnector(i);if(!d||!u)return;const l=P.evaluateHistoryGroup(s);if(l){const f=(c=d.destinations.find(M=>M.destinationConnector.parentNode.id===n))==null?void 0:c.css,g=this.id,y=()=>{var M;(M=b.get().getNodeflow(g))==null||M.addConnection({sourceNodeId:e,sourceConnectorId:o,destinationNodeId:n,destinationConnectorId:i,css:f},!1)},I=()=>{var M;(M=b.get().getNodeflow(g))==null||M.removeConnection(e,o,n,i,!1)};this.changes.addChange({type:"remove",source:"connection",applyChange:I,undoChange:y,historyGroup:l})}d.destinations.filterInPlace(f=>f.destinationConnector.parentNode.id!==n),u.sources.filterInPlace(f=>f.sourceConnector.parentNode.id!==e)}updateHeldNodePosition(e){this.mouseData.heldNodes.forEach(o=>o.node.updateWithPrevious(n=>({position:n.position.add(e)})))}setupDefaultEventHandlers(){this.eventStore.onNodeConnected.subscribeMultiple([{name:"nodeflow:create-connection",event:e=>this.addConnection({sourceNodeId:e.inputNodeId,sourceConnectorId:e.inputId,destinationNodeId:e.outputNodeId,destinationConnectorId:e.outputId})},{name:"nodeflow:reset-mouse-data",event:()=>this.mouseData.reset()}]),this.eventStore.onMouseMoveInNodeflow.subscribeMultiple([{name:"nodeflow:update-background-position",event:({event:e})=>{this.updateBackgroundPosition(h.of(e.movementX,e.movementY))}}]),this.eventStore.onPointerUpInNodeflow.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>{e.stopPropagation(),e.preventDefault()}},{name:"nodeflow:reset-mouse-data",event:()=>{this.mouseData.pointerDown=!1,this.mouseData.heldConnectors.length===1&&this.mouseData.clearSelectedByType("node"),this.mouseData.clearSelectedByType("connector")}}]),this.eventStore.onTouchStartInNodeflow.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()},{name:"nodeflow:clear-held-keys",event:({event:e})=>{e.touches.length===1&&this.keyboardData.clearKeys()}},{name:"nodeflow:handle-pinch",event:({event:e})=>{const{touches:o}=e;if(o.length!==2)return;const{pageX:n,pageY:i}=e.touches[0],{pageX:s,pageY:c}=e.touches[1];this.pinchDistance=Math.hypot(n-s,i-c)}},{name:"nodeflow:update-mouse-data",event:({event:e})=>{const{touches:o}=e;if(o.length!==1)return;const n=o[0],i=h.fromEvent(n);this.mouseData.clearSelectedByType("node"),this.mouseData.update({pointerDown:!0,mousePosition:i,clickStartPosition:h.of(i.x/this.zoomLevel-this.position.x,i.y/this.zoomLevel-this.position.y)})}}]),this.eventStore.onTouchMoveInNodeflow.subscribeMultiple([{name:"nodeflow:handle-pinch",event:({event:e})=>{const{touches:o}=e;if(o.length!==2)return;const{pageX:n,pageY:i}=o[0],{pageX:s,pageY:c}=o[1],r=Math.hypot(n-s,i-c),a=h.of((n+s)/2,(i+c)/2);this.settings.canZoom&&this.updateZoom(r-this.pinchDistance,a),this.pinchDistance=r}},{name:"nodeflow:update-mouse-data",event:({event:e})=>{const{touches:o}=e;o.length===1&&this.mouseData.updateWithPrevious(n=>{const i=h.fromEvent(o[0]);return this.updateBackgroundPosition(i.subtract(n.mousePosition)),{mousePosition:i}})}}]),this.eventStore.onKeyUpInNodeflow.subscribe("nodeflow:remove-held-key",({event:e})=>this.keyboardData.releaseKey(e.code)),this.eventStore.onKeyDownInNodeflow.subscribeMultiple([{name:"nodeflow:add-held-key",event:({event:e})=>this.keyboardData.pressKey(e.code),priority:10},{name:"nodeflow:handle-controls",event:({event:e})=>{switch(e.code){case"Delete":if(this.mouseData.heldNodes.length>0&&this.settings.canDeleteNodes){const o=P.evaluateHistoryGroup();this.mouseData.heldNodes.forEach(n=>this.removeNode(n.node.id,o))}else if(this.mouseData.heldConnections.length>0&&this.settings.canDeleteConnections){const o=P.evaluateHistoryGroup();this.mouseData.heldConnections.forEach(n=>this.removeConnection(n.connection.sourceConnector.parentNode.id,n.connection.sourceConnector.id,n.connection.destinationConnector.parentSection.parentNode.id,n.connection.destinationConnector.id,o))}break;case"Escape":this.mouseData.clearSelections();break;case"Space":this.settings.debugMode&&(this.mouseData.selections.length>0?console.log(this.mouseData.selections):console.log(this.nodes));break;case"Equal":case"Minus":if(e.ctrlKey){if(!this.settings.canZoom)return;e.preventDefault(),this.updateZoom(this.settings.keyboardZoomMultiplier*(e.code==="Equal"?1:-1),Be().divideBy(2))}break;case"KeyZ":if(!e.ctrlKey)break;e.preventDefault(),e.shiftKey?this.changes.redo():this.changes.undo();break}}}]),this.eventStore.onWheelInNodeflow.subscribeMultiple([{name:"nodeflow:update-zoom",event:({event:e})=>{this.settings.canZoom&&this.updateZoom(-e.deltaY,h.fromEvent(e))}},{name:"nodeflow:prevent-scroll",event:({event:e})=>{e.preventDefault()}}]),this.eventStore.onMouseDownInNodeflow.subscribeMultiple([{name:"nodeflow:reset-movement",event:({event:e})=>{e.button===ue.LEFT&&this.resetMovement()}},{name:"nodeflow:reset-mouse-data",event:({event:e})=>{e.button===ue.LEFT&&this.mouseData.clearSelections(),this.mouseData.selectNodeflow(),this.mouseData.update({clickStartPosition:h.of(e.clientX/this.zoomLevel-this.position.x,e.clientY/this.zoomLevel-this.position.y),pointerDown:this.settings.canPan,mousePosition:h.fromEvent(e)})}},{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()}]),this.eventStore.onMouseDownInConnector.blacklist("nodeflow:allow-pan",(e,o)=>e.event.button!==ue.LEFT&&o.startsWith("nodeflow")),this.eventStore.onMouseDownInConnector.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()},{name:"nodeflow:start-creating-connection",event:({event:e,nodeId:o,connectorId:n})=>{this.mouseData.startCreatingConnection(o,h.fromEvent(e),n)}}]),this.eventStore.onTouchStartInConnector.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()},{name:"nodeflow:start-creating-connection",event:({event:e,nodeId:o,connectorId:n})=>{const{clientX:i,clientY:s}=e.touches[0];this.mouseData.startCreatingConnection(o,h.of(i,s),n)}}]),this.eventStore.onPointerUpInConnector.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>{e.preventDefault(),e.stopPropagation()},priority:2},{name:"nodeflow:connect-held-nodes",event:({event:e,nodeId:o,connectorId:n})=>{var i;if(!this.settings.canCreateConnections)return;const s=(i=this.mouseData.heldConnectors.at(-1))==null?void 0:i.connector,c=s?.parentNode;!s||!c||this.eventStore.onNodeConnected.publish({outputNodeId:c.id,outputId:s.id,inputNodeId:o,inputId:n,event:e})},priority:2},{name:"nodeflow:reset-mouse-data",event:()=>{this.mouseData.pointerDown=!1},priority:1}]),this.eventStore.onMouseDownInNode.blacklist("nodeflow:allow-pan",(e,o)=>e.event.button!==ue.LEFT&&o.startsWith("nodeflow")),this.eventStore.onMouseDownInNode.subscribeMultiple([{name:"nodeflow:select-node",event:({event:e,nodeId:o})=>{this.keyboardData.isActionPressed(this.keymap.SELECT_MULTIPLE)||this.mouseData.clearSelections(),this.mouseData.selectNode(o,h.fromEvent(e),this.settings.canMoveNodes)}},{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()}]),this.eventStore.onTouchStartInNode.subscribeMultiple([{name:"nodeflow:select-node",event:({event:e,nodeId:o})=>{const{clientX:n,clientY:i}=e.touches[0];this.keyboardData.isActionPressed(this.keymap.SELECT_MULTIPLE)||this.mouseData.clearSelections(),this.mouseData.selectNode(o,h.of(n,i),this.settings.canMoveNodes)}},{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()}]),this.eventStore.onPointerDownInNodeCurve.blacklist("nodeflow:allow-pan",(e,o)=>e.event.button!==ue.LEFT&&o.startsWith("nodeflow")),this.eventStore.onPointerDownInNodeCurve.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>{e.preventDefault(),e.stopPropagation()},priority:1},{name:"nodeflow:update-mouse-data",event:({event:e,sourceConnector:o,destinationConnector:n})=>{this.mouseData.pointerDown=!0,this.mouseData.mousePosition=h.fromEvent(e),this.keyboardData.isActionPressed(this.keymap.SELECT_MULTIPLE)||this.mouseData.clearSelections(),this.mouseData.selections.push({type:"connection",connection:{sourceConnector:o,destinationConnector:n}})}}]),this.eventStore.onPointerUpInNode.subscribeMultiple([{name:"nodeflow:reset-mouse-data",event:()=>{this.mouseData.pointerDown=!1,this.mouseData.heldConnectors.length===1&&this.mouseData.clearSelectedByType("node"),this.mouseData.clearSelectedByType("connector")}},{name:"nodeflow:stop-propagation",event:({event:e})=>{e.stopPropagation(),e.preventDefault()}}])}selectNode(e,o){this.mouseData.selectNode(e,o??h.zero(),!1)}};p(Ut,"DEFAULT_SETTINGS",{allowCollision:!1,canAddNodes:!0,canCreateConnections:!0,canDeleteConnections:!0,canDeleteNodes:!0,canMoveNodes:!0,canPan:!0,canZoom:!0,debugMode:!1,keyboardZoomMultiplier:15,maxMovementSpeed:15,maxZoom:200,minZoom:.02,movementAcceleration:1.5,movementDeceleration:.85,zoomMultiplier:.005});let Ko=Ut;var Go=Pt("<div><p></p><p>");const Uo=t=>(()=>{var e=Go(),o=e.firstChild,n=o.nextSibling;return e.style.setProperty("padding","1rem"),e.style.setProperty("padding-left","2rem"),Pe(o,()=>t.node.position.x.toFixed(2)),Pe(n,()=>t.node.position.y.toFixed(2)),e})(),Ho=(t,e=!1)=>{const o=crypto.randomUUID(),n=Y.addNode({position:t,display:Uo,centered:e},o),i=n.addConnectorSection({id:"inputs"},o),s=n.addConnectorSection({id:"outputs"},o),c=Math.random()*4;for(let a=0;a<c;a++)s.addConnector({},o);const r=Math.random()*4;for(let a=0;a<r;a++)i.addConnector({},o);return n},Ro=(t=50)=>{for(let e=0;e<t;e++)Ho(h.of(Math.random()*2e3,Math.random()*2e3))},Vo=()=>{const t=Y.nodes.size;for(let e=0;e<t;e++){const o=Math.floor(Math.random()*t),n=Math.floor(Math.random()*t);if(!Y.nodes.has(o.toString())||!Y.nodes.has(n.toString()))continue;const i=Y.nodes.get(o.toString()),s=Y.nodes.get(n.toString()),c=i.connectorSections.get("outputs").connectors,r=s.connectorSections.get("inputs").connectors,a=Array.from(c.values()),d=Array.from(r.values());if(a.length===0||d.length===0)continue;const u=a[Math.floor(Math.random()*a.length)],l=d[Math.floor(Math.random()*d.length)];o===n||s.getTotalConnectedInputs(l.toString())>0||Y.addConnection({sourceNodeId:o.toString(),sourceConnectorId:u.id,destinationNodeId:n.toString(),destinationConnectorId:l.id})}};var Zo=Pt("<div>");const[Y,Xo]=b.get().createCanvas("main"),Yo=()=>(Yt(()=>{Ro(),Vo()}),(()=>{var t=Zo();return Pe(t,Nt(Xo,{height:"100%",width:"100%"})),Ie(e=>{var o=`${Be().x}px`,n=`${Be().y}px`;return o!==e.e&&((e.e=o)!=null?t.style.setProperty("width",o):t.style.removeProperty("width")),n!==e.t&&((e.t=n)!=null?t.style.setProperty("height",n):t.style.removeProperty("height")),e},{e:void 0,t:void 0}),t})()),qo=document.getElementById("root");oo(()=>Nt(Yo,{}),qo);
