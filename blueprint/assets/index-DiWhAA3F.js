(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function o(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=o(s);fetch(s.href,r)}})();const oo=(t,e)=>t===e,Ee={equals:oo};let zt=At;const q=1,Me=2,kt={owned:null,cleanups:null,context:null,owner:null};var k=null;let Ze=null,no=null,w=null,N=null,K=null,He=0;function so(t,e){const o=w,n=k,s=t.length===0,r=e===void 0?n:e,i=s?kt:{owned:null,cleanups:null,context:r?r.context:null,owner:r},c=s?t:()=>t(()=>ae(()=>me(i)));k=i,w=null;try{return Ne(c,!0)}finally{w=o,k=n}}function ro(t,e){e=e?Object.assign({},Ee,e):Ee;const o={value:t,observers:null,observerSlots:null,comparator:e.equals||void 0},n=s=>(typeof s=="function"&&(s=s(o.value)),Mt(o,s));return[Et.bind(o),n]}function ye(t,e,o){const n=it(t,e,!1,q);De(n)}function io(t,e,o){zt=uo;const n=it(t,e,!1,q);n.user=!0,K?K.push(n):De(n)}function gt(t,e,o){o=o?Object.assign({},Ee,o):Ee;const n=it(t,e,!0,0);return n.observers=null,n.observerSlots=null,n.comparator=o.equals||void 0,De(n),Et.bind(n)}function ae(t){if(w===null)return t();const e=w;w=null;try{return t()}finally{w=e}}function co(t){io(()=>ae(t))}function Et(){if(this.sources&&this.state)if(this.state===q)De(this);else{const t=N;N=null,Ne(()=>Oe(this),!1),N=t}if(w){const t=this.observers?this.observers.length:0;w.sources?(w.sources.push(this),w.sourceSlots.push(t)):(w.sources=[this],w.sourceSlots=[t]),this.observers?(this.observers.push(w),this.observerSlots.push(w.sources.length-1)):(this.observers=[w],this.observerSlots=[w.sources.length-1])}return this.value}function Mt(t,e,o){let n=t.value;return(!t.comparator||!t.comparator(n,e))&&(t.value=e,t.observers&&t.observers.length&&Ne(()=>{for(let s=0;s<t.observers.length;s+=1){const r=t.observers[s],i=Ze&&Ze.running;i&&Ze.disposed.has(r),(i?!r.tState:!r.state)&&(r.pure?N.push(r):K.push(r),r.observers&&Ot(r)),i||(r.state=q)}if(N.length>1e6)throw N=[],new Error},!1)),e}function De(t){if(!t.fn)return;me(t);const e=He;ao(t,t.value,e)}function ao(t,e,o){let n;const s=k,r=w;w=k=t;try{n=t.fn(e)}catch(i){return t.pure&&(t.state=q,t.owned&&t.owned.forEach(me),t.owned=null),t.updatedAt=o+1,$t(i)}finally{w=r,k=s}(!t.updatedAt||t.updatedAt<=o)&&(t.updatedAt!=null&&"observers"in t?Mt(t,n):t.value=n,t.updatedAt=o)}function it(t,e,o,n=q,s){const r={fn:t,state:n,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:k,context:k?k.context:null,pure:o};return k===null||k!==kt&&(k.owned?k.owned.push(r):k.owned=[r]),r}function Ae(t){if(t.state===0)return;if(t.state===Me)return Oe(t);if(t.suspense&&ae(t.suspense.inFallback))return t.suspense.effects.push(t);const e=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<He);)t.state&&e.push(t);for(let o=e.length-1;o>=0;o--)if(t=e[o],t.state===q)De(t);else if(t.state===Me){const n=N;N=null,Ne(()=>Oe(t,e[0]),!1),N=n}}function Ne(t,e){if(N)return t();let o=!1;e||(N=[]),K?o=!0:K=[],He++;try{const n=t();return lo(o),n}catch(n){o||(K=null),N=null,$t(n)}}function lo(t){if(N&&(At(N),N=null),t)return;const e=K;K=null,e.length&&Ne(()=>zt(e),!1)}function At(t){for(let e=0;e<t.length;e++)Ae(t[e])}function uo(t){let e,o=0;for(e=0;e<t.length;e++){const n=t[e];n.user?t[o++]=n:Ae(n)}for(e=0;e<o;e++)Ae(t[e])}function Oe(t,e){t.state=0;for(let o=0;o<t.sources.length;o+=1){const n=t.sources[o];if(n.sources){const s=n.state;s===q?n!==e&&(!n.updatedAt||n.updatedAt<He)&&Ae(n):s===Me&&Oe(n,e)}}}function Ot(t){for(let e=0;e<t.observers.length;e+=1){const o=t.observers[e];o.state||(o.state=Me,o.pure?N.push(o):K.push(o),o.observers&&Ot(o))}}function me(t){let e;if(t.sources)for(;t.sources.length;){const o=t.sources.pop(),n=t.sourceSlots.pop(),s=o.observers;if(s&&s.length){const r=s.pop(),i=o.observerSlots.pop();n<s.length&&(r.sourceSlots[i]=n,s[n]=r,o.observerSlots[n]=i)}}if(t.tOwned){for(e=t.tOwned.length-1;e>=0;e--)me(t.tOwned[e]);delete t.tOwned}if(t.owned){for(e=t.owned.length-1;e>=0;e--)me(t.owned[e]);t.owned=null}if(t.cleanups){for(e=t.cleanups.length-1;e>=0;e--)t.cleanups[e]();t.cleanups=null}t.state=0}function ho(t){return t instanceof Error?t:new Error(typeof t=="string"?t:"Unknown error",{cause:t})}function $t(t,e=k){throw ho(t)}function Je(t,e){return ae(()=>t(e||{}))}const fo=t=>`Stale read from <${t}>.`;function po(t){const e=t.keyed,o=gt(()=>t.when,void 0,{equals:(n,s)=>e?n===s:!n==!s});return gt(()=>{const n=o();if(n){const s=t.children;return typeof s=="function"&&s.length>0?ae(()=>s(e?n:()=>{if(!ae(o))throw fo("Show");return t.when})):s}return t.fallback},void 0,void 0)}function go(t,e,o){let n=o.length,s=e.length,r=n,i=0,c=0,a=e[s-1].nextSibling,l=null;for(;i<s||c<r;){if(e[i]===o[c]){i++,c++;continue}for(;e[s-1]===o[r-1];)s--,r--;if(s===i){const u=r<n?c?o[c-1].nextSibling:o[r-c]:a;for(;c<r;)t.insertBefore(o[c++],u)}else if(r===c)for(;i<s;)(!l||!l.has(e[i]))&&e[i].remove(),i++;else if(e[i]===o[r-1]&&o[c]===e[s-1]){const u=e[--s].nextSibling;t.insertBefore(o[c++],e[i++].nextSibling),t.insertBefore(o[--r],u),e[s]=o[r]}else{if(!l){l=new Map;let d=c;for(;d<r;)l.set(o[d],d++)}const u=l.get(e[i]);if(u!=null)if(c<u&&u<r){let d=i,f=1,g;for(;++d<s&&d<r&&!((g=l.get(e[d]))==null||g!==u+f);)f++;if(f>u-c){const y=e[i];for(;c<u;)t.insertBefore(o[c++],y)}else t.replaceChild(o[c++],e[i++])}else i++;else e[i++].remove()}}}const vt="_$DX_DELEGATE";function vo(t,e,o,n={}){let s;return so(r=>{s=r,e===document?t():re(e,t(),e.firstChild?null:void 0,o)},n.owner),()=>{s(),e.textContent=""}}function ct(t,e,o){let n;const s=()=>{const i=document.createElement("template");return i.innerHTML=t,i.content.firstChild},r=()=>(n||(n=s())).cloneNode(!0);return r.cloneNode=r,r}function yo(t,e=window.document){const o=e[vt]||(e[vt]=new Set);for(let n=0,s=t.length;n<s;n++){const r=t[n];o.has(r)||(o.add(r),e.addEventListener(r,mo))}}function yt(t,e){e==null?t.removeAttribute("class"):t.className=e}function re(t,e,o,n){if(o!==void 0&&!n&&(n=[]),typeof e!="function")return $e(t,e,n,o);ye(s=>$e(t,e(),s,o),n)}function mo(t){let e=t.target;const o=`$$${t.type}`,n=t.target,s=t.currentTarget,r=a=>Object.defineProperty(t,"target",{configurable:!0,value:a}),i=()=>{const a=e[o];if(a&&!e.disabled){const l=e[`${o}Data`];if(l!==void 0?a.call(e,l,t):a.call(e,t),t.cancelBubble)return}return e.host&&typeof e.host!="string"&&!e.host._$host&&e.contains(t.target)&&r(e.host),!0},c=()=>{for(;i()&&(e=e._$host||e.parentNode||e.host););};if(Object.defineProperty(t,"currentTarget",{configurable:!0,get(){return e||document}}),t.composedPath){const a=t.composedPath();r(a[0]);for(let l=0;l<a.length-2&&(e=a[l],!!i());l++){if(e._$host){e=e._$host,c();break}if(e.parentNode===s)break}}else c();r(n)}function $e(t,e,o,n,s){for(;typeof o=="function";)o=o();if(e===o)return o;const r=typeof e,i=n!==void 0;if(t=i&&o[0]&&o[0].parentNode||t,r==="string"||r==="number"){if(r==="number"&&(e=e.toString(),e===o))return o;if(i){let c=o[0];c&&c.nodeType===3?c.data!==e&&(c.data=e):c=document.createTextNode(e),o=te(t,o,n,c)}else o!==""&&typeof o=="string"?o=t.firstChild.data=e:o=t.textContent=e}else if(e==null||r==="boolean")o=te(t,o,n);else{if(r==="function")return ye(()=>{let c=e();for(;typeof c=="function";)c=c();o=$e(t,c,o,n)}),()=>o;if(Array.isArray(e)){const c=[],a=o&&Array.isArray(o);if(et(c,e,o,s))return ye(()=>o=$e(t,c,o,n,!0)),()=>o;if(c.length===0){if(o=te(t,o,n),i)return o}else a?o.length===0?mt(t,c,n):go(t,o,c):(o&&te(t),mt(t,c));o=c}else if(e.nodeType){if(Array.isArray(o)){if(i)return o=te(t,o,n,e);te(t,o,null,e)}else o==null||o===""||!t.firstChild?t.appendChild(e):t.replaceChild(e,t.firstChild);o=e}}return o}function et(t,e,o,n){let s=!1;for(let r=0,i=e.length;r<i;r++){let c=e[r],a=o&&o[t.length],l;if(!(c==null||c===!0||c===!1))if((l=typeof c)=="object"&&c.nodeType)t.push(c);else if(Array.isArray(c))s=et(t,c,a)||s;else if(l==="function")if(n){for(;typeof c=="function";)c=c();s=et(t,Array.isArray(c)?c:[c],Array.isArray(a)?a:[a])||s}else t.push(c),s=!0;else{const u=String(c);a&&a.nodeType===3&&a.data===u?t.push(a):t.push(document.createTextNode(u))}}return s}function mt(t,e,o=null){for(let n=0,s=e.length;n<s;n++)t.insertBefore(e[n],o)}function te(t,e,o,n){if(o===void 0)return t.textContent="";const s=n||document.createTextNode("");if(e.length){let r=!1;for(let i=e.length-1;i>=0;i--){const c=e[i];if(s!==c){const a=c.parentNode===t;!r&&!i?a?t.replaceChild(s,c):t.insertBefore(s,o):a&&c.remove()}else r=!0}}else t.insertBefore(s,o);return[s]}(function(){try{if(typeof document<"u"){var t=document.createElement("style");t.appendChild(document.createTextNode("@layer nodeflow{.nodeflowConnectorSection{position:absolute;display:flex;justify-content:space-evenly;width:0;height:0;top:50%;left:50%}.nodeflowNode{position:absolute;border:1px solid black;-webkit-user-select:none;user-select:none;z-index:1;cursor:grab}}")),document.head.appendChild(t)}}catch(e){console.error("vite-plugin-css-injected-by-js",e)}})();var wo=Object.defineProperty,Co=(t,e,o)=>e in t?wo(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,p=(t,e,o)=>(Co(t,typeof e!="symbol"?e+"":e,o),o),Tt=(t,e,o)=>{if(!e.has(t))throw TypeError("Cannot "+o)},v=(t,e,o)=>(Tt(t,e,"read from private field"),o?o.call(t):e.get(t)),tt=(t,e,o)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,o)},bo=(t,e,o,n)=>(Tt(t,e,"write to private field"),e.set(t,o),o);const So=(t,e)=>t===e,J=Symbol("solid-proxy"),ot=Symbol("solid-track"),Te={equals:So};let Lt=Ft;const X=1,Le=2,Bt={owned:null,cleanups:null,context:null,owner:null};var b=null;let qe=null,m=null,I=null,U=null,Re=0;function Xe(t,e){const o=m,n=b,s=t.length===0,r=n,i=s?Bt:{owned:null,cleanups:null,context:r?r.context:null,owner:r},c=s?t:()=>t(()=>Z(()=>Ce(i)));b=i,m=null;try{return fe(c,!0)}finally{m=o,b=n}}function Ie(t,e){e=e?Object.assign({},Te,e):Te;const o={value:t,observers:null,observerSlots:null,comparator:e.equals||void 0},n=s=>(typeof s=="function"&&(s=s(o.value)),Wt(o,s));return[jt.bind(o),n]}function M(t,e,o){const n=lt(t,e,!1,X);Pe(n)}function we(t,e,o){Lt=Io;const n=lt(t,e,!1,X);n.user=!0,U?U.push(n):Pe(n)}function j(t,e,o){o=o?Object.assign({},Te,o):Te;const n=lt(t,e,!0,0);return n.observers=null,n.observerSlots=null,n.comparator=o.equals||void 0,Pe(n),jt.bind(n)}function ze(t){return fe(t,!1)}function Z(t){if(m===null)return t();const e=m;m=null;try{return t()}finally{m=e}}function at(t){return b===null||(b.cleanups===null?b.cleanups=[t]:b.cleanups.push(t)),t}function Be(){return m}function jt(){if(this.sources&&this.state)if(this.state===X)Pe(this);else{const t=I;I=null,fe(()=>We(this),!1),I=t}if(m){const t=this.observers?this.observers.length:0;m.sources?(m.sources.push(this),m.sourceSlots.push(t)):(m.sources=[this],m.sourceSlots=[t]),this.observers?(this.observers.push(m),this.observerSlots.push(m.sources.length-1)):(this.observers=[m],this.observerSlots=[m.sources.length-1])}return this.value}function Wt(t,e,o){let n=t.value;return(!t.comparator||!t.comparator(n,e))&&(t.value=e,t.observers&&t.observers.length&&fe(()=>{for(let s=0;s<t.observers.length;s+=1){const r=t.observers[s],i=qe&&qe.running;i&&qe.disposed.has(r),(i?!r.tState:!r.state)&&(r.pure?I.push(r):U.push(r),r.observers&&_t(r)),i||(r.state=X)}if(I.length>1e6)throw I=[],new Error},!1)),e}function Pe(t){if(!t.fn)return;Ce(t);const e=Re;Do(t,t.value,e)}function Do(t,e,o){let n;const s=b,r=m;m=b=t;try{n=t.fn(e)}catch(i){return t.pure&&(t.state=X,t.owned&&t.owned.forEach(Ce),t.owned=null),t.updatedAt=o+1,Gt(i)}finally{m=r,b=s}(!t.updatedAt||t.updatedAt<=o)&&(t.updatedAt!=null&&"observers"in t?Wt(t,n):t.value=n,t.updatedAt=o)}function lt(t,e,o,n=X,s){const r={fn:t,state:n,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:b,context:b?b.context:null,pure:o};return b===null||b!==Bt&&(b.owned?b.owned.push(r):b.owned=[r]),r}function je(t){if(t.state===0)return;if(t.state===Le)return We(t);if(t.suspense&&Z(t.suspense.inFallback))return t.suspense.effects.push(t);const e=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<Re);)t.state&&e.push(t);for(let o=e.length-1;o>=0;o--)if(t=e[o],t.state===X)Pe(t);else if(t.state===Le){const n=I;I=null,fe(()=>We(t,e[0]),!1),I=n}}function fe(t,e){if(I)return t();let o=!1;e||(I=[]),U?o=!0:U=[],Re++;try{const n=t();return No(o),n}catch(n){o||(U=null),I=null,Gt(n)}}function No(t){if(I&&(Ft(I),I=null),t)return;const e=U;U=null,e.length&&fe(()=>Lt(e),!1)}function Ft(t){for(let e=0;e<t.length;e++)je(t[e])}function Io(t){let e,o=0;for(e=0;e<t.length;e++){const n=t[e];n.user?t[o++]=n:je(n)}for(e=0;e<o;e++)je(t[e])}function We(t,e){t.state=0;for(let o=0;o<t.sources.length;o+=1){const n=t.sources[o];if(n.sources){const s=n.state;s===X?n!==e&&(!n.updatedAt||n.updatedAt<Re)&&je(n):s===Le&&We(n,e)}}}function _t(t){for(let e=0;e<t.observers.length;e+=1){const o=t.observers[e];o.state||(o.state=Le,o.pure?I.push(o):U.push(o),o.observers&&_t(o))}}function Ce(t){let e;if(t.sources)for(;t.sources.length;){const o=t.sources.pop(),n=t.sourceSlots.pop(),s=o.observers;if(s&&s.length){const r=s.pop(),i=o.observerSlots.pop();n<s.length&&(r.sourceSlots[i]=n,s[n]=r,o.observerSlots[n]=i)}}if(t.tOwned){for(e=t.tOwned.length-1;e>=0;e--)Ce(t.tOwned[e]);delete t.tOwned}if(t.owned){for(e=t.owned.length-1;e>=0;e--)Ce(t.owned[e]);t.owned=null}if(t.cleanups){for(e=t.cleanups.length-1;e>=0;e--)t.cleanups[e]();t.cleanups=null}t.state=0}function Po(t){return t instanceof Error?t:new Error(typeof t=="string"?t:"Unknown error",{cause:t})}function Gt(t,e=b){throw Po(t)}const xo=Symbol("fallback");function wt(t){for(let e=0;e<t.length;e++)t[e]()}function zo(t,e,o={}){let n=[],s=[],r=[],i=0,c=e.length>1?[]:null;return at(()=>wt(r)),()=>{let a=t()||[],l=a.length,u,d;return a[ot],Z(()=>{let g,y,P,O,xe,L,B,W,ee;if(l===0)i!==0&&(wt(r),r=[],n=[],s=[],i=0,c&&(c=[])),o.fallback&&(n=[xo],s[0]=Xe(to=>(r[0]=to,o.fallback())),i=1);else if(i===0){for(s=new Array(l),d=0;d<l;d++)n[d]=a[d],s[d]=Xe(f);i=l}else{for(P=new Array(l),O=new Array(l),c&&(xe=new Array(l)),L=0,B=Math.min(i,l);L<B&&n[L]===a[L];L++);for(B=i-1,W=l-1;B>=L&&W>=L&&n[B]===a[W];B--,W--)P[W]=s[B],O[W]=r[B],c&&(xe[W]=c[B]);for(g=new Map,y=new Array(W+1),d=W;d>=L;d--)ee=a[d],u=g.get(ee),y[d]=u===void 0?-1:u,g.set(ee,d);for(u=L;u<=B;u++)ee=n[u],d=g.get(ee),d!==void 0&&d!==-1?(P[d]=s[u],O[d]=r[u],c&&(xe[d]=c[u]),d=y[d],g.set(ee,d)):r[u]();for(d=L;d<l;d++)d in P?(s[d]=P[d],r[d]=O[d],c&&(c[d]=xe[d],c[d](d))):s[d]=Xe(f);s=s.slice(0,i=l),n=a.slice(0)}return s});function f(g){if(r[d]=g,c){const[y,P]=Ie(d);return c[d]=P,e(a[d],y)}return e(a[d])}}}function A(t,e){return Z(()=>t(e||{}))}const ko=t=>`Stale read from <${t}>.`;function ne(t){const e="fallback"in t&&{fallback:()=>t.fallback};return j(zo(()=>t.each,t.children,e||void 0))}function dt(t){const e=t.keyed,o=j(()=>t.when,void 0,{equals:(n,s)=>e?n===s:!n==!s});return j(()=>{const n=o();if(n){const s=t.children;return typeof s=="function"&&s.length>0?Z(()=>s(e?n:()=>{if(!Z(o))throw ko("Show");return t.when})):s}return t.fallback},void 0,void 0)}function Eo(t,e,o){let n=o.length,s=e.length,r=n,i=0,c=0,a=e[s-1].nextSibling,l=null;for(;i<s||c<r;){if(e[i]===o[c]){i++,c++;continue}for(;e[s-1]===o[r-1];)s--,r--;if(s===i){const u=r<n?c?o[c-1].nextSibling:o[r-c]:a;for(;c<r;)t.insertBefore(o[c++],u)}else if(r===c)for(;i<s;)(!l||!l.has(e[i]))&&e[i].remove(),i++;else if(e[i]===o[r-1]&&o[c]===e[s-1]){const u=e[--s].nextSibling;t.insertBefore(o[c++],e[i++].nextSibling),t.insertBefore(o[--r],u),e[s]=o[r]}else{if(!l){l=new Map;let d=c;for(;d<r;)l.set(o[d],d++)}const u=l.get(e[i]);if(u!=null)if(c<u&&u<r){let d=i,f=1,g;for(;++d<s&&d<r&&!((g=l.get(e[d]))==null||g!==u+f);)f++;if(f>u-c){const y=e[i];for(;c<u;)t.insertBefore(o[c++],y)}else t.replaceChild(o[c++],e[i++])}else i++;else e[i++].remove()}}}const Ct="_$DX_DELEGATE";function Y(t,e,o){let n;const s=()=>{const i=document.createElement("template");return i.innerHTML=t,o?i.content.firstChild.firstChild:i.content.firstChild},r=e?()=>Z(()=>document.importNode(n||(n=s()),!0)):()=>(n||(n=s())).cloneNode(!0);return r.cloneNode=r,r}function Ve(t,e=window.document){const o=e[Ct]||(e[Ct]=new Set);for(let n=0,s=t.length;n<s;n++){const r=t[n];o.has(r)||(o.add(r),e.addEventListener(r,Mo))}}function S(t,e,o){o==null?t.removeAttribute(e):t.setAttribute(e,o)}function Kt(t,e){e==null?t.removeAttribute("class"):t.className=e}function nt(t,e,o={}){const n=Object.keys(e||{}),s=Object.keys(o);let r,i;for(r=0,i=s.length;r<i;r++){const c=s[r];!c||c==="undefined"||e[c]||(bt(t,c,!1),delete o[c])}for(r=0,i=n.length;r<i;r++){const c=n[r],a=!!e[c];!c||c==="undefined"||o[c]===a||!a||(bt(t,c,!0),o[c]=a)}return o}function ut(t,e,o){return Z(()=>t(e,o))}function Q(t,e,o,n){if(o!==void 0&&!n&&(n=[]),typeof e!="function")return Fe(t,e,n,o);M(s=>Fe(t,e(),s,o),n)}function bt(t,e,o){const n=e.trim().split(/\s+/);for(let s=0,r=n.length;s<r;s++)t.classList.toggle(n[s],o)}function Mo(t){let e=t.target;const o=`$$${t.type}`,n=t.target,s=t.currentTarget,r=a=>Object.defineProperty(t,"target",{configurable:!0,value:a}),i=()=>{const a=e[o];if(a&&!e.disabled){const l=e[`${o}Data`];if(l!==void 0?a.call(e,l,t):a.call(e,t),t.cancelBubble)return}return e.host&&typeof e.host!="string"&&!e.host._$host&&e.contains(t.target)&&r(e.host),!0},c=()=>{for(;i()&&(e=e._$host||e.parentNode||e.host););};if(Object.defineProperty(t,"currentTarget",{configurable:!0,get(){return e||document}}),t.composedPath){const a=t.composedPath();r(a[0]);for(let l=0;l<a.length-2&&(e=a[l],!!i());l++){if(e._$host){e=e._$host,c();break}if(e.parentNode===s)break}}else c();r(n)}function Fe(t,e,o,n,s){for(;typeof o=="function";)o=o();if(e===o)return o;const r=typeof e,i=n!==void 0;if(t=i&&o[0]&&o[0].parentNode||t,r==="string"||r==="number"){if(r==="number"&&(e=e.toString(),e===o))return o;if(i){let c=o[0];c&&c.nodeType===3?c.data!==e&&(c.data=e):c=document.createTextNode(e),o=oe(t,o,n,c)}else o!==""&&typeof o=="string"?o=t.firstChild.data=e:o=t.textContent=e}else if(e==null||r==="boolean")o=oe(t,o,n);else{if(r==="function")return M(()=>{let c=e();for(;typeof c=="function";)c=c();o=Fe(t,c,o,n)}),()=>o;if(Array.isArray(e)){const c=[],a=o&&Array.isArray(o);if(st(c,e,o,s))return M(()=>o=Fe(t,c,o,n,!0)),()=>o;if(c.length===0){if(o=oe(t,o,n),i)return o}else a?o.length===0?St(t,c,n):Eo(t,o,c):(o&&oe(t),St(t,c));o=c}else if(e.nodeType){if(Array.isArray(o)){if(i)return o=oe(t,o,n,e);oe(t,o,null,e)}else o==null||o===""||!t.firstChild?t.appendChild(e):t.replaceChild(e,t.firstChild);o=e}}return o}function st(t,e,o,n){let s=!1;for(let r=0,i=e.length;r<i;r++){let c=e[r],a=o&&o[t.length],l;if(!(c==null||c===!0||c===!1))if((l=typeof c)=="object"&&c.nodeType)t.push(c);else if(Array.isArray(c))s=st(t,c,a)||s;else if(l==="function")if(n){for(;typeof c=="function";)c=c();s=st(t,Array.isArray(c)?c:[c],Array.isArray(a)?a:[a])||s}else t.push(c),s=!0;else{const u=String(c);a&&a.nodeType===3&&a.data===u?t.push(a):t.push(document.createTextNode(u))}}return s}function St(t,e,o=null){for(let n=0,s=e.length;n<s;n++)t.insertBefore(e[n],o)}function oe(t,e,o,n){if(o===void 0)return t.textContent="";const s=n||document.createTextNode("");if(e.length){let r=!1;for(let i=e.length-1;i>=0;i--){const c=e[i];if(s!==c){const a=c.parentNode===t;!r&&!i?a?t.replaceChild(s,c):t.insertBefore(s,o):a&&c.remove()}else r=!0}}else t.insertBefore(s,o);return[s]}class h{constructor(e,o){p(this,"x"),p(this,"y"),this.x=e,this.y=o}static zero(){return new h(0,0)}static of(e,o){return new h(e,o)}static fromEvent(e){return new h(e.clientX,e.clientY)}static fromVec2(e){return new h(e.x,e.y)}copy(){return h.fromVec2(this)}serialize(){return{x:this.x,y:this.y}}static deserialize(e){return new h(e.x,e.y)}static deserializeOrDefault(e,o=h.zero()){return e?h.deserialize(e):o}add(...e){return e.reduce((o,n)=>new h(o.x+n.x,o.y+n.y),this)}subtract(...e){return e.reduce((o,n)=>new h(o.x-n.x,o.y-n.y),this)}multiply(...e){return e.reduce((o,n)=>new h(o.x*n.x,o.y*n.y),this)}divide(...e){return e.reduce((o,n)=>new h(n.x/o.x,n.y/o.y),this)}negate(){return new h(-this.x,-this.y)}shift(e){return new h(this.x+e,this.y+e)}multiplyBy(e){return new h(this.x*e,this.y*e)}divideBy(e){return new h(this.x/e,this.y/e)}isWithinRect(e,o){return this.x>=e.x&&this.x<=e.x+o.x&&this.y>=e.y&&this.y<=e.y+o.y}distanceTo(e){return Math.hypot(this.x-e.x,this.y-e.y)}abs(){return h.of(Math.abs(this.x),Math.abs(this.y))}equals(e){return this.x===e.x&&this.y===e.y}hashCode(){return`${this.x}:${this.y}`}get magnitude(){return Math.hypot(this.x,this.y)}normalize(){const e=this.magnitude;return new h(this.x/e,this.y/e)}}var Ao=Y("<div>");const Oo=t=>(()=>{var e=Ao();return e.$$pointerup=o=>t.nodeflowData.eventStore.onPointerUpInConnector.publish({event:o,nodeId:t.nodeId,connectorId:t.connectorId}),e.$$touchstart=o=>t.nodeflowData.eventStore.onTouchStartInConnector.publish({event:o,nodeId:t.nodeId,connectorId:t.connectorId}),e.$$mousedown=o=>t.nodeflowData.eventStore.onMouseDownInConnector.publish({event:o,nodeId:t.nodeId,connectorId:t.connectorId}),ut(o=>setTimeout(()=>{var n,s;if(!o)return;const r=t.nodeflowData.nodes.get(t.nodeId).connectorSections.get(t.sectionId).connectors.get(t.connectorId),i=new ResizeObserver(()=>{r.size=h.of(o.offsetWidth,o.offsetHeight)});i.observe(o),r.update({position:h.of((((n=o?.parentElement)==null?void 0:n.offsetLeft)??0)+o.offsetLeft,(((s=o?.parentElement)==null?void 0:s.offsetTop)??0)+o.offsetTop),ref:o,resizeObserver:i,size:h.of(o.offsetWidth,o.offsetHeight)})}),e),M(o=>{var n,s=(n=t.connector)==null?void 0:n.css,r=`connector-${t.connectorId}`;return s!==o.e&&Kt(e,o.e=s),r!==o.t&&S(e,"id",o.t=r),o},{e:void 0,t:void 0}),e})();Ve(["mousedown","touchstart","pointerup"]);var Dt=Y("<svg><circle r=4 fill=none></svg>",!1,!0),$o=Y("<svg><path stroke=black stroke-width=1 fill=transparent>");const To=t=>{const e=j(()=>{const{mouseData:o,curveFunctions:n}=t.nodeflowData;if(o.heldConnectors.length!==1)return;const s=o.heldConnectors[0].connector,r=s.parentNode,i=s.getCenter(),c=o.globalMousePosition(),{anchorStart:a,anchorEnd:l}=n.calculateCurveAnchors(i,c,r.getCenter(),c);return{start:i,end:c,anchorStart:a,anchorEnd:l,path:n.createDefaultCurvePath(i,c,a,l)}});return(()=>{var o=$o(),n=o.firstChild;return o.style.setProperty("z-index","2"),o.style.setProperty("position","absolute"),o.style.setProperty("width","1px"),o.style.setProperty("height","1px"),o.style.setProperty("pointer-events","none"),o.style.setProperty("overflow","visible"),Q(o,A(dt,{get when(){return t.nodeflowData.settings.debugMode},get children(){return[(()=>{var s=Dt();return M(r=>{var i,c,a=(i=e())==null?void 0:i.anchorStart.x,l=(c=e())==null?void 0:c.anchorStart.y,u=t.css??"";return a!==r.e&&S(s,"cx",r.e=a),l!==r.t&&S(s,"cy",r.t=l),u!==r.a&&S(s,"class",r.a=u),r},{e:void 0,t:void 0,a:void 0}),s})(),(()=>{var s=Dt();return M(r=>{var i,c,a=(i=e())==null?void 0:i.anchorEnd.x,l=(c=e())==null?void 0:c.anchorEnd.y,u=t.css??"";return a!==r.e&&S(s,"cx",r.e=a),l!==r.t&&S(s,"cy",r.t=l),u!==r.a&&S(s,"class",r.a=u),r},{e:void 0,t:void 0,a:void 0}),s})()]}}),null),M(s=>{var r,i=(r=e())==null?void 0:r.path,c=t.css;return i!==s.e&&S(n,"d",s.e=i),c!==s.t&&S(n,"class",s.t=c),s},{e:void 0,t:void 0}),o})()};var Lo=Y("<svg><path stroke=black stroke-width=1 fill=none></svg>",!1,!0),Nt=Y("<svg><circle r=4 fill=none></svg>",!1,!0);const Bo=t=>{const e=j(()=>t.nodeflowData.nodes.get(t.sourceNodeId)),o=j(()=>t.nodeflowData.nodes.get(t.destinationNodeId)),n=j(()=>e().getConnector(t.sourceConnectorId)),s=j(()=>o().getConnector(t.destinationConnectorId)),r=j(()=>{var i,c;return!e()||!o()?-1:((c=(i=n())==null?void 0:i.destinations)==null?void 0:c.findIndex(a=>a.destinationConnector===s()))??-1});return we(()=>{if(r()<0)return;const{curveFunctions:i}=t.nodeflowData,c=e().getConnector(t.sourceConnectorId),a=o().getConnector(t.destinationConnectorId),l=c.getCenter(),u=a.getCenter(),{anchorStart:d,anchorEnd:f}=i.calculateCurveAnchors(l,u,e().getCenter(),o().getCenter());n().destinations.get(r()).path={start:l,end:u,anchorStart:d,anchorEnd:f,path:i.createDefaultCurvePath(l,u,d,f)}}),[(()=>{var i=Lo();return i.$$pointerdown=c=>{t.nodeflowData.eventStore.onPointerDownInNodeCurve.publish({event:c,sourceConnector:n(),destinationConnector:s()})},i.style.setProperty("cursor","pointer"),i.style.setProperty("pointer-events","visibleStroke"),M(c=>{var a,l,u,d=(a=n().destinations.get(r()).path)==null?void 0:a.path,f={[((l=t.css)==null?void 0:l.normal)??""]:!0,[((u=t.css)==null?void 0:u.selected)??""]:t.nodeflowData.mouseData.hasSelectedConnection(t.sourceNodeId,t.sourceConnectorId,t.destinationNodeId,t.destinationConnectorId)};return d!==c.e&&S(i,"d",c.e=d),c.t=nt(i,f,c.t),c},{e:void 0,t:void 0}),i})(),A(dt,{get when(){return t.nodeflowData.settings.debugMode},get children(){return[(()=>{var i=Nt();return M(c=>{var a,l,u,d,f,g=(l=(a=n().destinations.get(r()).path)==null?void 0:a.anchorStart)==null?void 0:l.x,y=(d=(u=n().destinations.get(r()).path)==null?void 0:u.anchorStart)==null?void 0:d.y,P=((f=t.css)==null?void 0:f.normal)??"";return g!==c.e&&S(i,"cx",c.e=g),y!==c.t&&S(i,"cy",c.t=y),P!==c.a&&S(i,"class",c.a=P),c},{e:void 0,t:void 0,a:void 0}),i})(),(()=>{var i=Nt();return M(c=>{var a,l,u,d,f,g=(l=(a=n().destinations.get(r()).path)==null?void 0:a.anchorEnd)==null?void 0:l.x,y=(d=(u=n().destinations.get(r()).path)==null?void 0:u.anchorEnd)==null?void 0:d.y,P=((f=t.css)==null?void 0:f.normal)??"";return g!==c.e&&S(i,"cx",c.e=g),y!==c.t&&S(i,"cy",c.t=y),P!==c.a&&S(i,"class",c.a=P),c},{e:void 0,t:void 0,a:void 0}),i})()]}})]};Ve(["pointerdown"]);var jo=Y("<div class=nodeflowNode>"),Wo=Y("<div>");const Fo=t=>{const e=j(()=>t.nodeflowData.nodes.get(t.nodeId)),[o,n]=Ie(!1);return M(()=>{const s=t.nodeflowData.mouseData.selections.at(-1);s?.type!=="node"||s.node.id!==t.nodeId||!t.nodeflowData.mouseData.pointerDown||e().updateWithPrevious(r=>{const i=t.nodeflowData.mouseData.mousePosition.divideBy(t.nodeflowData.zoomLevel).subtract(t.nodeflowData.mouseData.clickStartPosition??h.zero());return t.nodeflowData.chunking.updateNodeInChunk(t.nodeId,r.position,i),{position:i}})}),at(()=>{t.nodeflowData.chunking.removeNodeFromChunk(t.nodeId,e().position),e().resizeObserver&&(e().resizeObserver.disconnect(),Array.from(e().connectorSections.values()).forEach(s=>{Array.from(s.connectors.values()).forEach(r=>{r.resizeObserver&&r.resizeObserver.disconnect()})}))}),(()=>{var s=jo();return s.$$pointerup=r=>t.nodeflowData.eventStore.onPointerUpInNode.publish({event:r,nodeId:t.nodeId}),s.$$touchstart=r=>t.nodeflowData.eventStore.onTouchStartInNode.publish({event:r,nodeId:t.nodeId}),s.$$mousedown=r=>t.nodeflowData.eventStore.onMouseDownInNode.publish({event:r,nodeId:t.nodeId}),ut(r=>setTimeout(()=>{if(!r)return;const i=new ResizeObserver(()=>{e().update({size:h.of(r.clientWidth,r.clientHeight)}),Array.from(e().connectorSections.values()).forEach(a=>Array.from(a.connectors.values()).forEach(l=>{var u,d;const f=l.ref;f&&(l.position=h.of((((u=f?.parentElement)==null?void 0:u.offsetLeft)??0)+f.offsetLeft,(((d=f?.parentElement)==null?void 0:d.offsetTop)??0)+f.offsetTop))}))});i.observe(r);const c=e().centered?h.of(r.clientWidth,r.clientHeight).divideBy(2):h.zero();e().update({offset:h.of(r.clientLeft,r.clientTop),ref:r,resizeObserver:i,position:e().position.subtract(c),size:h.of(r.clientWidth,r.clientHeight)}),n(!0)}),s),Q(s,()=>e().display({node:e()}),null),Q(s,A(ne,{get each(){return Array.from(e().connectorSections.entries())},children:([r,i])=>(()=>{var c=Wo();return S(c,"id",`section-${r}`),Q(c,A(ne,{get each(){return Array.from(i.connectors.entries())},children:([a,l])=>A(Oo,{connector:l,connectorId:a,get nodeId(){return t.nodeId},sectionId:r,get nodeflowData(){return t.nodeflowData}})})),M(a=>nt(c,{[i?.css??""]:!0,nodeflowConnectorSection:!0},a)),c})()}),null),M(r=>{var i,c,a,l,u=`${e().position.x}px`,d=`${e().position.y}px`,f=o()?1:0,g=`node-${t.nodeId}`,y={[((c=(i=e())==null?void 0:i.css)==null?void 0:c.normal)??""]:!0,[((l=(a=e())==null?void 0:a.css)==null?void 0:l.selected)??""]:t.nodeflowData.mouseData.hasSelectedNode(t.nodeId)};return u!==r.e&&((r.e=u)!=null?s.style.setProperty("left",u):s.style.removeProperty("left")),d!==r.t&&((r.t=d)!=null?s.style.setProperty("top",d):s.style.removeProperty("top")),f!==r.a&&((r.a=f)!=null?s.style.setProperty("opacity",f):s.style.removeProperty("opacity")),g!==r.o&&S(s,"id",r.o=g),r.i=nt(s,y,r.i),r},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),s})()};Ve(["mousedown","touchstart","pointerup"]);var _o=Y("<div tabindex=0><div><svg>");const Go=t=>e=>(()=>{var o=_o(),n=o.firstChild,s=n.firstChild;return o.$$touchmove=r=>t.eventStore.onTouchMoveInNodeflow.publish({event:r}),o.$$touchstart=r=>t.eventStore.onTouchStartInNodeflow.publish({event:r}),o.$$keyup=r=>t.eventStore.onKeyUpInNodeflow.publish({event:r}),o.$$keydown=r=>t.eventStore.onKeyDownInNodeflow.publish({event:r}),o.$$mousedown=r=>t.eventStore.onMouseDownInNodeflow.publish({event:r}),o.addEventListener("wheel",r=>t.eventStore.onWheelInNodeflow.publish({event:r})),o.$$pointerup=r=>t.eventStore.onPointerUpInNodeflow.publish({event:r}),o.$$mousemove=r=>t.eventStore.onMouseMoveInNodeflow.publish({event:r}),ut(r=>{new ResizeObserver(()=>{t.update({size:h.of(r.clientWidth,r.clientHeight),startPosition:h.of(r.offsetLeft,r.offsetTop)})}).observe(r)},o),o.style.setProperty("overflow","hidden"),n.style.setProperty("position","absolute"),n.style.setProperty("transform-origin","center"),n.style.setProperty("transition","scale 0.1s ease-out"),Q(n,A(ne,{get each(){return Array.from(t.nodes.keys())},children:r=>A(Fo,{nodeId:r,nodeflowData:t})}),s),s.style.setProperty("z-index","2"),s.style.setProperty("position","absolute"),s.style.setProperty("width","1px"),s.style.setProperty("height","1px"),s.style.setProperty("pointer-events","none"),s.style.setProperty("overflow","visible"),Q(s,A(ne,{get each(){return Array.from(t.nodes.entries())},children:([r,i])=>A(ne,{get each(){return i.getAllConnectors()},children:c=>A(ne,{get each(){return c.destinations.array},children:a=>A(Bo,{nodeflowData:t,sourceNodeId:r,get sourceConnectorId(){return c.id},get destinationNodeId(){return a.destinationConnector.parentSection.parentNode.id},get destinationConnectorId(){return a.destinationConnector.id},get css(){return a.css}})})})})),Q(n,A(dt,{get when(){return t.mouseData.heldConnectors.length===1},get children(){return A(To,{get css(){var r;return(r=e?.css)==null?void 0:r.newCurve},nodeflowData:t})}}),null),M(r=>{var i,c=`nodeflow-${t.id}`,a=(i=e?.css)==null?void 0:i.nodeflow,l=e.height,u=e.width,d=`scale(${t.zoomLevel}) translate(${t.position.x}px, ${t.position.y}px)`;return c!==r.e&&S(o,"id",r.e=c),a!==r.t&&Kt(o,r.t=a),l!==r.a&&((r.a=l)!=null?o.style.setProperty("height",l):o.style.removeProperty("height")),u!==r.o&&((r.o=u)!=null?o.style.setProperty("width",u):o.style.removeProperty("width")),d!==r.i&&((r.i=d)!=null?n.style.setProperty("transform",d):n.style.removeProperty("transform")),r},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),o})();Ve(["mousemove","pointerup","mousedown","keydown","keyup","touchstart","touchmove"]);const _e=Symbol("store-raw"),ie=Symbol("store-node"),_=Symbol("store-has"),Ut=Symbol("store-self");function Ht(t){let e=t[J];if(!e&&(Object.defineProperty(t,J,{value:e=new Proxy(t,Ho)}),!Array.isArray(t))){const o=Object.keys(t),n=Object.getOwnPropertyDescriptors(t);for(let s=0,r=o.length;s<r;s++){const i=o[s];n[i].get&&Object.defineProperty(t,i,{enumerable:n[i].enumerable,get:n[i].get.bind(e)})}}return e}function le(t){let e;return t!=null&&typeof t=="object"&&(t[J]||!(e=Object.getPrototypeOf(t))||e===Object.prototype||Array.isArray(t))}function de(t,e=new Set){let o,n,s,r;if(o=t!=null&&t[_e])return o;if(!le(t)||e.has(t))return t;if(Array.isArray(t)){Object.isFrozen(t)?t=t.slice(0):e.add(t);for(let i=0,c=t.length;i<c;i++)s=t[i],(n=de(s,e))!==s&&(t[i]=n)}else{Object.isFrozen(t)?t=Object.assign({},t):e.add(t);const i=Object.keys(t),c=Object.getOwnPropertyDescriptors(t);for(let a=0,l=i.length;a<l;a++)r=i[a],!c[r].get&&(s=t[r],(n=de(s,e))!==s&&(t[r]=n))}return t}function Ge(t,e){let o=t[e];return o||Object.defineProperty(t,e,{value:o=Object.create(null)}),o}function be(t,e,o){if(t[e])return t[e];const[n,s]=Ie(o,{equals:!1,internal:!0});return n.$=s,t[e]=n}function Ko(t,e){const o=Reflect.getOwnPropertyDescriptor(t,e);return!o||o.get||!o.configurable||e===J||e===ie||(delete o.value,delete o.writable,o.get=()=>t[J][e]),o}function Rt(t){Be()&&be(Ge(t,ie),Ut)()}function Uo(t){return Rt(t),Reflect.ownKeys(t)}const Ho={get(t,e,o){if(e===_e)return t;if(e===J)return o;if(e===ot)return Rt(t),o;const n=Ge(t,ie),s=n[e];let r=s?s():t[e];if(e===ie||e===_||e==="__proto__")return r;if(!s){const i=Object.getOwnPropertyDescriptor(t,e);Be()&&(typeof r!="function"||t.hasOwnProperty(e))&&!(i&&i.get)&&(r=be(n,e,r)())}return le(r)?Ht(r):r},has(t,e){return e===_e||e===J||e===ot||e===ie||e===_||e==="__proto__"?!0:(Be()&&be(Ge(t,_),e)(),e in t)},set(){return!0},deleteProperty(){return!0},ownKeys:Uo,getOwnPropertyDescriptor:Ko};function ue(t,e,o,n=!1){if(!n&&t[e]===o)return;const s=t[e],r=t.length;o===void 0?(delete t[e],t[_]&&t[_][e]&&s!==void 0&&t[_][e].$()):(t[e]=o,t[_]&&t[_][e]&&s===void 0&&t[_][e].$());let i=Ge(t,ie),c;if((c=be(i,e,s))&&c.$(()=>o),Array.isArray(t)&&t.length!==r){for(let a=t.length;a<r;a++)(c=i[a])&&c.$();(c=be(i,"length",r))&&c.$(t.length)}(c=i[Ut])&&c.$()}function Vt(t,e){const o=Object.keys(e);for(let n=0;n<o.length;n+=1){const s=o[n];ue(t,s,e[s])}}function Ro(t,e){if(typeof e=="function"&&(e=e(t)),e=de(e),Array.isArray(e)){if(t===e)return;let o=0,n=e.length;for(;o<n;o++){const s=e[o];t[o]!==s&&ue(t,o,s)}ue(t,"length",n)}else Vt(t,e)}function ge(t,e,o=[]){let n,s=t;if(e.length>1){n=e.shift();const i=typeof n,c=Array.isArray(t);if(Array.isArray(n)){for(let a=0;a<n.length;a++)ge(t,[n[a]].concat(e),o);return}else if(c&&i==="function"){for(let a=0;a<t.length;a++)n(t[a],a)&&ge(t,[a].concat(e),o);return}else if(c&&i==="object"){const{from:a=0,to:l=t.length-1,by:u=1}=n;for(let d=a;d<=l;d+=u)ge(t,[d].concat(e),o);return}else if(e.length>1){ge(t[n],e,[n].concat(o));return}s=t[n],o=[n].concat(o)}let r=e[0];typeof r=="function"&&(r=r(s,o),r===s)||n===void 0&&r==null||(r=de(r),n===void 0||le(s)&&le(r)&&!Array.isArray(r)?Vt(s,r):ue(t,n,r))}function T(...[t,e]){const o=de(t||{}),n=Array.isArray(o),s=Ht(o);function r(...i){ze(()=>{n&&i.length===1?Ro(o,i[0]):ge(o,i)})}return[s,r]}const Ke=new WeakMap,Zt={get(t,e){if(e===_e)return t;const o=t[e];let n;return le(o)?Ke.get(o)||(Ke.set(o,n=new Proxy(o,Zt)),n):o},set(t,e,o){return ue(t,e,de(o)),!0},deleteProperty(t,e){return ue(t,e,void 0,!0),!0}};function rt(t){return e=>{if(le(e)){let o;(o=Ke.get(e))||Ke.set(e,o=new Proxy(e,Zt)),t(o)}return e}}class ${constructor(e){p(this,"store"),this.store=T(e??[])}get array(){return this.store[0]}get length(){return this.store[0].length}at(e){return this.store[0].at(e)}forEach(e){this.store[0].forEach(e)}filter(e){return this.store[0].filter(e)}filterInPlace(e){this.store[1](this.filter(e))}map(e){return this.store[0].map(e)}flatMap(e){return this.store[0].flatMap(e)}find(e){return this.store[0].find(e)}findIndex(e){return this.store[0].findIndex(e)}splice(e,o,...n){this.store[1](this.store[0].splice(e,o,...n))}reduce(e,o){return this.store[0].reduce(e,o)}some(e){return this.store[0].some(e)}every(e){return this.store[0].every(e)}get(e){return this.store[0][e]}set(e,o){this.store[1](e,o)}push(e){this.store[1](this.store[0].length,e)}}class z{constructor(e=-1){p(this,"changes"),p(this,"currentChangeIndex",-1),p(this,"maxChanges"),this.maxChanges=e,this.changes=[]}serialize(){return{changes:this.changes,currentChangeIndex:this.currentChangeIndex,maxChanges:this.maxChanges}}deserialize(e){this.changes=e.changes,this.currentChangeIndex=e.currentChangeIndex,this.maxChanges=e.maxChanges}addChange(e){this.changes=this.changes.slice(0,this.currentChangeIndex+1),this.changes.length===this.maxChanges&&this.changes.shift(),this.changes.push(e),this.currentChangeIndex=this.changes.length-1}undo(){if(this.currentChangeIndex===-1)return!1;const e=this.changes[this.currentChangeIndex].historyGroup;for(;this.currentChangeIndex>-1&&this.changes[this.currentChangeIndex].historyGroup===e;)this.changes[this.currentChangeIndex].undoChange(),this.currentChangeIndex--;return!0}redo(){if(this.currentChangeIndex===this.changes.length-1)return!1;const e=this.changes[this.currentChangeIndex+1].historyGroup;for(;this.currentChangeIndex<this.changes.length-1&&this.changes[this.currentChangeIndex+1].historyGroup===e;)this.currentChangeIndex++,this.changes[this.currentChangeIndex].applyChange();return!0}static evaluateHistoryGroup(e=!0){return typeof e=="boolean"?e?crypto.randomUUID():!1:e}}class qt{constructor(e){p(this,"nodeflowData"),p(this,"getHorizontalCurve",(o,n)=>h.of((n.x-o.x)/1.5,0)),p(this,"getVerticalCurve",(o,n)=>h.of(0,(n.y-o.y)/1.5)),p(this,"createDefaultCurvePath",(o,n,s,r)=>`M ${o.x} ${o.y} C ${s.x} ${s.y}, ${r.x} ${r.y}, ${n.x} ${n.y}`),this.nodeflowData=e}calculateCurveAnchors(e,o,n,s){const r=e.distanceTo(o)/300,i=n.add(e.subtract(n).multiplyBy(r)),c=s.add(o.subtract(s).multiplyBy(r));return{anchorStart:i,anchorEnd:c}}}class Vo{constructor(e){p(this,"store"),this.store=T(e)}get css(){return this.store[0].css}get destinationConnector(){return this.store[0].destinationConnector}get path(){return this.store[0].path}set css(e){this.store[1]({css:e})}set path(e){this.store[1]({path:e})}set destinationConnector(e){this.store[1]({destinationConnector:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}}const ve=(...t)=>{const e=t[0];return t.slice(1).reduce((o,n)=>new Set([...o].filter(s=>n.has(s))),e)},se=t=>t.size===0,G=t=>typeof t!="object"||t===null||t===void 0?t:Array.isArray(t)?t.map(G):typeof t=="object"?Object.fromEntries(Object.entries(t).map(([e,o])=>[e,G(o)])):t;class ht{constructor(e){p(this,"store"),this.store=T(e)}serialize(){return{css:this.css,hovered:this.hovered,id:this.id,position:this.position.serialize()}}serializeConnections(){return[...this.destinations.map(({destinationConnector:e,css:o})=>({sourceNodeId:this.parentNode.id,sourceConnectorId:this.id,destinationNodeId:e.parentNode.id,destinationConnectorId:e.id,css:G(o)})),...this.sources.map(({sourceConnector:e})=>{var o;return{sourceNodeId:e.parentNode.id,sourceConnectorId:e.id,destinationNodeId:this.parentNode.id,destinationConnectorId:this.id,css:G((o=e.destinations.find(n=>n.destinationConnector.parentNode.id===this.parentNode.id))==null?void 0:o.css)}})]}static deserialize(e,o){const n=!e.id||o.connectors.has(e.id)?o.parentNode.getNextFreeConnectorId():e.id;return new ht({css:e.css,destinations:new $,hovered:e.hovered??!1,id:n,parentSection:o,position:h.deserializeOrDefault(e.position),ref:void 0,resizeObserver:void 0,size:h.zero(),sources:new $})}get css(){return this.store[0].css}values(){return this.store[0]}get destinations(){return this.store[0].destinations}get hovered(){return this.store[0].hovered}get id(){return this.store[0].id}get parentSection(){return this.store[0].parentSection}get parentNode(){return this.store[0].parentSection.parentNode}get position(){return this.store[0].position}get ref(){return this.store[0].ref}get resizeObserver(){return this.store[0].resizeObserver}get size(){return this.store[0].size}get sources(){return this.store[0].sources}set css(e){this.store[1]({css:e})}set destinations(e){this.store[1]({destinations:e})}set hovered(e){this.store[1]({hovered:e})}set id(e){this.store[1]({id:e})}set parentSection(e){this.store[1]({parentSection:e})}set position(e){this.store[1]({position:e})}set ref(e){this.store[1]({ref:e})}set resizeObserver(e){this.store[1]({resizeObserver:e})}set size(e){this.store[1]({size:e})}set sources(e){this.store[1]({sources:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}removeIncomingConnections(){this.sources.forEach(({sourceConnector:e})=>{e.destinations.filterInPlace(({destinationConnector:o})=>o.parentNode.id!==this.id)}),this.sources=new $}removeOutgoingConnections(){this.destinations.forEach(({destinationConnector:e})=>{e.sources.filterInPlace(({sourceConnector:o})=>o.parentNode.id!==this.id)}),this.destinations=new $}getCenter(){const{position:e,offset:o}=this.parentNode;return e.add(o,this.position,this.size.divideBy(2))}}const Xt=class ke{constructor(){p(this,"nodeflows"),p(this,"globalEventStore"),this.nodeflows=new Map,this.globalEventStore={onMouseMoveInDocument:new Ye,onPointerLeaveFromDocument:new Ye,onPointerUpInDocument:new Ye},this.setupDefaultEventHandlers()}static get(){return this.instance||(ke.instance=new ke),ke.instance}createCanvas(...e){const o=new tn(...e);return this.nodeflows.set(e[0],o),[o,Go(o)]}getNodeflow(e){return this.nodeflows.get(e)}removeNodeflow(e){this.nodeflows.delete(e)}clear(){this.nodeflows.clear()}hasNodeflow(e){return this.nodeflows.has(e)}setupDefaultEventHandlers(){document.onmousemove=e=>this.globalEventStore.onMouseMoveInDocument.publish({event:e}),document.onpointerleave=e=>this.globalEventStore.onPointerLeaveFromDocument.publish({event:e}),document.onpointerup=e=>this.globalEventStore.onPointerUpInDocument.publish({event:e}),this.globalEventStore.onMouseMoveInDocument.subscribeMultiple([{name:"update-mouse-position",event:({event:e})=>{this.nodeflows.forEach(o=>{o.mouseData.mousePosition=h.fromEvent(e)})}}]),this.globalEventStore.onPointerLeaveFromDocument.subscribeMultiple([{name:"reset-mouse-data",event:()=>{this.nodeflows.forEach(e=>{e.mouseData.reset()})}}]),this.globalEventStore.onPointerUpInDocument.subscribeMultiple([])}};p(Xt,"instance");let C=Xt;var Zo={equals:!1},qo=Zo,H,It,Pt=(It=class{constructor(t=Map){tt(this,H,void 0),bo(this,H,new t)}dirty(t){var e;(e=v(this,H).get(t))==null||e.$$()}dirtyAll(){for(const t of v(this,H).values())t.$$()}track(t){if(!Be())return;let e=v(this,H).get(t);if(e)e.n++;else{const[o,n]=Ie(void 0,qo);v(this,H).set(t,e={$:o,$$:n,n:1})}at(()=>{e.n--===1&&queueMicrotask(()=>e.n===0&&v(this,H).delete(t))}),e.$()}},H=new WeakMap,It),R=Symbol("track-keys"),x,F,xt,he=(xt=class extends Map{constructor(t){if(super(),tt(this,x,new Pt),tt(this,F,new Pt),t)for(const e of t)super.set(e[0],e[1])}has(t){return v(this,x).track(t),super.has(t)}get(t){return v(this,F).track(t),super.get(t)}get size(){return v(this,x).track(R),super.size}*keys(){for(const t of super.keys())v(this,x).track(t),yield t;v(this,x).track(R)}*values(){for(const[t,e]of super.entries())v(this,F).track(t),yield e;v(this,x).track(R)}*entries(){for(const t of super.entries())v(this,F).track(t[0]),yield t;v(this,x).track(R)}set(t,e){return ze(()=>{if(super.has(t)){if(super.get(t)===e)return}else v(this,x).dirty(t),v(this,x).dirty(R);v(this,F).dirty(t),super.set(t,e)}),this}delete(t){const e=super.delete(t);return e&&ze(()=>{v(this,x).dirty(t),v(this,x).dirty(R),v(this,F).dirty(t)}),e}clear(){super.size&&ze(()=>{for(const t of super.keys())v(this,x).dirty(t),v(this,F).dirty(t);super.clear(),v(this,x).dirty(R)})}forEach(t){v(this,x).track(R);for(const[e,o]of super.entries())v(this,F).track(e),t(o,e,this)}[Symbol.iterator](){return this.entries()}},x=new WeakMap,F=new WeakMap,xt);class ft{constructor(e,o){p(this,"store"),p(this,"nodeflowData"),this.nodeflowData=e,this.store=T(o)}serialize(){return{connectors:Object.fromEntries(Array.from(this.connectors.entries()).map(([e,o])=>[e,o.serialize()])),css:this.css,id:this.id}}static deserialize(e,o,n=!0){const s=z.evaluateHistoryGroup(n),r=!e.id||o.connectorSections.has(e.id)?o.getNextFreeConnectorSectionId():e.id,i=new ft(o.nodeflow,{connectors:new he,css:e.css,id:r,parentNode:o});for(const[c,a]of Object.entries(e.connectors??{}))i.addConnector({...a,id:c},s);return i}addConnector(e,o=!0){const n=ht.deserialize(e,this);if(this.connectors.has(n.id))return this.connectors.get(n.id);const s=z.evaluateHistoryGroup(o);if(s){const r=n.serialize(),i=this.id,c=r.id,a=this.parentNode.id,l=this.nodeflowData.id;this.nodeflowData.changes.addChange({type:"add",source:"connector",applyChange:()=>{var u,d;(d=(u=C.get().getNodeflow(l))==null?void 0:u.nodes.get(a))==null||d.addConnector(i,r,!1)},undoChange:()=>{var u,d;(d=(u=C.get().getNodeflow(l))==null?void 0:u.nodes.get(a))==null||d.removeConnector(i,c,!1)},historyGroup:s})}return this.connectors.set(n.id,n),n}removeConnector(e,o=!0){if(!this.connectors.has(e))return;const n=this.connectors.get(e),s=z.evaluateHistoryGroup(o);if(s){const r=n.serialize(),i=this.id,c=r.id,a=this.parentNode.id,l=this.nodeflowData.id;this.nodeflowData.changes.addChange({type:"remove",source:"connector",applyChange:()=>{var u,d;(d=(u=C.get().getNodeflow(l))==null?void 0:u.nodes.get(a))==null||d.removeConnector(i,c,!1)},undoChange:()=>{var u,d;(d=(u=C.get().getNodeflow(l))==null?void 0:u.nodes.get(a))==null||d.addConnector(i,r,!1)},historyGroup:s})}this.connectors.delete(e)}get connectors(){return this.store[0].connectors}get css(){return this.store[0].css}get id(){return this.store[0].id}get parentNode(){return this.store[0].parentNode}set connectors(e){this.store[1]({connectors:e})}set css(e){this.store[1]({css:e})}set id(e){this.store[1]({id:e})}set parentNode(e){this.store[1]({parentNode:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}removeIncomingConnections(){this.connectors.forEach(e=>e.removeIncomingConnections())}removeOutgoingConnections(){this.connectors.forEach(e=>e.removeOutgoingConnections())}getSourceConnectors(){return Array.from(this.connectors.values()).flatMap(e=>e.sources.flatMap(o=>o.sourceConnector))}getDestinationConnectors(){return Array.from(this.connectors.values()).flatMap(e=>e.destinations.flatMap(o=>o.destinationConnector))}}class Xo{constructor(e){p(this,"store"),this.store=T(e)}get sourceConnector(){return this.store[0].sourceConnector}set sourceConnector(e){this.store[1]({sourceConnector:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}}class Yt{constructor(){p(this,"subscriptions",new he),p(this,"blacklistFilters",new he)}blacklist(e,o){this.blacklistFilters.set(e,o)}unblacklist(e){this.blacklistFilters.delete(e)}unblacklistMultiple(e){e.forEach(this.unblacklist)}clearBlacklist(){this.blacklistFilters.clear()}subscribe(e,o,n=0){this.subscriptions.set(e,{name:e,event:o,priority:n})}subscribeMultiple(e){e.forEach(({name:o,event:n,priority:s})=>this.subscribe(o,n,s))}unsubscribe(e){this.subscriptions.delete(e)}unsubsribeMultiple(e){e.forEach(this.unsubscribe)}publish(e){Array.from(this.subscriptions.values()).sort((o,n)=>n.priority-o.priority).filter(({name:o,priority:n})=>!Array.from(this.blacklistFilters.values()).some(s=>s(e,o,n))).map(({event:o})=>o).forEach(o=>o(e))}clear(){this.subscriptions.clear()}get size(){return this.subscriptions.size}get isEmpty(){return this.size===0}}class D extends Yt{constructor(e){super(),p(this,"nodeflowData"),this.nodeflowData=e}}class Ye extends Yt{}class Yo{constructor(e){p(this,"store"),p(this,"nodeflowData"),this.nodeflowData=e,this.store=T({heldKeys:new Set})}get heldKeys(){return this.store[0].heldKeys}set heldKeys(e){this.store[1]({heldKeys:e})}releaseKey(e){this.store[1](rt(o=>o.heldKeys.delete(e)))}clearKeys(){this.store[1]({heldKeys:new Set})}pressKey(e){this.store[1](rt(o=>o.heldKeys.add(e)))}isActionPressed(e){return!se(ve(this.heldKeys,e))}}class Qo{constructor(e){p(this,"store"),p(this,"nodeflowData"),p(this,"selectNode",(o,n,s=!0)=>{if(!this.nodeflowData.nodes.has(o))return;const r=this.nodeflowData.nodes.get(o);this.hasSelectedNode(o)&&this.selections.filterInPlace(i=>i.type!=="node"||i.node.id!==o),this.selections.push({node:r,type:"node"}),this.update({pointerDown:s,mousePosition:n,clickStartPosition:n.divideBy(this.nodeflowData.zoomLevel).subtract(this.nodeflowData.nodes.get(o).position)})}),p(this,"clearSelections",()=>{this.store[1]("selections",new $),this.nodeflowData.resetMovement()}),p(this,"startCreatingConnection",(o,n,s)=>{if(!this.nodeflowData.settings.canCreateConnections)return;const r=this.nodeflowData.nodes.get(o);if(!r)return;const i=r.getConnector(s);i&&this.update({pointerDown:!0,selections:new $([{connector:i,type:"connector"}]),mousePosition:n,clickStartPosition:n.divideBy(this.nodeflowData.zoomLevel).subtract(r.position)})}),p(this,"globalMousePosition",()=>this.mousePosition.subtract(this.nodeflowData.startPosition).divideBy(this.nodeflowData.zoomLevel).subtract(this.nodeflowData.position)),this.nodeflowData=e,this.store=T({clickStartPosition:void 0,mousePosition:h.zero(),pointerDown:!1,selections:new $})}serialize(){var e;const o=this.store[0].selections.map(n=>{switch(n.type){case"connector":return{connectorId:n.connector.id,nodeId:n.connector.parentNode.id,type:"connector"};case"node":return{nodeId:n.node.id,type:"node"};case"connection":return{connection:{destinationConnectorId:n.connection.destinationConnector.id,destinationNodeId:n.connection.destinationConnector.parentSection.parentNode.id,sourceConnectorId:n.connection.sourceConnector.id,sourceNodeId:n.connection.sourceConnector.parentNode.id},type:"connection"};default:return{type:"nodeflow"}}});return{clickStartPosition:(e=this.clickStartPosition)==null?void 0:e.serialize(),selections:o}}deserialize(e){const o=e.selections.map(n=>{if(n.type==="connector"){const s=this.nodeflowData.nodes.get(n.nodeId);if(!s)return;const r=s.getConnector(n.connectorId);return r?{connector:r,type:"connector"}:void 0}else if(n.type==="node"){const s=this.nodeflowData.nodes.get(n.nodeId);return s?{node:s,type:"node"}:void 0}else if(n.type==="connection"){const s=this.nodeflowData.nodes.get(n.connection.sourceNodeId);if(!s)return;const r=s.getConnector(n.connection.sourceConnectorId);if(!r)return;const i=this.nodeflowData.nodes.get(n.connection.destinationNodeId);if(!i)return;const c=i.getConnector(n.connection.destinationConnectorId);return c?{connection:{destinationConnector:c,sourceConnector:r},type:"connection"}:void 0}else return{type:"nodeflow"}}).filter(Boolean);this.update({clickStartPosition:h.deserializeOrDefault(e.clickStartPosition),selections:new $(o)})}get clickStartPosition(){return this.store[0].clickStartPosition}get isDraggingObject(){return this.store[0].pointerDown}get selections(){return this.store[0].selections}get heldConnections(){return this.store[0].selections.filter(e=>e.type==="connection")}get heldConnectors(){return this.store[0].selections.filter(e=>e.type==="connector")}get heldNodes(){return this.store[0].selections.filter(e=>e.type==="node")}filterSelections(e){this.selections.filterInPlace(e)}get mousePosition(){return this.store[0].mousePosition}get pointerDown(){return this.store[0].pointerDown}set clickStartPosition(e){this.store[1]({clickStartPosition:e})}set mousePosition(e){this.store[1]({mousePosition:e})}set pointerDown(e){this.store[1]({pointerDown:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}reset(e=!1){this.update({clickStartPosition:void 0,pointerDown:e,selections:new $})}selectNodeflow(){this.hasSelectedNodeflow()&&this.selections.filterInPlace(e=>e.type!=="nodeflow"),this.selections.push({type:"nodeflow"})}clearSelectedByType(e){this.store[0].selections.filterInPlace(o=>o.type!==e)}hasSelectedNodeflow(){return this.store[0].selections.some(e=>e.type==="nodeflow")}hasSelectedNode(e){return this.store[0].selections.some(o=>o.type==="node"&&o.node.id===e)}hasSelectedConnector(e){return this.store[0].selections.some(o=>o.type==="connector"&&o.connector.id===e)}hasSelectedConnection(e,o,n,s){return this.store[0].selections.some(r=>r.type==="connection"&&r.connection.sourceConnector.id===o&&r.connection.sourceConnector.parentNode.id===e&&r.connection.destinationConnector.id===s&&r.connection.destinationConnector.parentNode.id===n)}}class Jo{constructor(e,o=2048){p(this,"store"),p(this,"nodeflowData"),this.nodeflowData=e,this.store=T({chunkSize:o,chunks:new he})}get chunkSize(){return this.store[0].chunkSize}set chunkSize(e){this.store[1]({chunkSize:e})}get chunks(){return this.store[0].chunks}set chunks(e){this.store[1]({chunks:e})}addNodeToChunk(e,o){const n=this.calculateChunkPosition(o),s=this.chunks.get(n)||new Set;s.add(e),this.chunks.set(n,s)}removeNodeFromChunk(e,o){const n=this.calculateChunkPosition(o),s=this.chunks.get(n);s&&(s.delete(e),this.chunks.set(n,s))}updateNodeInChunk(e,o,n){const s=this.calculateChunkPosition(o),r=this.calculateChunkPosition(n);s!=r&&we(()=>{const i=this.chunks.get(s),c=this.chunks.get(r)||new Set;i&&(i.delete(e),this.chunks.set(s,i),se(i)&&this.chunks.delete(s)),c&&(c.add(e),this.chunks.set(r,c))})}getChunk(e){return this.chunks.get(this.calculateChunkPosition(e))||new Set}calculateChunkPosition(e){return h.of(Math.floor(e.x/this.chunkSize),Math.floor(e.y/this.chunkSize)).hashCode()}checkForCollisions(e){if(!this.nodeflowData.settings.allowCollision)return[];const o=this.nodeflowData.nodes.get(e),n=[];if(!o)return n;for(let s=-1;s<2;++s)for(let r=-1;r<2;++r){const i=this.getChunk(o.rectWithOffset.position.add(h.of(s*this.chunkSize,r*this.chunkSize)));i.size>0&&n.push(...i)}return n.filter(s=>{const r=this.nodeflowData.nodes.get(s);return r?.id==o.id?!1:r&&r.id!=o.id&&r.rectWithOffset.intersects(o.rectWithOffset)})}}const[Ue,en]=Ie(h.of(window.innerWidth,window.innerHeight));we(()=>{const t=()=>en(h.of(window.innerWidth,window.innerHeight));return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)});const Qe=(t,e,o)=>Math.min(Math.max(t,e),o);class ce{constructor(e,o,n,s){p(this,"position"),p(this,"size"),this.position=h.of(e,o),this.size=h.of(n,s)}static of(e,o){return new ce(e.x,e.y,o.x,o.y)}static fromRect(e){return new ce(e.position.x,e.position.y,e.size.x,e.size.y)}copy(){return ce.fromRect(this)}get center(){return this.position.add(this.size.divideBy(2))}intersects(e){return this.position.x<e.position.x+e.size.x&&this.position.x+this.size.x>e.position.x&&this.position.y<e.position.y+e.size.y&&this.position.y+this.size.y>e.position.y}}class pt{constructor(e,o){p(this,"store"),p(this,"nodeflowData"),this.nodeflowData=e,this.store=T(o),this.nodeflowData.chunking.addNodeToChunk(this.id,this.getCenter()),we(()=>{const n=this.getCollidingNodes();n.length>0&&we(()=>{n.forEach(s=>{const r=this.nodeflowData.nodes.get(s);if(r){const i=r.rectWithOffset,c=this.rectWithOffset;if(i.intersects(c)){const a=i.center.subtract(c.center).magnitude,l=i.center.subtract(c.center).normalize();this.position=this.position.subtract(l.multiplyBy(a))}}})})})}get nodeflow(){return this.nodeflowData}get centered(){return this.store[0].centered}get connectorSections(){return this.store[0].connectorSections}get css(){return this.store[0].css}get customData(){return this.store[0].customData}get display(){return this.store[0].display}get id(){return this.store[0].id}get offset(){return this.store[0].offset}get position(){return this.store[0].position}get ref(){return this.store[0].ref}get resizeObserver(){return this.store[0].resizeObserver}get size(){return this.store[0].size}set centered(e){this.store[1]({centered:e})}set connectorSections(e){this.store[1]({connectorSections:e})}set css(e){this.store[1]({css:e})}set customData(e){this.store[1]({customData:e})}set display(e){this.store[1]({display:e})}set id(e){this.store[1]({id:e})}set offset(e){this.store[1]({offset:e})}set position(e){this.store[1]({position:e})}set ref(e){this.store[1]({ref:e})}set resizeObserver(e){this.store[1]({resizeObserver:e})}set size(e){this.store[1]({size:e})}get sizeWithOffset(){return this.size.add(this.offset)}update(e){this.store[1](e)}serialize(){const e=Array.from(this.connectorSections.values()).reduce((o,n)=>(o[n.id]=n.serialize(),o),{});return{centered:this.centered,connectorSections:e,css:G(this.css),customData:G(this.customData),id:this.id,display:this.display,position:this.position.serialize()}}static deserialize(e,o,n=!0){const s=o.id??e.getNextFreeNodeId(),r=new pt(e,{centered:o.centered??!1,connectorSections:new he,css:G(o.css)??{},customData:G(o.customData)??{},display:o.display??(()=>{}),id:s,offset:h.zero(),position:h.deserializeOrDefault(o.position),ref:void 0,resizeObserver:void 0,size:h.zero()}),i=z.evaluateHistoryGroup(n);return Object.entries(o.connectorSections??[]).forEach(([c,a])=>{r.addConnectorSection({css:a.css,id:c,connectors:a.connectors},i)}),r}serializeConnections(){return Array.from(this.connectorSections.values()).flatMap(e=>Array.from(e.connectors.values()).flatMap(o=>o.serializeConnections()))}updateWithPrevious(e){this.store[1](e)}addConnectorSection(e,o=!0){const n=z.evaluateHistoryGroup(o),s=ft.deserialize(e,this,n);if(this.connectorSections.has(s.id))return this.connectorSections.get(s.id);if(n){const r=s.serialize(),i=this.nodeflowData.id,c=this.id,a=r.id;this.nodeflowData.changes.addChange({type:"remove",source:"connector-section",applyChange:()=>{var l,u;(u=(l=C.get().getNodeflow(i))==null?void 0:l.nodes.get(c))==null||u.addConnectorSection(r,!1)},undoChange:()=>{var l,u;(u=(l=C.get().getNodeflow(i))==null?void 0:l.nodes.get(c))==null||u.removeConnectorSection(a,!1)},historyGroup:n})}return this.connectorSections.set(s.id,s),s}removeConnectorSection(e,o=!0){if(!this.connectorSections.has(e))return;const n=this.connectorSections.get(e),s=z.evaluateHistoryGroup(o);if(s){const r=n.serialize(),i=this.nodeflowData.id,c=this.id;this.nodeflowData.changes.addChange({type:"remove",source:"connector-section",applyChange:()=>{var a,l;(l=(a=C.get().getNodeflow(i))==null?void 0:a.nodes.get(c))==null||l.removeConnectorSection(e,!1)},undoChange:()=>{var a,l;(l=(a=C.get().getNodeflow(i))==null?void 0:a.nodes.get(c))==null||l.addConnectorSection(r,!1)},historyGroup:s})}this.connectorSections.delete(e)}getConnectorCount(){return Array.from(this.connectorSections.values()).reduce((e,o)=>e+o.connectors.size,0)}addConnector(e,o,n=!0){if(this.connectorSections.has(e))return this.connectorSections.get(e).addConnector(o,n)}removeConnector(e,o,n=!0){this.connectorSections.has(e)&&this.connectorSections.get(e).removeConnector(o,n)}getConnector(e){var o;return(o=this.getSectionFromConnector(e))==null?void 0:o.connectors.get(e)}getTotalConnectedInputs(e){var o;return((o=this.getConnector(e))==null?void 0:o.sources.length)??0}getAllConnectors(){return Array.from(this.connectorSections.values()).reduce((e,o)=>e.concat(Array.from(o.connectors.values())),[])}getNextFreeConnectorSectionId(){let e="0";for(let o=1;this.connectorSections.has(e);++o)e=o.toString();return e}getNextFreeConnectorId(){let e="0";for(let o=1;Array.from(this.connectorSections.values()).some(n=>n.connectors.has(e));++o)e=o.toString();return e}removeIncomingConnections(){this.connectorSections.forEach(e=>e.removeIncomingConnections())}removeOutgoingConnections(){this.connectorSections.forEach(e=>e.removeOutgoingConnections())}getAllSourceConnectors(){return Array.from(this.connectorSections.values()).reduce((e,o)=>e.concat(o.getSourceConnectors()),[])}getAllDestinationConnectors(){return Array.from(this.connectorSections.values()).reduce((e,o)=>e.concat(o.getDestinationConnectors()),[])}getAllSourceConnections(){return this.getAllSourceConnectors().map(e=>e.destinations.filter(o=>o.destinationConnector.parentNode.id===this.id).map(o=>({sourceNodeId:e.parentNode.id,sourceConnectorId:e.id,destinationNodeId:o.destinationConnector.parentNode.id,destinationConnectorId:o.destinationConnector.id,css:o.css}))).flat()}getAllDestinationConnections(){return this.getAllDestinationConnectors().map(e=>e.sources.filter(o=>o.sourceConnector.parentNode.id===this.id).map(o=>({sourceNodeId:o.sourceConnector.parentNode.id,sourceConnectorId:o.sourceConnector.id,destinationNodeId:e.parentNode.id,destinationConnectorId:e.id}))).flat()}getAllSourceNodes(){return this.getAllSourceConnectors().map(e=>e.parentNode)}getAllDestinationNodes(){return this.getAllDestinationConnectors().map(e=>e.parentNode)}getSectionFromConnector(e){return Array.from(this.connectorSections.values()).find(o=>o.connectors.get(e))}getCenter(){return this.position.add(this.offset,this.size.divideBy(2))}select(e){this.nodeflowData.selectNode(this.id,e)}get rect(){return ce.of(this.position,this.size)}get rectWithOffset(){return ce.of(this.position.subtract(this.offset),this.size.add(this.offset.multiplyBy(2)))}getCollidingNodes(){return this.nodeflowData.chunking.checkForCollisions(this.id)}isColliding(){return this.getCollidingNodes().length>0}}const pe={LEFT:0,MIDDLE:1,RIGHT:2,BACK:3,FORWARD:4},Qt=class Jt{constructor(e,o={},n){p(this,"store"),p(this,"changes"),p(this,"mouseData"),p(this,"keyboardData"),p(this,"curveFunctions"),p(this,"settingsStore"),p(this,"nodes"),p(this,"eventStore"),p(this,"chunking"),p(this,"id"),p(this,"keymap",{MOVE_DOWN:new Set(["ArrowDown","KeyS"]),MOVE_LEFT:new Set(["ArrowLeft","KeyA"]),MOVE_RIGHT:new Set(["ArrowRight","KeyD"]),MOVE_UP:new Set(["ArrowUp","KeyW"]),SELECT_MULTIPLE:new Set(["ShiftLeft","ShiftRight"])}),p(this,"resetMovement",()=>{this.currentMoveSpeed=h.zero(),this.keymap.MOVE_LEFT.forEach(s=>this.keyboardData.releaseKey(s)),this.keymap.MOVE_RIGHT.forEach(s=>this.keyboardData.releaseKey(s)),this.keymap.MOVE_UP.forEach(s=>this.keyboardData.releaseKey(s)),this.keymap.MOVE_DOWN.forEach(s=>this.keyboardData.releaseKey(s))}),p(this,"updateZoom",(s,r)=>{const i=this.zoomLevel;if(s===0)return;const c=Number(Qe(s>0?i+i*s*this.settings.zoomMultiplier:i/(1-s*this.settings.zoomMultiplier),this.settings.minZoom,this.settings.maxZoom).toFixed(4));this.mouseData.pointerDown=!1;const a=this.size,l=r.subtract(this.startPosition),u=a.multiplyBy(i),d=a.multiplyBy(c),f=l.subtract(u.divideBy(2)).divideBy(i),g=l.subtract(d.divideBy(2)).divideBy(c);this.updateWithPrevious(y=>({position:y.position.subtract(f).add(g),zoomLevel:c}))}),this.id=e,this.settingsStore=T({...Jt.DEFAULT_SETTINGS,...o}),this.curveFunctions=n?.(this)??new qt(this),this.store=T({currentMoveSpeed:h.zero(),position:h.zero(),startPosition:h.zero(),size:h.zero(),zoomLevel:1,pinchDistance:0}),this.changes=new z,this.mouseData=new Qo(this),this.keyboardData=new Yo(this),this.nodes=new he,this.chunking=new Jo(this),this.eventStore={onKeyDownInNodeflow:new D(this),onKeyUpInNodeflow:new D(this),onMouseDownInConnector:new D(this),onMouseDownInNodeflow:new D(this),onMouseDownInNode:new D(this),onMouseMoveInNodeflow:new D(this),onNodeConnected:new D(this),onNodeDataChanged:new D(this),onPointerDownInNodeCurve:new D(this),onPointerUpInConnector:new D(this),onPointerUpInNodeflow:new D(this),onPointerUpInNode:new D(this),onTouchMoveInNodeflow:new D(this),onTouchStartInConnector:new D(this),onTouchStartInNodeflow:new D(this),onTouchStartInNode:new D(this),onWheelInNodeflow:new D(this)},this.setupDefaultEventHandlers(),setInterval(()=>{const s=!se(ve(this.keyboardData.heldKeys,this.keymap.MOVE_LEFT)),r=!se(ve(this.keyboardData.heldKeys,this.keymap.MOVE_RIGHT)),i=!se(ve(this.keyboardData.heldKeys,this.keymap.MOVE_UP)),c=!se(ve(this.keyboardData.heldKeys,this.keymap.MOVE_DOWN)),a=this.mouseData.heldNodes.length>0;this.currentMoveSpeed=h.of(this.calculateDirectionalMovementAmount(s||r,this.currentMoveSpeed.x,r,s,!a),this.calculateDirectionalMovementAmount(i||c,this.currentMoveSpeed.y,c,i,!a)),!(this.currentMoveSpeed.x===0&&this.currentMoveSpeed.y===0)&&(this.settings.canPan&&!a?this.updateBackgroundPosition(this.currentMoveSpeed,!0):a&&this.settings.canMoveNodes&&this.updateHeldNodePosition(this.currentMoveSpeed.divideBy(this.zoomLevel)))},10)}serialize(){return{changes:this.changes.serialize(),connections:this.serializeConnections(),currentMoveSpeed:this.currentMoveSpeed.serialize(),mouseData:this.mouseData.serialize(),nodes:Object.fromEntries(Array.from(this.nodes.entries()).map(([e,o])=>[e,o.serialize()])),pinchDistance:this.pinchDistance,position:this.position.serialize(),size:this.size.serialize(),startPosition:this.startPosition.serialize(),zoomLevel:this.zoomLevel}}deserialize(e,o=!1){this.update({currentMoveSpeed:h.deserializeOrDefault(e.currentMoveSpeed),pinchDistance:e.pinchDistance,position:h.deserializeOrDefault(e.position),size:h.deserializeOrDefault(e.size),startPosition:h.deserializeOrDefault(e.startPosition),zoomLevel:e.zoomLevel});const n=z.evaluateHistoryGroup(o);this.nodes.clear(),Object.values(e.nodes).forEach(s=>{this.addNode(s,n)}),this.mouseData.deserialize(e.mouseData),e.connections.forEach(s=>{this.addConnection(s,n)}),this.changes.deserialize(e.changes)}serializeConnections(){return Array.from(this.nodes.values()).flatMap(e=>e.serializeConnections())}get settings(){return this.settingsStore[0]}updateSettings(e){this.settingsStore[1](e)}get currentMoveSpeed(){return this.store[0].currentMoveSpeed}get position(){return this.store[0].position}get startPosition(){return this.store[0].startPosition}get size(){return this.store[0].size}get zoomLevel(){return this.store[0].zoomLevel}get pinchDistance(){return this.store[0].pinchDistance}set currentMoveSpeed(e){this.store[1]({currentMoveSpeed:e})}set position(e){this.store[1]({position:e})}set startPosition(e){this.store[1]({startPosition:e})}set size(e){this.store[1]({size:e})}set zoomLevel(e){this.store[1]({zoomLevel:e})}set pinchDistance(e){this.store[1]({pinchDistance:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}center(){const e=Ue().divideBy(2);return this.startPosition.add(e).divideBy(this.zoomLevel).subtract(this.position)}calculateDirectionalMovementAmount(e,o,n,s,r=!1){let i=o;if(e){const c=this.settings.movementAcceleration*(r?-1:1);i=Qe(i+(n?c:0)-(s?c:0),-this.settings.maxMovementSpeed,this.settings.maxMovementSpeed)}else i=Qe(i*this.settings.movementDeceleration,-this.settings.maxMovementSpeed,this.settings.maxMovementSpeed);return i<=.1&&i>=-.1&&(i=0),i}updateBackgroundPosition(e,o=!1){!this.mouseData.hasSelectedNodeflow()||o===this.mouseData.isDraggingObject||this.updateWithPrevious(n=>({position:n.position.add(e.divideBy(this.zoomLevel))}))}addNode(e,o=!0){const n=z.evaluateHistoryGroup(o),s=pt.deserialize(this,e,n);if(this.nodes.set(s.id,s),n){const r=s.serializeConnections(),i=s.serialize(),c=this.id;this.changes.addChange({type:"add",source:"node",applyChange:()=>{const a=C.get().getNodeflow(c);a?.addNode(i,!1),r.forEach(l=>{a?.addConnection(l,!1)})},undoChange:()=>{var a;(a=C.get().getNodeflow(c))==null||a.removeNode(s.id,!1)},historyGroup:n})}return s}updateNode(e,o,n=!0){if(!this.nodes.has(e))return;const s=this.nodes.get(e),r=z.evaluateHistoryGroup(n);if(r){const i=this.nodes.get(e),c=i.serialize(),a=i.serializeConnections(),l=this.id,u=Object.entries(c).reduce((d,[f,g])=>(f in o&&Object.assign(d,{[f]:G(g)}),d),{});this.changes.addChange({type:"update",source:"node",applyChange:()=>{var d;(d=C.get().getNodeflow(l))==null||d.updateNode(e,o,!1)},undoChange:()=>{const d=C.get().getNodeflow(l);d?.updateNode(e,u,!1),a.forEach(f=>{d?.addConnection(f,!1)})},historyGroup:r})}s.updateWithPrevious(rt(i=>Object.assign(i,o))),this.eventStore.onNodeDataChanged.publish({nodeId:e,data:o})}removeNode(e,o=!0){if(!this.nodes.has(e))return;this.mouseData.filterSelections(s=>s.type!=="node"||s.node.id!==e);const n=z.evaluateHistoryGroup(o);if(n){const s=this.nodes.get(e),r=s.serializeConnections(),i=this.id;this.changes.addChange({type:"remove",source:"node",applyChange:()=>{var c;(c=C.get().getNodeflow(i))==null||c.removeNode(e,!1)},undoChange:()=>{const c=C.get().getNodeflow(i);c?.addNode(s.serialize(),!1),r.forEach(a=>{c?.addConnection(a,!1)})},historyGroup:n})}this.removeIncomingConnections(e),this.removeOutgoingConnections(e),this.nodes.delete(e)}removeIncomingConnections(e){this.nodes.has(e)&&this.nodes.get(e).connectorSections.forEach(o=>{o.connectors.forEach(n=>{n.sources.forEach(({sourceConnector:s})=>{s.destinations.filterInPlace(({destinationConnector:r})=>r.parentNode.id!==e)}),n.sources=new $})})}removeOutgoingConnections(e){this.nodes.has(e)&&this.nodes.get(e).connectorSections.forEach(o=>{o.connectors.forEach(n=>{n.destinations.forEach(({destinationConnector:s})=>{s.sources.filterInPlace(({sourceConnector:r})=>r.parentNode.id!==e)}),n.destinations=new $})})}getAllSourceConnectors(e){return this.nodes.has(e)?this.nodes.get(e).getAllSourceConnectors():[]}getAllDestinationConnectors(e){return this.nodes.has(e)?this.nodes.get(e).getAllDestinationConnectors():[]}getAllSourceConnections(e){return this.nodes.has(e)?this.nodes.get(e).getAllSourceConnections():[]}getAllDestinationConnections(e){return this.nodes.has(e)?this.nodes.get(e).getAllDestinationConnections():[]}getNextFreeNodeId(){let e="0";for(let o=1;this.nodes.has(e);++o)e=o.toString();return e}addConnection(e,o=!0){const{sourceNodeId:n,sourceConnectorId:s,destinationNodeId:r,destinationConnectorId:i,css:c}=e;if(!this.nodes.has(n)||!this.nodes.has(r))return;const a=this.nodes.get(n),l=this.nodes.get(r),u=a.getConnector(s),d=l.getConnector(i);if(!u||!d||u.destinations.some(g=>g.destinationConnector===d))return;const f=z.evaluateHistoryGroup(o);if(f){const g=this.id;this.changes.addChange({type:"add",source:"connection",applyChange:()=>this.addConnection(e,!1),undoChange:()=>{var y;return(y=C.get().getNodeflow(g))==null?void 0:y.removeConnection(n,s,r,i,!1)},historyGroup:f})}u.destinations.push(new Vo({destinationConnector:d,css:c??{}})),d.sources.push(new Xo({sourceConnector:u}))}removeConnection(e,o,n,s,r=!0){var i;if(!this.nodes.has(e)||!this.nodes.has(n))return;const c=this.nodes.get(e),a=this.nodes.get(n),l=c.getConnector(o),u=a.getConnector(s);if(!l||!u)return;const d=z.evaluateHistoryGroup(r);if(d){const f=(i=l.destinations.find(O=>O.destinationConnector.parentNode.id===n))==null?void 0:i.css,g=this.id,y=()=>{var O;(O=C.get().getNodeflow(g))==null||O.addConnection({sourceNodeId:e,sourceConnectorId:o,destinationNodeId:n,destinationConnectorId:s,css:f},!1)},P=()=>{var O;(O=C.get().getNodeflow(g))==null||O.removeConnection(e,o,n,s,!1)};this.changes.addChange({type:"remove",source:"connection",applyChange:P,undoChange:y,historyGroup:d})}l.destinations.filterInPlace(f=>f.destinationConnector.parentNode.id!==n),u.sources.filterInPlace(f=>f.sourceConnector.parentNode.id!==e)}updateHeldNodePosition(e){this.mouseData.heldNodes.forEach(o=>o.node.updateWithPrevious(n=>({position:n.position.add(e)})))}setupDefaultEventHandlers(){this.eventStore.onNodeConnected.subscribeMultiple([{name:"nodeflow:create-connection",event:e=>this.addConnection({sourceNodeId:e.inputNodeId,sourceConnectorId:e.inputId,destinationNodeId:e.outputNodeId,destinationConnectorId:e.outputId})},{name:"nodeflow:reset-mouse-data",event:()=>this.mouseData.reset()}]),this.eventStore.onMouseMoveInNodeflow.subscribeMultiple([{name:"nodeflow:update-background-position",event:({event:e})=>{this.updateBackgroundPosition(h.of(e.movementX,e.movementY))}}]),this.eventStore.onPointerUpInNodeflow.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>{e.stopPropagation(),e.preventDefault()}},{name:"nodeflow:reset-mouse-data",event:()=>{this.mouseData.pointerDown=!1,this.mouseData.heldConnectors.length===1&&this.mouseData.clearSelectedByType("node"),this.mouseData.clearSelectedByType("connector")}}]),this.eventStore.onTouchStartInNodeflow.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()},{name:"nodeflow:clear-held-keys",event:({event:e})=>{e.touches.length===1&&this.keyboardData.clearKeys()}},{name:"nodeflow:handle-pinch",event:({event:e})=>{const{touches:o}=e;if(o.length!==2)return;const{pageX:n,pageY:s}=e.touches[0],{pageX:r,pageY:i}=e.touches[1];this.pinchDistance=Math.hypot(n-r,s-i)}},{name:"nodeflow:update-mouse-data",event:({event:e})=>{const{touches:o}=e;if(o.length!==1)return;const n=o[0],s=h.fromEvent(n);this.mouseData.clearSelectedByType("node"),this.mouseData.update({pointerDown:!0,mousePosition:s,clickStartPosition:h.of(s.x/this.zoomLevel-this.position.x,s.y/this.zoomLevel-this.position.y)})}}]),this.eventStore.onTouchMoveInNodeflow.subscribeMultiple([{name:"nodeflow:handle-pinch",event:({event:e})=>{const{touches:o}=e;if(o.length!==2)return;const{pageX:n,pageY:s}=o[0],{pageX:r,pageY:i}=o[1],c=Math.hypot(n-r,s-i),a=h.of((n+r)/2,(s+i)/2);this.settings.canZoom&&this.updateZoom(c-this.pinchDistance,a),this.pinchDistance=c}},{name:"nodeflow:update-mouse-data",event:({event:e})=>{const{touches:o}=e;o.length===1&&this.mouseData.updateWithPrevious(n=>{const s=h.fromEvent(o[0]);return this.updateBackgroundPosition(s.subtract(n.mousePosition)),{mousePosition:s}})}}]),this.eventStore.onKeyUpInNodeflow.subscribe("nodeflow:remove-held-key",({event:e})=>this.keyboardData.releaseKey(e.code)),this.eventStore.onKeyDownInNodeflow.subscribeMultiple([{name:"nodeflow:add-held-key",event:({event:e})=>this.keyboardData.pressKey(e.code),priority:10},{name:"nodeflow:handle-controls",event:({event:e})=>{switch(e.code){case"Delete":if(this.mouseData.heldNodes.length>0&&this.settings.canDeleteNodes){const o=z.evaluateHistoryGroup();this.mouseData.heldNodes.forEach(n=>this.removeNode(n.node.id,o))}else if(this.mouseData.heldConnections.length>0&&this.settings.canDeleteConnections){const o=z.evaluateHistoryGroup();this.mouseData.heldConnections.forEach(n=>this.removeConnection(n.connection.sourceConnector.parentNode.id,n.connection.sourceConnector.id,n.connection.destinationConnector.parentSection.parentNode.id,n.connection.destinationConnector.id,o))}break;case"Escape":this.mouseData.clearSelections();break;case"Space":this.settings.debugMode&&(this.mouseData.selections.length>0?console.log(this.mouseData.selections):console.log(this.nodes));break;case"Equal":case"Minus":if(e.ctrlKey){if(!this.settings.canZoom)return;e.preventDefault(),this.updateZoom(this.settings.keyboardZoomMultiplier*(e.code==="Equal"?1:-1),Ue().divideBy(2))}break;case"KeyZ":if(!e.ctrlKey)break;e.preventDefault(),e.shiftKey?this.changes.redo():this.changes.undo();break}}}]),this.eventStore.onWheelInNodeflow.subscribeMultiple([{name:"nodeflow:update-zoom",event:({event:e})=>{this.settings.canZoom&&this.updateZoom(-e.deltaY,h.fromEvent(e))}},{name:"nodeflow:prevent-scroll",event:({event:e})=>{e.preventDefault()}}]),this.eventStore.onMouseDownInNodeflow.subscribeMultiple([{name:"nodeflow:reset-movement",event:({event:e})=>{e.button===pe.LEFT&&this.resetMovement()}},{name:"nodeflow:reset-mouse-data",event:({event:e})=>{e.button===pe.LEFT&&this.mouseData.clearSelections(),this.mouseData.selectNodeflow(),this.mouseData.update({clickStartPosition:h.of(e.clientX/this.zoomLevel-this.position.x,e.clientY/this.zoomLevel-this.position.y),pointerDown:this.settings.canPan,mousePosition:h.fromEvent(e)})}},{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()}]),this.eventStore.onMouseDownInConnector.blacklist("nodeflow:allow-pan",(e,o)=>e.event.button!==pe.LEFT&&o.startsWith("nodeflow")),this.eventStore.onMouseDownInConnector.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()},{name:"nodeflow:start-creating-connection",event:({event:e,nodeId:o,connectorId:n})=>{this.mouseData.startCreatingConnection(o,h.fromEvent(e),n)}}]),this.eventStore.onTouchStartInConnector.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()},{name:"nodeflow:start-creating-connection",event:({event:e,nodeId:o,connectorId:n})=>{const{clientX:s,clientY:r}=e.touches[0];this.mouseData.startCreatingConnection(o,h.of(s,r),n)}}]),this.eventStore.onPointerUpInConnector.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>{e.preventDefault(),e.stopPropagation()},priority:2},{name:"nodeflow:connect-held-nodes",event:({event:e,nodeId:o,connectorId:n})=>{var s;if(!this.settings.canCreateConnections)return;const r=(s=this.mouseData.heldConnectors.at(-1))==null?void 0:s.connector,i=r?.parentNode;!r||!i||this.eventStore.onNodeConnected.publish({outputNodeId:i.id,outputId:r.id,inputNodeId:o,inputId:n,event:e})},priority:2},{name:"nodeflow:reset-mouse-data",event:()=>{this.mouseData.pointerDown=!1},priority:1}]),this.eventStore.onMouseDownInNode.blacklist("nodeflow:allow-pan",(e,o)=>e.event.button!==pe.LEFT&&o.startsWith("nodeflow")),this.eventStore.onMouseDownInNode.subscribeMultiple([{name:"nodeflow:select-node",event:({event:e,nodeId:o})=>{this.keyboardData.isActionPressed(this.keymap.SELECT_MULTIPLE)||this.mouseData.clearSelections(),this.mouseData.selectNode(o,h.fromEvent(e),this.settings.canMoveNodes)}},{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()}]),this.eventStore.onTouchStartInNode.subscribeMultiple([{name:"nodeflow:select-node",event:({event:e,nodeId:o})=>{const{clientX:n,clientY:s}=e.touches[0];this.keyboardData.isActionPressed(this.keymap.SELECT_MULTIPLE)||this.mouseData.clearSelections(),this.mouseData.selectNode(o,h.of(n,s),this.settings.canMoveNodes)}},{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()}]),this.eventStore.onPointerDownInNodeCurve.blacklist("nodeflow:allow-pan",(e,o)=>e.event.button!==pe.LEFT&&o.startsWith("nodeflow")),this.eventStore.onPointerDownInNodeCurve.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>{e.preventDefault(),e.stopPropagation()},priority:1},{name:"nodeflow:update-mouse-data",event:({event:e,sourceConnector:o,destinationConnector:n})=>{this.mouseData.pointerDown=!0,this.mouseData.mousePosition=h.fromEvent(e),this.keyboardData.isActionPressed(this.keymap.SELECT_MULTIPLE)||this.mouseData.clearSelections(),this.mouseData.selections.push({type:"connection",connection:{sourceConnector:o,destinationConnector:n}})}}]),this.eventStore.onPointerUpInNode.subscribeMultiple([{name:"nodeflow:reset-mouse-data",event:()=>{this.mouseData.pointerDown=!1,this.mouseData.heldConnectors.length===1&&this.mouseData.clearSelectedByType("node"),this.mouseData.clearSelectedByType("connector")}},{name:"nodeflow:stop-propagation",event:({event:e})=>{e.stopPropagation(),e.preventDefault()}}])}selectNode(e,o){this.mouseData.selectNode(e,o??h.zero(),!1)}};p(Qt,"DEFAULT_SETTINGS",{allowCollision:!1,canAddNodes:!0,canCreateConnections:!0,canDeleteConnections:!0,canDeleteNodes:!0,canMoveNodes:!0,canPan:!0,canZoom:!0,debugMode:!1,keyboardZoomMultiplier:15,maxMovementSpeed:15,maxZoom:200,minZoom:.02,movementAcceleration:1.5,movementDeceleration:.85,zoomMultiplier:.005});let tn=Qt;const on="_connection_1glcg_1",nn="_selectedConnection_1glcg_16",sn="_newConnection_1glcg_27",Se={connection:on,selectedConnection:nn,newConnection:sn},rn="_node_1kvvi_1",cn="_selectedNode_1kvvi_15",an="_inputConnector_1kvvi_22",ln="_outputConnector_1kvvi_35",dn="_inputsSection_1kvvi_48",un="_outputsSection_1kvvi_52",V={node:rn,selectedNode:cn,inputConnector:an,outputConnector:ln,inputsSection:dn,outputsSection:un},hn="_nodeflow_1ic3z_1",fn={nodeflow:hn};var pn=ct("<div><p></p><p>");const gn=t=>(()=>{var e=pn(),o=e.firstChild,n=o.nextSibling;return e.style.setProperty("padding","1rem"),e.style.setProperty("padding-left","2rem"),re(o,()=>t.node.position.x.toFixed(2)),re(n,()=>t.node.position.y.toFixed(2)),e})(),eo=(t,e=!1)=>{const o=crypto.randomUUID(),n=E.addNode({css:{normal:V.node,selected:V.selectedNode},position:t,display:gn,centered:e},o),s=n.addConnectorSection({id:"inputs",css:V.inputsSection},o),r=n.addConnectorSection({id:"outputs",css:V.outputsSection},o),i=Math.random()*6;for(let a=0;a<i;a++)r.addConnector({css:V.outputConnector},o);const c=Math.random()*6;for(let a=0;a<c;a++)s.addConnector({css:V.inputConnector},o);return n},vn=()=>{E.eventStore.onNodeConnected.subscribe("create-connection",t=>{t.outputNodeId!==t.inputNodeId&&E.addConnection({sourceNodeId:t.outputNodeId,sourceConnectorId:t.outputId,destinationNodeId:t.inputNodeId,destinationConnectorId:t.inputId,css:{normal:Se.connection,selected:Se.selectedConnection}})})},yn=(t=50)=>{for(let e=0;e<t;e++)eo(h.of(Math.random()*2e3,Math.random()*2e3))},mn=()=>{const t=E.nodes.size;for(let e=0;e<t;e++){const o=Math.floor(Math.random()*t),n=Math.floor(Math.random()*t);if(!E.nodes.has(o.toString())||!E.nodes.has(n.toString()))continue;const s=E.nodes.get(o.toString()),r=E.nodes.get(n.toString()),i=s.connectorSections.get("outputs").connectors,c=r.connectorSections.get("inputs").connectors,a=Array.from(i.values()),l=Array.from(c.values());if(a.length===0||l.length===0)continue;const u=a[Math.floor(Math.random()*a.length)],d=l[Math.floor(Math.random()*l.length)];o===n||r.getTotalConnectedInputs(d.toString())>0||E.addConnection({sourceNodeId:o.toString(),sourceConnectorId:u.id,destinationNodeId:n.toString(),destinationConnectorId:d.id,css:{normal:Se.connection,selected:Se.selectedConnection}})}};class wn extends qt{calculateCurveAnchors(e,o,n,s){const r=this.getHorizontalCurve(e,o),i=e.add(r),c=o.subtract(r);return{anchorStart:i,anchorEnd:c}}}var Cn=ct("<div>"),bn=ct("<div><div><div>Generic node");const[E,Sn]=C.get().createCanvas("main",{},t=>new wn(t)),Dn=()=>{const[t,e]=ro(void 0),o=n=>{if(!t())return;e(void 0);const s=h.fromEvent(n.event),r=E.startPosition,i=E.size;if(!s.isWithinRect(r,i))return;const c=s.subtract(r).divideBy(E.zoomLevel).subtract(E.position);eo(c,!0)};return co(()=>{vn(),yn(),mn(),C.get().globalEventStore.onPointerUpInDocument.subscribe("create-node",o)}),(()=>{var n=bn(),s=n.firstChild,r=s.firstChild;return n.style.setProperty("display","flex"),n.style.setProperty("flex-direction","column-reverse"),re(n,Je(Sn,{get css(){return{newCurve:Se.newConnection,nodeflow:fn.nodeflow}},height:"100%",width:"100%"}),s),s.style.setProperty("width","100%"),s.style.setProperty("min-height","300px"),s.style.setProperty("background-color","gray"),s.style.setProperty("opacity","0.5"),s.style.setProperty("display","flex"),s.style.setProperty("align-items","center"),s.style.setProperty("justify-content","center"),r.$$pointerdown=()=>{e("Generic node")},r.style.setProperty("width","150px"),r.style.setProperty("height","90px"),r.style.setProperty("display","flex"),r.style.setProperty("align-items","center"),r.style.setProperty("justify-content","center"),re(n,Je(po,{get when(){return t()},get children(){var i=Cn();return i.style.setProperty("position","absolute"),i.style.setProperty("width","150px"),i.style.setProperty("height","90px"),i.style.setProperty("display","flex"),i.style.setProperty("align-items","center"),i.style.setProperty("justify-content","center"),i.style.setProperty("z-index","1000"),re(i,t),ye(c=>{var a=`${E.mouseData.mousePosition.x-75}px`,l=`${E.mouseData.mousePosition.y-45}px`,u=V.node;return a!==c.e&&((c.e=a)!=null?i.style.setProperty("left",a):i.style.removeProperty("left")),l!==c.t&&((c.t=l)!=null?i.style.setProperty("top",l):i.style.removeProperty("top")),u!==c.a&&yt(i,c.a=u),c},{e:void 0,t:void 0,a:void 0}),i}}),null),ye(i=>{var c=`${Ue().x}px`,a=`${Ue().y}px`,l=V.node;return c!==i.e&&((i.e=c)!=null?n.style.setProperty("width",c):n.style.removeProperty("width")),a!==i.t&&((i.t=a)!=null?n.style.setProperty("height",a):n.style.removeProperty("height")),l!==i.a&&yt(r,i.a=l),i},{e:void 0,t:void 0,a:void 0}),n})()};yo(["pointerdown"]);const Nn=document.getElementById("root");vo(()=>Je(Dn,{}),Nn);
