(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();const Mt=(t,e)=>t===e,q=Symbol("solid-proxy"),Ae=Symbol("solid-track"),me={equals:Mt};let ut=pt;const Z=1,ye=2,ht={owned:null,cleanups:null,context:null,owner:null};var _=null;let ke=null,N=null,x=null,R=null,Pe=0;function fe(t,e){const n=N,o=_,r=t.length===0,s=e===void 0?o:e,i=r?ht:{owned:null,cleanups:null,context:s?s.context:null,owner:s},c=r?t:()=>t(()=>j(()=>Ee(i)));_=i,N=null;try{return re(c,!0)}finally{N=n,_=o}}function Q(t,e){e=e?Object.assign({},me,e):me;const n={value:t,observers:null,observerSlots:null,comparator:e.equals||void 0},o=r=>(typeof r=="function"&&(r=r(n.value)),gt(n,r));return[ft.bind(n),o]}function b(t,e,n){const o=Ge(t,e,!1,Z);he(o)}function ze(t,e,n){ut=xt;const o=Ge(t,e,!1,Z),r=qe&&zt(qe);r&&(o.suspense=r),(!n||!n.render)&&(o.user=!0),R?R.push(o):he(o)}function I(t,e,n){n=n?Object.assign({},me,n):me;const o=Ge(t,e,!0,0);return o.observers=null,o.observerSlots=null,o.comparator=n.equals||void 0,he(o),ft.bind(o)}function ge(t){return re(t,!1)}function j(t){if(N===null)return t();const e=N;N=null;try{return t()}finally{N=e}}function Pt(t){ze(()=>j(t))}function Te(t){return _===null||(_.cleanups===null?_.cleanups=[t]:_.cleanups.push(t)),t}function Ce(){return N}function zt(t){return _&&_.context&&_.context[t.id]!==void 0?_.context[t.id]:t.defaultValue}let qe;function ft(){if(this.sources&&this.state)if(this.state===Z)he(this);else{const t=x;x=null,re(()=>De(this),!1),x=t}if(N){const t=this.observers?this.observers.length:0;N.sources?(N.sources.push(this),N.sourceSlots.push(t)):(N.sources=[this],N.sourceSlots=[t]),this.observers?(this.observers.push(N),this.observerSlots.push(N.sources.length-1)):(this.observers=[N],this.observerSlots=[N.sources.length-1])}return this.value}function gt(t,e,n){let o=t.value;return(!t.comparator||!t.comparator(o,e))&&(t.value=e,t.observers&&t.observers.length&&re(()=>{for(let r=0;r<t.observers.length;r+=1){const s=t.observers[r],i=ke&&ke.running;i&&ke.disposed.has(s),(i?!s.tState:!s.state)&&(s.pure?x.push(s):R.push(s),s.observers&&vt(s)),i||(s.state=Z)}if(x.length>1e6)throw x=[],new Error},!1)),e}function he(t){if(!t.fn)return;Ee(t);const e=_,n=N,o=Pe;N=_=t,Et(t,t.value,o),N=n,_=e}function Et(t,e,n){let o;try{o=t.fn(e)}catch(r){return t.pure&&(t.state=Z,t.owned&&t.owned.forEach(Ee),t.owned=null),t.updatedAt=n+1,mt(r)}(!t.updatedAt||t.updatedAt<=n)&&(t.updatedAt!=null&&"observers"in t?gt(t,o):t.value=o,t.updatedAt=n)}function Ge(t,e,n,o=Z,r){const s={fn:t,state:o,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:_,context:_?_.context:null,pure:n};return _===null||_!==ht&&(_.owned?_.owned.push(s):_.owned=[s]),s}function we(t){if(t.state===0)return;if(t.state===ye)return De(t);if(t.suspense&&j(t.suspense.inFallback))return t.suspense.effects.push(t);const e=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<Pe);)t.state&&e.push(t);for(let n=e.length-1;n>=0;n--)if(t=e[n],t.state===Z)he(t);else if(t.state===ye){const o=x;x=null,re(()=>De(t,e[0]),!1),x=o}}function re(t,e){if(x)return t();let n=!1;e||(x=[]),R?n=!0:R=[],Pe++;try{const o=t();return kt(n),o}catch(o){n||(R=null),x=null,mt(o)}}function kt(t){if(x&&(pt(x),x=null),t)return;const e=R;R=null,e.length&&re(()=>ut(e),!1)}function pt(t){for(let e=0;e<t.length;e++)we(t[e])}function xt(t){let e,n=0;for(e=0;e<t.length;e++){const o=t[e];o.user?t[n++]=o:we(o)}for(e=0;e<n;e++)we(t[e])}function De(t,e){t.state=0;for(let n=0;n<t.sources.length;n+=1){const o=t.sources[n];if(o.sources){const r=o.state;r===Z?o!==e&&(!o.updatedAt||o.updatedAt<Pe)&&we(o):r===ye&&De(o,e)}}}function vt(t){for(let e=0;e<t.observers.length;e+=1){const n=t.observers[e];n.state||(n.state=ye,n.pure?x.push(n):R.push(n),n.observers&&vt(n))}}function Ee(t){let e;if(t.sources)for(;t.sources.length;){const n=t.sources.pop(),o=t.sourceSlots.pop(),r=n.observers;if(r&&r.length){const s=r.pop(),i=n.observerSlots.pop();o<r.length&&(s.sourceSlots[i]=o,r[o]=s,n.observerSlots[o]=i)}}if(t.owned){for(e=t.owned.length-1;e>=0;e--)Ee(t.owned[e]);t.owned=null}if(t.cleanups){for(e=t.cleanups.length-1;e>=0;e--)t.cleanups[e]();t.cleanups=null}t.state=0}function Ot(t){return t instanceof Error?t:new Error(typeof t=="string"?t:"Unknown error",{cause:t})}function mt(t,e=_){throw Ot(t)}const At=Symbol("fallback");function Qe(t){for(let e=0;e<t.length;e++)t[e]()}function Ft(t,e,n={}){let o=[],r=[],s=[],i=0,c=e.length>1?[]:null;return Te(()=>Qe(s)),()=>{let a=t()||[],l,d;return a[Ae],j(()=>{let h=a.length,m,g,$,F,B,O,M,E,p;if(h===0)i!==0&&(Qe(s),s=[],o=[],r=[],i=0,c&&(c=[])),n.fallback&&(o=[At],r[0]=fe(L=>(s[0]=L,n.fallback())),i=1);else if(i===0){for(r=new Array(h),d=0;d<h;d++)o[d]=a[d],r[d]=fe(f);i=h}else{for($=new Array(h),F=new Array(h),c&&(B=new Array(h)),O=0,M=Math.min(i,h);O<M&&o[O]===a[O];O++);for(M=i-1,E=h-1;M>=O&&E>=O&&o[M]===a[E];M--,E--)$[E]=r[M],F[E]=s[M],c&&(B[E]=c[M]);for(m=new Map,g=new Array(E+1),d=E;d>=O;d--)p=a[d],l=m.get(p),g[d]=l===void 0?-1:l,m.set(p,d);for(l=O;l<=M;l++)p=o[l],d=m.get(p),d!==void 0&&d!==-1?($[d]=r[l],F[d]=s[l],c&&(B[d]=c[l]),d=g[d],m.set(p,d)):s[l]();for(d=O;d<h;d++)d in $?(r[d]=$[d],s[d]=F[d],c&&(c[d]=B[d],c[d](d))):r[d]=fe(f);r=r.slice(0,i=h),o=a.slice(0)}return r});function f(h){if(s[d]=h,c){const[m,g]=Q(d);return c[d]=g,e(a[d],m)}return e(a[d])}}}function v(t,e){return j(()=>t(e||{}))}const Lt=t=>`Stale read from <${t}>.`;function V(t){const e="fallback"in t&&{fallback:()=>t.fallback};return I(Ft(()=>t.each,t.children,e||void 0))}function G(t){const e=t.keyed,n=I(()=>t.when,void 0,{equals:(o,r)=>e?o===r:!o==!r});return I(()=>{const o=n();if(o){const r=t.children;return typeof r=="function"&&r.length>0?j(()=>r(e?o:()=>{if(!j(n))throw Lt("Show");return t.when})):r}return t.fallback},void 0,void 0)}function Tt(t,e,n){let o=n.length,r=e.length,s=o,i=0,c=0,a=e[r-1].nextSibling,l=null;for(;i<r||c<s;){if(e[i]===n[c]){i++,c++;continue}for(;e[r-1]===n[s-1];)r--,s--;if(r===i){const d=s<o?c?n[c-1].nextSibling:n[s-c]:a;for(;c<s;)t.insertBefore(n[c++],d)}else if(s===c)for(;i<r;)(!l||!l.has(e[i]))&&e[i].remove(),i++;else if(e[i]===n[s-1]&&n[c]===e[r-1]){const d=e[--r].nextSibling;t.insertBefore(n[c++],e[i++].nextSibling),t.insertBefore(n[--s],d),e[r]=n[s]}else{if(!l){l=new Map;let f=c;for(;f<s;)l.set(n[f],f++)}const d=l.get(e[i]);if(d!=null)if(c<d&&d<s){let f=i,h=1,m;for(;++f<r&&f<s&&!((m=l.get(e[f]))==null||m!==d+h);)h++;if(h>d-c){const g=e[i];for(;c<d;)t.insertBefore(n[c++],g)}else t.replaceChild(n[c++],e[i++])}else i++;else e[i++].remove()}}}const Je="_$DX_DELEGATE";function Gt(t,e,n,o={}){let r;return fe(s=>{r=s,e===document?t():C(e,t(),e.firstChild?null:void 0,n)},o.owner),()=>{r(),e.textContent=""}}function w(t,e,n){let o;const r=()=>{const i=document.createElement("template");return i.innerHTML=t,n?i.content.firstChild.firstChild:i.content.firstChild},s=e?()=>j(()=>document.importNode(o||(o=r()),!0)):()=>(o||(o=r())).cloneNode(!0);return s.cloneNode=s,s}function Y(t,e=window.document){const n=e[Je]||(e[Je]=new Set);for(let o=0,r=t.length;o<r;o++){const s=t[o];n.has(s)||(n.add(s),e.addEventListener(s,Bt))}}function z(t,e,n){n==null?t.removeAttribute(e):t.setAttribute(e,n)}function y(t,e){e==null?t.removeAttribute("class"):t.className=e}function be(t,e,n={}){const o=Object.keys(e||{}),r=Object.keys(n);let s,i;for(s=0,i=r.length;s<i;s++){const c=r[s];!c||c==="undefined"||e[c]||(et(t,c,!1),delete n[c])}for(s=0,i=o.length;s<i;s++){const c=o[s],a=!!e[c];!c||c==="undefined"||n[c]===a||!a||(et(t,c,!0),n[c]=a)}return n}function Be(t,e,n){return j(()=>t(e,n))}function C(t,e,n,o){if(n!==void 0&&!o&&(o=[]),typeof e!="function")return Se(t,e,o,n);b(r=>Se(t,e(),r,n),o)}function et(t,e,n){const o=e.trim().split(/\s+/);for(let r=0,s=o.length;r<s;r++)t.classList.toggle(o[r],n)}function Bt(t){const e=`$$${t.type}`;let n=t.composedPath&&t.composedPath()[0]||t.target;for(t.target!==n&&Object.defineProperty(t,"target",{configurable:!0,value:n}),Object.defineProperty(t,"currentTarget",{configurable:!0,get(){return n||document}});n;){const o=n[e];if(o&&!n.disabled){const r=n[`${e}Data`];if(r!==void 0?o.call(n,r,t):o.call(n,t),t.cancelBubble)return}n=n._$host||n.parentNode||n.host}}function Se(t,e,n,o,r){for(;typeof n=="function";)n=n();if(e===n)return n;const s=typeof e,i=o!==void 0;if(t=i&&n[0]&&n[0].parentNode||t,s==="string"||s==="number")if(s==="number"&&(e=e.toString()),i){let c=n[0];c&&c.nodeType===3?c.data=e:c=document.createTextNode(e),n=J(t,n,o,c)}else n!==""&&typeof n=="string"?n=t.firstChild.data=e:n=t.textContent=e;else if(e==null||s==="boolean")n=J(t,n,o);else{if(s==="function")return b(()=>{let c=e();for(;typeof c=="function";)c=c();n=Se(t,c,n,o)}),()=>n;if(Array.isArray(e)){const c=[],a=n&&Array.isArray(n);if(Fe(c,e,n,r))return b(()=>n=Se(t,c,n,o,!0)),()=>n;if(c.length===0){if(n=J(t,n,o),i)return n}else a?n.length===0?tt(t,c,o):Tt(t,n,c):(n&&J(t),tt(t,c));n=c}else if(e.nodeType){if(Array.isArray(n)){if(i)return n=J(t,n,o,e);J(t,n,null,e)}else n==null||n===""||!t.firstChild?t.appendChild(e):t.replaceChild(e,t.firstChild);n=e}}return n}function Fe(t,e,n,o){let r=!1;for(let s=0,i=e.length;s<i;s++){let c=e[s],a=n&&n[s],l;if(!(c==null||c===!0||c===!1))if((l=typeof c)=="object"&&c.nodeType)t.push(c);else if(Array.isArray(c))r=Fe(t,c,a)||r;else if(l==="function")if(o){for(;typeof c=="function";)c=c();r=Fe(t,Array.isArray(c)?c:[c],Array.isArray(a)?a:[a])||r}else t.push(c),r=!0;else{const d=String(c);a&&a.nodeType===3&&a.data===d?t.push(a):t.push(document.createTextNode(d))}}return r}function tt(t,e,n=null){for(let o=0,r=e.length;o<r;o++)t.insertBefore(e[o],n)}function J(t,e,n,o){if(n===void 0)return t.textContent="";const r=o||document.createTextNode("");if(e.length){let s=!1;for(let i=e.length-1;i>=0;i--){const c=e[i];if(r!==c){const a=c.parentNode===t;!s&&!i?a?t.replaceChild(r,c):t.insertBefore(r,n):a&&c.remove()}else s=!0}}else t.insertBefore(r,n);return[r]}const _e=Symbol("store-raw"),te=Symbol("store-node"),W=Symbol("store-has"),yt=Symbol("store-self");function Ct(t){let e=t[q];if(!e&&(Object.defineProperty(t,q,{value:e=new Proxy(t,Ut)}),!Array.isArray(t))){const n=Object.keys(t),o=Object.getOwnPropertyDescriptors(t);for(let r=0,s=n.length;r<s;r++){const i=n[r];o[i].get&&Object.defineProperty(t,i,{enumerable:o[i].enumerable,get:o[i].get.bind(e)})}}return e}function ne(t){let e;return t!=null&&typeof t=="object"&&(t[q]||!(e=Object.getPrototypeOf(t))||e===Object.prototype||Array.isArray(t))}function oe(t,e=new Set){let n,o,r,s;if(n=t!=null&&t[_e])return n;if(!ne(t)||e.has(t))return t;if(Array.isArray(t)){Object.isFrozen(t)?t=t.slice(0):e.add(t);for(let i=0,c=t.length;i<c;i++)r=t[i],(o=oe(r,e))!==r&&(t[i]=o)}else{Object.isFrozen(t)?t=Object.assign({},t):e.add(t);const i=Object.keys(t),c=Object.getOwnPropertyDescriptors(t);for(let a=0,l=i.length;a<l;a++)s=i[a],!c[s].get&&(r=t[s],(o=oe(r,e))!==r&&(t[s]=o))}return t}function Ne(t,e){let n=t[e];return n||Object.defineProperty(t,e,{value:n=Object.create(null)}),n}function le(t,e,n){if(t[e])return t[e];const[o,r]=Q(n,{equals:!1,internal:!0});return o.$=r,t[e]=o}function Kt(t,e){const n=Reflect.getOwnPropertyDescriptor(t,e);return!n||n.get||!n.configurable||e===q||e===te||(delete n.value,delete n.writable,n.get=()=>t[q][e]),n}function wt(t){Ce()&&le(Ne(t,te),yt)()}function Wt(t){return wt(t),Reflect.ownKeys(t)}const Ut={get(t,e,n){if(e===_e)return t;if(e===q)return n;if(e===Ae)return wt(t),n;const o=Ne(t,te),r=o[e];let s=r?r():t[e];if(e===te||e===W||e==="__proto__")return s;if(!r){const i=Object.getOwnPropertyDescriptor(t,e);Ce()&&(typeof s!="function"||t.hasOwnProperty(e))&&!(i&&i.get)&&(s=le(o,e,s)())}return ne(s)?Ct(s):s},has(t,e){return e===_e||e===q||e===Ae||e===te||e===W||e==="__proto__"?!0:(Ce()&&le(Ne(t,W),e)(),e in t)},set(){return!0},deleteProperty(){return!0},ownKeys:Wt,getOwnPropertyDescriptor:Kt};function se(t,e,n,o=!1){if(!o&&t[e]===n)return;const r=t[e],s=t.length;n===void 0?(delete t[e],t[W]&&t[W][e]&&r!==void 0&&t[W][e].$()):(t[e]=n,t[W]&&t[W][e]&&r===void 0&&t[W][e].$());let i=Ne(t,te),c;if((c=le(i,e,r))&&c.$(()=>n),Array.isArray(t)&&t.length!==s){for(let a=t.length;a<s;a++)(c=i[a])&&c.$();(c=le(i,"length",s))&&c.$(t.length)}(c=i[yt])&&c.$()}function Dt(t,e){const n=Object.keys(e);for(let o=0;o<n.length;o+=1){const r=n[o];se(t,r,e[r])}}function Rt(t,e){if(typeof e=="function"&&(e=e(t)),e=oe(e),Array.isArray(e)){if(t===e)return;let n=0,o=e.length;for(;n<o;n++){const r=e[n];t[n]!==r&&se(t,n,r)}se(t,"length",o)}else Dt(t,e)}function ce(t,e,n=[]){let o,r=t;if(e.length>1){o=e.shift();const i=typeof o,c=Array.isArray(t);if(Array.isArray(o)){for(let a=0;a<o.length;a++)ce(t,[o[a]].concat(e),n);return}else if(c&&i==="function"){for(let a=0;a<t.length;a++)o(t[a],a)&&ce(t,[a].concat(e),n);return}else if(c&&i==="object"){const{from:a=0,to:l=t.length-1,by:d=1}=o;for(let f=a;f<=l;f+=d)ce(t,[f].concat(e),n);return}else if(e.length>1){ce(t[o],e,[o].concat(n));return}r=t[o],n=[o].concat(n)}let s=e[0];typeof s=="function"&&(s=s(r,n),s===r)||o===void 0&&s==null||(s=oe(s),o===void 0||ne(r)&&ne(s)&&!Array.isArray(s)?Dt(r,s):se(t,o,s))}function K(...[t,e]){const n=oe(t||{}),o=Array.isArray(n),r=Ct(n);function s(...i){ge(()=>{o&&i.length===1?Rt(n,i[0]):ce(n,i)})}return[r,s]}const $e=new WeakMap,bt={get(t,e){if(e===_e)return t;const n=t[e];let o;return ne(n)?$e.get(n)||($e.set(n,o=new Proxy(n,bt)),o):n},set(t,e,n){return se(t,e,oe(n)),!0},deleteProperty(t,e){return se(t,e,void 0,!0),!0}};function Le(t){return e=>{if(ne(e)){let n;(n=$e.get(e))||$e.set(e,n=new Proxy(e,bt)),t(n)}return e}}var jt={equals:!1},Ht=jt,nt=class{#e;constructor(t=Map){this.#e=new t}dirty(t){this.#e.get(t)?.$$()}track(t){if(!Ce())return;let e=this.#e.get(t);if(e)e.n++;else{const[n,o]=Q(void 0,Ht);this.#e.set(t,e={$:n,$$:o,n:1})}Te(()=>{e.n--===1&&queueMicrotask(()=>e.n===0&&this.#e.delete(t))}),e.$()}},H=Symbol("track-keys"),ue=class extends Map{#e=new nt;#t=new nt;constructor(t){if(super(),t)for(const e of t)super.set(e[0],e[1])}has(t){return this.#e.track(t),super.has(t)}get(t){return this.#t.track(t),super.get(t)}get size(){return this.#e.track(H),super.size}*keys(){for(const t of super.keys())this.#e.track(t),yield t;this.#e.track(H)}*values(){for(const[t,e]of super.entries())this.#t.track(t),yield e;this.#e.track(H)}*entries(){for(const t of super.entries())this.#t.track(t[0]),yield t;this.#e.track(H)}set(t,e){return ge(()=>{if(super.has(t)){if(super.get(t)===e)return}else this.#e.dirty(t),this.#e.dirty(H);this.#t.dirty(t),super.set(t,e)}),this}delete(t){const e=super.delete(t);return e&&ge(()=>{this.#e.dirty(t),this.#e.dirty(H),this.#t.dirty(t)}),e}clear(){super.size&&ge(()=>{for(const t of super.keys())this.#e.dirty(t),this.#t.dirty(t);super.clear(),this.#e.dirty(H)})}forEach(t){this.#e.track(H);for(const[e,n]of super.entries())this.#t.track(e),t(n,e,this)}[Symbol.iterator](){return this.entries()}};class u{constructor(e,n){this.x=e,this.y=n}static zero(){return new u(0,0)}static of(e,n){return new u(e,n)}static fromEvent(e){return new u(e.clientX,e.clientY)}static fromVec2(e){return new u(e.x,e.y)}copy(){return new u(this.x,this.y)}serialize(){return{x:this.x,y:this.y}}static deserialize(e){return new u(e.x,e.y)}static deserializeOrDefault(e,n=u.zero()){return e?u.deserialize(e):n}add(...e){return e.reduce((n,o)=>new u(n.x+o.x,n.y+o.y),this)}subtract(...e){return e.reduce((n,o)=>new u(n.x-o.x,n.y-o.y),this)}multiply(...e){return e.reduce((n,o)=>new u(n.x*o.x,n.y*o.y),this)}divide(...e){return e.reduce((n,o)=>new u(o.x/n.x,o.y/n.y),this)}negate(){return new u(-this.x,-this.y)}shift(e){return new u(this.x+e,this.y+e)}multiplyBy(e){return new u(this.x*e,this.y*e)}divideBy(e){return new u(this.x/e,this.y/e)}isWithinRect(e,n){return this.x>=e.x&&this.x<=e.x+n.x&&this.y>=e.y&&this.y<=e.y+n.y}distanceTo(e){return Math.hypot(this.x-e.x,this.y-e.y)}abs(){return u.of(Math.abs(this.x),Math.abs(this.y))}}const Zt=w("<div>"),Yt=t=>(()=>{const e=Zt();return e.$$pointerup=n=>t.nodeflowData.eventStore.onPointerUpInConnector.publish({event:n,nodeId:t.nodeId,connectorId:t.connectorId}),e.$$touchstart=n=>t.nodeflowData.eventStore.onTouchStartInConnector.publish({event:n,nodeId:t.nodeId,connectorId:t.connectorId}),e.$$mousedown=n=>t.nodeflowData.eventStore.onMouseDownInConnector.publish({event:n,nodeId:t.nodeId,connectorId:t.connectorId}),Be(n=>setTimeout(()=>{if(!n)return;const o=t.nodeflowData.nodes.get(t.nodeId).connectorSections.get(t.sectionId).connectors.get(t.connectorId),r=new ResizeObserver(()=>{o.size=u.of(n.offsetWidth,n.offsetHeight)});r.observe(n),o.update({position:u.of((n?.parentElement?.offsetLeft??0)+n.offsetLeft,(n?.parentElement?.offsetTop??0)+n.offsetTop),ref:n,resizeObserver:r,size:u.of(n.offsetWidth,n.offsetHeight)})}),e),b(()=>y(e,t.connector?.css)),e})();Y(["mousedown","touchstart","pointerup"]);const ot=w('<svg><circle r="4" fill="none"></svg>',!1,!0),Xt=w('<svg><path stroke="black" stroke-width="1" fill="transparent">'),Vt=t=>{const e=I(()=>{const{mouseData:n,curveFunctions:o}=t.nodeflowData;if(n.heldConnectors.length!==1)return;const r=n.heldConnectors[0].connector,s=r.parentNode,i=r.getCenter(),c=n.globalMousePosition(),{anchorStart:a,anchorEnd:l}=o.calculateCurveAnchors(i,c,s.getCenter(),c);return{start:i,end:c,anchorStart:a,anchorEnd:l,path:o.createDefaultCurvePath(i,c,a,l)}});return(()=>{const n=Xt(),o=n.firstChild;return n.style.setProperty("z-index","2"),n.style.setProperty("position","absolute"),n.style.setProperty("width","1px"),n.style.setProperty("height","1px"),n.style.setProperty("pointer-events","none"),n.style.setProperty("overflow","visible"),C(n,v(G,{get when(){return t.nodeflowData.settings.debugMode},get children(){return[(()=>{const r=ot();return b(s=>{const i=e()?.anchorStart.x,c=e()?.anchorStart.y,a=t.css??"";return i!==s._v$&&z(r,"cx",s._v$=i),c!==s._v$2&&z(r,"cy",s._v$2=c),a!==s._v$3&&z(r,"class",s._v$3=a),s},{_v$:void 0,_v$2:void 0,_v$3:void 0}),r})(),(()=>{const r=ot();return b(s=>{const i=e()?.anchorEnd.x,c=e()?.anchorEnd.y,a=t.css??"";return i!==s._v$4&&z(r,"cx",s._v$4=i),c!==s._v$5&&z(r,"cy",s._v$5=c),a!==s._v$6&&z(r,"class",s._v$6=a),s},{_v$4:void 0,_v$5:void 0,_v$6:void 0}),r})()]}}),null),b(r=>{const s=e()?.path,i=t.css;return s!==r._v$7&&z(o,"d",r._v$7=s),i!==r._v$8&&z(o,"class",r._v$8=i),r},{_v$7:void 0,_v$8:void 0}),n})()},qt=w('<svg><path stroke="black" stroke-width="1" fill="none"></svg>',!1,!0),st=w('<svg><circle r="4" fill="none"></svg>',!1,!0),Qt=t=>{const e=I(()=>t.nodeflowData.nodes.get(t.sourceNodeId)),n=I(()=>t.nodeflowData.nodes.get(t.destinationNodeId)),o=I(()=>e().getConnector(t.sourceConnectorId)),r=I(()=>n().getConnector(t.destinationConnectorId)),s=I(()=>!e()||!n()?-1:o()?.destinations?.findIndex(i=>i.destinationConnector===r())??-1);return ze(()=>{if(s()<0)return;const{curveFunctions:i}=t.nodeflowData,c=e().getConnector(t.sourceConnectorId),a=n().getConnector(t.destinationConnectorId),l=c.getCenter(),d=a.getCenter(),{anchorStart:f,anchorEnd:h}=i.calculateCurveAnchors(l,d,e().getCenter(),n().getCenter());o().destinations.get(s()).path={start:l,end:d,anchorStart:f,anchorEnd:h,path:i.createDefaultCurvePath(l,d,f,h)}}),[(()=>{const i=qt();return i.$$pointerdown=c=>{t.nodeflowData.eventStore.onPointerDownInNodeCurve.publish({event:c,sourceConnector:o(),destinationConnector:r()})},i.style.setProperty("cursor","pointer"),i.style.setProperty("pointer-events","visibleStroke"),b(c=>{const a=o().destinations.get(s()).path?.path,l={[t.css?.normal??""]:!0,[t.css?.selected??""]:t.nodeflowData.mouseData.hasSelectedConnection(t.sourceNodeId,t.sourceConnectorId,t.destinationNodeId,t.destinationConnectorId)};return a!==c._v$&&z(i,"d",c._v$=a),c._v$2=be(i,l,c._v$2),c},{_v$:void 0,_v$2:void 0}),i})(),v(G,{get when(){return t.nodeflowData.settings.debugMode},get children(){return[(()=>{const i=st();return b(c=>{const a=o().destinations.get(s()).path?.anchorStart?.x,l=o().destinations.get(s()).path?.anchorStart?.y,d=t.css?.normal??"";return a!==c._v$3&&z(i,"cx",c._v$3=a),l!==c._v$4&&z(i,"cy",c._v$4=l),d!==c._v$5&&z(i,"class",c._v$5=d),c},{_v$3:void 0,_v$4:void 0,_v$5:void 0}),i})(),(()=>{const i=st();return b(c=>{const a=o().destinations.get(s()).path?.anchorEnd?.x,l=o().destinations.get(s()).path?.anchorEnd?.y,d=t.css?.normal??"";return a!==c._v$6&&z(i,"cx",c._v$6=a),l!==c._v$7&&z(i,"cy",c._v$7=l),d!==c._v$8&&z(i,"class",c._v$8=d),c},{_v$6:void 0,_v$7:void 0,_v$8:void 0}),i})()]}})]};Y(["pointerdown"]);const rt=w("<div>"),Jt=t=>{const e=I(()=>t.nodeflowData.nodes.get(t.nodeId)),[n,o]=Q(!1);return ze(()=>{const r=t.nodeflowData.mouseData.selections.at(-1);r?.type!=="node"||r.node.id!==t.nodeId||!t.nodeflowData.mouseData.pointerDown||(e().position=t.nodeflowData.mouseData.mousePosition.divideBy(t.nodeflowData.zoomLevel).subtract(t.nodeflowData.mouseData.clickStartPosition??u.zero()))}),Te(()=>{e().resizeObserver&&(e().resizeObserver.disconnect(),Array.from(e().connectorSections.values()).forEach(r=>{Array.from(r.connectors.values()).forEach(s=>{s.resizeObserver&&s.resizeObserver.disconnect()})}))}),(()=>{const r=rt();return r.$$pointerup=s=>t.nodeflowData.eventStore.onPointerUpInNode.publish({event:s,nodeId:t.nodeId}),r.$$touchstart=s=>t.nodeflowData.eventStore.onTouchStartInNode.publish({event:s,nodeId:t.nodeId}),r.$$mousedown=s=>t.nodeflowData.eventStore.onMouseDownInNode.publish({event:s,nodeId:t.nodeId}),Be(s=>setTimeout(()=>{if(!s)return;const i=new ResizeObserver(()=>{e().update({size:u.of(s.clientWidth,s.clientHeight)}),Array.from(e().connectorSections.values()).forEach(a=>Array.from(a.connectors.values()).forEach(l=>{const d=l.ref;d&&(l.position=u.of((d?.parentElement?.offsetLeft??0)+d.offsetLeft,(d?.parentElement?.offsetTop??0)+d.offsetTop))}))});i.observe(s);const c=e().centered?u.of(s.clientWidth,s.clientHeight).divideBy(2):u.zero();e().update({offset:u.of(s.clientLeft,s.clientTop),ref:s,resizeObserver:i,position:e().position.subtract(c),size:u.of(s.clientWidth,s.clientHeight)}),o(!0)}),r),C(r,()=>e().display({node:e()}),null),C(r,v(V,{get each(){return Array.from(e().connectorSections.entries())},children:([s,i])=>(()=>{const c=rt();return C(c,v(V,{get each(){return Array.from(i.connectors.entries())},children:([a,l])=>v(Yt,{connector:l,connectorId:a,get nodeId(){return t.nodeId},sectionId:s,get nodeflowData(){return t.nodeflowData}})})),b(()=>y(c,i?.css)),c})()}),null),b(s=>{const i=`${e().position.x}px`,c=`${e().position.y}px`,a=n()?1:0,l={[e()?.css?.normal??""]:!0,[e()?.css?.selected??""]:t.nodeflowData.mouseData.hasSelectedNode(t.nodeId)};return i!==s._v$&&((s._v$=i)!=null?r.style.setProperty("left",i):r.style.removeProperty("left")),c!==s._v$2&&((s._v$2=c)!=null?r.style.setProperty("top",c):r.style.removeProperty("top")),a!==s._v$3&&((s._v$3=a)!=null?r.style.setProperty("opacity",a):r.style.removeProperty("opacity")),s._v$4=be(r,l,s._v$4),s},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),r})()};Y(["mousedown","touchstart","pointerup"]);const en=w('<div tabindex="0"><div><svg>'),tn=t=>e=>(()=>{const n=en(),o=n.firstChild,r=o.firstChild;return n.$$touchmove=s=>t.eventStore.onTouchMoveInNodeflow.publish({event:s}),n.$$touchstart=s=>t.eventStore.onTouchStartInNodeflow.publish({event:s}),n.$$keyup=s=>t.eventStore.onKeyUpInNodeflow.publish({event:s}),n.$$keydown=s=>t.eventStore.onKeyDownInNodeflow.publish({event:s}),n.$$mousedown=s=>t.eventStore.onMouseDownInNodeflow.publish({event:s}),n.addEventListener("wheel",s=>t.eventStore.onWheelInNodeflow.publish({event:s})),n.$$pointerup=s=>t.eventStore.onPointerUpInNodeflow.publish({event:s}),n.$$mousemove=s=>t.eventStore.onMouseMoveInNodeflow.publish({event:s}),Be(s=>{new ResizeObserver(()=>{t.update({size:u.of(s.clientWidth,s.clientHeight),startPosition:u.of(s.offsetLeft,s.offsetTop)})}).observe(s)},n),n.style.setProperty("overflow","hidden"),o.style.setProperty("position","absolute"),o.style.setProperty("transform-origin","center"),o.style.setProperty("transition","scale 0.1s ease-out"),C(o,v(V,{get each(){return Array.from(t.nodes.keys())},children:s=>v(Jt,{nodeId:s,nodeflowData:t})}),r),r.style.setProperty("z-index","2"),r.style.setProperty("position","absolute"),r.style.setProperty("width","1px"),r.style.setProperty("height","1px"),r.style.setProperty("pointer-events","none"),r.style.setProperty("overflow","visible"),C(r,v(V,{get each(){return Array.from(t.nodes.entries())},children:([s,i])=>v(V,{get each(){return i.getAllConnectors()},children:c=>v(V,{get each(){return c.destinations.array},children:a=>v(Qt,{nodeflowData:t,sourceNodeId:s,get sourceConnectorId(){return c.id},get destinationNodeId(){return a.destinationConnector.parentSection.parentNode.id},get destinationConnectorId(){return a.destinationConnector.id},get css(){return a.css}})})})})),C(o,v(G,{get when(){return t.mouseData.heldConnectors.length===1},get children(){return v(Vt,{get css(){return e?.css?.newCurve},nodeflowData:t})}}),null),b(s=>{const i=e?.css?.nodeflow,c=e.height,a=e.width,l=`scale(${t.zoomLevel}) translate(${t.position.x}px, ${t.position.y}px)`;return i!==s._v$&&y(n,s._v$=i),c!==s._v$2&&((s._v$2=c)!=null?n.style.setProperty("height",c):n.style.removeProperty("height")),a!==s._v$3&&((s._v$3=a)!=null?n.style.setProperty("width",a):n.style.removeProperty("width")),l!==s._v$4&&((s._v$4=l)!=null?o.style.setProperty("transform",l):o.style.removeProperty("transform")),s},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),n})();Y(["mousemove","pointerup","mousedown","keydown","keyup","touchstart","touchmove"]);class T{constructor(e){this.store=K(e??[])}get array(){return this.store[0]}get length(){return this.store[0].length}at(e){return this.store[0].at(e)}forEach(e){this.store[0].forEach(e)}filter(e){return this.store[0].filter(e)}filterInPlace(e){this.store[1](this.filter(e))}map(e){return this.store[0].map(e)}flatMap(e){return this.store[0].flatMap(e)}find(e){return this.store[0].find(e)}findIndex(e){return this.store[0].findIndex(e)}splice(e,n,...o){this.store[1](this.store[0].splice(e,n,...o))}reduce(e,n){return this.store[0].reduce(e,n)}some(e){return this.store[0].some(e)}every(e){return this.store[0].every(e)}get(e){return this.store[0][e]}set(e,n){this.store[1](e,n)}push(e){this.store[1](this.store[0].length,e)}}class A{currentChangeIndex=-1;constructor(e=-1){this.maxChanges=e,this.changes=[]}serialize(){return{changes:this.changes,currentChangeIndex:this.currentChangeIndex,maxChanges:this.maxChanges}}deserialize(e){this.changes=e.changes,this.currentChangeIndex=e.currentChangeIndex,this.maxChanges=e.maxChanges}addChange(e){this.changes=this.changes.slice(0,this.currentChangeIndex+1),this.changes.length===this.maxChanges&&this.changes.shift(),this.changes.push(e),this.currentChangeIndex=this.changes.length-1}undo(){if(this.currentChangeIndex===-1)return!1;const e=this.changes[this.currentChangeIndex].historyGroup;for(;this.currentChangeIndex>-1&&this.changes[this.currentChangeIndex].historyGroup===e;)this.changes[this.currentChangeIndex].undoChange(),this.currentChangeIndex--;return!0}redo(){if(this.currentChangeIndex===this.changes.length-1)return!1;const e=this.changes[this.currentChangeIndex+1].historyGroup;for(;this.currentChangeIndex<this.changes.length-1&&this.changes[this.currentChangeIndex+1].historyGroup===e;)this.currentChangeIndex++,this.changes[this.currentChangeIndex].applyChange();return!0}static evaluateHistoryGroup(e=!0){return typeof e=="boolean"?e?crypto.randomUUID():!1:e}}class St{constructor(e){this.nodeflowData=e}getHorizontalCurve=(e,n)=>u.of((n.x-e.x)/1.5,0);getVerticalCurve=(e,n)=>u.of(0,(n.y-e.y)/1.5);calculateCurveAnchors(e,n,o,r){const s=e.distanceTo(n)/300,i=o.add(e.subtract(o).multiplyBy(s)),c=r.add(n.subtract(r).multiplyBy(s));return{anchorStart:i,anchorEnd:c}}createDefaultCurvePath=(e,n,o,r)=>`M ${e.x} ${e.y} C ${o.x} ${o.y}, ${r.x} ${r.y}, ${n.x} ${n.y}`}class nn{constructor(e){this.store=K(e)}get css(){return this.store[0].css}get destinationConnector(){return this.store[0].destinationConnector}get path(){return this.store[0].path}set css(e){this.store[1]({css:e})}set path(e){this.store[1]({path:e})}set destinationConnector(e){this.store[1]({destinationConnector:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}}const ae=(...t)=>{const e=t[0];return t.slice(1).reduce((o,r)=>new Set([...o].filter(s=>r.has(s))),e)},de=t=>t.size===0,U=t=>typeof t!="object"||t===null||t===void 0?t:Array.isArray(t)?t.map(U):typeof t=="object"?Object.fromEntries(Object.entries(t).map(([e,n])=>[e,U(n)])):t;class Ke{constructor(e){this.store=K(e)}serialize(){return{css:this.css,hovered:this.hovered,id:this.id,position:this.position.serialize()}}serializeConnections(){return[...this.destinations.map(({destinationConnector:e,css:n})=>({sourceNodeId:this.parentNode.id,sourceConnectorId:this.id,destinationNodeId:e.parentNode.id,destinationConnectorId:e.id,css:U(n)})),...this.sources.map(({sourceConnector:e})=>({sourceNodeId:e.parentNode.id,sourceConnectorId:e.id,destinationNodeId:this.parentNode.id,destinationConnectorId:this.id,css:U(e.destinations.find(n=>n.destinationConnector.parentNode.id===this.parentNode.id)?.css)}))]}static deserialize(e,n){const o=!e.id||n.connectors.has(e.id)?n.parentNode.getNextFreeConnectorId():e.id;return new Ke({css:e.css,destinations:new T,hovered:e.hovered??!1,id:o,parentSection:n,position:u.deserializeOrDefault(e.position),ref:void 0,resizeObserver:void 0,size:u.zero(),sources:new T})}get css(){return this.store[0].css}values(){return this.store[0]}get destinations(){return this.store[0].destinations}get hovered(){return this.store[0].hovered}get id(){return this.store[0].id}get parentSection(){return this.store[0].parentSection}get parentNode(){return this.store[0].parentSection.parentNode}get position(){return this.store[0].position}get ref(){return this.store[0].ref}get resizeObserver(){return this.store[0].resizeObserver}get size(){return this.store[0].size}get sources(){return this.store[0].sources}set css(e){this.store[1]({css:e})}set destinations(e){this.store[1]({destinations:e})}set hovered(e){this.store[1]({hovered:e})}set id(e){this.store[1]({id:e})}set parentSection(e){this.store[1]({parentSection:e})}set position(e){this.store[1]({position:e})}set ref(e){this.store[1]({ref:e})}set resizeObserver(e){this.store[1]({resizeObserver:e})}set size(e){this.store[1]({size:e})}set sources(e){this.store[1]({sources:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}removeIncomingConnections(){this.sources.forEach(({sourceConnector:e})=>{e.destinations.filterInPlace(({destinationConnector:n})=>n.parentNode.id!==this.id)}),this.sources=new T}removeOutgoingConnections(){this.destinations.forEach(({destinationConnector:e})=>{e.sources.filterInPlace(({sourceConnector:n})=>n.parentNode.id!==this.id)}),this.destinations=new T}getCenter(){const{position:e,offset:n}=this.parentNode;return e.add(n,this.position,this.size.divideBy(2))}}class D{constructor(){this.nodeflows=new Map,this.globalEventStore={onMouseMoveInDocument:new xe,onPointerLeaveFromDocument:new xe,onPointerUpInDocument:new xe},this.setupDefaultEventHandlers()}static get(){return this.instance||(D.instance=new D),D.instance}createCanvas(...e){const n=new Ue(...e);return this.nodeflows.set(e[0],n),[n,tn(n)]}getNodeflow(e){return this.nodeflows.get(e)}removeNodeflow(e){this.nodeflows.delete(e)}clear(){this.nodeflows.clear()}hasNodeflow(e){return this.nodeflows.has(e)}setupDefaultEventHandlers(){document.onmousemove=e=>this.globalEventStore.onMouseMoveInDocument.publish({event:e}),document.onpointerleave=e=>this.globalEventStore.onPointerLeaveFromDocument.publish({event:e}),document.onpointerup=e=>this.globalEventStore.onPointerUpInDocument.publish({event:e}),this.globalEventStore.onMouseMoveInDocument.subscribeMultiple([{name:"update-mouse-position",event:({event:e})=>{this.nodeflows.forEach(n=>{n.mouseData.mousePosition=u.fromEvent(e)})}}]),this.globalEventStore.onPointerLeaveFromDocument.subscribeMultiple([{name:"reset-mouse-data",event:()=>{this.nodeflows.forEach(e=>{e.mouseData.reset()})}}]),this.globalEventStore.onPointerUpInDocument.subscribeMultiple([])}}class on{constructor(e,n){this.nodeflowData=e,this.store=K(n)}serialize(){return{connectors:Object.fromEntries(Array.from(this.connectors.entries()).map(([e,n])=>[e,n.serialize()])),css:this.css,id:this.id}}addConnector(e,n=!0){const o=Ke.deserialize(e,this);if(this.connectors.has(o.id))return;const r=A.evaluateHistoryGroup(n);if(r){const s=o.serialize(),i=this.id,c=s.id,a=this.parentNode.id,l=this.nodeflowData.id;this.nodeflowData.changes.addChange({type:"add",source:"connector",applyChange:()=>{D.get().getNodeflow(l)?.nodes.get(a)?.addConnector(i,s,!1)},undoChange:()=>{D.get().getNodeflow(l)?.nodes.get(a)?.removeConnector(i,c,!1)},historyGroup:r})}return this.connectors.set(o.id,o),o}removeConnector(e,n=!0){if(!this.connectors.has(e))return;const o=this.connectors.get(e),r=A.evaluateHistoryGroup(n);if(r){const s=o.serialize(),i=this.id,c=s.id,a=this.parentNode.id,l=this.nodeflowData.id;this.nodeflowData.changes.addChange({type:"remove",source:"connector",applyChange:()=>{D.get().getNodeflow(l)?.nodes.get(a)?.removeConnector(i,c,!1)},undoChange:()=>{D.get().getNodeflow(l)?.nodes.get(a)?.addConnector(i,s,!1)},historyGroup:r})}this.connectors.delete(e)}get connectors(){return this.store[0].connectors}get css(){return this.store[0].css}get id(){return this.store[0].id}get parentNode(){return this.store[0].parentNode}set connectors(e){this.store[1]({connectors:e})}set css(e){this.store[1]({css:e})}set id(e){this.store[1]({id:e})}set parentNode(e){this.store[1]({parentNode:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}removeIncomingConnections(){this.connectors.forEach(e=>e.removeIncomingConnections())}removeOutgoingConnections(){this.connectors.forEach(e=>e.removeOutgoingConnections())}getSourceConnectors(){return Array.from(this.connectors.values()).flatMap(e=>e.sources.flatMap(n=>n.sourceConnector))}getDestinationConnectors(){return Array.from(this.connectors.values()).flatMap(e=>e.destinations.flatMap(n=>n.destinationConnector))}}class sn{constructor(e){this.store=K(e)}get sourceConnector(){return this.store[0].sourceConnector}set sourceConnector(e){this.store[1]({sourceConnector:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}}class _t{subscriptions=new ue;blacklistFilters=new ue;blacklist(e,n){this.blacklistFilters.set(e,n)}unblacklist(e){this.blacklistFilters.delete(e)}unblacklistMultiple(e){e.forEach(this.unblacklist)}clearBlacklist(){this.blacklistFilters.clear()}subscribe(e,n,o=0){this.subscriptions.set(e,{name:e,event:n,priority:o})}subscribeMultiple(e){e.forEach(({name:n,event:o,priority:r})=>this.subscribe(n,o,r))}unsubscribe(e){this.subscriptions.delete(e)}unsubsribeMultiple(e){e.forEach(this.unsubscribe)}publish(e){Array.from(this.subscriptions.values()).sort((n,o)=>o.priority-n.priority).filter(({name:n,priority:o})=>!Array.from(this.blacklistFilters.values()).some(s=>s(e,n,o))).map(({event:n})=>n).forEach(n=>n(e))}clear(){this.subscriptions.clear()}get size(){return this.subscriptions.size}get isEmpty(){return this.size===0}}class P extends _t{constructor(e){super(),this.nodeflowData=e}}class xe extends _t{}class rn{constructor(e){this.nodeflowData=e,this.store=K({heldKeys:new Set})}get heldKeys(){return this.store[0].heldKeys}set heldKeys(e){this.store[1]({heldKeys:e})}releaseKey(e){this.store[1](Le(n=>n.heldKeys.delete(e)))}clearKeys(){this.store[1]({heldKeys:new Set})}pressKey(e){this.store[1](Le(n=>n.heldKeys.add(e)))}isActionPressed(e){return!de(ae(this.heldKeys,e))}}class cn{constructor(e){this.nodeflowData=e,this.store=K({clickStartPosition:void 0,mousePosition:u.zero(),pointerDown:!1,selections:new T})}serialize(){const e=this.store[0].selections.map(n=>{switch(n.type){case"connector":return{connectorId:n.connector.id,nodeId:n.connector.parentNode.id,type:"connector"};case"node":return{nodeId:n.node.id,type:"node"};case"connection":return{connection:{destinationConnectorId:n.connection.destinationConnector.id,destinationNodeId:n.connection.destinationConnector.parentSection.parentNode.id,sourceConnectorId:n.connection.sourceConnector.id,sourceNodeId:n.connection.sourceConnector.parentNode.id},type:"connection"};default:return{type:"nodeflow"}}});return{clickStartPosition:this.clickStartPosition?.serialize(),selections:e}}deserialize(e){const n=e.selections.map(o=>{if(o.type==="connector"){const r=this.nodeflowData.nodes.get(o.nodeId);if(!r)return;const s=r.getConnector(o.connectorId);return s?{connector:s,type:"connector"}:void 0}else if(o.type==="node"){const r=this.nodeflowData.nodes.get(o.nodeId);return r?{node:r,type:"node"}:void 0}else if(o.type==="connection"){const r=this.nodeflowData.nodes.get(o.connection.sourceNodeId);if(!r)return;const s=r.getConnector(o.connection.sourceConnectorId);if(!s)return;const i=this.nodeflowData.nodes.get(o.connection.destinationNodeId);if(!i)return;const c=i.getConnector(o.connection.destinationConnectorId);return c?{connection:{destinationConnector:c,sourceConnector:s},type:"connection"}:void 0}else return{type:"nodeflow"}}).filter(Boolean);this.update({clickStartPosition:u.deserializeOrDefault(e.clickStartPosition),selections:new T(n)})}get clickStartPosition(){return this.store[0].clickStartPosition}get isDraggingObject(){return this.store[0].pointerDown}get selections(){return this.store[0].selections}get heldConnections(){return this.store[0].selections.filter(e=>e.type==="connection")}get heldConnectors(){return this.store[0].selections.filter(e=>e.type==="connector")}get heldNodes(){return this.store[0].selections.filter(e=>e.type==="node")}get mousePosition(){return this.store[0].mousePosition}get pointerDown(){return this.store[0].pointerDown}set clickStartPosition(e){this.store[1]({clickStartPosition:e})}set mousePosition(e){this.store[1]({mousePosition:e})}set pointerDown(e){this.store[1]({pointerDown:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}reset(e=!1){this.update({clickStartPosition:void 0,pointerDown:e,selections:new T})}selectNodeflow(){this.hasSelectedNodeflow()&&this.selections.filterInPlace(e=>e.type!=="nodeflow"),this.selections.push({type:"nodeflow"})}selectNode=(e,n,o=!0)=>{if(!this.nodeflowData.nodes.has(e))return;const r=this.nodeflowData.nodes.get(e);this.hasSelectedNode(e)&&this.selections.filterInPlace(s=>s.type!=="node"||s.node.id!==e),this.selections.push({node:r,type:"node"}),this.update({pointerDown:o,mousePosition:n,clickStartPosition:n.divideBy(this.nodeflowData.zoomLevel).subtract(this.nodeflowData.nodes.get(e).position)})};clearSelections=()=>{this.store[1]("selections",new T),this.nodeflowData.resetMovement()};startCreatingConnection=(e,n,o)=>{if(!this.nodeflowData.settings.canCreateConnections)return;const r=this.nodeflowData.nodes.get(e);if(!r)return;const s=r.getConnector(o);s&&this.update({pointerDown:!0,selections:new T([{connector:s,type:"connector"}]),mousePosition:n,clickStartPosition:n.divideBy(this.nodeflowData.zoomLevel).subtract(r.position)})};clearSelectedByType(e){this.store[0].selections.filterInPlace(n=>n.type!==e)}hasSelectedNodeflow(){return this.store[0].selections.some(e=>e.type==="nodeflow")}hasSelectedNode(e){return this.store[0].selections.some(n=>n.type==="node"&&n.node.id===e)}hasSelectedConnector(e){return this.store[0].selections.some(n=>n.type==="connector"&&n.connector.id===e)}hasSelectedConnection(e,n,o,r){return this.store[0].selections.some(s=>s.type==="connection"&&s.connection.sourceConnector.id===n&&s.connection.sourceConnector.parentNode.id===e&&s.connection.destinationConnector.id===r&&s.connection.destinationConnector.parentNode.id===o)}globalMousePosition=()=>this.mousePosition.subtract(this.nodeflowData.startPosition).divideBy(this.nodeflowData.zoomLevel).subtract(this.nodeflowData.position)}const[Ie,an]=Q(u.of(window.innerWidth,window.innerHeight));ze(()=>{const t=()=>an(u.of(window.innerWidth,window.innerHeight));return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)});const Oe=(t,e,n)=>Math.min(Math.max(t,e),n);class We{constructor(e,n){this.nodeflowData=e,this.store=K(n)}get nodeflow(){return this.nodeflowData}get centered(){return this.store[0].centered}get connectorSections(){return this.store[0].connectorSections}get css(){return this.store[0].css}get customData(){return this.store[0].customData}get display(){return this.store[0].display}get id(){return this.store[0].id}get offset(){return this.store[0].offset}get position(){return this.store[0].position}get ref(){return this.store[0].ref}get resizeObserver(){return this.store[0].resizeObserver}get size(){return this.store[0].size}set centered(e){this.store[1]({centered:e})}set connectorSections(e){this.store[1]({connectorSections:e})}set css(e){this.store[1]({css:e})}set customData(e){this.store[1]({customData:e})}set display(e){this.store[1]({display:e})}set id(e){this.store[1]({id:e})}set offset(e){this.store[1]({offset:e})}set position(e){this.store[1]({position:e})}set ref(e){this.store[1]({ref:e})}set resizeObserver(e){this.store[1]({resizeObserver:e})}set size(e){this.store[1]({size:e})}update(e){this.store[1](e)}serialize(){const e=Array.from(this.connectorSections.values()).reduce((n,o)=>(n[o.id]=o.serialize(),n),{});return{centered:this.centered,connectorSections:e,css:U(this.css),customData:U(this.customData),id:this.id,display:this.display,position:this.position.serialize()}}static deserialize(e,n,o=!0){const r=n.id??e.getNextFreeNodeId(),s=new We(e,{centered:n.centered??!1,connectorSections:new ue,css:U(n.css)??{},customData:U(n.customData)??{},display:n.display??(()=>{}),id:r,offset:u.zero(),position:u.deserializeOrDefault(n.position),ref:void 0,resizeObserver:void 0,size:u.zero()}),i=A.evaluateHistoryGroup(o);return Object.entries(n.connectorSections??[]).forEach(([c,a])=>{s.addConnectorSection(c,a.css,i),Object.values(a.connectors).forEach(l=>{s.addConnector(c,l,i)})}),s}serializeConnections(){return Array.from(this.connectorSections.values()).flatMap(e=>Array.from(e.connectors.values()).flatMap(n=>n.serializeConnections()))}updateWithPrevious(e){this.store[1](e)}addConnectorSection(e,n,o=!0){(!e||this.connectorSections.has(e))&&(e=this.getNextFreeConnectorSectionId());const r=A.evaluateHistoryGroup(o);if(r){const i=this.nodeflowData.id,c=this.id;this.nodeflowData.changes.addChange({type:"remove",source:"connector-section",applyChange:()=>{D.get().getNodeflow(i)?.nodes.get(c)?.addConnectorSection(e,n,!1)},undoChange:()=>{D.get().getNodeflow(i)?.nodes.get(c)?.removeConnectorSection(e,!1)},historyGroup:r})}const s=new on(this.nodeflowData,{connectors:new ue,css:n,id:e,parentNode:this});return this.connectorSections.set(e,s),s}removeConnectorSection(e,n=!0){if(!this.connectorSections.has(e))return;const o=this.connectorSections.get(e),r=A.evaluateHistoryGroup(n);if(r){const s=this.nodeflowData.id,i=o.css,c=this.id;this.nodeflowData.changes.addChange({type:"remove",source:"connector-section",applyChange:()=>{D.get().getNodeflow(s)?.nodes.get(c)?.removeConnectorSection(e,!1)},undoChange:()=>{D.get().getNodeflow(s)?.nodes.get(c)?.addConnectorSection(e,i,!1)},historyGroup:r})}this.connectorSections.delete(e)}getConnectorCount(){return Array.from(this.connectorSections.values()).reduce((e,n)=>e+n.connectors.size,0)}addConnector(e,n,o=!0){if(this.connectorSections.has(e))return this.connectorSections.get(e).addConnector(n,o)}removeConnector(e,n,o=!0){this.connectorSections.has(e)&&this.connectorSections.get(e).removeConnector(n,o)}getConnector(e){return this.getSectionFromConnector(e)?.connectors.get(e)}getTotalConnectedInputs(e){return this.getConnector(e)?.sources.length??0}getAllConnectors(){return Array.from(this.connectorSections.values()).reduce((e,n)=>e.concat(Array.from(n.connectors.values())),[])}getNextFreeConnectorSectionId(){let e="0";for(let n=1;this.connectorSections.has(e);++n)e=n.toString();return e}getNextFreeConnectorId(){let e="0";for(let n=1;Array.from(this.connectorSections.values()).some(o=>o.connectors.has(e));++n)e=n.toString();return e}removeIncomingConnections(){this.connectorSections.forEach(e=>e.removeIncomingConnections())}removeOutgoingConnections(){this.connectorSections.forEach(e=>e.removeOutgoingConnections())}getAllSourceConnectors(){return Array.from(this.connectorSections.values()).reduce((e,n)=>e.concat(n.getSourceConnectors()),[])}getAllDestinationConnectors(){return Array.from(this.connectorSections.values()).reduce((e,n)=>e.concat(n.getDestinationConnectors()),[])}getAllSourceConnections(){return this.getAllSourceConnectors().map(e=>e.destinations.filter(o=>o.destinationConnector.parentNode.id===this.id).map(o=>({sourceNodeId:e.parentNode.id,sourceConnectorId:e.id,destinationNodeId:o.destinationConnector.parentNode.id,destinationConnectorId:o.destinationConnector.id,css:o.css}))).flat()}getAllDestinationConnections(){return this.getAllDestinationConnectors().map(e=>e.sources.filter(o=>o.sourceConnector.parentNode.id===this.id).map(o=>({sourceNodeId:o.sourceConnector.parentNode.id,sourceConnectorId:o.sourceConnector.id,destinationNodeId:e.parentNode.id,destinationConnectorId:e.id}))).flat()}getSectionFromConnector(e){return Array.from(this.connectorSections.values()).find(n=>n.connectors.get(e))}getCenter(){return this.position.add(this.offset).add(this.size.divideBy(2))}select(e){this.nodeflowData.selectNode(this.id,e)}}const ie={LEFT:0,MIDDLE:1,RIGHT:2,BACK:3,FORWARD:4};class Ue{static DEFAULT_SETTINGS={canAddNodes:!0,canCreateConnections:!0,canDeleteConnections:!0,canDeleteNodes:!0,canMoveNodes:!0,canPan:!0,canZoom:!0,debugMode:!1,keyboardZoomMultiplier:15,maxMovementSpeed:15,maxZoom:200,minZoom:.02,movementAcceleration:1.5,movementSlowdown:.85,zoomMultiplier:.005};keymap={MOVE_DOWN:new Set(["ArrowDown","KeyS"]),MOVE_LEFT:new Set(["ArrowLeft","KeyA"]),MOVE_RIGHT:new Set(["ArrowRight","KeyD"]),MOVE_UP:new Set(["ArrowUp","KeyW"]),SELECT_MULTIPLE:new Set(["ShiftLeft","ShiftRight"])};constructor(e,n,o){this.id=e,this.settingsStore=K({...Ue.DEFAULT_SETTINGS,...n}),this.curveFunctions=o?.(this)??new St(this),this.store=K({currentMoveSpeed:u.zero(),position:u.zero(),startPosition:u.zero(),size:u.zero(),zoomLevel:1,pinchDistance:0}),this.changes=new A,this.mouseData=new cn(this),this.keyboardData=new rn(this),this.nodes=new ue,this.eventStore={onKeyDownInNodeflow:new P(this),onKeyUpInNodeflow:new P(this),onMouseDownInConnector:new P(this),onMouseDownInNodeflow:new P(this),onMouseDownInNode:new P(this),onMouseMoveInNodeflow:new P(this),onNodeConnected:new P(this),onNodeDataChanged:new P(this),onPointerDownInNodeCurve:new P(this),onPointerUpInConnector:new P(this),onPointerUpInNodeflow:new P(this),onPointerUpInNode:new P(this),onTouchMoveInNodeflow:new P(this),onTouchStartInConnector:new P(this),onTouchStartInNodeflow:new P(this),onTouchStartInNode:new P(this),onWheelInNodeflow:new P(this)},this.setupDefaultEventHandlers(),setInterval(()=>{const r=!de(ae(this.keyboardData.heldKeys,this.keymap.MOVE_LEFT)),s=!de(ae(this.keyboardData.heldKeys,this.keymap.MOVE_RIGHT)),i=!de(ae(this.keyboardData.heldKeys,this.keymap.MOVE_UP)),c=!de(ae(this.keyboardData.heldKeys,this.keymap.MOVE_DOWN)),a=this.mouseData.heldNodes.length>0;this.currentMoveSpeed=u.of(this.calculateDirectionalMovementAmount(r||s,this.currentMoveSpeed.x,s,r,!a),this.calculateDirectionalMovementAmount(i||c,this.currentMoveSpeed.y,c,i,!a)),!(this.currentMoveSpeed.x===0&&this.currentMoveSpeed.y===0)&&(this.settings.canPan&&!a?this.updateBackgroundPosition(this.currentMoveSpeed,!0):a&&this.settings.canMoveNodes&&this.updateHeldNodePosition(this.currentMoveSpeed.divideBy(this.zoomLevel)))},10)}serialize(){return{changes:this.changes.serialize(),connections:this.serializeConnections(),currentMoveSpeed:this.currentMoveSpeed.serialize(),mouseData:this.mouseData.serialize(),nodes:Object.fromEntries(Array.from(this.nodes.entries()).map(([e,n])=>[e,n.serialize()])),pinchDistance:this.pinchDistance,position:this.position.serialize(),size:this.size.serialize(),startPosition:this.startPosition.serialize(),zoomLevel:this.zoomLevel}}deserialize(e,n=!1){this.update({currentMoveSpeed:u.deserializeOrDefault(e.currentMoveSpeed),pinchDistance:e.pinchDistance,position:u.deserializeOrDefault(e.position),size:u.deserializeOrDefault(e.size),startPosition:u.deserializeOrDefault(e.startPosition),zoomLevel:e.zoomLevel});const o=A.evaluateHistoryGroup(n);this.nodes.clear(),Object.values(e.nodes).forEach(r=>{this.addNode(r,o)}),this.mouseData.deserialize(e.mouseData),e.connections.forEach(r=>{this.addConnection(r,o)}),this.changes.deserialize(e.changes)}serializeConnections(){return Array.from(this.nodes.values()).flatMap(e=>e.serializeConnections())}get settings(){return this.settingsStore[0]}updateSettings(e){this.settingsStore[1](e)}resetMovement=()=>{this.currentMoveSpeed=u.zero(),this.keymap.MOVE_LEFT.forEach(e=>this.keyboardData.releaseKey(e)),this.keymap.MOVE_RIGHT.forEach(e=>this.keyboardData.releaseKey(e)),this.keymap.MOVE_UP.forEach(e=>this.keyboardData.releaseKey(e)),this.keymap.MOVE_DOWN.forEach(e=>this.keyboardData.releaseKey(e))};get currentMoveSpeed(){return this.store[0].currentMoveSpeed}get position(){return this.store[0].position}get startPosition(){return this.store[0].startPosition}get size(){return this.store[0].size}get zoomLevel(){return this.store[0].zoomLevel}get pinchDistance(){return this.store[0].pinchDistance}set currentMoveSpeed(e){this.store[1]({currentMoveSpeed:e})}set position(e){this.store[1]({position:e})}set startPosition(e){this.store[1]({startPosition:e})}set size(e){this.store[1]({size:e})}set zoomLevel(e){this.store[1]({zoomLevel:e})}set pinchDistance(e){this.store[1]({pinchDistance:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}center(){const n=Ie().divideBy(2);return this.startPosition.add(n).divideBy(this.zoomLevel).subtract(this.position)}calculateDirectionalMovementAmount(e,n,o,r,s=!1){let i=n;if(e){const c=this.settings.movementAcceleration*(s?-1:1);i=Oe(i+(o?c:0)-(r?c:0),-this.settings.maxMovementSpeed,this.settings.maxMovementSpeed)}else i=Oe(i*this.settings.movementSlowdown,-this.settings.maxMovementSpeed,this.settings.maxMovementSpeed);return i<=.1&&i>=-.1&&(i=0),i}updateZoom=(e,n)=>{const o=this.zoomLevel;if(e===0)return;const r=Number(Oe(e>0?o+o*e*this.settings.zoomMultiplier:o/(1-e*this.settings.zoomMultiplier),this.settings.minZoom,this.settings.maxZoom).toFixed(4));this.mouseData.pointerDown=!1;const s=this.size,i=n.subtract(this.startPosition),c=s.multiplyBy(o),a=s.multiplyBy(r),l=i.subtract(c.divideBy(2)).divideBy(o),d=i.subtract(a.divideBy(2)).divideBy(r);this.updateWithPrevious(f=>({position:f.position.subtract(l).add(d),zoomLevel:r}))};updateBackgroundPosition(e,n=!1){!this.mouseData.hasSelectedNodeflow()||n===this.mouseData.isDraggingObject||this.updateWithPrevious(o=>({position:o.position.add(e.divideBy(this.zoomLevel))}))}addNode(e,n=!0){const o=A.evaluateHistoryGroup(n),r=We.deserialize(this,e,o);if(this.nodes.set(r.id,r),o){const s=r.serializeConnections(),i=r.serialize(),c=this.id;this.changes.addChange({type:"add",source:"node",applyChange:()=>{const a=D.get().getNodeflow(c);a?.addNode(i,!1),s.forEach(l=>{a?.addConnection(l,!1)})},undoChange:()=>{D.get().getNodeflow(c)?.removeNode(r.id,!1)},historyGroup:o})}return r}updateNode(e,n,o=!0){if(!this.nodes.has(e))return;const r=this.nodes.get(e),s=A.evaluateHistoryGroup(o);if(s){const i=this.nodes.get(e),c=i.serialize(),a=i.serializeConnections(),l=this.id,d=Object.entries(c).reduce((f,[h,m])=>(h in n&&Object.assign(f,{[h]:U(m)}),f),{});this.changes.addChange({type:"update",source:"node",applyChange:()=>{D.get().getNodeflow(l)?.updateNode(e,n,!1)},undoChange:()=>{const f=D.get().getNodeflow(l);f?.updateNode(e,d,!1),a.forEach(h=>{f?.addConnection(h,!1)})},historyGroup:s})}r.updateWithPrevious(Le(i=>Object.assign(i,n))),this.eventStore.onNodeDataChanged.publish({nodeId:e,data:n})}removeNode(e,n=!0){if(!this.nodes.has(e))return;this.mouseData.clearSelections();const o=A.evaluateHistoryGroup(n);if(o){const r=this.nodes.get(e),s=r.serializeConnections(),i=this.id;this.changes.addChange({type:"remove",source:"node",applyChange:()=>{D.get().getNodeflow(i)?.removeNode(e,!1)},undoChange:()=>{const c=D.get().getNodeflow(i);c?.addNode(r.serialize(),!1),s.forEach(a=>{c?.addConnection(a,!1)})},historyGroup:o})}this.removeIncomingConnections(e),this.removeOutgoingConnections(e),this.nodes.delete(e)}removeIncomingConnections(e){this.nodes.has(e)&&this.nodes.get(e).connectorSections.forEach(n=>{n.connectors.forEach(o=>{o.sources.forEach(({sourceConnector:r})=>{r.destinations.filterInPlace(({destinationConnector:s})=>s.parentNode.id!==e)}),o.sources=new T})})}removeOutgoingConnections(e){this.nodes.has(e)&&this.nodes.get(e).connectorSections.forEach(n=>{n.connectors.forEach(o=>{o.destinations.forEach(({destinationConnector:r})=>{r.sources.filterInPlace(({sourceConnector:s})=>s.parentNode.id!==e)}),o.destinations=new T})})}getAllSourceConnectors(e){return this.nodes.has(e)?this.nodes.get(e).getAllSourceConnectors():[]}getAllDestinationConnectors(e){return this.nodes.has(e)?this.nodes.get(e).getAllDestinationConnectors():[]}getAllSourceConnections(e){return this.nodes.has(e)?this.nodes.get(e).getAllSourceConnections():[]}getAllDestinationConnections(e){return this.nodes.has(e)?this.nodes.get(e).getAllDestinationConnections():[]}getNextFreeNodeId(){let e="0";for(let n=1;this.nodes.has(e);++n)e=n.toString();return e}addConnection(e,n=!0){const{sourceNodeId:o,sourceConnectorId:r,destinationNodeId:s,destinationConnectorId:i,css:c}=e;if(!this.nodes.has(o)||!this.nodes.has(s))return;const a=this.nodes.get(o),l=this.nodes.get(s),d=a.getConnector(r),f=l.getConnector(i);if(!d||!f||d.destinations.some(m=>m.destinationConnector===f))return;const h=A.evaluateHistoryGroup(n);if(h){const m=this.id;this.changes.addChange({type:"add",source:"connection",applyChange:()=>this.addConnection(e,!1),undoChange:()=>D.get().getNodeflow(m)?.removeConnection(o,r,s,i,!1),historyGroup:h})}d.destinations.push(new nn({destinationConnector:f,css:c??{}})),f.sources.push(new sn({sourceConnector:d}))}removeConnection(e,n,o,r,s=!0){if(!this.nodes.has(e)||!this.nodes.has(o))return;const i=this.nodes.get(e),c=this.nodes.get(o),a=i.getConnector(n),l=c.getConnector(r);if(!a||!l)return;const d=A.evaluateHistoryGroup(s);if(d){const f=a.destinations.find($=>$.destinationConnector.parentNode.id===o)?.css,h=this.id,m=()=>{D.get().getNodeflow(h)?.addConnection({sourceNodeId:e,sourceConnectorId:n,destinationNodeId:o,destinationConnectorId:r,css:f},!1)},g=()=>{D.get().getNodeflow(h)?.removeConnection(e,n,o,r,!1)};this.changes.addChange({type:"remove",source:"connection",applyChange:g,undoChange:m,historyGroup:d})}a.destinations.filterInPlace(f=>f.destinationConnector.parentNode.id!==o),l.sources.filterInPlace(f=>f.sourceConnector.parentNode.id!==e)}updateHeldNodePosition(e){this.mouseData.heldNodes.forEach(n=>n.node.updateWithPrevious(o=>({position:o.position.add(e)})))}setupDefaultEventHandlers(){this.eventStore.onNodeConnected.subscribeMultiple([{name:"nodeflow:create-connection",event:e=>this.addConnection({sourceNodeId:e.inputNodeId,sourceConnectorId:e.inputId,destinationNodeId:e.outputNodeId,destinationConnectorId:e.outputId})},{name:"nodeflow:reset-mouse-data",event:()=>this.mouseData.reset()}]),this.eventStore.onMouseMoveInNodeflow.subscribeMultiple([{name:"nodeflow:update-background-position",event:({event:e})=>{this.updateBackgroundPosition(u.of(e.movementX,e.movementY))}}]),this.eventStore.onPointerUpInNodeflow.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>{e.stopPropagation(),e.preventDefault()}},{name:"nodeflow:reset-mouse-data",event:()=>{this.mouseData.pointerDown=!1,this.mouseData.heldConnectors.length===1&&this.mouseData.clearSelectedByType("node"),this.mouseData.clearSelectedByType("connector")}}]),this.eventStore.onTouchStartInNodeflow.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()},{name:"nodeflow:clear-held-keys",event:({event:e})=>{e.touches.length===1&&this.keyboardData.clearKeys()}},{name:"nodeflow:handle-pinch",event:({event:e})=>{const{touches:n}=e;if(n.length!==2)return;const{pageX:o,pageY:r}=e.touches[0],{pageX:s,pageY:i}=e.touches[1];this.pinchDistance=Math.hypot(o-s,r-i)}},{name:"nodeflow:update-mouse-data",event:({event:e})=>{const{touches:n}=e;if(n.length!==1)return;const o=n[0],r=u.fromEvent(o);this.mouseData.clearSelectedByType("node"),this.mouseData.update({pointerDown:!0,mousePosition:r,clickStartPosition:u.of(r.x/this.zoomLevel-this.position.x,r.y/this.zoomLevel-this.position.y)})}}]),this.eventStore.onTouchMoveInNodeflow.subscribeMultiple([{name:"nodeflow:handle-pinch",event:({event:e})=>{const{touches:n}=e;if(n.length!==2)return;const{pageX:o,pageY:r}=n[0],{pageX:s,pageY:i}=n[1],c=Math.hypot(o-s,r-i),a=u.of((o+s)/2,(r+i)/2);this.settings.canZoom&&this.updateZoom(c-this.pinchDistance,a),this.pinchDistance=c}},{name:"nodeflow:update-mouse-data",event:({event:e})=>{const{touches:n}=e;n.length===1&&this.mouseData.updateWithPrevious(o=>{const r=u.fromEvent(n[0]);return this.updateBackgroundPosition(r.subtract(o.mousePosition)),{mousePosition:r}})}}]),this.eventStore.onKeyUpInNodeflow.subscribe("nodeflow:remove-held-key",({event:e})=>this.keyboardData.releaseKey(e.code)),this.eventStore.onKeyDownInNodeflow.subscribeMultiple([{name:"nodeflow:add-held-key",event:({event:e})=>this.keyboardData.pressKey(e.code),priority:10},{name:"nodeflow:handle-controls",event:({event:e})=>{switch(e.code){case"Delete":if(this.mouseData.heldNodes.length>0&&this.settings.canDeleteNodes){const n=A.evaluateHistoryGroup();this.mouseData.heldNodes.forEach(o=>this.removeNode(o.node.id,n))}else if(this.mouseData.heldConnections.length>0&&this.settings.canDeleteConnections){const n=A.evaluateHistoryGroup();this.mouseData.heldConnections.forEach(o=>this.removeConnection(o.connection.sourceConnector.parentNode.id,o.connection.sourceConnector.id,o.connection.destinationConnector.parentSection.parentNode.id,o.connection.destinationConnector.id,n))}break;case"Escape":this.mouseData.clearSelections();break;case"Space":this.settings.debugMode&&(this.mouseData.heldNodes.length>0?console.log(this.mouseData.heldNodes):console.log(this.nodes));break;case"Equal":case"Minus":if(e.ctrlKey){if(!this.settings.canZoom)return;e.preventDefault(),this.updateZoom(this.settings.keyboardZoomMultiplier*(e.code==="Equal"?1:-1),Ie().divideBy(2))}break;case"KeyZ":if(!e.ctrlKey)break;e.preventDefault(),e.shiftKey?this.changes.redo():this.changes.undo();break}}}]),this.eventStore.onWheelInNodeflow.subscribeMultiple([{name:"nodeflow:update-zoom",event:({event:e})=>{this.settings.canZoom&&this.updateZoom(-e.deltaY,u.fromEvent(e))}},{name:"nodeflow:prevent-scroll",event:({event:e})=>{e.preventDefault()}}]),this.eventStore.onMouseDownInNodeflow.subscribeMultiple([{name:"nodeflow:reset-movement",event:({event:e})=>{e.button===ie.LEFT&&this.resetMovement()}},{name:"nodeflow:reset-mouse-data",event:({event:e})=>{e.button===ie.LEFT&&this.mouseData.clearSelections(),this.mouseData.selectNodeflow(),this.mouseData.update({clickStartPosition:u.of(e.clientX/this.zoomLevel-this.position.x,e.clientY/this.zoomLevel-this.position.y),pointerDown:this.settings.canPan,mousePosition:u.fromEvent(e)})}},{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()}]),this.eventStore.onMouseDownInConnector.blacklist("nodeflow:allow-pan",(e,n)=>e.event.button!==ie.LEFT&&n.startsWith("nodeflow")),this.eventStore.onMouseDownInConnector.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()},{name:"nodeflow:start-creating-connection",event:({event:e,nodeId:n,connectorId:o})=>{this.mouseData.startCreatingConnection(n,u.fromEvent(e),o)}}]),this.eventStore.onTouchStartInConnector.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()},{name:"nodeflow:start-creating-connection",event:({event:e,nodeId:n,connectorId:o})=>{const{clientX:r,clientY:s}=e.touches[0];this.mouseData.startCreatingConnection(n,u.of(r,s),o)}}]),this.eventStore.onPointerUpInConnector.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>{e.preventDefault(),e.stopPropagation()},priority:2},{name:"nodeflow:connect-held-nodes",event:({event:e,nodeId:n,connectorId:o})=>{if(!this.settings.canCreateConnections)return;const r=this.mouseData.heldConnectors.at(-1)?.connector,s=r?.parentNode;!r||!s||this.eventStore.onNodeConnected.publish({outputNodeId:s.id,outputId:r.id,inputNodeId:n,inputId:o,event:e})},priority:2},{name:"nodeflow:reset-mouse-data",event:()=>{this.mouseData.pointerDown=!1},priority:1}]),this.eventStore.onMouseDownInNode.blacklist("nodeflow:allow-pan",(e,n)=>e.event.button!==ie.LEFT&&n.startsWith("nodeflow")),this.eventStore.onMouseDownInNode.subscribeMultiple([{name:"nodeflow:select-node",event:({event:e,nodeId:n})=>{this.keyboardData.isActionPressed(this.keymap.SELECT_MULTIPLE)||this.mouseData.clearSelections(),this.mouseData.selectNode(n,u.fromEvent(e),this.settings.canMoveNodes)}},{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()}]),this.eventStore.onTouchStartInNode.subscribeMultiple([{name:"nodeflow:select-node",event:({event:e,nodeId:n})=>{const{clientX:o,clientY:r}=e.touches[0];this.keyboardData.isActionPressed(this.keymap.SELECT_MULTIPLE)||this.mouseData.clearSelections(),this.mouseData.selectNode(n,u.of(o,r),this.settings.canMoveNodes)}},{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()}]),this.eventStore.onPointerDownInNodeCurve.blacklist("nodeflow:allow-pan",(e,n)=>e.event.button!==ie.LEFT&&n.startsWith("nodeflow")),this.eventStore.onPointerDownInNodeCurve.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>{e.preventDefault(),e.stopPropagation()},priority:1},{name:"nodeflow:update-mouse-data",event:({event:e,sourceConnector:n,destinationConnector:o})=>{this.mouseData.pointerDown=!0,this.mouseData.mousePosition=u.fromEvent(e),this.keyboardData.isActionPressed(this.keymap.SELECT_MULTIPLE)||this.mouseData.clearSelections(),this.mouseData.selections.push({type:"connection",connection:{sourceConnector:n,destinationConnector:o}})}}]),this.eventStore.onPointerUpInNode.subscribeMultiple([{name:"nodeflow:reset-mouse-data",event:()=>{this.mouseData.pointerDown=!1,this.mouseData.heldConnectors.length===1&&this.mouseData.clearSelectedByType("node"),this.mouseData.clearSelectedByType("connector")}},{name:"nodeflow:stop-propagation",event:({event:e})=>{e.stopPropagation(),e.preventDefault()}}])}selectNode(e,n){this.mouseData.selectNode(e,n??u.zero(),!1)}}const dn="_fatherCurve_12xj5_1",ln="_motherCurve_12xj5_15",un="_selectedFatherCurve_12xj5_29",hn="_selectedMotherCurve_12xj5_40",fn="_newFatherCurve_12xj5_51",gn="_newMotherCurve_12xj5_62",ee={fatherCurve:dn,motherCurve:ln,selectedFatherCurve:un,selectedMotherCurve:hn,newFatherCurve:fn,newMotherCurve:gn},pn="_nodeflow_1mhat_1",vn={nodeflow:pn},mn="_femaleNode_1r50o_1",yn="_maleNode_1r50o_25",Cn="_selectedMaleNode_1r50o_49",wn="_selectedFemaleNode_1r50o_72",Dn="_inputConnector_1r50o_95",bn="_maleOutputConnector_1r50o_110",Sn="_femaleOutputConnector_1r50o_126",_n="_inputsSection_1r50o_142",Nn="_outputsSection_1r50o_151",$n="_nodeFont_1r50o_160",k={femaleNode:mn,maleNode:yn,selectedMaleNode:Cn,selectedFemaleNode:wn,inputConnector:Dn,maleOutputConnector:bn,femaleOutputConnector:Sn,inputsSection:_n,outputsSection:Nn,nodeFont:$n},In=w("<p>"),Mn=t=>(()=>{const e=In();return C(e,()=>t.node.customData?.name),b(()=>y(e,k.nodeFont)),e})(),Nt=async t=>await(await fetch(`https://randomuser.me/api/?inc=gender,name&noinfo&results=${t}`)).json().then(n=>n.results).then(n=>n.map(o=>({gender:o.gender==="female"?"F":"M",name:o.name.first+" "+o.name.last}))),pe=t=>({normal:t=="M"?ee.fatherCurve:ee.motherCurve,selected:t=="M"?ee.selectedFatherCurve:ee.selectedMotherCurve}),Re=(t,e,n,o)=>{const r=e,s=t.addNode({css:{normal:n==="M"?k.maleNode:k.femaleNode,selected:n==="M"?k.selectedMaleNode:k.selectedFemaleNode},position:o,customData:{gender:n,name:e},display:Mn,centered:!0},r),i=s.addConnectorSection("inputs",k.inputsSection,r);return s.addConnectorSection("outputs",k.outputsSection,r).addConnector({id:"O",css:n==="M"?k.maleOutputConnector:k.femaleOutputConnector},r),i.addConnector({id:"I",css:k.inputConnector},r),s},Pn=async(t,e=50)=>{const n=await Nt(e);for(const o of n)Re(t,o.name,o.gender,u.of((Math.random()*2-1)*2e3,(Math.random()*2-1)*2e3))},zn=t=>{t.eventStore.onPointerUpInConnector.blacklist("familytree-app:prevent-connections-to-parent-connectors",({connectorId:e},n)=>e==="O"&&n==="nodeflow:connect-held-nodes"),t.eventStore.onTouchStartInConnector.blacklist("familytree-app:prevent-connections-from-parent-connectors",({connectorId:e})=>e==="I"),t.eventStore.onMouseDownInConnector.blacklist("familytree-app:prevent-connections-from-parent-connectors",({connectorId:e})=>e==="I"),t.eventStore.onPointerUpInNodeflow.subscribe("familytree-app:spawn-new-node",()=>{const e=t.mouseData.heldConnectors;if(e.length!==1)return;const n=e[0].connector.parentNode,o=t.mouseData.globalMousePosition();Nt(1).then(r=>{const s=Re(t,r[0].name,r[0].gender,o);t.addConnection({sourceNodeId:n.id,sourceConnectorId:"O",destinationNodeId:s.id,destinationConnectorId:"I",css:pe(n.customData.gender)})})},1),t.eventStore.onNodeConnected.subscribe("nodeflow:create-connection",({outputNodeId:e,inputNodeId:n})=>{const o=t.nodes.get(e),r=t.nodes.get(n);if(e===n)return;const s=r.getConnector("I")?.sources;s?.length===2||s?.some(i=>i.sourceConnector.parentNode.customData.gender===o.customData.gender)||t.addConnection({sourceNodeId:e,sourceConnectorId:"O",destinationNodeId:n,destinationConnectorId:"I",css:pe(o.customData.gender)})}),t.eventStore.onPointerUpInNode.subscribe("nodeflow:create-connection",({nodeId:e})=>{const n=t.nodes.get(e);if(!n||t.mouseData.heldConnectors.length!==1)return;const o=t.mouseData.heldConnectors[0].connector.parentSection.parentNode;if(e===o.id)return;const r=n.getConnector("I")?.sources;r?.length===2||r?.some(s=>s.sourceConnector.parentNode.customData.gender===o.customData.gender)||t.addConnection({sourceNodeId:o.id,sourceConnectorId:"O",destinationNodeId:e,destinationConnectorId:"I",css:pe(o.customData.gender)})},2)},En=t=>{const e=t.nodes.size;for(let n=0;n<e;n++){const o=Math.floor(Math.random()*e),r=Math.floor(Math.random()*e);if(!t.nodes.has(o.toString())||!t.nodes.has(r.toString()))continue;const s=t.nodes.get(o.toString()),i=t.nodes.get(r.toString()),c=s.customData.gender,a=i.getConnector("I")?.sources;o===r||a?.length===2||a?.some(l=>l.sourceConnector.parentNode.customData.gender===c)||t.addConnection({sourceNodeId:o.toString(),sourceConnectorId:"O",destinationNodeId:r.toString(),destinationConnectorId:"I",css:pe(s.customData.gender)})}},it=t=>t?t.trim().replace(/\s+/g," "):"",kn="_sidebar_o4wha_1",xn="_sidebarContent_o4wha_100",ve={"sidebar-container":"_sidebar-container_o4wha_1","sidebar-container-closed":"_sidebar-container-closed_o4wha_27",sidebar:kn,"sidebar-toggle":"_sidebar-toggle_o4wha_52","sidebar-toggle-closed":"_sidebar-toggle-closed_o4wha_77",sidebarContent:xn},On=""+new URL("right-arrow-890fb5bd.svg",import.meta.url).href,An=w('<div><div></div><img alt="Toggle sidebar">'),Fn=t=>{const[e,n]=Q(!1);return(()=>{const o=An(),r=o.firstChild,s=r.nextSibling;return C(r,()=>t.children),s.$$click=()=>n(!e()),z(s,"src",On),z(s,"draggable",!1),b(i=>{const c=ve[e()?"sidebar-container":"sidebar-container-closed"],a=ve.sidebar,l=ve[e()?"sidebar-toggle":"sidebar-toggle-closed"];return c!==i._v$&&y(o,i._v$=c),a!==i._v$2&&y(r,i._v$2=a),l!==i._v$3&&y(s,i._v$3=l),i},{_v$:void 0,_v$2:void 0,_v$3:void 0}),o})()};Y(["click"]);const Ln="_formButtonContainer_1ro6k_1",Tn="_displayContainer_1ro6k_9",Gn="_fieldDisplayContainer_1ro6k_37",Bn="_femaleFont_1ro6k_57",Kn="_maleFont_1ro6k_61",Wn="_radioInputFemale_1ro6k_65",Un="_radioInputMale_1ro6k_127",Rn="_horizontalRadioInput_1ro6k_189",jn="_horizontalRadioContainer_1ro6k_196",Hn="_parentDisplayContainer_1ro6k_204",Zn="_parentDisplay_1ro6k_204",Yn="_invalidParent_1ro6k_231",Xn="_validMother_1ro6k_235",Vn="_validFather_1ro6k_244",qn="_childrenDisplayContainer_1ro6k_253",Qn="_childrenDisplayWindow_1ro6k_280",Jn="_child_1ro6k_253",S={formButtonContainer:Ln,displayContainer:Tn,fieldDisplayContainer:Gn,femaleFont:Bn,maleFont:Kn,radioInputFemale:Wn,radioInputMale:Un,horizontalRadioInput:Rn,horizontalRadioContainer:jn,parentDisplayContainer:Hn,parentDisplay:Zn,invalidParent:Yn,validMother:Xn,validFather:Vn,childrenDisplayContainer:qn,childrenDisplayWindow:Qn,child:Jn},eo=w("<div>"),to=w("<div><h2>Selected Node</h2><div><p>Name</p><p></p></div><div><p>Gender</p><p></p></div><div><div><p>Mother</p><p></p></div><div><p>Father</p><p></p></div></div><div><p>Children"),no=w("<p>None"),oo=w("<p>"),so=t=>{const e=I(()=>t.nodeData.getAllSourceConnectors().map(s=>s.parentNode)),n=I(()=>e().find(s=>s.customData.gender==="F")),o=I(()=>e().find(s=>s.customData.gender==="M")),r=I(()=>t.nodeData.getAllDestinationConnectors().map(s=>s.parentNode).sort((s,i)=>s.customData.name.localeCompare(i.customData.name)));return(()=>{const s=to(),i=s.firstChild,c=i.nextSibling,a=c.firstChild,l=a.nextSibling,d=c.nextSibling,f=d.firstChild,h=f.nextSibling,m=d.nextSibling,g=m.firstChild,$=g.firstChild,F=$.nextSibling,B=g.nextSibling,O=B.firstChild,M=O.nextSibling,E=m.nextSibling;return E.firstChild,C(l,()=>t.nodeData.customData.name),C(h,()=>t.nodeData.customData.gender==="F"?"Female":"Male"),F.$$click=()=>{n()?.nodeflow.mouseData.clearSelections(),n()?.select()},C(F,()=>n()?.customData.name||"Unknown"),M.$$click=()=>{o()?.nodeflow.mouseData.clearSelections(),o()?.select()},C(M,()=>o()?.customData.name||"Unknown"),C(E,v(G,{get when(){return r()?.length>0},get fallback(){return no()},get children(){const p=eo();return C(p,v(V,{get each(){return r()},children:L=>(()=>{const X=oo();return X.$$click=()=>{L.nodeflow.mouseData.clearSelections(),L.select()},C(X,()=>L.customData.name),b(()=>y(X,S.child)),X})()})),b(()=>y(p,S.childrenDisplayWindow)),p}}),null),b(p=>{const L=S.displayContainer,X=S.fieldDisplayContainer,je=S.fieldDisplayContainer,He=S[t.nodeData.customData.gender==="F"?"femaleFont":"maleFont"],Ze=S.parentDisplayContainer,Ye=S.parentDisplay,$t={[S.validMother]:!!n(),[S.invalidParent]:!n()},Xe=S.parentDisplay,It={[S.validFather]:!!o(),[S.invalidParent]:!o()},Ve=S.childrenDisplayContainer;return L!==p._v$&&y(s,p._v$=L),X!==p._v$2&&y(c,p._v$2=X),je!==p._v$3&&y(d,p._v$3=je),He!==p._v$4&&y(h,p._v$4=He),Ze!==p._v$5&&y(m,p._v$5=Ze),Ye!==p._v$6&&y(g,p._v$6=Ye),p._v$7=be(F,$t,p._v$7),Xe!==p._v$8&&y(B,p._v$8=Xe),p._v$9=be(M,It,p._v$9),Ve!==p._v$10&&y(E,p._v$10=Ve),p},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0,_v$6:void 0,_v$7:void 0,_v$8:void 0,_v$9:void 0,_v$10:void 0}),s})()};Y(["click"]);const Me={MAIN_NODEFLOW:"main-nodeflow"},ro=w("<button>Add"),ct=w("<button>Save"),at=w("<button>Cancel"),io=w("<button>Edit"),dt=w("<button>Delete"),co=w("<div>"),lt=t=>(()=>{const e=ro();return e.$$click=()=>t.onClick(),e})(),ao=t=>{const e=D.get().getNodeflow(Me.MAIN_NODEFLOW),n=()=>t.setFormData({name:""}),o=()=>t.setFormData(void 0),r=()=>t.setFormData({...t.nodeData}),s=()=>{e.removeNode(t.formData.id),t.setFormData(void 0)},i=()=>e.removeNode(t.nodeData.id),c=()=>{if(!t.formData?.name||!t.formData?.gender)return;const l=Re(e,it(t.formData.name),t.formData.gender,e.center());e.mouseData.clearSelections(),l.select(l.getCenter()),t.setFormData(void 0)},a=()=>{const l=t.formData.id,d=e.nodes.get(l);if(d===void 0){t.setFormData(void 0);return}const f=d.customData,h=Object.fromEntries(Object.entries(t.formData).map(([g,$])=>[g,typeof $=="string"?it($):$]).filter(([g,$])=>g!=="id"&&!!$&&$!==f[g]));if(Object.keys(h).length===0){t.setFormData(void 0);return}const m={customData:{...f,...h}};"gender"in h&&Object.assign(m,{css:{normal:h.gender==="M"?k.maleNode:k.femaleNode,selected:h.gender==="M"?k.selectedMaleNode:k.selectedFemaleNode}}),e.updateNode(l,m),t.setFormData(void 0),"gender"in h&&(d.getConnector("O").css=h.gender==="M"?k.maleOutputConnector:k.femaleOutputConnector,e.removeOutgoingConnections(l))};return(()=>{const l=co();return C(l,v(G,{get when(){return t.mode==="empty"},get children(){return v(lt,{onClick:n})}}),null),C(l,v(G,{get when(){return t.mode==="add"},get children(){return[(()=>{const d=ct();return d.$$click=c,d})(),(()=>{const d=at();return d.$$click=o,d})()]}}),null),C(l,v(G,{get when(){return t.mode==="view"},get children(){return[v(lt,{onClick:n}),(()=>{const d=io();return d.$$click=r,d})(),(()=>{const d=dt();return d.$$click=i,d})()]}}),null),C(l,v(G,{get when(){return t.mode==="edit"},get children(){return[(()=>{const d=ct();return d.$$click=a,d})(),(()=>{const d=at();return d.$$click=o,d})(),(()=>{const d=dt();return d.$$click=s,d})()]}}),null),b(()=>y(l,S.formButtonContainer)),l})()};Y(["click"]);const lo=w('<svg fill=#0078ea height=256px width=256px version=1.1 id=Capa_1 xmlns=http://www.w3.org/2000/svg viewBox="-30.6 -30.6 673.20 673.20"stroke=#0078ea><g id=SVGRepo_bgCarrier stroke-width=0></g><g id=SVGRepo_tracerCarrier stroke-linecap=round stroke-linejoin=round stroke=#080808 stroke-width=36.71988><g><path d="M569.569,0H413.755c-23.403,0-42.377,18.973-42.377,42.375s18.973,42.375,42.377,42.375h53.51L348.501,203.513 c-36.655-24.899-79.878-38.296-125.165-38.296c-59.67,0-115.768,23.237-157.961,65.429c-87.098,87.102-87.098,228.824,0,315.922 c42.193,42.193,98.291,65.431,157.961,65.431s115.768-23.237,157.961-65.431c76.855-76.855,85.878-196.233,27.101-283.094 l118.797-118.795v53.51c0,23.403,18.973,42.375,42.375,42.375c23.405,0,42.375-18.973,42.375-42.375V42.375 C611.945,18.973,592.972,0,569.569,0z M321.369,486.64c-26.186,26.186-61.001,40.607-98.032,40.607s-71.846-14.421-98.032-40.607 c-54.054-54.056-54.054-142.009,0-196.066c26.186-26.186,61.001-40.605,98.032-40.605s71.848,14.421,98.032,40.605 C375.422,344.632,375.422,432.587,321.369,486.64z"></path></g></g><g id=SVGRepo_iconCarrier><g><path d="M569.569,0H413.755c-23.403,0-42.377,18.973-42.377,42.375s18.973,42.375,42.377,42.375h53.51L348.501,203.513 c-36.655-24.899-79.878-38.296-125.165-38.296c-59.67,0-115.768,23.237-157.961,65.429c-87.098,87.102-87.098,228.824,0,315.922 c42.193,42.193,98.291,65.431,157.961,65.431s115.768-23.237,157.961-65.431c76.855-76.855,85.878-196.233,27.101-283.094 l118.797-118.795v53.51c0,23.403,18.973,42.375,42.375,42.375c23.405,0,42.375-18.973,42.375-42.375V42.375 C611.945,18.973,592.972,0,569.569,0z M321.369,486.64c-26.186,26.186-61.001,40.607-98.032,40.607s-71.846-14.421-98.032-40.607 c-54.054-54.056-54.054-142.009,0-196.066c26.186-26.186,61.001-40.605,98.032-40.605s71.848,14.421,98.032,40.605 C375.422,344.632,375.422,432.587,321.369,486.64z">'),uo=()=>lo(),ho=w('<svg fill=#ea0078 height=256px width=256px version=1.1 id=Capa_1 xmlns=http://www.w3.org/2000/svg viewBox="-23.86 -23.86 524.86 524.86"stroke=#cb3283 stroke-width=0.00477141><g id=SVGRepo_bgCarrier stroke-width=0></g><g id=SVGRepo_tracerCarrier stroke-linecap=round stroke-linejoin=round stroke=#080808 stroke-width=28.62846><g><path d="M326.711,341.99h-64.628v-64.634c0-0.686-0.142-1.323-0.213-1.997c65.409-11.119,115.378-68.161,115.378-136.681 C377.249,62.208,315.044,0,238.571,0C162.103,0,99.892,62.208,99.892,138.678c0,68.521,49.973,125.562,115.375,136.681 c-0.059,0.674-0.204,1.312-0.204,1.997v64.634h-64.631c-12.983,0-23.501,10.527-23.501,23.502c0,12.98,10.518,23.507,23.501,23.507 h64.637v64.64c0,12.98,10.524,23.502,23.501,23.502c12.979,0,23.513-10.527,23.513-23.502v-64.64h64.628 c12.986,0,23.508-10.526,23.508-23.507C350.219,352.518,339.698,341.99,326.711,341.99z M146.904,138.678 c0-50.546,41.121-91.673,91.667-91.673c50.549,0,91.676,41.122,91.676,91.673s-41.127,91.667-91.676,91.667 C188.031,230.346,146.904,189.224,146.904,138.678z"></path></g></g><g id=SVGRepo_iconCarrier><g><path d="M326.711,341.99h-64.628v-64.634c0-0.686-0.142-1.323-0.213-1.997c65.409-11.119,115.378-68.161,115.378-136.681 C377.249,62.208,315.044,0,238.571,0C162.103,0,99.892,62.208,99.892,138.678c0,68.521,49.973,125.562,115.375,136.681 c-0.059,0.674-0.204,1.312-0.204,1.997v64.634h-64.631c-12.983,0-23.501,10.527-23.501,23.502c0,12.98,10.518,23.507,23.501,23.507 h64.637v64.64c0,12.98,10.524,23.502,23.501,23.502c12.979,0,23.513-10.527,23.513-23.502v-64.64h64.628 c12.986,0,23.508-10.526,23.508-23.507C350.219,352.518,339.698,341.99,326.711,341.99z M146.904,138.678 c0-50.546,41.121-91.673,91.667-91.673c50.549,0,91.676,41.122,91.676,91.673s-41.127,91.667-91.676,91.667 C188.031,230.346,146.904,189.224,146.904,138.678z">'),fo=()=>ho(),go=w("<h2>Update Node"),po=w("<div><div><p>Name</p><input type=text name=lname placeholder=Name></div><div><p>Gender</p><div><div><input type=radio id=male name=gender value=M><label for=male>Male</label></div><div><input type=radio id=female name=gender value=M><label for=female>Female"),vo=w("<h2>Create Node"),mo=t=>(()=>{const e=po(),n=e.firstChild,o=n.firstChild,r=o.nextSibling,s=n.nextSibling,i=s.firstChild,c=i.nextSibling,a=c.firstChild,l=a.firstChild,d=l.nextSibling,f=a.nextSibling,h=f.firstChild,m=h.nextSibling;return C(e,v(G,{get when(){return t.formData.id},get fallback(){return vo()},get children(){return go()}}),n),r.$$input=g=>t.updateFormData({name:g.target.value}),l.addEventListener("change",()=>t.updateFormData({gender:"M"})),C(a,v(uo,{}),d),h.addEventListener("change",()=>t.updateFormData({gender:"F"})),C(f,v(fo,{}),m),b(g=>{const $=S.displayContainer,F=S.fieldDisplayContainer,B=S.fieldDisplayContainer,O=S.horizontalRadioContainer,M=S.horizontalRadioInput,E=S.radioInputMale,p=S.horizontalRadioInput,L=S.radioInputFemale;return $!==g._v$&&y(e,g._v$=$),F!==g._v$2&&y(n,g._v$2=F),B!==g._v$3&&y(s,g._v$3=B),O!==g._v$4&&y(c,g._v$4=O),M!==g._v$5&&y(a,g._v$5=M),E!==g._v$6&&y(l,g._v$6=E),p!==g._v$7&&y(f,g._v$7=p),L!==g._v$8&&y(h,g._v$8=L),g},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0,_v$6:void 0,_v$7:void 0,_v$8:void 0}),b(()=>r.value=t.formData.name),b(()=>l.checked=t.formData.gender==="M"),b(()=>h.checked=t.formData.gender==="F"),e})();Y(["input"]);const yo=w("<div><h1>Family Tree"),Co=w("<h2>No Node Selected"),wo=()=>{const[t,e]=Q(void 0),n=I(()=>D.get().hasNodeflow(Me.MAIN_NODEFLOW)?D.get().getNodeflow(Me.MAIN_NODEFLOW).mouseData.heldNodes.at(-1)?.node:void 0),o=I(()=>{const i=n();if(i)return{...i.customData,id:i.id}}),r=I(()=>t()!==void 0||o()!==void 0),s=I(()=>{if(!r())return"empty";const i=t();return i!==void 0?i.id?"edit":"add":"view"});return(()=>{const i=yo();return i.firstChild,C(i,v(G,{get when(){return r()},get fallback(){return Co()},get children(){return v(G,{get when(){return t()!==void 0},get fallback(){return v(so,{get nodeData(){return n()}})},get children(){return v(mo,{get formData(){return t()},updateFormData:c=>e({...t(),...c})})}})}}),null),C(i,v(ao,{get mode(){return s()},setFormData:e,get nodeData(){return o()},get formData(){return t()}}),null),b(()=>y(i,ve.sidebarContent)),i})()};class Do extends St{calculateCurveAnchors(e,n,o,r){const s=this.getVerticalCurve(e,n),i=e.add(s),c=n.subtract(s);return{anchorStart:i,anchorEnd:c}}}const bo=()=>{const[t,e]=D.get().createCanvas(Me.MAIN_NODEFLOW,{},o=>new Do(o));Pt(()=>{zn(t),Pn(t).then(()=>En(t))});const n=I(()=>{const o=t.mouseData.heldConnectors.at(-1);if(o)return o.connector.parentNode.customData.gender==="M"?ee.newFatherCurve:ee.newMotherCurve});return[v(e,{get css(){return{newCurve:n(),nodeflow:vn.nodeflow}},get width(){return`${Ie().x}px`},get height(){return`${Ie().y}px`}}),v(Fn,{get children(){return v(wo,{})}})]},So=document.getElementById("root");Gt(()=>v(bo,{}),So);
