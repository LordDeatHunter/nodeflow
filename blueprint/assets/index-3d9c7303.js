(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();const dt=(t,e)=>t===e,F=Symbol("solid-proxy"),Me=Symbol("solid-track"),he={equals:dt};let He=Ve;const T=1,fe=2,Xe={owned:null,cleanups:null,context:null,owner:null};var p=null;let De=null,g=null,y=null,$=null,be=0;function le(t,e){const n=g,o=p,i=t.length===0,s=e===void 0?o:e,r=i?Xe:{owned:null,cleanups:null,context:s?s.context:null,owner:s},c=i?t:()=>t(()=>O(()=>Pe(r)));p=r,g=null;try{return ee(c,!0)}finally{g=n,p=o}}function J(t,e){e=e?Object.assign({},he,e):he;const n={value:t,observers:null,observerSlots:null,comparator:e.equals||void 0},o=i=>(typeof i=="function"&&(i=i(n.value)),Ze(n,i));return[Ye.bind(n),o]}function b(t,e,n){const o=xe(t,e,!1,T);re(o)}function Ie(t,e,n){He=ft;const o=xe(t,e,!1,T),i=Te&&lt(Te);i&&(o.suspense=i),(!n||!n.render)&&(o.user=!0),$?$.push(o):re(o)}function z(t,e,n){n=n?Object.assign({},he,n):he;const o=xe(t,e,!0,0);return o.observers=null,o.observerSlots=null,o.comparator=n.equals||void 0,re(o),Ye.bind(o)}function ue(t){return ee(t,!1)}function O(t){if(g===null)return t();const e=g;g=null;try{return t()}finally{g=e}}function at(t){Ie(()=>O(t))}function Ae(t){return p===null||(p.cleanups===null?p.cleanups=[t]:p.cleanups.push(t)),t}function pe(){return g}function lt(t){return p&&p.context&&p.context[t.id]!==void 0?p.context[t.id]:t.defaultValue}let Te;function Ye(){if(this.sources&&this.state)if(this.state===T)re(this);else{const t=y;y=null,ee(()=>ve(this),!1),y=t}if(g){const t=this.observers?this.observers.length:0;g.sources?(g.sources.push(this),g.sourceSlots.push(t)):(g.sources=[this],g.sourceSlots=[t]),this.observers?(this.observers.push(g),this.observerSlots.push(g.sources.length-1)):(this.observers=[g],this.observerSlots=[g.sources.length-1])}return this.value}function Ze(t,e,n){let o=t.value;return(!t.comparator||!t.comparator(o,e))&&(t.value=e,t.observers&&t.observers.length&&ee(()=>{for(let i=0;i<t.observers.length;i+=1){const s=t.observers[i],r=De&&De.running;r&&De.disposed.has(s),(r?!s.tState:!s.state)&&(s.pure?y.push(s):$.push(s),s.observers&&qe(s)),r||(s.state=T)}if(y.length>1e6)throw y=[],new Error},!1)),e}function re(t){if(!t.fn)return;Pe(t);const e=p,n=g,o=be;g=p=t,ut(t,t.value,o),g=n,p=e}function ut(t,e,n){let o;try{o=t.fn(e)}catch(i){return t.pure&&(t.state=T,t.owned&&t.owned.forEach(Pe),t.owned=null),t.updatedAt=n+1,Ge(i)}(!t.updatedAt||t.updatedAt<=n)&&(t.updatedAt!=null&&"observers"in t?Ze(t,o):t.value=o,t.updatedAt=n)}function xe(t,e,n,o=T,i){const s={fn:t,state:o,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:p,context:p?p.context:null,pure:n};return p===null||p!==Xe&&(p.owned?p.owned.push(s):p.owned=[s]),s}function ge(t){if(t.state===0)return;if(t.state===fe)return ve(t);if(t.suspense&&O(t.suspense.inFallback))return t.suspense.effects.push(t);const e=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<be);)t.state&&e.push(t);for(let n=e.length-1;n>=0;n--)if(t=e[n],t.state===T)re(t);else if(t.state===fe){const o=y;y=null,ee(()=>ve(t,e[0]),!1),y=o}}function ee(t,e){if(y)return t();let n=!1;e||(y=[]),$?n=!0:$=[],be++;try{const o=t();return ht(n),o}catch(o){n||($=null),y=null,Ge(o)}}function ht(t){if(y&&(Ve(y),y=null),t)return;const e=$;$=null,e.length&&ee(()=>He(e),!1)}function Ve(t){for(let e=0;e<t.length;e++)ge(t[e])}function ft(t){let e,n=0;for(e=0;e<t.length;e++){const o=t[e];o.user?t[n++]=o:ge(o)}for(e=0;e<n;e++)ge(t[e])}function ve(t,e){t.state=0;for(let n=0;n<t.sources.length;n+=1){const o=t.sources[n];if(o.sources){const i=o.state;i===T?o!==e&&(!o.updatedAt||o.updatedAt<be)&&ge(o):i===fe&&ve(o,e)}}}function qe(t){for(let e=0;e<t.observers.length;e+=1){const n=t.observers[e];n.state||(n.state=fe,n.pure?y.push(n):$.push(n),n.observers&&qe(n))}}function Pe(t){let e;if(t.sources)for(;t.sources.length;){const n=t.sources.pop(),o=t.sourceSlots.pop(),i=n.observers;if(i&&i.length){const s=i.pop(),r=n.observerSlots.pop();o<i.length&&(s.sourceSlots[r]=o,i[o]=s,n.observerSlots[o]=r)}}if(t.owned){for(e=t.owned.length-1;e>=0;e--)Pe(t.owned[e]);t.owned=null}if(t.cleanups){for(e=t.cleanups.length-1;e>=0;e--)t.cleanups[e]();t.cleanups=null}t.state=0}function pt(t){return t instanceof Error?t:new Error(typeof t=="string"?t:"Unknown error",{cause:t})}function Ge(t,e=p){throw pt(t)}const gt=Symbol("fallback");function Be(t){for(let e=0;e<t.length;e++)t[e]()}function vt(t,e,n={}){let o=[],i=[],s=[],r=0,c=e.length>1?[]:null;return Ae(()=>Be(s)),()=>{let d=t()||[],l,a;return d[Me],O(()=>{let f=d.length,C,I,A,U,R,P,D,E,K;if(f===0)r!==0&&(Be(s),s=[],o=[],i=[],r=0,c&&(c=[])),n.fallback&&(o=[gt],i[0]=le(ct=>(s[0]=ct,n.fallback())),r=1);else if(r===0){for(i=new Array(f),a=0;a<f;a++)o[a]=d[a],i[a]=le(h);r=f}else{for(A=new Array(f),U=new Array(f),c&&(R=new Array(f)),P=0,D=Math.min(r,f);P<D&&o[P]===d[P];P++);for(D=r-1,E=f-1;D>=P&&E>=P&&o[D]===d[E];D--,E--)A[E]=i[D],U[E]=s[D],c&&(R[E]=c[D]);for(C=new Map,I=new Array(E+1),a=E;a>=P;a--)K=d[a],l=C.get(K),I[a]=l===void 0?-1:l,C.set(K,a);for(l=P;l<=D;l++)K=o[l],a=C.get(K),a!==void 0&&a!==-1?(A[a]=i[l],U[a]=s[l],c&&(R[a]=c[l]),a=I[a],C.set(K,a)):s[l]();for(a=P;a<f;a++)a in A?(i[a]=A[a],s[a]=U[a],c&&(c[a]=R[a],c[a](a))):i[a]=le(h);i=i.slice(0,r=f),o=d.slice(0)}return i});function h(f){if(s[a]=f,c){const[C,I]=J(a);return c[a]=I,e(d[a],C)}return e(d[a])}}}function m(t,e){return O(()=>t(e||{}))}const yt=t=>`Stale read from <${t}>.`;function X(t){const e="fallback"in t&&{fallback:()=>t.fallback};return z(vt(()=>t.each,t.children,e||void 0))}function Qe(t){const e=t.keyed,n=z(()=>t.when,void 0,{equals:(o,i)=>e?o===i:!o==!i});return z(()=>{const o=n();if(o){const i=t.children;return typeof i=="function"&&i.length>0?O(()=>i(e?o:()=>{if(!O(n))throw yt("Show");return t.when})):i}return t.fallback},void 0,void 0)}function mt(t,e,n){let o=n.length,i=e.length,s=o,r=0,c=0,d=e[i-1].nextSibling,l=null;for(;r<i||c<s;){if(e[r]===n[c]){r++,c++;continue}for(;e[i-1]===n[s-1];)i--,s--;if(i===r){const a=s<o?c?n[c-1].nextSibling:n[s-c]:d;for(;c<s;)t.insertBefore(n[c++],a)}else if(s===c)for(;r<i;)(!l||!l.has(e[r]))&&e[r].remove(),r++;else if(e[r]===n[s-1]&&n[c]===e[i-1]){const a=e[--i].nextSibling;t.insertBefore(n[c++],e[r++].nextSibling),t.insertBefore(n[--s],a),e[i]=n[s]}else{if(!l){l=new Map;let h=c;for(;h<s;)l.set(n[h],h++)}const a=l.get(e[r]);if(a!=null)if(c<a&&a<s){let h=r,f=1,C;for(;++h<i&&h<s&&!((C=l.get(e[h]))==null||C!==a+f);)f++;if(f>a-c){const I=e[r];for(;c<a;)t.insertBefore(n[c++],I)}else t.replaceChild(n[c++],e[r++])}else r++;else e[r++].remove()}}}const We="_$DX_DELEGATE";function Ct(t,e,n,o={}){let i;return le(s=>{i=s,e===document?t():S(e,t(),e.firstChild?null:void 0,n)},o.owner),()=>{i(),e.textContent=""}}function B(t,e,n){let o;const i=()=>{const r=document.createElement("template");return r.innerHTML=t,n?r.content.firstChild.firstChild:r.content.firstChild},s=e?()=>O(()=>document.importNode(o||(o=i()),!0)):()=>(o||(o=i())).cloneNode(!0);return s.cloneNode=s,s}function ce(t,e=window.document){const n=e[We]||(e[We]=new Set);for(let o=0,i=t.length;o<i;o++){const s=t[o];n.has(s)||(n.add(s),e.addEventListener(s,wt))}}function $e(t,e,n){n==null?t.removeAttribute(e):t.setAttribute(e,n)}function ne(t,e){e==null?t.removeAttribute("class"):t.className=e}function Je(t,e,n={}){const o=Object.keys(e||{}),i=Object.keys(n);let s,r;for(s=0,r=i.length;s<r;s++){const c=i[s];!c||c==="undefined"||e[c]||(Ue(t,c,!1),delete n[c])}for(s=0,r=o.length;s<r;s++){const c=o[s],d=!!e[c];!c||c==="undefined"||n[c]===d||!d||(Ue(t,c,!0),n[c]=d)}return n}function _e(t,e,n){return O(()=>t(e,n))}function S(t,e,n,o){if(n!==void 0&&!o&&(o=[]),typeof e!="function")return ye(t,e,o,n);b(i=>ye(t,e(),i,n),o)}function Ue(t,e,n){const o=e.trim().split(/\s+/);for(let i=0,s=o.length;i<s;i++)t.classList.toggle(o[i],n)}function wt(t){const e=`$$${t.type}`;let n=t.composedPath&&t.composedPath()[0]||t.target;for(t.target!==n&&Object.defineProperty(t,"target",{configurable:!0,value:n}),Object.defineProperty(t,"currentTarget",{configurable:!0,get(){return n||document}});n;){const o=n[e];if(o&&!n.disabled){const i=n[`${e}Data`];if(i!==void 0?o.call(n,i,t):o.call(n,t),t.cancelBubble)return}n=n._$host||n.parentNode||n.host}}function ye(t,e,n,o,i){for(;typeof n=="function";)n=n();if(e===n)return n;const s=typeof e,r=o!==void 0;if(t=r&&n[0]&&n[0].parentNode||t,s==="string"||s==="number")if(s==="number"&&(e=e.toString()),r){let c=n[0];c&&c.nodeType===3?c.data=e:c=document.createTextNode(e),n=H(t,n,o,c)}else n!==""&&typeof n=="string"?n=t.firstChild.data=e:n=t.textContent=e;else if(e==null||s==="boolean")n=H(t,n,o);else{if(s==="function")return b(()=>{let c=e();for(;typeof c=="function";)c=c();n=ye(t,c,n,o)}),()=>n;if(Array.isArray(e)){const c=[],d=n&&Array.isArray(n);if(Oe(c,e,n,i))return b(()=>n=ye(t,c,n,o,!0)),()=>n;if(c.length===0){if(n=H(t,n,o),r)return n}else d?n.length===0?Re(t,c,o):mt(t,n,c):(n&&H(t),Re(t,c));n=c}else if(e.nodeType){if(Array.isArray(n)){if(r)return n=H(t,n,o,e);H(t,n,null,e)}else n==null||n===""||!t.firstChild?t.appendChild(e):t.replaceChild(e,t.firstChild);n=e}}return n}function Oe(t,e,n,o){let i=!1;for(let s=0,r=e.length;s<r;s++){let c=e[s],d=n&&n[s],l;if(!(c==null||c===!0||c===!1))if((l=typeof c)=="object"&&c.nodeType)t.push(c);else if(Array.isArray(c))i=Oe(t,c,d)||i;else if(l==="function")if(o){for(;typeof c=="function";)c=c();i=Oe(t,Array.isArray(c)?c:[c],Array.isArray(d)?d:[d])||i}else t.push(c),i=!0;else{const a=String(c);d&&d.nodeType===3&&d.data===a?t.push(d):t.push(document.createTextNode(a))}}return i}function Re(t,e,n=null){for(let o=0,i=e.length;o<i;o++)t.insertBefore(e[o],n)}function H(t,e,n,o){if(n===void 0)return t.textContent="";const i=o||document.createTextNode("");if(e.length){let s=!1;for(let r=e.length-1;r>=0;r--){const c=e[r];if(i!==c){const d=c.parentNode===t;!s&&!r?d?t.replaceChild(i,c):t.insertBefore(i,n):d&&c.remove()}else s=!0}}else t.insertBefore(i,n);return[i]}const me=Symbol("store-raw"),Z=Symbol("store-node"),M=Symbol("store-has"),et=Symbol("store-self");function tt(t){let e=t[F];if(!e&&(Object.defineProperty(t,F,{value:e=new Proxy(t,bt)}),!Array.isArray(t))){const n=Object.keys(t),o=Object.getOwnPropertyDescriptors(t);for(let i=0,s=n.length;i<s;i++){const r=n[i];o[r].get&&Object.defineProperty(t,r,{enumerable:o[r].enumerable,get:o[r].get.bind(e)})}}return e}function q(t){let e;return t!=null&&typeof t=="object"&&(t[F]||!(e=Object.getPrototypeOf(t))||e===Object.prototype||Array.isArray(t))}function G(t,e=new Set){let n,o,i,s;if(n=t!=null&&t[me])return n;if(!q(t)||e.has(t))return t;if(Array.isArray(t)){Object.isFrozen(t)?t=t.slice(0):e.add(t);for(let r=0,c=t.length;r<c;r++)i=t[r],(o=G(i,e))!==i&&(t[r]=o)}else{Object.isFrozen(t)?t=Object.assign({},t):e.add(t);const r=Object.keys(t),c=Object.getOwnPropertyDescriptors(t);for(let d=0,l=r.length;d<l;d++)s=r[d],!c[s].get&&(i=t[s],(o=G(i,e))!==i&&(t[s]=o))}return t}function Ce(t,e){let n=t[e];return n||Object.defineProperty(t,e,{value:n=Object.create(null)}),n}function oe(t,e,n){if(t[e])return t[e];const[o,i]=J(n,{equals:!1,internal:!0});return o.$=i,t[e]=o}function St(t,e){const n=Reflect.getOwnPropertyDescriptor(t,e);return!n||n.get||!n.configurable||e===F||e===Z||(delete n.value,delete n.writable,n.get=()=>t[F][e]),n}function nt(t){pe()&&oe(Ce(t,Z),et)()}function Nt(t){return nt(t),Reflect.ownKeys(t)}const bt={get(t,e,n){if(e===me)return t;if(e===F)return n;if(e===Me)return nt(t),n;const o=Ce(t,Z),i=o[e];let s=i?i():t[e];if(e===Z||e===M||e==="__proto__")return s;if(!i){const r=Object.getOwnPropertyDescriptor(t,e);pe()&&(typeof s!="function"||t.hasOwnProperty(e))&&!(r&&r.get)&&(s=oe(o,e,s)())}return q(s)?tt(s):s},has(t,e){return e===me||e===F||e===Me||e===Z||e===M||e==="__proto__"?!0:(pe()&&oe(Ce(t,M),e)(),e in t)},set(){return!0},deleteProperty(){return!0},ownKeys:Nt,getOwnPropertyDescriptor:St};function Q(t,e,n,o=!1){if(!o&&t[e]===n)return;const i=t[e],s=t.length;n===void 0?(delete t[e],t[M]&&t[M][e]&&i!==void 0&&t[M][e].$()):(t[e]=n,t[M]&&t[M][e]&&i===void 0&&t[M][e].$());let r=Ce(t,Z),c;if((c=oe(r,e,i))&&c.$(()=>n),Array.isArray(t)&&t.length!==s){for(let d=t.length;d<s;d++)(c=r[d])&&c.$();(c=oe(r,"length",s))&&c.$(t.length)}(c=r[et])&&c.$()}function ot(t,e){const n=Object.keys(e);for(let o=0;o<n.length;o+=1){const i=n[o];Q(t,i,e[i])}}function It(t,e){if(typeof e=="function"&&(e=e(t)),e=G(e),Array.isArray(e)){if(t===e)return;let n=0,o=e.length;for(;n<o;n++){const i=e[n];t[n]!==i&&Q(t,n,i)}Q(t,"length",o)}else ot(t,e)}function te(t,e,n=[]){let o,i=t;if(e.length>1){o=e.shift();const r=typeof o,c=Array.isArray(t);if(Array.isArray(o)){for(let d=0;d<o.length;d++)te(t,[o[d]].concat(e),n);return}else if(c&&r==="function"){for(let d=0;d<t.length;d++)o(t[d],d)&&te(t,[d].concat(e),n);return}else if(c&&r==="object"){const{from:d=0,to:l=t.length-1,by:a=1}=o;for(let h=d;h<=l;h+=a)te(t,[h].concat(e),n);return}else if(e.length>1){te(t[o],e,[o].concat(n));return}i=t[o],n=[o].concat(n)}let s=e[0];typeof s=="function"&&(s=s(i,n),s===i)||o===void 0&&s==null||(s=G(s),o===void 0||q(i)&&q(s)&&!Array.isArray(s)?ot(i,s):Q(t,o,s))}function W(...[t,e]){const n=G(t||{}),o=Array.isArray(n),i=tt(n);function s(...r){ue(()=>{o&&r.length===1?It(n,r[0]):te(n,r)})}return[i,s]}const we=new WeakMap,st={get(t,e){if(e===me)return t;const n=t[e];let o;return q(n)?we.get(n)||(we.set(n,o=new Proxy(n,st)),o):n},set(t,e,n){return Q(t,e,G(n)),!0},deleteProperty(t,e){return Q(t,e,void 0,!0),!0}};function Pt(t){return e=>{if(q(e)){let n;(n=we.get(e))||we.set(e,n=new Proxy(e,st)),t(n)}return e}}var Dt={equals:!1},zt=Dt,Fe=class{#e;constructor(t=Map){this.#e=new t}dirty(t){this.#e.get(t)?.$$()}track(t){if(!pe())return;let e=this.#e.get(t);if(e)e.n++;else{const[n,o]=J(void 0,zt);this.#e.set(t,e={$:n,$$:o,n:1})}Ae(()=>{e.n--===1&&queueMicrotask(()=>e.n===0&&this.#e.delete(t))}),e.$()}},x=Symbol("track-keys"),se=class extends Map{#e=new Fe;#t=new Fe;constructor(t){if(super(),t)for(const e of t)super.set(e[0],e[1])}has(t){return this.#e.track(t),super.has(t)}get(t){return this.#t.track(t),super.get(t)}get size(){return this.#e.track(x),super.size}*keys(){for(const t of super.keys())this.#e.track(t),yield t;this.#e.track(x)}*values(){for(const[t,e]of super.entries())this.#t.track(t),yield e;this.#e.track(x)}*entries(){for(const t of super.entries())this.#t.track(t[0]),yield t;this.#e.track(x)}set(t,e){return ue(()=>{if(super.has(t)){if(super.get(t)===e)return}else this.#e.dirty(t),this.#e.dirty(x);this.#t.dirty(t),super.set(t,e)}),this}delete(t){const e=super.delete(t);return e&&ue(()=>{this.#e.dirty(t),this.#e.dirty(x),this.#t.dirty(t)}),e}clear(){super.size&&ue(()=>{for(const t of super.keys())this.#e.dirty(t),this.#t.dirty(t);super.clear(),this.#e.dirty(x)})}forEach(t){this.#e.track(x);for(const[e,n]of super.entries())this.#t.track(e),t(n,e,this)}[Symbol.iterator](){return this.entries()}};class u{constructor(e,n){this.x=e,this.y=n}static zero(){return new u(0,0)}static of(e,n){return new u(e,n)}static fromEvent(e){return new u(e.clientX,e.clientY)}static fromVec2(e){return new u(e.x,e.y)}copy(){return new u(this.x,this.y)}serialize(){return{x:this.x,y:this.y}}static deserialize(e){return new u(e.x,e.y)}static deserializeOrDefault(e,n=u.zero()){return e?u.deserialize(e):n}add(...e){return e.reduce((n,o)=>new u(n.x+o.x,n.y+o.y),this)}subtract(...e){return e.reduce((n,o)=>new u(n.x-o.x,n.y-o.y),this)}multiply(...e){return e.reduce((n,o)=>new u(n.x*o.x,n.y*o.y),this)}divide(...e){return e.reduce((n,o)=>new u(o.x/n.x,o.y/n.y),this)}negate(){return new u(-this.x,-this.y)}shift(e){return new u(this.x+e,this.y+e)}multiplyBy(e){return new u(this.x*e,this.y*e)}divideBy(e){return new u(this.x/e,this.y/e)}isWithinRect(e,n){return this.x>=e.x&&this.x<=e.x+n.x&&this.y>=e.y&&this.y<=e.y+n.y}}const Et=B("<div>"),Mt=t=>(()=>{const e=Et();return e.$$pointerup=n=>t.nodeflowData.eventStore.onPointerUpInConnector.publish({event:n,nodeId:t.nodeId,connectorId:t.connectorId}),e.$$touchstart=n=>t.nodeflowData.eventStore.onTouchStartInConnector.publish({event:n,nodeId:t.nodeId,connectorId:t.connectorId}),e.$$mousedown=n=>t.nodeflowData.eventStore.onMouseDownInConnector.publish({event:n,nodeId:t.nodeId,connectorId:t.connectorId}),_e(n=>setTimeout(()=>{if(!n)return;const o=t.nodeflowData.nodes.get(t.nodeId).connectorSections.get(t.sectionId).connectors.get(t.connectorId),i=new ResizeObserver(()=>{o.size=u.of(n.offsetWidth,n.offsetHeight)});i.observe(n),o.update({position:u.of((n?.parentElement?.offsetLeft??0)+n.offsetLeft,(n?.parentElement?.offsetTop??0)+n.offsetTop),ref:n,resizeObserver:i,size:u.of(n.offsetWidth,n.offsetHeight)})}),e),b(()=>ne(e,t.connector?.css)),e})();ce(["mousedown","touchstart","pointerup"]);class Y{constructor(e){this.store=W(e)}get array(){return this.store[0]}get length(){return this.store[0].length}forEach(e){this.store[0].forEach(e)}filter(e){return this.store[0].filter(e)}filterInPlace(e){this.store[1](this.filter(e))}map(e){return this.store[0].map(e)}flatMap(e){return this.store[0].flatMap(e)}find(e){return this.store[0].find(e)}findIndex(e){return this.store[0].findIndex(e)}splice(e,n,...o){this.store[1](this.store[0].splice(e,n,...o))}reduce(e,n){return this.store[0].reduce(e,n)}some(e){return this.store[0].some(e)}every(e){return this.store[0].every(e)}get(e){return this.store[0][e]}set(e,n){this.store[1](e,n)}push(e){this.store[1](this.store[0].length,e)}}class $t{changes=[];currentChangeIndex=-1;serialize(){return{changes:this.changes,currentChangeIndex:this.currentChangeIndex}}deserialize(e){this.changes=e.changes,this.currentChangeIndex=e.currentChangeIndex}addChange(e){this.changes=this.changes.slice(0,this.currentChangeIndex+1),this.changes.push(e),this.currentChangeIndex=this.changes.length-1}undo(){return this.currentChangeIndex===-1?!1:(this.changes[this.currentChangeIndex].undoChange(),this.currentChangeIndex--,!0)}redo(){return this.currentChangeIndex===this.changes.length-1?!1:(this.currentChangeIndex++,this.changes[this.currentChangeIndex].applyChange(),!0)}}class Ot{constructor(e){this.store=W(e)}get css(){return this.store[0].css}get destinationConnector(){return this.store[0].destinationConnector}get path(){return this.store[0].path}set css(e){this.store[1]({css:e})}set path(e){this.store[1]({path:e})}set destinationConnector(e){this.store[1]({destinationConnector:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}}const de=(...t)=>{const e=t[0];return t.slice(1).reduce((o,i)=>new Set([...o].filter(s=>i.has(s))),e)},ae=t=>t.size===0,L=t=>typeof t!="object"||t===null||t===void 0?t:Array.isArray(t)?t.map(L):typeof t=="object"?Object.fromEntries(Object.entries(t).map(([e,n])=>[e,L(n)])):t;class ke{constructor(e){this.store=W(e)}serialize(){return{css:this.css,hovered:this.hovered,id:this.id,position:this.position.serialize()}}serializeConnections(){return[...this.destinations.map(({destinationConnector:e,css:n})=>({sourceNodeId:this.parentSection.parentNode.id,sourceConnectorId:this.id,destinationNodeId:e.parentSection.parentNode.id,destinationConnectorId:e.id,css:L(n)})),...this.sources.map(({sourceConnector:e})=>({sourceNodeId:e.parentSection.parentNode.id,sourceConnectorId:e.id,destinationNodeId:this.parentSection.parentNode.id,destinationConnectorId:this.id,css:L(e.destinations.find(n=>n.destinationConnector.parentSection.parentNode.id===this.parentSection.parentNode.id)?.css)}))]}static deserialize(e,n){const o=!e.id||n.connectors.has(e.id)?n.parentNode.getNextFreeConnectorId():e.id;return new ke({css:e.css,destinations:new Y([]),hovered:e.hovered??!1,id:o,parentSection:n,position:u.deserializeOrDefault(e.position),ref:void 0,resizeObserver:void 0,size:u.zero(),sources:new Y([])})}get css(){return this.store[0].css}values(){return this.store[0]}get destinations(){return this.store[0].destinations}get hovered(){return this.store[0].hovered}get id(){return this.store[0].id}get parentSection(){return this.store[0].parentSection}get position(){return this.store[0].position}get ref(){return this.store[0].ref}get resizeObserver(){return this.store[0].resizeObserver}get size(){return this.store[0].size}get sources(){return this.store[0].sources}set css(e){this.store[1]({css:e})}set destinations(e){this.store[1]({destinations:e})}set hovered(e){this.store[1]({hovered:e})}set id(e){this.store[1]({id:e})}set parentSection(e){this.store[1]({parentSection:e})}set position(e){this.store[1]({position:e})}set ref(e){this.store[1]({ref:e})}set resizeObserver(e){this.store[1]({resizeObserver:e})}set size(e){this.store[1]({size:e})}set sources(e){this.store[1]({sources:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}removeIncomingConnections(){this.sources.forEach(({sourceConnector:e})=>{e.destinations.filterInPlace(({destinationConnector:n})=>n.parentSection.parentNode.id!==this.id)}),this.sources=new Y([])}removeOutgoingConnections(){this.destinations.forEach(({destinationConnector:e})=>{e.sources.filterInPlace(({sourceConnector:n})=>n.parentSection.parentNode.id!==this.id)}),this.destinations=new Y([])}}class At{constructor(e,n){this.nodeflowData=e,this.store=W(n)}serialize(){return{connectors:Object.fromEntries(Array.from(this.connectors.entries()).map(([e,n])=>[e,n.serialize()])),css:this.css,id:this.id}}removeConnector(e,n=!0){if(!this.connectors.has(e))return;const o=this.connectors.get(e);n&&this.nodeflowData.changes.addChange({type:"remove",source:"connector",applyChange:()=>{this.removeConnector(e,!1)},undoChange:()=>{this.addConnector(o.serialize(),!1)}}),this.connectors.delete(e)}addConnector(e,n=!0){const o=ke.deserialize(e,this);if(!this.connectors.has(o.id))return n&&this.nodeflowData.changes.addChange({type:"add",source:"connector",applyChange:()=>{this.addConnector(o.serialize(),!1)},undoChange:()=>{this.removeConnector(o.id,!1)}}),this.connectors.set(o.id,o),o}get connectors(){return this.store[0].connectors}get css(){return this.store[0].css}get id(){return this.store[0].id}get parentNode(){return this.store[0].parentNode}set connectors(e){this.store[1]({connectors:e})}set css(e){this.store[1]({css:e})}set id(e){this.store[1]({id:e})}set parentNode(e){this.store[1]({parentNode:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}removeIncomingConnections(){this.connectors.forEach(e=>e.removeIncomingConnections())}removeOutgoingConnections(){this.connectors.forEach(e=>e.removeOutgoingConnections())}getSourceConnectors(){return Array.from(this.connectors.values()).flatMap(e=>e.sources.flatMap(n=>n.sourceConnector))}getDestinationConnectors(){return Array.from(this.connectors.values()).flatMap(e=>e.destinations.flatMap(n=>n.destinationConnector))}}class xt{constructor(e){this.store=W(e)}get sourceConnector(){return this.store[0].sourceConnector}set sourceConnector(e){this.store[1]({sourceConnector:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}}const[Se,_t]=J(u.of(window.innerWidth,window.innerHeight));Ie(()=>{const t=()=>_t(u.of(window.innerWidth,window.innerHeight));return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)});const ze=(t,e,n)=>Math.min(Math.max(t,e),n),w={KEYBOARD_ZOOM_AMOUNT:15,MAX_SPEED:15,MAX_ZOOM:200,MIN_ZOOM:.02,MOVE_DISTANCE:100,MOVE_SLOWDOWN:.85,MOVE_SPEED_INCREASE:1.5,SQRT_2_OVER_2:.7071067811865476,ZOOM_MULTIPLIER:.005,CURVE_MULTIPLIER:3},N=new Set,_={MOVE_DOWN:new Set(["ArrowDown","KeyS"]),MOVE_LEFT:new Set(["ArrowLeft","KeyA"]),MOVE_RIGHT:new Set(["ArrowRight","KeyD"]),MOVE_UP:new Set(["ArrowUp","KeyW"])};class kt{constructor(e){this.nodeflowData=e,this.store=W({clickStartPosition:void 0,heldConnection:void 0,heldConnectorId:void 0,heldNodeId:void 0,isDraggingNode:!1,mousePosition:u.zero()})}serialize(){const e=this.heldConnection?{sourceNodeId:this.heldConnection.sourceConnector.parentSection.parentNode.id,sourceConnectorId:this.heldConnection.sourceConnector.id,destinationNodeId:this.heldConnection.destinationConnector.parentSection.parentNode.id,destinationConnectorId:this.heldConnection.destinationConnector.id}:void 0;return{clickStartPosition:this.clickStartPosition?.serialize(),heldConnection:e,heldConnectorId:this.heldConnectorId,heldNodeId:this.heldNodeId}}deserialize(e){let n;if(e.heldConnection){const o=this.nodeflowData.nodes.get(e.heldConnection.sourceNodeId)?.getConnector(e.heldConnection.sourceConnectorId),i=this.nodeflowData.nodes.get(e.heldConnection.destinationNodeId)?.getConnector(e.heldConnection.destinationConnectorId);o&&i&&(n={sourceConnector:o,destinationConnector:i})}this.update({clickStartPosition:u.deserializeOrDefault(e.clickStartPosition),heldConnection:n,heldConnectorId:e.heldConnectorId,heldNodeId:e.heldNodeId})}get clickStartPosition(){return this.store[0].clickStartPosition}get isDraggingNode(){return this.store[0].isDraggingNode}get heldConnectorId(){return this.store[0].heldConnectorId}get heldNodeId(){return this.store[0].heldNodeId}get mousePosition(){return this.store[0].mousePosition}get heldConnection(){return this.store[0].heldConnection}set clickStartPosition(e){this.store[1]({clickStartPosition:e})}set isDraggingNode(e){this.store[1]({isDraggingNode:e})}set heldConnectorId(e){this.store[1]({heldConnectorId:e})}set heldNodeId(e){this.store[1]({heldNodeId:e})}set mousePosition(e){this.store[1]({mousePosition:e})}set heldConnection(e){this.store[1]({heldConnection:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}reset(){this.store[1]({isDraggingNode:!1,heldConnection:void 0,heldConnectorId:void 0,heldNodeId:void 0})}selectNode=(e,n,o=!0)=>{this.update({isDraggingNode:o,heldConnectorId:void 0,heldConnection:void 0,heldNodeId:e,mousePosition:n,clickStartPosition:n.divideBy(this.nodeflowData.zoomLevel).subtract(this.nodeflowData.nodes.get(e).position)})};deselectNode=()=>{this.update({heldNodeId:void 0,heldConnectorId:void 0,heldConnection:void 0}),this.nodeflowData.resetMovement()};startCreatingConnection=(e,n,o)=>{this.update({isDraggingNode:!1,heldNodeId:e,heldConnectorId:o,mousePosition:n,clickStartPosition:n.divideBy(this.nodeflowData.zoomLevel).subtract(this.nodeflowData.nodes.get(e).position)})};globalMousePosition=()=>this.mousePosition.subtract(this.nodeflowData.startPosition).divideBy(this.nodeflowData.zoomLevel).subtract(this.nodeflowData.position)}class Le{constructor(e,n){this.nodeflowData=e,this.store=W(n)}get centered(){return this.store[0].centered}get connectorSections(){return this.store[0].connectorSections}get css(){return this.store[0].css}get customData(){return this.store[0].customData}get display(){return this.store[0].display}get id(){return this.store[0].id}get offset(){return this.store[0].offset}get position(){return this.store[0].position}get ref(){return this.store[0].ref}get resizeObserver(){return this.store[0].resizeObserver}get size(){return this.store[0].size}set centered(e){this.store[1]({centered:e})}set connectorSections(e){this.store[1]({connectorSections:e})}set css(e){this.store[1]({css:e})}set customData(e){this.store[1]({customData:e})}set display(e){this.store[1]({display:e})}set id(e){this.store[1]({id:e})}set offset(e){this.store[1]({offset:e})}set position(e){this.store[1]({position:e})}set ref(e){this.store[1]({ref:e})}set resizeObserver(e){this.store[1]({resizeObserver:e})}set size(e){this.store[1]({size:e})}update(e){this.store[1](e)}serialize(){const e=Array.from(this.connectorSections.values()).reduce((n,o)=>(n[o.id]=o.serialize(),n),{});return{centered:this.centered,connectorSections:e,css:L(this.css),customData:L(this.customData),id:this.id,display:this.display,position:this.position.serialize()}}static deserialize(e,n){const o=n.id??e.getNextFreeNodeId(),i=new Le(e,{centered:n.centered??!1,connectorSections:new se,css:L(n.css)??{},customData:L(n.customData)??{},display:n.display??(()=>{}),id:o,offset:u.zero(),position:u.deserializeOrDefault(n.position),ref:void 0,resizeObserver:void 0,size:u.zero()});return Object.entries(n.connectorSections??[]).forEach(([s,r])=>{i.addConnectorSection(s,r.css,!1),Object.values(r.connectors).forEach(c=>{i.addConnector(s,c,!1)})}),i}serializeConnections(){return Array.from(this.connectorSections.values()).flatMap(e=>Array.from(e.connectors.values()).flatMap(n=>n.serializeConnections()))}updateWithPrevious(e){this.store[1](e)}addConnectorSection=(e,n,o=!0)=>{(!e||this.connectorSections.has(e))&&(e=this.getNextFreeConnectorSectionId()),o&&this.nodeflowData.changes.addChange({type:"remove",source:"connector-section",applyChange:()=>{this.addConnectorSection(e,n,!1)},undoChange:()=>{this.removeConnectorSection(e,!1)}});const i=new At(this.nodeflowData,{connectors:new se,css:n,id:e,parentNode:this});return this.connectorSections.set(e,i),i};removeConnectorSection(e,n=!0){if(!this.connectorSections.has(e))return;const o=this.connectorSections.get(e);n&&this.nodeflowData.changes.addChange({type:"remove",source:"connector-section",applyChange:()=>{this.removeConnectorSection(e,!1)},undoChange:()=>{this.addConnectorSection(e,o.css,!1)}}),this.connectorSections.delete(e)}getConnectorCount(){return Array.from(this.connectorSections.values()).reduce((e,n)=>e+n.connectors.size,0)}addConnector(e,n,o=!0){if(this.connectorSections.has(e))return this.connectorSections.get(e).addConnector(n,o)}removeConnector(e,n,o=!0){this.connectorSections.has(e)&&this.connectorSections.get(e).removeConnector(n,o)}getConnector(e){return this.getSectionFromConnector(e)?.connectors.get(e)}getTotalConnectedInputs(e){return this.getConnector(e)?.sources.length??0}getAllConnectors(){return Array.from(this.connectorSections.values()).reduce((e,n)=>e.concat(Array.from(n.connectors.values())),[])}getNextFreeConnectorSectionId(){let e="0";for(let n=1;this.connectorSections.has(e);++n)e=n.toString();return e}getNextFreeConnectorId(){let e="0";for(let n=1;Array.from(this.connectorSections.values()).some(o=>o.connectors.has(e));++n)e=n.toString();return e}removeIncomingConnections(){this.connectorSections.forEach(e=>e.removeIncomingConnections())}removeOutgoingConnections(){this.connectorSections.forEach(e=>e.removeOutgoingConnections())}getAllSourceConnectors(){return Array.from(this.connectorSections.values()).reduce((e,n)=>e.concat(n.getSourceConnectors()),[])}getAllDestinationConnectors(){return Array.from(this.connectorSections.values()).reduce((e,n)=>e.concat(n.getDestinationConnectors()),[])}getAllSourceConnections(){return this.getAllSourceConnectors().map(e=>e.destinations.filter(o=>o.destinationConnector.parentSection.parentNode.id===this.id).map(o=>({sourceNodeId:e.parentSection.parentNode.id,sourceConnectorId:e.id,destinationNodeId:o.destinationConnector.parentSection.parentNode.id,destinationConnectorId:o.destinationConnector.id,css:o.css}))).flat()}getAllDestinationConnections(){return this.getAllDestinationConnectors().map(e=>e.sources.filter(o=>o.sourceConnector.parentSection.parentNode.id===this.id).map(o=>({sourceNodeId:o.sourceConnector.parentSection.parentNode.id,sourceConnectorId:o.sourceConnector.id,destinationNodeId:e.parentSection.parentNode.id,destinationConnectorId:e.id,css:o.sourceConnector.css}))).flat()}getSectionFromConnector(e){return Array.from(this.connectorSections.values()).find(n=>n.connectors.get(e))}}class it{subscriptions=new se;blacklistFilters=new se;blacklist(e,n){this.blacklistFilters.set(e,n)}unblacklist(e){this.blacklistFilters.delete(e)}unblacklistMultiple(e){e.forEach(this.unblacklist)}clearBlacklist(){this.blacklistFilters.clear()}subscribe(e,n,o=0){this.subscriptions.set(e,{name:e,event:n,priority:o})}subscribeMultiple(e){e.forEach(({name:n,event:o,priority:i})=>this.subscribe(n,o,i))}unsubscribe(e){this.subscriptions.delete(e)}unsubsribeMultiple(e){e.forEach(this.unsubscribe)}publish(e){Array.from(this.subscriptions.values()).sort((n,o)=>o.priority-n.priority).filter(({name:n,priority:o})=>!Array.from(this.blacklistFilters.values()).some(s=>s(e,n,o))).map(({event:n})=>n).forEach(n=>n(e))}clear(){this.subscriptions.clear()}get size(){return this.subscriptions.size}get isEmpty(){return this.size===0}}class v extends it{constructor(e){super(),this.nodeflowData=e}}class Ee extends it{}class Ne{constructor(){this.store=W({currentMoveSpeed:u.zero(),position:u.zero(),startPosition:u.zero(),size:u.zero(),zoomLevel:1,pinchDistance:0}),this.changes=new $t,this.mouseData=new kt(this),this.nodes=new se,this.eventStore={onKeyDownInNodeflow:new v(this),onKeyUpInNodeflow:new v(this),onMouseDownInConnector:new v(this),onMouseDownInNodeflow:new v(this),onMouseDownInNode:new v(this),onMouseMoveInNodeflow:new v(this),onNodeConnected:new v(this),onNodeDataChanged:new v(this),onPointerDownInNodeCurve:new v(this),onPointerUpInConnector:new v(this),onPointerUpInNodeflow:new v(this),onPointerUpInNode:new v(this),onTouchMoveInNodeflow:new v(this),onTouchStartInConnector:new v(this),onTouchStartInNodeflow:new v(this),onTouchStartInNode:new v(this),onWheelInNodeflow:new v(this)},this.setupDefaultEventHandlers(),setInterval(()=>{const e=!ae(de(N,_.MOVE_LEFT)),n=!ae(de(N,_.MOVE_RIGHT)),o=!ae(de(N,_.MOVE_UP)),i=!ae(de(N,_.MOVE_DOWN)),s=this.mouseData.heldNodeId!==void 0;this.currentMoveSpeed=u.of(Ne.calculateMovement(e||n,this.currentMoveSpeed.x,n,e,!s),Ne.calculateMovement(o||i,this.currentMoveSpeed.y,i,o,!s)),s?this.updateHeldNodePosition(this.currentMoveSpeed):this.updateBackgroundPosition(this.currentMoveSpeed,!0)},10)}serialize(){return{changes:this.changes.serialize(),connections:this.serializeConnections(),currentMoveSpeed:this.currentMoveSpeed.serialize(),mouseData:this.mouseData.serialize(),nodes:Object.fromEntries(Array.from(this.nodes.entries()).map(([e,n])=>[e,n.serialize()])),pinchDistance:this.pinchDistance,position:this.position.serialize(),size:this.size.serialize(),startPosition:this.startPosition.serialize(),zoomLevel:this.zoomLevel}}deserialize(e){this.update({currentMoveSpeed:u.deserializeOrDefault(e.currentMoveSpeed),pinchDistance:e.pinchDistance,position:u.deserializeOrDefault(e.position),size:u.deserializeOrDefault(e.size),startPosition:u.deserializeOrDefault(e.startPosition),zoomLevel:e.zoomLevel}),this.nodes.clear(),Object.entries(e.nodes).forEach(([n,o])=>{this.addNode(o,!1)}),this.mouseData.deserialize(e.mouseData),e.connections.forEach(n=>{this.addConnection(n,!1)}),this.changes.deserialize(e.changes)}resetMovement=()=>{this.currentMoveSpeed=u.zero(),_.MOVE_LEFT.forEach(e=>N.delete(e)),_.MOVE_RIGHT.forEach(e=>N.delete(e)),_.MOVE_UP.forEach(e=>N.delete(e)),_.MOVE_DOWN.forEach(e=>N.delete(e))};serializeConnections(){return Array.from(this.nodes.values()).flatMap(e=>e.serializeConnections())}get currentMoveSpeed(){return this.store[0].currentMoveSpeed}get position(){return this.store[0].position}get startPosition(){return this.store[0].startPosition}get size(){return this.store[0].size}get zoomLevel(){return this.store[0].zoomLevel}get pinchDistance(){return this.store[0].pinchDistance}set currentMoveSpeed(e){this.store[1]({currentMoveSpeed:e})}set position(e){this.store[1]({position:e})}set startPosition(e){this.store[1]({startPosition:e})}set size(e){this.store[1]({size:e})}set zoomLevel(e){this.store[1]({zoomLevel:e})}set pinchDistance(e){this.store[1]({pinchDistance:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}center(){const n=Se().divideBy(2);return this.startPosition.add(n).divideBy(this.zoomLevel).subtract(this.position)}static calculateMovement(e,n,o,i,s=!1){let r=n;if(e){const c=w.MOVE_SPEED_INCREASE*(s?-1:1);r=ze(r+(o?c:0)-(i?c:0),-w.MAX_SPEED,w.MAX_SPEED)}else r=ze(r*w.MOVE_SLOWDOWN,-w.MAX_SPEED,w.MAX_SPEED);return r<=.1&&r>=-.1&&(r=0),r}updateZoom=(e,n)=>{const o=this.zoomLevel;if(e===0)return;const i=Number(ze(e>0?o+o*e*w.ZOOM_MULTIPLIER:o/(1-e*w.ZOOM_MULTIPLIER),w.MIN_ZOOM,w.MAX_ZOOM).toFixed(4));this.mouseData.isDraggingNode=!1;const s=this.size,r=n.subtract(this.startPosition),c=s.multiplyBy(o),d=s.multiplyBy(i),l=r.subtract(c.divideBy(2)).divideBy(o),a=r.subtract(d.divideBy(2)).divideBy(i);this.updateWithPrevious(h=>({position:h.position.subtract(l).add(a),zoomLevel:i}))};updateBackgroundPosition(e,n=!1){this.mouseData.heldNodeId||n===this.mouseData.isDraggingNode||this.updateWithPrevious(o=>({position:o.position.add(e.divideBy(this.zoomLevel))}))}addNode(e,n=!0){const o=Le.deserialize(this,e);if(this.nodes.set(o.id,o),n){const i=o.serializeConnections();this.changes.addChange({type:"add",source:"node",applyChange:()=>{this.addNode(o.serialize(),!1),i.forEach(s=>{this.addConnection(s,!1)})},undoChange:()=>{this.removeNode(o.id,!1)}})}return o}updateNode(e,n,o=!0){if(!this.nodes.has(e))return;const i=this.nodes.get(e);if(o){const s=this.nodes.get(e),r=s.serializeConnections(),c=()=>{this.updateNode(e,n,!1)},d=()=>{this.updateNode(e,s,!1),r.forEach(l=>{this.addConnection(l,!1)})};this.changes.addChange({type:"update",source:"node",applyChange:c,undoChange:d})}this.eventStore.onNodeDataChanged.publish({nodeId:e,data:n}),i.updateWithPrevious(Pt(s=>Object.assign(s,n)))}removeNode(e,n=!0){if(this.nodes.has(e)){if(this.mouseData.deselectNode(),n){const o=this.nodes.get(e),i=o.serializeConnections();this.changes.addChange({type:"remove",source:"node",applyChange:()=>{this.removeNode(e,!1)},undoChange:()=>{this.addNode(o.serialize(),!1),i.forEach(s=>{this.addConnection(s,!1)})}})}this.removeIncomingConnections(e),this.removeOutgoingConnections(e),this.nodes.delete(e)}}removeIncomingConnections(e){this.nodes.has(e)&&this.nodes.get(e).connectorSections.forEach(n=>{n.connectors.forEach(o=>{o.sources.forEach(({sourceConnector:i})=>{i.destinations.filterInPlace(({destinationConnector:s})=>s.parentSection.parentNode.id!==e)}),o.sources=new Y([])})})}removeOutgoingConnections(e){this.nodes.has(e)&&this.nodes.get(e).connectorSections.forEach(n=>{n.connectors.forEach(o=>{o.destinations.forEach(({destinationConnector:i})=>{i.sources.filterInPlace(({sourceConnector:s})=>s.parentSection.parentNode.id!==e)}),o.destinations=new Y([])})})}getAllSourceConnectors(e){return this.nodes.has(e)?this.nodes.get(e).getAllSourceConnectors():[]}getAllDestinationConnectors(e){return this.nodes.has(e)?this.nodes.get(e).getAllDestinationConnectors():[]}getAllSourceConnections(e){return this.nodes.has(e)?this.nodes.get(e).getAllSourceConnections():[]}getAllDestinationConnections(e){return this.nodes.has(e)?this.nodes.get(e).getAllDestinationConnections():[]}getNextFreeNodeId(){let e="0";for(let n=1;this.nodes.has(e);++n)e=n.toString();return e}addConnection(e,n=!0){const{sourceNodeId:o,sourceConnectorId:i,destinationNodeId:s,destinationConnectorId:r,css:c}=e;if(!this.nodes.has(o)||!this.nodes.has(s))return;const d=this.nodes.get(o),l=this.nodes.get(s),a=d.getConnector(i),h=l.getConnector(r);!a||!h||a.destinations.some(f=>f.destinationConnector===h)||(n&&this.changes.addChange({type:"add",source:"connection",applyChange:()=>this.addConnection(e,!1),undoChange:()=>this.removeConnection(o,i,s,r,!1)}),a.destinations.push(new Ot({destinationConnector:h,css:c??{}})),h.sources.push(new xt({sourceConnector:a})))}removeConnection(e,n,o,i,s=!0){if(!this.nodes.has(e)||!this.nodes.has(o))return;const r=this.nodes.get(e),c=this.nodes.get(o),d=r.getConnector(n),l=c.getConnector(i);if(!(!d||!l)){if(s){const a=d.destinations.find(C=>C.destinationConnector.parentSection.parentNode.id===o)?.css,h=()=>{this.addConnection({sourceNodeId:e,sourceConnectorId:n,destinationNodeId:o,destinationConnectorId:i,css:a},!1)},f=()=>{this.removeConnection(e,n,o,i,!1)};this.changes.addChange({type:"remove",source:"connection",applyChange:f,undoChange:h})}d.destinations.filterInPlace(a=>a.destinationConnector.parentSection.parentNode.id!==o),l.sources.filterInPlace(a=>a.sourceConnector.parentSection.parentNode.id!==e)}}updateHeldNodePosition(e){const n=this.mouseData.heldNodeId;if(!n||!this.nodes.has(n))return;this.nodes.get(n).updateWithPrevious(i=>({position:i.position.add(e)}))}setupDefaultEventHandlers(){this.eventStore.onNodeConnected.subscribeMultiple([{name:"create-connection",event:e=>this.addConnection({sourceNodeId:e.inputNodeId,sourceConnectorId:e.inputId,destinationNodeId:e.outputNodeId,destinationConnectorId:e.outputId})},{name:"reset-mouse-data",event:()=>this.mouseData.reset()}]),this.eventStore.onMouseMoveInNodeflow.subscribeMultiple([{name:"update-background-position",event:({event:e})=>{this.updateBackgroundPosition(u.of(e.movementX,e.movementY))}}]),this.eventStore.onPointerUpInNodeflow.subscribeMultiple([{name:"stop-propagation",event:({event:e})=>{e.stopPropagation(),e.preventDefault()}},{name:"reset-mouse-data",event:()=>this.mouseData.updateWithPrevious(e=>({isDraggingNode:!1,heldConnectorId:void 0,heldNodeId:e.heldConnectorId?void 0:e.heldNodeId}))}]),this.eventStore.onTouchStartInNodeflow.subscribeMultiple([{name:"stop-propagation",event:({event:e})=>e.stopPropagation()},{name:"clear-held-keys",event:({event:e})=>{e.touches.length===1&&N.clear()}},{name:"handle-pinch",event:({event:e})=>{const{touches:n}=e;if(n.length!==2)return;const{pageX:o,pageY:i}=e.touches[0],{pageX:s,pageY:r}=e.touches[1];this.pinchDistance=Math.hypot(o-s,i-r)}},{name:"update-mouse-data",event:({event:e})=>{const{touches:n}=e;if(n.length!==1)return;const o=n[0],i=u.fromEvent(o);this.mouseData.update({isDraggingNode:!0,heldNodeId:void 0,mousePosition:i,clickStartPosition:u.of(i.x/this.zoomLevel-this.position.x,i.y/this.zoomLevel-this.position.y)})}}]),this.eventStore.onTouchMoveInNodeflow.subscribeMultiple([{name:"handle-pinch",event:({event:e})=>{const{touches:n}=e;if(n.length!==2)return;const{pageX:o,pageY:i}=n[0],{pageX:s,pageY:r}=n[1],c=Math.hypot(o-s,i-r),d=u.of((o+s)/2,(i+r)/2);this.updateZoom(c-this.pinchDistance,d),this.pinchDistance=c}},{name:"update-mouse-data",event:({event:e})=>{const{touches:n}=e;n.length===1&&this.mouseData.updateWithPrevious(o=>{const i=u.fromEvent(n[0]);return this.updateBackgroundPosition(i.subtract(o.mousePosition)),{mousePosition:i}})}}]),this.eventStore.onKeyUpInNodeflow.subscribe("remove-held-key",({event:e})=>N.delete(e.key)),this.eventStore.onKeyDownInNodeflow.subscribeMultiple([{name:"add-held-key",event:({event:e})=>N.add(e.key)},{name:"handle-controls",event:({event:e})=>{switch(e.code){case"Delete":this.mouseData.heldNodeId?this.removeNode(this.mouseData.heldNodeId):this.mouseData.heldConnection&&this.removeConnection(this.mouseData.heldConnection.sourceConnector.parentSection.parentNode.id,this.mouseData.heldConnection.sourceConnector.id,this.mouseData.heldConnection.destinationConnector.parentSection.parentNode.id,this.mouseData.heldConnection.destinationConnector.id);break;case"Escape":this.mouseData.deselectNode();break;case"Space":this.mouseData.heldNodeId?console.log(this.nodes.get(this.mouseData.heldNodeId)):console.log(this.nodes);break;case"Equal":case"Minus":e.ctrlKey&&(e.preventDefault(),this.updateZoom(w.KEYBOARD_ZOOM_AMOUNT*(e.code==="Equal"?1:-1),Se().divideBy(2)));break;case"KeyZ":if(!e.ctrlKey)break;e.preventDefault(),e.shiftKey?this.changes.redo():this.changes.undo();break}}}]),this.eventStore.onWheelInNodeflow.subscribeMultiple([{name:"update-zoom",event:({event:e})=>{this.updateZoom(-e.deltaY,u.fromEvent(e))}},{name:"prevent-scroll",event:({event:e})=>{e.preventDefault()}}]),this.eventStore.onMouseDownInNodeflow.subscribeMultiple([{name:"reset-movement",event:()=>this.resetMovement()},{name:"reset-mouse-data",event:({event:e})=>this.mouseData.update({clickStartPosition:u.of(e.clientX/this.zoomLevel-this.position.x,e.clientY/this.zoomLevel-this.position.y),isDraggingNode:!0,heldConnection:void 0,heldConnectorId:void 0,heldNodeId:void 0,mousePosition:u.fromEvent(e)})},{name:"stop-propagation",event:({event:e})=>e.stopPropagation()}]),this.eventStore.onMouseDownInConnector.subscribeMultiple([{name:"stop-propagation",event:({event:e})=>e.stopPropagation()},{name:"start-creating-connection",event:({event:e,nodeId:n,connectorId:o})=>{this.mouseData.startCreatingConnection(n,u.fromEvent(e),o)}}]),this.eventStore.onTouchStartInConnector.subscribeMultiple([{name:"stop-propagation",event:({event:e})=>e.stopPropagation()},{name:"start-creating-connection",event:({event:e,nodeId:n,connectorId:o})=>{const{clientX:i,clientY:s}=e.touches[0];this.mouseData.startCreatingConnection(n,u.of(i,s),o)}}]),this.eventStore.onPointerUpInConnector.subscribeMultiple([{name:"stop-propagation",event:({event:e})=>{e.preventDefault(),e.stopPropagation()},priority:2},{name:"connect-held-nodes",event:({event:e,nodeId:n,connectorId:o})=>{this.mouseData.heldConnectorId&&this.eventStore.onNodeConnected.publish({outputNodeId:this.mouseData.heldNodeId,outputId:this.mouseData.heldConnectorId,inputNodeId:n,inputId:o,event:e})},priority:2},{name:"reset-mouse-data",event:()=>this.mouseData.update({isDraggingNode:!1,heldConnectorId:void 0,heldNodeId:void 0}),priority:1}]),this.eventStore.onMouseDownInNode.subscribeMultiple([{name:"select-node",event:({event:e,nodeId:n})=>{this.mouseData.selectNode(n,u.fromEvent(e))}},{name:"stop-propagation",event:({event:e})=>e.stopPropagation()}]),this.eventStore.onTouchStartInNode.subscribeMultiple([{name:"select-node",event:({event:e,nodeId:n})=>{const{clientX:o,clientY:i}=e.touches[0];this.mouseData.selectNode(n,u.of(o,i))}},{name:"stop-propagation",event:({event:e})=>e.stopPropagation()}]),this.eventStore.onPointerDownInNodeCurve.subscribeMultiple([{name:"stop-propagation",event:({event:e})=>{e.preventDefault(),e.stopPropagation()},priority:1},{name:"update-mouse-data",event:({event:e,sourceConnector:n,destinationConnector:o})=>this.mouseData.update({isDraggingNode:!1,heldConnection:{sourceConnector:n,destinationConnector:o},heldConnectorId:void 0,heldNodeId:void 0,mousePosition:u.fromEvent(e)})}]),this.eventStore.onPointerUpInNode.subscribeMultiple([{name:"reset-mouse-data",event:()=>this.mouseData.update({isDraggingNode:!1,heldConnection:void 0,heldConnectorId:void 0})}])}}const Lt=(t,e)=>u.of((e.x-t.x)/1.5,0),Tt=(t,e)=>u.of(0,(e.y-t.y)/1.5),Bt=(t,e,n,o)=>{const i=t.subtract(n),s=e.subtract(o),r=n.add(i.multiplyBy(w.CURVE_MULTIPLIER)),c=o.add(s.multiplyBy(w.CURVE_MULTIPLIER));return{startCurve:r,endCurve:c}},Wt=(t,e,n,o)=>{const{startCurve:i,endCurve:s}=Bt(t,e,n,o);return`M ${t.x} ${t.y} C ${i.x} ${i.y}, ${s.x} ${s.y}, ${e.x} ${e.y}`},Ut=(t,e,n,o)=>`M ${t.x} ${t.y} C ${t.x+n} ${t.y+o}, ${e.x-n} ${e.y-o}, ${e.x} ${e.y}`,Rt=(t,e,n,o)=>{const{x:i,y:s}=j.getDefaultCurve(t,e);return j.createDefaultPathString(t,e,i,s)},j={createNodePathCurve:Wt,createDraggingPathCurve:Rt,getDefaultCurve:(t,e)=>u.zero(),getHorizontalCurve:Lt,getVerticalCurve:Tt,createDefaultPathString:Ut},je=(t,e)=>{j[t]=e},Ke=B("<div>"),Ft=t=>{const e=z(()=>t.nodeflowData.nodes.get(t.nodeId)),[n,o]=J(!1);return Ie(()=>{t.nodeflowData.mouseData.heldNodeId!==t.nodeId||!t.nodeflowData.mouseData.isDraggingNode||(e().position=t.nodeflowData.mouseData.mousePosition.divideBy(t.nodeflowData.zoomLevel).subtract(t.nodeflowData.mouseData.clickStartPosition??u.zero()))}),Ae(()=>{e().resizeObserver&&(e().resizeObserver.disconnect(),Array.from(e().connectorSections.values()).forEach(i=>{Array.from(i.connectors.values()).forEach(s=>{s.resizeObserver&&s.resizeObserver.disconnect()})}))}),(()=>{const i=Ke();return i.$$pointerup=s=>t.nodeflowData.eventStore.onPointerUpInNode.publish({event:s,nodeId:t.nodeId}),i.$$touchstart=s=>t.nodeflowData.eventStore.onTouchStartInNode.publish({event:s,nodeId:t.nodeId}),i.$$mousedown=s=>t.nodeflowData.eventStore.onMouseDownInNode.publish({event:s,nodeId:t.nodeId}),_e(s=>setTimeout(()=>{if(!s)return;const r=new ResizeObserver(()=>{e().update({size:u.of(s.clientWidth,s.clientHeight)}),Array.from(e().connectorSections.values()).forEach(d=>Array.from(d.connectors.values()).forEach(l=>{const a=l.ref;a&&(l.position=u.of((a?.parentElement?.offsetLeft??0)+a.offsetLeft,(a?.parentElement?.offsetTop??0)+a.offsetTop))}))});r.observe(s);const c=e().centered?u.of(s.clientWidth,s.clientHeight).divideBy(2):u.zero();e().update({offset:u.of(s.clientLeft,s.clientTop),ref:s,resizeObserver:r,position:e().position.subtract(c),size:u.of(s.clientWidth,s.clientHeight)}),o(!0)}),i),S(i,()=>e().display({node:e()}),null),S(i,m(X,{get each(){return Array.from(e().connectorSections.entries())},children:([s,r])=>(()=>{const c=Ke();return S(c,m(X,{get each(){return Array.from(r.connectors.entries())},children:([d,l])=>m(Mt,{connector:l,connectorId:d,get nodeId(){return t.nodeId},sectionId:s,get nodeflowData(){return t.nodeflowData}})})),b(()=>ne(c,r?.css)),c})()}),null),b(s=>{const r=`${e().position.x}px`,c=`${e().position.y}px`,d=n()?1:0,l={[e()?.css?.normal??""]:!0,[e()?.css?.selected??""]:t.nodeflowData.mouseData.heldNodeId===t.nodeId};return r!==s._v$&&((s._v$=r)!=null?i.style.setProperty("left",r):i.style.removeProperty("left")),c!==s._v$2&&((s._v$2=c)!=null?i.style.setProperty("top",c):i.style.removeProperty("top")),d!==s._v$3&&((s._v$3=d)!=null?i.style.setProperty("opacity",d):i.style.removeProperty("opacity")),s._v$4=Je(i,l,s._v$4),s},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),i})()};ce(["mousedown","touchstart","pointerup"]);const jt=B('<svg><path stroke="black" stroke-width="1" fill="none"></svg>',!1,!0),Kt=t=>{const e=z(()=>t.nodeflowData.nodes.get(t.sourceNodeId)),n=z(()=>t.nodeflowData.nodes.get(t.destinationNodeId)),o=z(()=>e().getConnector(t.sourceConnectorId)),i=z(()=>n().getConnector(t.destinationConnectorId)),s=z(()=>!e()||!n()?-1:o()?.destinations?.findIndex(r=>r.destinationConnector===i())??-1);return Ie(()=>{if(s()<0)return;const{position:r,offset:c,size:d}=e(),{position:l,offset:a,size:h}=n(),f=e().getSectionFromConnector(t.sourceConnectorId),I=n().getSectionFromConnector(t.destinationConnectorId).connectors.get(t.destinationConnectorId),A=f.connectors.get(t.sourceConnectorId),U=r.add(c,A.position,A.size.divideBy(2)),R=l.add(a,I.position,I.size.divideBy(2));o().destinations.get(s()).path={start:U,end:R,path:j.createNodePathCurve(U,R,r.add(c).add(d.divideBy(2)),l.add(a).add(h.divideBy(2)))}}),(()=>{const r=jt();return r.$$pointerdown=c=>{t.nodeflowData.eventStore.onPointerDownInNodeCurve.publish({event:c,sourceConnector:o(),destinationConnector:i()})},r.style.setProperty("cursor","pointer"),r.style.setProperty("pointer-events","visibleStroke"),b(c=>{const d=o().destinations.get(s()).path?.path,l={[t.css?.normal??""]:!0,[t.css?.selected??""]:t.nodeflowData.mouseData.heldConnection?.sourceConnector.parentSection.parentNode.id===t.sourceNodeId&&t.nodeflowData.mouseData.heldConnection?.sourceConnector.id===t.sourceConnectorId&&t.nodeflowData.mouseData.heldConnection?.destinationConnector.parentSection.parentNode.id===t.destinationNodeId&&t.nodeflowData.mouseData.heldConnection?.destinationConnector.id===t.destinationConnectorId};return d!==c._v$&&$e(r,"d",c._v$=d),c._v$2=Je(r,l,c._v$2),c},{_v$:void 0,_v$2:void 0}),r})()};ce(["pointerdown"]);const Ht=B('<div tabindex="0"><div><svg>'),Xt=t=>e=>(()=>{const n=Ht(),o=n.firstChild,i=o.firstChild;return n.$$touchmove=s=>t.eventStore.onTouchMoveInNodeflow.publish({event:s}),n.$$touchstart=s=>t.eventStore.onTouchStartInNodeflow.publish({event:s}),n.$$keyup=s=>t.eventStore.onKeyUpInNodeflow.publish({event:s}),n.$$keydown=s=>t.eventStore.onKeyDownInNodeflow.publish({event:s}),n.$$mousedown=s=>t.eventStore.onMouseDownInNodeflow.publish({event:s}),n.addEventListener("wheel",s=>t.eventStore.onWheelInNodeflow.publish({event:s})),n.$$pointerup=s=>t.eventStore.onPointerUpInNodeflow.publish({event:s}),n.$$mousemove=s=>t.eventStore.onMouseMoveInNodeflow.publish({event:s}),_e(s=>{new ResizeObserver(()=>{t.update({size:u.of(s.clientWidth,s.clientHeight),startPosition:u.of(s.offsetLeft,s.offsetTop)})}).observe(s)},n),o.style.setProperty("position","absolute"),o.style.setProperty("transform-origin","center"),o.style.setProperty("transition","scale 0.1s ease-out"),S(o,m(X,{get each(){return Array.from(t.nodes.keys())},children:s=>m(Ft,{nodeId:s,nodeflowData:t})}),i),i.style.setProperty("z-index","2"),i.style.setProperty("position","absolute"),i.style.setProperty("width","1px"),i.style.setProperty("height","1px"),i.style.setProperty("pointer-events","none"),i.style.setProperty("overflow","visible"),S(i,m(X,{get each(){return Array.from(t.nodes.entries())},children:([s,r])=>m(X,{get each(){return r.getAllConnectors()},children:c=>m(X,{get each(){return c.destinations.array},children:d=>m(Kt,{nodeflowData:t,sourceNodeId:s,get sourceConnectorId(){return c.id},get destinationNodeId(){return d.destinationConnector.parentSection.parentNode.id},get destinationConnectorId(){return d.destinationConnector.id},get css(){return d.css}})})})})),S(o,m(Qe,{get when(){return t.mouseData.heldNodeId&&t.mouseData.heldConnectorId},get children(){return m(Zt,{get css(){return e?.css?.newCurve},nodeflowData:t})}}),null),b(s=>{const r=e?.css?.nodeflow,c=e.height,d=e.width,l=`scale(${t.zoomLevel}) translate(${t.position.x}px, ${t.position.y}px)`;return r!==s._v$&&ne(n,s._v$=r),c!==s._v$2&&((s._v$2=c)!=null?n.style.setProperty("height",c):n.style.removeProperty("height")),d!==s._v$3&&((s._v$3=d)!=null?n.style.setProperty("width",d):n.style.removeProperty("width")),l!==s._v$4&&((s._v$4=l)!=null?o.style.setProperty("transform",l):o.style.removeProperty("transform")),s},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),n})();ce(["mousemove","pointerup","mousedown","keydown","keyup","touchstart","touchmove"]);class V{constructor(){this.nodeflows=new Map,this.globalEventStore={onMouseMoveInDocument:new Ee,onPointerLeaveFromDocument:new Ee,onPointerUpInDocument:new Ee},this.setupDefaultEventHandlers()}static get(){return this.instance||(V.instance=new V),V.instance}createCanvas(e){const n=new Ne;return this.nodeflows.set(e,n),[n,Xt(n)]}getNodeflow(e){return this.nodeflows.get(e)}removeNodeflow(e){this.nodeflows.delete(e)}clear(){this.nodeflows.clear()}hasNodeflow(e){return this.nodeflows.has(e)}setupDefaultEventHandlers(){document.onmousemove=e=>this.globalEventStore.onMouseMoveInDocument.publish({event:e}),document.onpointerleave=e=>this.globalEventStore.onPointerLeaveFromDocument.publish({event:e}),document.onpointerup=e=>this.globalEventStore.onPointerUpInDocument.publish({event:e}),this.globalEventStore.onMouseMoveInDocument.subscribeMultiple([{name:"update-mouse-position",event:({event:e})=>{this.nodeflows.forEach(n=>{n.mouseData.mousePosition=u.fromEvent(e)})}}]),this.globalEventStore.onPointerLeaveFromDocument.subscribeMultiple([{name:"reset-mouse-data",event:()=>{this.nodeflows.forEach(e=>{e.mouseData.reset()})}}]),this.globalEventStore.onPointerUpInDocument.subscribeMultiple([])}}const Yt=B('<svg><path stroke="black" stroke-width="1" fill="transparent">'),Zt=t=>{const e=z(()=>{const n=t.nodeflowData.mouseData.heldNodeId,o=t.nodeflowData.mouseData.heldConnectorId;if(!n||!o)return;const i=t.nodeflowData.nodes.get(n),{position:s,offset:r,size:c}=i,d=i.getConnector(o),l=s.add(r,d.position,d.size.divideBy(2)),a=t.nodeflowData.mouseData.globalMousePosition();return{start:l,end:a,path:j.createDraggingPathCurve(l,a,s.add(r).add(c.divideBy(2)),a)}});return(()=>{const n=Yt(),o=n.firstChild;return n.style.setProperty("z-index","2"),n.style.setProperty("position","absolute"),n.style.setProperty("width","1px"),n.style.setProperty("height","1px"),n.style.setProperty("pointer-events","none"),n.style.setProperty("overflow","visible"),b(i=>{const s=e()?.path,r=t.css;return s!==i._v$&&$e(o,"d",i._v$=s),r!==i._v$2&&$e(o,"class",i._v$2=r),i},{_v$:void 0,_v$2:void 0}),n})()},Vt="_connection_gh35w_1",qt="_selectedConnection_gh35w_16",Gt="_newConnection_gh35w_27",ie={connection:Vt,selectedConnection:qt,newConnection:Gt},Qt="_node_zneqc_1",Jt="_selectedNode_zneqc_19",en="_inputConnector_zneqc_41",tn="_outputConnector_zneqc_54",nn="_inputsSection_zneqc_67",on="_outputsSection_zneqc_78",k={node:Qt,selectedNode:Jt,inputConnector:en,outputConnector:tn,inputsSection:nn,outputsSection:on},sn="_nodeflow_1ic3z_1",rn={nodeflow:sn},cn=B("<div><p></p><p>"),dn=t=>(()=>{const e=cn(),n=e.firstChild,o=n.nextSibling;return e.style.setProperty("padding","1rem"),e.style.setProperty("padding-left","2rem"),S(n,()=>t.node.position.x.toFixed(2)),S(o,()=>t.node.position.y.toFixed(2)),e})(),rt=(t,e,n=!1)=>{const o=t.addNode({css:{normal:k.node,selected:k.selectedNode},position:e,display:dn,centered:n}),i=o.addConnectorSection("inputs",k.inputsSection,!1),s=o.addConnectorSection("outputs",k.outputsSection,!1),r=Math.random()*6;for(let d=0;d<r;d++)s.addConnector({css:k.outputConnector},!1);const c=Math.random()*6;for(let d=0;d<c;d++)i.addConnector({css:k.inputConnector},!1);return o},an=t=>{t.eventStore.onNodeConnected.subscribe("create-connection",e=>{e.outputNodeId!==e.inputNodeId&&t.addConnection({sourceNodeId:e.outputNodeId,sourceConnectorId:e.outputId,destinationNodeId:e.inputNodeId,destinationConnectorId:e.inputId,css:{normal:ie.connection,selected:ie.selectedConnection}})}),je("getDefaultCurve",j.getHorizontalCurve),je("createNodePathCurve",j.createDraggingPathCurve)},ln=(t,e=50)=>{for(let n=0;n<e;n++)rt(t,u.of(Math.random()*2e3,Math.random()*2e3))},un=t=>{const e=t.nodes.size;for(let n=0;n<e;n++){const o=Math.floor(Math.random()*e),i=Math.floor(Math.random()*e);if(!t.nodes.has(o.toString())||!t.nodes.has(i.toString()))continue;const s=t.nodes.get(o.toString()),r=t.nodes.get(i.toString()),c=s.connectorSections.get("outputs").connectors,d=r.connectorSections.get("inputs").connectors,l=Array.from(c.values()),a=Array.from(d.values());if(l.length===0||a.length===0)continue;const h=l[Math.floor(Math.random()*l.length)],f=a[Math.floor(Math.random()*a.length)];o===i||r.getTotalConnectedInputs(f.toString())>0||t.addConnection({sourceNodeId:o.toString(),sourceConnectorId:h.id,destinationNodeId:i.toString(),destinationConnectorId:f.id,css:{normal:ie.connection,selected:ie.selectedConnection}})}},hn=B("<div>"),fn=B("<div><div><div>Generic node"),pn=()=>{const[t,e]=J(void 0),[n,o]=V.get().createCanvas("main"),i=s=>{if(!t())return;e(void 0);const r=u.fromEvent(s.event),c=n.startPosition,d=n.size;if(!r.isWithinRect(c,d))return;const l=r.subtract(c).divideBy(n.zoomLevel).subtract(n.position);rt(n,l,!0)};return at(()=>{an(n),ln(n),un(n),V.get().globalEventStore.onPointerUpInDocument.subscribe("create-node",i)}),(()=>{const s=fn(),r=s.firstChild,c=r.firstChild;return s.style.setProperty("display","flex"),s.style.setProperty("flex-direction","column-reverse"),S(s,m(o,{get css(){return{newCurve:ie.newConnection,nodeflow:rn.nodeflow}},height:"100%",width:"100%"}),r),r.style.setProperty("width","100%"),r.style.setProperty("min-height","300px"),r.style.setProperty("background-color","gray"),r.style.setProperty("opacity","0.5"),r.style.setProperty("display","flex"),r.style.setProperty("align-items","center"),r.style.setProperty("justify-content","center"),c.$$pointerdown=()=>{e("Generic node")},c.style.setProperty("width","150px"),c.style.setProperty("height","90px"),c.style.setProperty("display","flex"),c.style.setProperty("align-items","center"),c.style.setProperty("justify-content","center"),S(s,m(Qe,{get when(){return t()},get children(){const d=hn();return d.style.setProperty("position","absolute"),d.style.setProperty("width","150px"),d.style.setProperty("height","90px"),d.style.setProperty("display","flex"),d.style.setProperty("align-items","center"),d.style.setProperty("justify-content","center"),d.style.setProperty("z-index","1000"),S(d,t),b(l=>{const a=`${n.mouseData.mousePosition.x-75}px`,h=`${n.mouseData.mousePosition.y-45}px`,f=k.node;return a!==l._v$&&((l._v$=a)!=null?d.style.setProperty("left",a):d.style.removeProperty("left")),h!==l._v$2&&((l._v$2=h)!=null?d.style.setProperty("top",h):d.style.removeProperty("top")),f!==l._v$3&&ne(d,l._v$3=f),l},{_v$:void 0,_v$2:void 0,_v$3:void 0}),d}}),null),b(d=>{const l=`${Se().x}px`,a=`${Se().y}px`,h=k.node;return l!==d._v$4&&((d._v$4=l)!=null?s.style.setProperty("width",l):s.style.removeProperty("width")),a!==d._v$5&&((d._v$5=a)!=null?s.style.setProperty("height",a):s.style.removeProperty("height")),h!==d._v$6&&ne(c,d._v$6=h),d},{_v$4:void 0,_v$5:void 0,_v$6:void 0}),s})()};ce(["pointerdown"]);const gn=document.getElementById("root");Ct(()=>m(pn,{}),gn);
