(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function o(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=o(s);fetch(s.href,i)}})();const Nt=(t,e)=>t===e,Q=Symbol("solid-proxy"),Le=Symbol("solid-track"),Ce={equals:Nt};let nt=at;const X=1,De=2,st={owned:null,cleanups:null,context:null,owner:null};var N=null;let ke=null,bt=null,C=null,M=null,G=null,Ae=0;function ye(t,e){const o=C,n=N,s=t.length===0,i=e===void 0?n:e,r=s?st:{owned:null,cleanups:null,context:i?i.context:null,owner:i},a=s?t:()=>t(()=>j(()=>ue(r)));N=r,C=null;try{return ce(a,!0)}finally{C=o,N=n}}function pe(t,e){e=e?Object.assign({},Ce,e):Ce;const o={value:t,observers:null,observerSlots:null,comparator:e.equals||void 0},n=s=>(typeof s=="function"&&(s=s(o.value)),rt(o,s));return[it.bind(o),n]}function z(t,e,o){const n=Re(t,e,!1,X);ge(n)}function he(t,e,o){nt=Mt;const n=Re(t,e,!1,X);n.user=!0,G?G.push(n):ge(n)}function O(t,e,o){o=o?Object.assign({},Ce,o):Ce;const n=Re(t,e,!0,0);return n.observers=null,n.observerSlots=null,n.comparator=o.equals||void 0,ge(n),it.bind(n)}function me(t){return ce(t,!1)}function j(t){if(C===null)return t();const e=C;C=null;try{return t()}finally{C=e}}function St(t){he(()=>j(t))}function Fe(t){return N===null||(N.cleanups===null?N.cleanups=[t]:N.cleanups.push(t)),t}function Ne(){return C}function it(){if(this.sources&&this.state)if(this.state===X)ge(this);else{const t=M;M=null,ce(()=>Se(this),!1),M=t}if(C){const t=this.observers?this.observers.length:0;C.sources?(C.sources.push(this),C.sourceSlots.push(t)):(C.sources=[this],C.sourceSlots=[t]),this.observers?(this.observers.push(C),this.observerSlots.push(C.sources.length-1)):(this.observers=[C],this.observerSlots=[C.sources.length-1])}return this.value}function rt(t,e,o){let n=t.value;return(!t.comparator||!t.comparator(n,e))&&(t.value=e,t.observers&&t.observers.length&&ce(()=>{for(let s=0;s<t.observers.length;s+=1){const i=t.observers[s],r=ke&&ke.running;r&&ke.disposed.has(i),(r?!i.tState:!i.state)&&(i.pure?M.push(i):G.push(i),i.observers&&ct(i)),r||(i.state=X)}if(M.length>1e6)throw M=[],new Error},!1)),e}function ge(t){if(!t.fn)return;ue(t);const e=Ae;It(t,t.value,e)}function It(t,e,o){let n;const s=N,i=C;C=N=t;try{n=t.fn(e)}catch(r){return t.pure&&(t.state=X,t.owned&&t.owned.forEach(ue),t.owned=null),t.updatedAt=o+1,dt(r)}finally{C=i,N=s}(!t.updatedAt||t.updatedAt<=o)&&(t.updatedAt!=null&&"observers"in t?rt(t,n):t.value=n,t.updatedAt=o)}function Re(t,e,o,n=X,s){const i={fn:t,state:n,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:N,context:N?N.context:null,pure:o};return N===null||N!==st&&(N.owned?N.owned.push(i):N.owned=[i]),i}function be(t){if(t.state===0)return;if(t.state===De)return Se(t);if(t.suspense&&j(t.suspense.inFallback))return t.suspense.effects.push(t);const e=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<Ae);)t.state&&e.push(t);for(let o=e.length-1;o>=0;o--)if(t=e[o],t.state===X)ge(t);else if(t.state===De){const n=M;M=null,ce(()=>Se(t,e[0]),!1),M=n}}function ce(t,e){if(M)return t();let o=!1;e||(M=[]),G?o=!0:G=[],Ae++;try{const n=t();return Et(o),n}catch(n){o||(G=null),M=null,dt(n)}}function Et(t){if(M&&(at(M),M=null),t)return;const e=G;G=null,e.length&&ce(()=>nt(e),!1)}function at(t){for(let e=0;e<t.length;e++)be(t[e])}function Mt(t){let e,o=0;for(e=0;e<t.length;e++){const n=t[e];n.user?t[o++]=n:be(n)}for(e=0;e<o;e++)be(t[e])}function Se(t,e){t.state=0;for(let o=0;o<t.sources.length;o+=1){const n=t.sources[o];if(n.sources){const s=n.state;s===X?n!==e&&(!n.updatedAt||n.updatedAt<Ae)&&be(n):s===De&&Se(n,e)}}}function ct(t){for(let e=0;e<t.observers.length;e+=1){const o=t.observers[e];o.state||(o.state=De,o.pure?M.push(o):G.push(o),o.observers&&ct(o))}}function ue(t){let e;if(t.sources)for(;t.sources.length;){const o=t.sources.pop(),n=t.sourceSlots.pop(),s=o.observers;if(s&&s.length){const i=s.pop(),r=o.observerSlots.pop();n<s.length&&(i.sourceSlots[r]=n,s[n]=i,o.observerSlots[n]=r)}}if(t.tOwned){for(e=t.tOwned.length-1;e>=0;e--)ue(t.tOwned[e]);delete t.tOwned}if(t.owned){for(e=t.owned.length-1;e>=0;e--)ue(t.owned[e]);t.owned=null}if(t.cleanups){for(e=t.cleanups.length-1;e>=0;e--)t.cleanups[e]();t.cleanups=null}t.state=0}function Pt(t){return t instanceof Error?t:new Error(typeof t=="string"?t:"Unknown error",{cause:t})}function dt(t,e=N){throw Pt(t)}const xt=Symbol("fallback");function Ye(t){for(let e=0;e<t.length;e++)t[e]()}function At(t,e,o={}){let n=[],s=[],i=[],r=0,a=e.length>1?[]:null;return Fe(()=>Ye(i)),()=>{let c=t()||[],l=c.length,h,d;return c[Le],j(()=>{let v,w,P,k,ve,_,F,R,J;if(l===0)r!==0&&(Ye(i),i=[],n=[],s=[],r=0,a&&(a=[])),o.fallback&&(n=[xt],s[0]=ye(Dt=>(i[0]=Dt,o.fallback())),r=1);else if(r===0){for(s=new Array(l),d=0;d<l;d++)n[d]=c[d],s[d]=ye(g);r=l}else{for(P=new Array(l),k=new Array(l),a&&(ve=new Array(l)),_=0,F=Math.min(r,l);_<F&&n[_]===c[_];_++);for(F=r-1,R=l-1;F>=_&&R>=_&&n[F]===c[R];F--,R--)P[R]=s[F],k[R]=i[F],a&&(ve[R]=a[F]);for(v=new Map,w=new Array(R+1),d=R;d>=_;d--)J=c[d],h=v.get(J),w[d]=h===void 0?-1:h,v.set(J,d);for(h=_;h<=F;h++)J=n[h],d=v.get(J),d!==void 0&&d!==-1?(P[d]=s[h],k[d]=i[h],a&&(ve[d]=a[h]),d=w[d],v.set(J,d)):i[h]();for(d=_;d<l;d++)d in P?(s[d]=P[d],i[d]=k[d],a&&(a[d]=ve[d],a[d](d))):s[d]=ye(g);s=s.slice(0,r=l),n=c.slice(0)}return s});function g(v){if(i[d]=v,a){const[w,P]=pe(d);return a[d]=P,e(c[d],w)}return e(c[d])}}}function E(t,e){return j(()=>t(e||{}))}const zt=t=>`Stale read from <${t}>.`;function te(t){const e="fallback"in t&&{fallback:()=>t.fallback};return O(At(()=>t.each,t.children,e||void 0))}function Ie(t){const e=t.keyed,o=O(()=>t.when,void 0,{equals:(n,s)=>e?n===s:!n==!s});return O(()=>{const n=o();if(n){const s=t.children;return typeof s=="function"&&s.length>0?j(()=>s(e?n:()=>{if(!j(o))throw zt("Show");return t.when})):s}return t.fallback},void 0,void 0)}function kt(t,e,o){let n=o.length,s=e.length,i=n,r=0,a=0,c=e[s-1].nextSibling,l=null;for(;r<s||a<i;){if(e[r]===o[a]){r++,a++;continue}for(;e[s-1]===o[i-1];)s--,i--;if(s===r){const h=i<n?a?o[a-1].nextSibling:o[i-a]:c;for(;a<i;)t.insertBefore(o[a++],h)}else if(i===a)for(;r<s;)(!l||!l.has(e[r]))&&e[r].remove(),r++;else if(e[r]===o[i-1]&&o[a]===e[s-1]){const h=e[--s].nextSibling;t.insertBefore(o[a++],e[r++].nextSibling),t.insertBefore(o[--i],h),e[s]=o[i]}else{if(!l){l=new Map;let d=a;for(;d<i;)l.set(o[d],d++)}const h=l.get(e[r]);if(h!=null)if(a<h&&h<i){let d=r,g=1,v;for(;++d<s&&d<i&&!((v=l.get(e[d]))==null||v!==h+g);)g++;if(g>h-a){const w=e[r];for(;a<h;)t.insertBefore(o[a++],w)}else t.replaceChild(o[a++],e[r++])}else r++;else e[r++].remove()}}}const je="_$DX_DELEGATE";function Ot(t,e,o,n={}){let s;return ye(i=>{s=i,e===document?t():T(e,t(),e.firstChild?null:void 0,o)},n.owner),()=>{s(),e.textContent=""}}function B(t,e,o){let n;const s=()=>{const r=document.createElement("template");return r.innerHTML=t,o?r.content.firstChild.firstChild:r.content.firstChild},i=e?()=>j(()=>document.importNode(n||(n=s()),!0)):()=>(n||(n=s())).cloneNode(!0);return i.cloneNode=i,i}function ze(t,e=window.document){const o=e[je]||(e[je]=new Set);for(let n=0,s=t.length;n<s;n++){const i=t[n];o.has(i)||(o.add(i),e.addEventListener(i,Tt))}}function b(t,e,o){o==null?t.removeAttribute(e):t.setAttribute(e,o)}function lt(t,e){e==null?t.removeAttribute("class"):t.className=e}function Ke(t,e,o={}){const n=Object.keys(e||{}),s=Object.keys(o);let i,r;for(i=0,r=s.length;i<r;i++){const a=s[i];!a||a==="undefined"||e[a]||(Ve(t,a,!1),delete o[a])}for(i=0,r=n.length;i<r;i++){const a=n[i],c=!!e[a];!a||a==="undefined"||o[a]===c||!c||(Ve(t,a,!0),o[a]=c)}return o}function He(t,e,o){return j(()=>t(e,o))}function T(t,e,o,n){if(o!==void 0&&!n&&(n=[]),typeof e!="function")return Ee(t,e,n,o);z(s=>Ee(t,e(),s,o),n)}function Ve(t,e,o){const n=e.trim().split(/\s+/);for(let s=0,i=n.length;s<i;s++)t.classList.toggle(n[s],o)}function Tt(t){let e=t.target;const o=`$$${t.type}`,n=t.target,s=t.currentTarget,i=c=>Object.defineProperty(t,"target",{configurable:!0,value:c}),r=()=>{const c=e[o];if(c&&!e.disabled){const l=e[`${o}Data`];if(l!==void 0?c.call(e,l,t):c.call(e,t),t.cancelBubble)return}return e.host&&typeof e.host!="string"&&!e.host._$host&&e.contains(t.target)&&i(e.host),!0},a=()=>{for(;r()&&(e=e._$host||e.parentNode||e.host););};if(Object.defineProperty(t,"currentTarget",{configurable:!0,get(){return e||document}}),t.composedPath){const c=t.composedPath();i(c[0]);for(let l=0;l<c.length-2&&(e=c[l],!!r());l++){if(e._$host){e=e._$host,a();break}if(e.parentNode===s)break}}else a();i(n)}function Ee(t,e,o,n,s){for(;typeof o=="function";)o=o();if(e===o)return o;const i=typeof e,r=n!==void 0;if(t=r&&o[0]&&o[0].parentNode||t,i==="string"||i==="number"){if(i==="number"&&(e=e.toString(),e===o))return o;if(r){let a=o[0];a&&a.nodeType===3?a.data!==e&&(a.data=e):a=document.createTextNode(e),o=ee(t,o,n,a)}else o!==""&&typeof o=="string"?o=t.firstChild.data=e:o=t.textContent=e}else if(e==null||i==="boolean")o=ee(t,o,n);else{if(i==="function")return z(()=>{let a=e();for(;typeof a=="function";)a=a();o=Ee(t,a,o,n)}),()=>o;if(Array.isArray(e)){const a=[],c=o&&Array.isArray(o);if($e(a,e,o,s))return z(()=>o=Ee(t,a,o,n,!0)),()=>o;if(a.length===0){if(o=ee(t,o,n),r)return o}else c?o.length===0?Ze(t,a,n):kt(t,o,a):(o&&ee(t),Ze(t,a));o=a}else if(e.nodeType){if(Array.isArray(o)){if(r)return o=ee(t,o,n,e);ee(t,o,null,e)}else o==null||o===""||!t.firstChild?t.appendChild(e):t.replaceChild(e,t.firstChild);o=e}}return o}function $e(t,e,o,n){let s=!1;for(let i=0,r=e.length;i<r;i++){let a=e[i],c=o&&o[t.length],l;if(!(a==null||a===!0||a===!1))if((l=typeof a)=="object"&&a.nodeType)t.push(a);else if(Array.isArray(a))s=$e(t,a,c)||s;else if(l==="function")if(n){for(;typeof a=="function";)a=a();s=$e(t,Array.isArray(a)?a:[a],Array.isArray(c)?c:[c])||s}else t.push(a),s=!0;else{const h=String(a);c&&c.nodeType===3&&c.data===h?t.push(c):t.push(document.createTextNode(h))}}return s}function Ze(t,e,o=null){for(let n=0,s=e.length;n<s;n++)t.insertBefore(e[n],o)}function ee(t,e,o,n){if(o===void 0)return t.textContent="";const s=n||document.createTextNode("");if(e.length){let i=!1;for(let r=e.length-1;r>=0;r--){const a=e[r];if(s!==a){const c=a.parentNode===t;!i&&!r?c?t.replaceChild(s,a):t.insertBefore(s,o):c&&a.remove()}else i=!0}}else t.insertBefore(s,o);return[s]}const Me=Symbol("store-raw"),se=Symbol("store-node"),U=Symbol("store-has"),ht=Symbol("store-self");function ut(t){let e=t[Q];if(!e&&(Object.defineProperty(t,Q,{value:e=new Proxy(t,$t)}),!Array.isArray(t))){const o=Object.keys(t),n=Object.getOwnPropertyDescriptors(t);for(let s=0,i=o.length;s<i;s++){const r=o[s];n[r].get&&Object.defineProperty(t,r,{enumerable:n[r].enumerable,get:n[r].get.bind(e)})}}return e}function ie(t){let e;return t!=null&&typeof t=="object"&&(t[Q]||!(e=Object.getPrototypeOf(t))||e===Object.prototype||Array.isArray(t))}function re(t,e=new Set){let o,n,s,i;if(o=t!=null&&t[Me])return o;if(!ie(t)||e.has(t))return t;if(Array.isArray(t)){Object.isFrozen(t)?t=t.slice(0):e.add(t);for(let r=0,a=t.length;r<a;r++)s=t[r],(n=re(s,e))!==s&&(t[r]=n)}else{Object.isFrozen(t)?t=Object.assign({},t):e.add(t);const r=Object.keys(t),a=Object.getOwnPropertyDescriptors(t);for(let c=0,l=r.length;c<l;c++)i=r[c],!a[i].get&&(s=t[i],(n=re(s,e))!==s&&(t[i]=n))}return t}function Pe(t,e){let o=t[e];return o||Object.defineProperty(t,e,{value:o=Object.create(null)}),o}function fe(t,e,o){if(t[e])return t[e];const[n,s]=pe(o,{equals:!1,internal:!0});return n.$=s,t[e]=n}function Lt(t,e){const o=Reflect.getOwnPropertyDescriptor(t,e);return!o||o.get||!o.configurable||e===Q||e===se||(delete o.value,delete o.writable,o.get=()=>t[Q][e]),o}function ft(t){Ne()&&fe(Pe(t,se),ht)()}function Kt(t){return ft(t),Reflect.ownKeys(t)}const $t={get(t,e,o){if(e===Me)return t;if(e===Q)return o;if(e===Le)return ft(t),o;const n=Pe(t,se),s=n[e];let i=s?s():t[e];if(e===se||e===U||e==="__proto__")return i;if(!s){const r=Object.getOwnPropertyDescriptor(t,e);Ne()&&(typeof i!="function"||t.hasOwnProperty(e))&&!(r&&r.get)&&(i=fe(n,e,i)())}return ie(i)?ut(i):i},has(t,e){return e===Me||e===Q||e===Le||e===se||e===U||e==="__proto__"?!0:(Ne()&&fe(Pe(t,U),e)(),e in t)},set(){return!0},deleteProperty(){return!0},ownKeys:Kt,getOwnPropertyDescriptor:Lt};function ae(t,e,o,n=!1){if(!n&&t[e]===o)return;const s=t[e],i=t.length;o===void 0?(delete t[e],t[U]&&t[U][e]&&s!==void 0&&t[U][e].$()):(t[e]=o,t[U]&&t[U][e]&&s===void 0&&t[U][e].$());let r=Pe(t,se),a;if((a=fe(r,e,s))&&a.$(()=>o),Array.isArray(t)&&t.length!==i){for(let c=t.length;c<i;c++)(a=r[c])&&a.$();(a=fe(r,"length",i))&&a.$(t.length)}(a=r[ht])&&a.$()}function pt(t,e){const o=Object.keys(e);for(let n=0;n<o.length;n+=1){const s=o[n];ae(t,s,e[s])}}function Bt(t,e){if(typeof e=="function"&&(e=e(t)),e=re(e),Array.isArray(e)){if(t===e)return;let o=0,n=e.length;for(;o<n;o++){const s=e[o];t[o]!==s&&ae(t,o,s)}ae(t,"length",n)}else pt(t,e)}function de(t,e,o=[]){let n,s=t;if(e.length>1){n=e.shift();const r=typeof n,a=Array.isArray(t);if(Array.isArray(n)){for(let c=0;c<n.length;c++)de(t,[n[c]].concat(e),o);return}else if(a&&r==="function"){for(let c=0;c<t.length;c++)n(t[c],c)&&de(t,[c].concat(e),o);return}else if(a&&r==="object"){const{from:c=0,to:l=t.length-1,by:h=1}=n;for(let d=c;d<=l;d+=h)de(t,[d].concat(e),o);return}else if(e.length>1){de(t[n],e,[n].concat(o));return}s=t[n],o=[n].concat(o)}let i=e[0];typeof i=="function"&&(i=i(s,o),i===s)||n===void 0&&i==null||(i=re(i),n===void 0||ie(s)&&ie(i)&&!Array.isArray(i)?pt(s,i):ae(t,n,i))}function L(...[t,e]){const o=re(t||{}),n=Array.isArray(o),s=ut(o);function i(...r){me(()=>{n&&r.length===1?Bt(o,r[0]):de(o,r)})}return[s,i]}const xe=new WeakMap,gt={get(t,e){if(e===Me)return t;const o=t[e];let n;return ie(o)?xe.get(o)||(xe.set(o,n=new Proxy(o,gt)),n):o},set(t,e,o){return ae(t,e,re(o)),!0},deleteProperty(t,e){return ae(t,e,void 0,!0),!0}};function Be(t){return e=>{if(ie(e)){let o;(o=xe.get(e))||xe.set(e,o=new Proxy(e,gt)),t(o)}return e}}(function(){try{if(typeof document<"u"){var t=document.createElement("style");t.appendChild(document.createTextNode("@layer nodeflow{.nodeflowConnectorSection{position:absolute;display:flex;justify-content:space-evenly;width:0;height:0;top:50%;left:50%}.nodeflowNode{position:absolute;border:1px solid black;-webkit-user-select:none;user-select:none;z-index:1;cursor:grab}.nodeflowSelectionBox{position:absolute;background-color:#0000001a;border:2px solid rgba(0,0,0,.3);border-radius:4px;pointer-events:none;z-index:10}}")),document.head.appendChild(t)}}catch(e){console.error("vite-plugin-css-injected-by-js",e)}})();var _t=Object.defineProperty,Ft=(t,e,o)=>e in t?_t(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,f=(t,e,o)=>(Ft(t,typeof e!="symbol"?e+"":e,o),o),vt=(t,e,o)=>{if(!e.has(t))throw TypeError("Cannot "+o)},m=(t,e,o)=>(vt(t,e,"read from private field"),o?o.call(t):e.get(t)),_e=(t,e,o)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,o)},Rt=(t,e,o,n)=>(vt(t,e,"write to private field"),e.set(t,o),o);class u{constructor(e,o){f(this,"x"),f(this,"y"),this.x=e,this.y=o}static zero(){return new u(0,0)}static of(e,o){return new u(e,o)}static fromEvent(e){return new u(e.clientX,e.clientY)}static fromVec2(e){return new u(e.x,e.y)}copy(){return u.fromVec2(this)}serialize(){return{x:this.x,y:this.y}}static deserialize(e){return new u(e.x,e.y)}static deserializeOrDefault(e,o=u.zero()){return e?u.deserialize(e):o}add(...e){return e.reduce((o,n)=>new u(o.x+n.x,o.y+n.y),this)}subtract(...e){return e.reduce((o,n)=>new u(o.x-n.x,o.y-n.y),this)}multiply(...e){return e.reduce((o,n)=>new u(o.x*n.x,o.y*n.y),this)}divide(...e){return e.reduce((o,n)=>new u(n.x/o.x,n.y/o.y),this)}negate(){return new u(-this.x,-this.y)}shift(e){return new u(this.x+e,this.y+e)}multiplyBy(e){return new u(this.x*e,this.y*e)}divideBy(e){return new u(this.x/e,this.y/e)}isWithinRect(e,o){return this.x>=e.x&&this.x<=e.x+o.x&&this.y>=e.y&&this.y<=e.y+o.y}distanceTo(e){return Math.hypot(this.x-e.x,this.y-e.y)}abs(){return u.of(Math.abs(this.x),Math.abs(this.y))}equals(e){return this.x===e.x&&this.y===e.y}hashCode(){return`${this.x}:${this.y}`}get magnitude(){return Math.hypot(this.x,this.y)}normalize(){const e=this.magnitude;return e===0?u.zero():new u(this.x/e,this.y/e)}}var Ht=B("<div>");const Ut=t=>(()=>{var e=Ht();return e.$$pointerup=o=>t.nodeflowData.eventStore.onPointerUpInConnector.publish({event:o,nodeId:t.nodeId,connectorId:t.connectorId}),e.$$touchstart=o=>t.nodeflowData.eventStore.onTouchStartInConnector.publish({event:o,nodeId:t.nodeId,connectorId:t.connectorId}),e.$$mousedown=o=>t.nodeflowData.eventStore.onMouseDownInConnector.publish({event:o,nodeId:t.nodeId,connectorId:t.connectorId}),He(o=>setTimeout(()=>{var n,s;if(!o||!t.nodeflowData.nodes.has(t.nodeId))return;const i=t.nodeflowData.nodes.get(t.nodeId).connectorSections.get(t.sectionId).connectors.get(t.connectorId),r=new ResizeObserver(()=>{i.size=u.of(o.offsetWidth,o.offsetHeight)});r.observe(o),i.update({position:u.of((((n=o?.parentElement)==null?void 0:n.offsetLeft)??0)+o.offsetLeft,(((s=o?.parentElement)==null?void 0:s.offsetTop)??0)+o.offsetTop),ref:o,resizeObserver:r,size:u.of(o.offsetWidth,o.offsetHeight)})}),e),z(o=>{var n,s=(n=t.connector)==null?void 0:n.css,i=`connector-${t.connectorId}`;return s!==o.e&&lt(e,o.e=s),i!==o.t&&b(e,"id",o.t=i),o},{e:void 0,t:void 0}),e})();ze(["mousedown","touchstart","pointerup"]);var Xe=B("<svg><circle r=4 fill=none></svg>",!1,!0),Wt=B("<svg><path stroke=black stroke-width=1 fill=transparent>");const Gt=t=>{const e=O(()=>{const{mouseData:o,curveFunctions:n}=t.nodeflowData;if(o.heldConnectors.length!==1)return;const s=o.heldConnectors[0],i=s.parentNode,r=s.getCenter(),a=o.globalMousePosition(),{anchorStart:c,anchorEnd:l}=n.calculateCurveAnchors(r,a,i.getCenter(),a);return{start:r,end:a,anchorStart:c,anchorEnd:l,path:n.createDefaultCurvePath(r,a,c,l)}});return(()=>{var o=Wt(),n=o.firstChild;return o.style.setProperty("z-index","2"),o.style.setProperty("position","absolute"),o.style.setProperty("width","1px"),o.style.setProperty("height","1px"),o.style.setProperty("pointer-events","none"),o.style.setProperty("overflow","visible"),T(o,E(Ie,{get when(){return t.nodeflowData.settings.debugMode},get children(){return[(()=>{var s=Xe();return z(i=>{var r,a,c=(r=e())==null?void 0:r.anchorStart.x,l=(a=e())==null?void 0:a.anchorStart.y,h=t.css??"";return c!==i.e&&b(s,"cx",i.e=c),l!==i.t&&b(s,"cy",i.t=l),h!==i.a&&b(s,"class",i.a=h),i},{e:void 0,t:void 0,a:void 0}),s})(),(()=>{var s=Xe();return z(i=>{var r,a,c=(r=e())==null?void 0:r.anchorEnd.x,l=(a=e())==null?void 0:a.anchorEnd.y,h=t.css??"";return c!==i.e&&b(s,"cx",i.e=c),l!==i.t&&b(s,"cy",i.t=l),h!==i.a&&b(s,"class",i.a=h),i},{e:void 0,t:void 0,a:void 0}),s})()]}}),null),z(s=>{var i,r=(i=e())==null?void 0:i.path,a=t.css;return r!==s.e&&b(n,"d",s.e=r),a!==s.t&&b(n,"class",s.t=a),s},{e:void 0,t:void 0}),o})()};var Yt=B("<svg><path stroke=black stroke-width=1 fill=none></svg>",!1,!0),qe=B("<svg><circle r=4 fill=none></svg>",!1,!0);const jt=t=>{const e=O(()=>t.nodeflowData.nodes.get(t.sourceNodeId)),o=O(()=>t.nodeflowData.nodes.get(t.destinationNodeId)),n=O(()=>e().getConnector(t.sourceConnectorId)),s=O(()=>o().getConnector(t.destinationConnectorId)),i=O(()=>{var r,a;return!e()||!o()?-1:((a=(r=n())==null?void 0:r.destinations)==null?void 0:a.findIndex(c=>c.destinationConnector===s()))??-1});return he(()=>{if(i()<0)return;const{curveFunctions:r}=t.nodeflowData,a=e().getConnector(t.sourceConnectorId),c=o().getConnector(t.destinationConnectorId),l=a.getCenter(),h=c.getCenter(),{anchorStart:d,anchorEnd:g}=r.calculateCurveAnchors(l,h,e().getCenter(),o().getCenter());n().destinations.get(i()).path={start:l,end:h,anchorStart:d,anchorEnd:g,path:r.createDefaultCurvePath(l,h,d,g)}}),[(()=>{var r=Yt();return r.$$pointerdown=a=>{t.nodeflowData.eventStore.onPointerDownInNodeCurve.publish({event:a,sourceConnector:n(),destinationConnector:s()})},r.style.setProperty("cursor","pointer"),r.style.setProperty("pointer-events","visibleStroke"),z(a=>{var c,l,h,d=(c=n().destinations.get(i()).path)==null?void 0:c.path,g={[((l=t.css)==null?void 0:l.normal)??""]:!0,[((h=t.css)==null?void 0:h.selected)??""]:t.nodeflowData.mouseData.hasSelectedConnection(t.sourceNodeId,t.sourceConnectorId,t.destinationNodeId,t.destinationConnectorId)};return d!==a.e&&b(r,"d",a.e=d),a.t=Ke(r,g,a.t),a},{e:void 0,t:void 0}),r})(),E(Ie,{get when(){return t.nodeflowData.settings.debugMode},get children(){return[(()=>{var r=qe();return z(a=>{var c,l,h,d,g,v=(l=(c=n().destinations.get(i()).path)==null?void 0:c.anchorStart)==null?void 0:l.x,w=(d=(h=n().destinations.get(i()).path)==null?void 0:h.anchorStart)==null?void 0:d.y,P=((g=t.css)==null?void 0:g.normal)??"";return v!==a.e&&b(r,"cx",a.e=v),w!==a.t&&b(r,"cy",a.t=w),P!==a.a&&b(r,"class",a.a=P),a},{e:void 0,t:void 0,a:void 0}),r})(),(()=>{var r=qe();return z(a=>{var c,l,h,d,g,v=(l=(c=n().destinations.get(i()).path)==null?void 0:c.anchorEnd)==null?void 0:l.x,w=(d=(h=n().destinations.get(i()).path)==null?void 0:h.anchorEnd)==null?void 0:d.y,P=((g=t.css)==null?void 0:g.normal)??"";return v!==a.e&&b(r,"cx",a.e=v),w!==a.t&&b(r,"cy",a.t=w),P!==a.a&&b(r,"class",a.a=P),a},{e:void 0,t:void 0,a:void 0}),r})()]}})]};ze(["pointerdown"]);var Vt=B("<div class=nodeflowNode>"),Zt=B("<div>");const Xt=t=>{const e=O(()=>t.nodeflowData.nodes.get(t.nodeId)),[o,n]=pe(!1);return Fe(()=>{t.nodeflowData.chunking.removeNodeFromChunk(t.nodeId,e().position),e().resizeObserver&&(e().resizeObserver.disconnect(),Array.from(e().connectorSections.values()).forEach(s=>{Array.from(s.connectors.values()).forEach(i=>{i.resizeObserver&&i.resizeObserver.disconnect()})}))}),(()=>{var s=Vt();return s.$$pointerup=i=>t.nodeflowData.eventStore.onPointerUpInNode.publish({event:i,nodeId:t.nodeId}),s.$$touchstart=i=>t.nodeflowData.eventStore.onTouchStartInNode.publish({event:i,nodeId:t.nodeId}),s.$$mousedown=i=>t.nodeflowData.eventStore.onMouseDownInNode.publish({event:i,nodeId:t.nodeId}),He(i=>setTimeout(()=>{if(!i)return;const r=new ResizeObserver(()=>{e().update({size:u.of(i.clientWidth,i.clientHeight)}),Array.from(e().connectorSections.values()).forEach(c=>Array.from(c.connectors.values()).forEach(l=>{var h,d;const g=l.ref;g&&(l.position=u.of((((h=g?.parentElement)==null?void 0:h.offsetLeft)??0)+g.offsetLeft,(((d=g?.parentElement)==null?void 0:d.offsetTop)??0)+g.offsetTop))}))});r.observe(i);const a=e().centered?u.of(i.clientWidth,i.clientHeight).divideBy(2):u.zero();e().update({offset:u.of(i.clientLeft,i.clientTop),ref:i,resizeObserver:r,position:e().position.subtract(a),size:u.of(i.clientWidth,i.clientHeight)}),n(!0)}),s),T(s,()=>e().display({node:e()}),null),T(s,E(te,{get each(){return Array.from(e().connectorSections.entries())},children:([i,r])=>(()=>{var a=Zt();return b(a,"id",`section-${i}`),T(a,E(te,{get each(){return Array.from(r.connectors.entries())},children:([c,l])=>E(Ut,{connector:l,connectorId:c,get nodeId(){return t.nodeId},sectionId:i,get nodeflowData(){return t.nodeflowData}})})),z(c=>Ke(a,{[r?.css??""]:!0,nodeflowConnectorSection:!0},c)),a})()}),null),z(i=>{var r,a,c,l,h=`${e().position.x}px`,d=`${e().position.y}px`,g=o()?1:0,v=`node-${t.nodeId}`,w={[((a=(r=e())==null?void 0:r.css)==null?void 0:a.normal)??""]:!0,[((l=(c=e())==null?void 0:c.css)==null?void 0:l.selected)??""]:t.nodeflowData.mouseData.hasSelectedNode(t.nodeId)||t.nodeflowData.mouseData.selectionBox.selections.isNodeSelected(t.nodeId)};return h!==i.e&&((i.e=h)!=null?s.style.setProperty("left",h):s.style.removeProperty("left")),d!==i.t&&((i.t=d)!=null?s.style.setProperty("top",d):s.style.removeProperty("top")),g!==i.a&&((i.a=g)!=null?s.style.setProperty("opacity",g):s.style.removeProperty("opacity")),v!==i.o&&b(s,"id",i.o=v),i.i=Ke(s,w,i.i),i},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),s})()};ze(["mousedown","touchstart","pointerup"]);var qt=B("<div class=nodeflowSelectionBox>");const Qt=t=>{const e=O(()=>t.nodeflowData.mouseData.selectionBox.boundingBox.startPosition()),o=O(()=>t.nodeflowData.mouseData.selectionBox.boundingBox.size.abs());return(()=>{var n=qt();return z(s=>{var i=`${e().x}px`,r=`${e().y}px`,a=`${o().x}px`,c=`${o().y}px`;return i!==s.e&&((s.e=i)!=null?n.style.setProperty("left",i):n.style.removeProperty("left")),r!==s.t&&((s.t=r)!=null?n.style.setProperty("top",r):n.style.removeProperty("top")),a!==s.a&&((s.a=a)!=null?n.style.setProperty("width",a):n.style.removeProperty("width")),c!==s.o&&((s.o=c)!=null?n.style.setProperty("height",c):n.style.removeProperty("height")),s},{e:void 0,t:void 0,a:void 0,o:void 0}),n})()};var Jt=B("<div tabindex=0><div><svg>");const eo=t=>e=>(()=>{var o=Jt(),n=o.firstChild,s=n.firstChild;return o.$$touchmove=i=>t.eventStore.onTouchMoveInNodeflow.publish({event:i}),o.$$touchstart=i=>t.eventStore.onTouchStartInNodeflow.publish({event:i}),o.$$keyup=i=>t.eventStore.onKeyUpInNodeflow.publish({event:i}),o.$$keydown=i=>t.eventStore.onKeyDownInNodeflow.publish({event:i}),o.$$mousedown=i=>t.eventStore.onMouseDownInNodeflow.publish({event:i}),o.addEventListener("wheel",i=>t.eventStore.onWheelInNodeflow.publish({event:i})),o.$$pointerup=i=>t.eventStore.onPointerUpInNodeflow.publish({event:i}),o.$$mousemove=i=>t.eventStore.onMouseMoveInNodeflow.publish({event:i}),He(i=>{new ResizeObserver(()=>{t.update({size:u.of(i.clientWidth,i.clientHeight),startPosition:u.of(i.offsetLeft,i.offsetTop)})}).observe(i)},o),o.style.setProperty("overflow","hidden"),n.style.setProperty("position","absolute"),n.style.setProperty("transform-origin","center"),n.style.setProperty("transition","scale 0.1s ease-out"),T(n,E(te,{get each(){return Array.from(t.nodes.keys())},children:i=>E(Xt,{nodeId:i,nodeflowData:t})}),s),s.style.setProperty("z-index","2"),s.style.setProperty("position","absolute"),s.style.setProperty("width","1px"),s.style.setProperty("height","1px"),s.style.setProperty("pointer-events","none"),s.style.setProperty("overflow","visible"),T(s,E(te,{get each(){return Array.from(t.nodes.entries())},children:([i,r])=>E(te,{get each(){return r.getAllConnectors()},children:a=>E(te,{get each(){return a.destinations.array},children:c=>E(jt,{nodeflowData:t,sourceNodeId:i,get sourceConnectorId(){return a.id},get destinationNodeId(){return c.destinationConnector.parentSection.parentNode.id},get destinationConnectorId(){return c.destinationConnector.id},get css(){return c.css}})})})})),T(n,E(Ie,{get when(){return t.mouseData.heldConnectors.length===1},get children(){return E(Gt,{get css(){var i,r;return(r=(i=e?.css)==null?void 0:i.getNewCurveCss)==null?void 0:r.call(i,t.mouseData.heldConnectors.at(0))},nodeflowData:t})}}),null),T(o,E(Ie,{get when(){return t.mouseData.selectionBox.boundingBox},get children(){return E(Qt,{nodeflowData:t})}}),null),z(i=>{var r,a=`nodeflow-${t.id}`,c=(r=e?.css)==null?void 0:r.nodeflow,l=e.height,h=e.width,d=`scale(${t.zoomLevel}) translate(${t.position.x}px, ${t.position.y}px)`;return a!==i.e&&b(o,"id",i.e=a),c!==i.t&&lt(o,i.t=c),l!==i.a&&((i.a=l)!=null?o.style.setProperty("height",l):o.style.removeProperty("height")),h!==i.o&&((i.o=h)!=null?o.style.setProperty("width",h):o.style.removeProperty("width")),d!==i.i&&((i.i=d)!=null?n.style.setProperty("transform",d):n.style.removeProperty("transform")),i},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),o})();ze(["mousemove","pointerup","mousedown","keydown","keyup","touchstart","touchmove"]);class oe{constructor(e){f(this,"store"),this.store=L(e??[])}get array(){return this.store[0]}get length(){return this.store[0].length}at(e){return this.store[0].at(e)}forEach(e){this.store[0].forEach(e)}filter(e){return this.store[0].filter(e)}filterInPlace(e){this.store[1](this.filter(e))}map(e){return this.store[0].map(e)}flatMap(e){return this.store[0].flatMap(e)}find(e){return this.store[0].find(e)}findIndex(e){return this.store[0].findIndex(e)}splice(e,o,...n){this.store[1](this.store[0].splice(e,o,...n))}reduce(e,o){return this.store[0].reduce(e,o)}some(e){return this.store[0].some(e)}every(e){return this.store[0].every(e)}get(e){return this.store[0][e]}set(e,o){this.store[1](e,o)}push(e){this.store[1](this.store[0].length,e)}}class A{constructor(e=-1){f(this,"changes"),f(this,"currentChangeIndex",-1),f(this,"maxChanges"),this.maxChanges=e,this.changes=[]}serialize(){return{changes:this.changes,currentChangeIndex:this.currentChangeIndex,maxChanges:this.maxChanges}}deserialize(e){this.changes=e.changes,this.currentChangeIndex=e.currentChangeIndex,this.maxChanges=e.maxChanges}addChange(e){this.changes=this.changes.slice(0,this.currentChangeIndex+1),this.changes.length===this.maxChanges&&this.changes.shift(),this.changes.push(e),this.currentChangeIndex=this.changes.length-1}undo(){if(this.currentChangeIndex===-1)return!1;const e=this.changes[this.currentChangeIndex].historyGroup;for(;this.currentChangeIndex>-1&&this.changes[this.currentChangeIndex].historyGroup===e;)this.changes[this.currentChangeIndex].undoChange(),this.currentChangeIndex--;return!0}redo(){if(this.currentChangeIndex===this.changes.length-1)return!1;const e=this.changes[this.currentChangeIndex+1].historyGroup;for(;this.currentChangeIndex<this.changes.length-1&&this.changes[this.currentChangeIndex+1].historyGroup===e;)this.currentChangeIndex++,this.changes[this.currentChangeIndex].applyChange();return!0}static evaluateHistoryGroup(e=!0){return typeof e=="boolean"?e?crypto.randomUUID():!1:e}}class to{constructor(e){f(this,"nodeflowData"),f(this,"getHorizontalCurve",(o,n)=>u.of((n.x-o.x)/1.5,0)),f(this,"getVerticalCurve",(o,n)=>u.of(0,(n.y-o.y)/1.5)),f(this,"createDefaultCurvePath",(o,n,s,i)=>`M ${o.x} ${o.y} C ${s.x} ${s.y}, ${i.x} ${i.y}, ${n.x} ${n.y}`),this.nodeflowData=e}calculateCurveAnchors(e,o,n,s){const i=e.distanceTo(o)/300,r=n.add(e.subtract(n).multiplyBy(i)),a=s.add(o.subtract(s).multiplyBy(i));return{anchorStart:r,anchorEnd:a}}}class oo{constructor(e){f(this,"store"),this.store=L(e)}get css(){return this.store[0].css}get destinationConnector(){return this.store[0].destinationConnector}get path(){return this.store[0].path}set css(e){this.store[1]({css:e})}set path(e){this.store[1]({path:e})}set destinationConnector(e){this.store[1]({destinationConnector:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}}const le=(...t)=>{const e=t[0];return t.slice(1).reduce((o,n)=>new Set([...o].filter(s=>n.has(s))),e)},ne=t=>t.size===0,W=t=>typeof t!="object"||t===null||t===void 0?t:Array.isArray(t)?t.map(W):typeof t=="object"?Object.fromEntries(Object.entries(t).map(([e,o])=>[e,W(o)])):t;class Ue{constructor(e){f(this,"store"),this.store=L(e)}serialize(){return{css:this.css,hovered:this.hovered,id:this.id,position:this.position.serialize()}}serializeConnections(){return[...this.destinations.map(({destinationConnector:e,css:o})=>({sourceNodeId:this.parentNode.id,sourceConnectorId:this.id,destinationNodeId:e.parentNode.id,destinationConnectorId:e.id,css:W(o)})),...this.sources.map(({sourceConnector:e})=>{var o;return{sourceNodeId:e.parentNode.id,sourceConnectorId:e.id,destinationNodeId:this.parentNode.id,destinationConnectorId:this.id,css:W((o=e.destinations.find(n=>n.destinationConnector.parentNode.id===this.parentNode.id))==null?void 0:o.css)}})]}static deserialize(e,o){const n=!e.id||o.connectors.has(e.id)?o.parentNode.getNextFreeConnectorId():e.id;return new Ue({css:e.css,destinations:new oe,hovered:e.hovered??!1,id:n,parentSection:o,position:u.deserializeOrDefault(e.position),ref:void 0,resizeObserver:void 0,size:u.zero(),sources:new oe})}get css(){return this.store[0].css}values(){return this.store[0]}get destinations(){return this.store[0].destinations}get hovered(){return this.store[0].hovered}get id(){return this.store[0].id}get parentSection(){return this.store[0].parentSection}get parentNode(){return this.store[0].parentSection.parentNode}get position(){return this.store[0].position}get ref(){return this.store[0].ref}get resizeObserver(){return this.store[0].resizeObserver}get size(){return this.store[0].size}get sources(){return this.store[0].sources}set css(e){this.store[1]({css:e})}set destinations(e){this.store[1]({destinations:e})}set hovered(e){this.store[1]({hovered:e})}set id(e){this.store[1]({id:e})}set parentSection(e){this.store[1]({parentSection:e})}set position(e){this.store[1]({position:e})}set ref(e){this.store[1]({ref:e})}set resizeObserver(e){this.store[1]({resizeObserver:e})}set size(e){this.store[1]({size:e})}set sources(e){this.store[1]({sources:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}removeIncomingConnections(){this.sources.forEach(({sourceConnector:e})=>{e.destinations.filterInPlace(({destinationConnector:o})=>o.parentNode.id!==this.id)}),this.sources=new oe}removeOutgoingConnections(){this.destinations.forEach(({destinationConnector:e})=>{e.sources.filterInPlace(({sourceConnector:o})=>o.parentNode.id!==this.id)}),this.destinations=new oe}getCenter(){const{position:e,offset:o}=this.parentNode;return e.add(o,this.position,this.size.divideBy(2))}}const yt=class we{constructor(){f(this,"nodeflows"),f(this,"globalEventStore"),this.nodeflows=new Map,this.globalEventStore={onMouseMoveInDocument:new Oe,onPointerLeaveFromDocument:new Oe,onPointerUpInDocument:new Oe},this.setupDefaultEventHandlers()}static get(){return this.instance||(we.instance=new we),we.instance}createCanvas(...e){const o=new lo(...e);return this.nodeflows.set(e[0],o),[o,eo(o)]}getNodeflow(e){return this.nodeflows.get(e)}removeNodeflow(e){this.nodeflows.delete(e)}clear(){this.nodeflows.clear()}hasNodeflow(e){return this.nodeflows.has(e)}setupDefaultEventHandlers(){document.onmousemove=e=>this.globalEventStore.onMouseMoveInDocument.publish({event:e}),document.onpointerleave=e=>this.globalEventStore.onPointerLeaveFromDocument.publish({event:e}),document.onpointerup=e=>this.globalEventStore.onPointerUpInDocument.publish({event:e}),this.globalEventStore.onMouseMoveInDocument.subscribeMultiple([{name:"update-mouse-position",event:({event:e})=>{this.nodeflows.forEach(o=>{o.mouseData.mousePosition=u.fromEvent(e)})}}]),this.globalEventStore.onPointerLeaveFromDocument.subscribeMultiple([{name:"reset-mouse-data",event:()=>{this.nodeflows.forEach(e=>{e.mouseData.reset()})}}]),this.globalEventStore.onPointerUpInDocument.subscribeMultiple([])}};f(yt,"instance");let S=yt;var no={equals:!1},so=no,V,Qe,Je=(Qe=class{constructor(t=Map){_e(this,V,void 0),Rt(this,V,new t)}dirty(t){var e;(e=m(this,V).get(t))==null||e.$$()}dirtyAll(){for(const t of m(this,V).values())t.$$()}track(t){if(!Ne())return;let e=m(this,V).get(t);if(e)e.n++;else{const[o,n]=pe(void 0,so);m(this,V).set(t,e={$:o,$$:n,n:1})}Fe(()=>{e.n--===1&&queueMicrotask(()=>e.n===0&&m(this,V).delete(t))}),e.$()}},V=new WeakMap,Qe),Z=Symbol("track-keys"),x,H,et,Y=(et=class extends Map{constructor(t){if(super(),_e(this,x,new Je),_e(this,H,new Je),t)for(const e of t)super.set(e[0],e[1])}has(t){return m(this,x).track(t),super.has(t)}get(t){return m(this,H).track(t),super.get(t)}get size(){return m(this,x).track(Z),super.size}*keys(){for(const t of super.keys())m(this,x).track(t),yield t;m(this,x).track(Z)}*values(){for(const[t,e]of super.entries())m(this,H).track(t),yield e;m(this,x).track(Z)}*entries(){for(const t of super.entries())m(this,H).track(t[0]),yield t;m(this,x).track(Z)}set(t,e){return me(()=>{if(super.has(t)){if(super.get(t)===e)return}else m(this,x).dirty(t),m(this,x).dirty(Z);m(this,H).dirty(t),super.set(t,e)}),this}delete(t){const e=super.delete(t);return e&&me(()=>{m(this,x).dirty(t),m(this,x).dirty(Z),m(this,H).dirty(t)}),e}clear(){super.size&&me(()=>{for(const t of super.keys())m(this,x).dirty(t),m(this,H).dirty(t);super.clear(),m(this,x).dirty(Z)})}forEach(t){m(this,x).track(Z);for(const[e,o]of super.entries())m(this,H).track(e),t(o,e,this)}[Symbol.iterator](){return this.entries()}},x=new WeakMap,H=new WeakMap,et);class We{constructor(e,o){f(this,"store"),f(this,"nodeflowData"),this.nodeflowData=e,this.store=L(o)}serialize(){return{connectors:Object.fromEntries(Array.from(this.connectors.entries()).map(([e,o])=>[e,o.serialize()])),css:this.css,id:this.id}}static deserialize(e,o,n=!0){const s=A.evaluateHistoryGroup(n),i=!e.id||o.connectorSections.has(e.id)?o.getNextFreeConnectorSectionId():e.id,r=new We(o.nodeflow,{connectors:new Y,css:e.css,id:i,parentNode:o});for(const[a,c]of Object.entries(e.connectors??{}))r.addConnector({...c,id:a},s);return r}addConnector(e,o=!0){const n=Ue.deserialize(e,this);if(this.connectors.has(n.id))return this.connectors.get(n.id);const s=A.evaluateHistoryGroup(o);if(s){const i=n.serialize(),r=this.id,a=i.id,c=this.parentNode.id,l=this.nodeflowData.id;this.nodeflowData.changes.addChange({type:"add",source:"connector",applyChange:()=>{var h,d;(d=(h=S.get().getNodeflow(l))==null?void 0:h.nodes.get(c))==null||d.addConnector(r,i,!1)},undoChange:()=>{var h,d;(d=(h=S.get().getNodeflow(l))==null?void 0:h.nodes.get(c))==null||d.removeConnector(r,a,!1)},historyGroup:s})}return this.connectors.set(n.id,n),n}removeConnector(e,o=!0){if(!this.connectors.has(e))return;const n=this.connectors.get(e),s=A.evaluateHistoryGroup(o);if(s){const i=n.serialize(),r=this.id,a=i.id,c=this.parentNode.id,l=this.nodeflowData.id;this.nodeflowData.changes.addChange({type:"remove",source:"connector",applyChange:()=>{var h,d;(d=(h=S.get().getNodeflow(l))==null?void 0:h.nodes.get(c))==null||d.removeConnector(r,a,!1)},undoChange:()=>{var h,d;(d=(h=S.get().getNodeflow(l))==null?void 0:h.nodes.get(c))==null||d.addConnector(r,i,!1)},historyGroup:s})}this.connectors.delete(e)}get connectors(){return this.store[0].connectors}get css(){return this.store[0].css}get id(){return this.store[0].id}get parentNode(){return this.store[0].parentNode}set connectors(e){this.store[1]({connectors:e})}set css(e){this.store[1]({css:e})}set id(e){this.store[1]({id:e})}set parentNode(e){this.store[1]({parentNode:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}removeIncomingConnections(){this.connectors.forEach(e=>e.removeIncomingConnections())}removeOutgoingConnections(){this.connectors.forEach(e=>e.removeOutgoingConnections())}getSourceConnectors(){return Array.from(this.connectors.values()).flatMap(e=>e.sources.flatMap(o=>o.sourceConnector))}getDestinationConnectors(){return Array.from(this.connectors.values()).flatMap(e=>e.destinations.flatMap(o=>o.destinationConnector))}}class io{constructor(e){f(this,"store"),this.store=L(e)}get sourceConnector(){return this.store[0].sourceConnector}set sourceConnector(e){this.store[1]({sourceConnector:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}}class mt{constructor(){f(this,"subscriptions",new Y),f(this,"blacklistFilters",new Y)}blacklist(e,o){this.blacklistFilters.set(e,o)}unblacklist(e){this.blacklistFilters.delete(e)}unblacklistMultiple(e){e.forEach(this.unblacklist)}clearBlacklist(){this.blacklistFilters.clear()}subscribe(e,o,n=0){this.subscriptions.set(e,{name:e,event:o,priority:n})}subscribeMultiple(e){e.forEach(({name:o,event:n,priority:s})=>this.subscribe(o,n,s))}unsubscribe(e){this.subscriptions.delete(e)}unsubsribeMultiple(e){e.forEach(this.unsubscribe)}publish(e){Array.from(this.subscriptions.values()).sort((o,n)=>n.priority-o.priority).filter(({name:o,priority:n})=>!Array.from(this.blacklistFilters.values()).some(s=>s(e,o,n))).map(({event:o})=>o).forEach(o=>o(e))}clear(){this.subscriptions.clear()}get size(){return this.subscriptions.size}get isEmpty(){return this.size===0}}class I extends mt{constructor(e){super(),f(this,"nodeflowData"),this.nodeflowData=e}}class Oe extends mt{}class ro{constructor(e){f(this,"store"),f(this,"nodeflowData"),this.nodeflowData=e,this.store=L({heldKeys:new Set})}get heldKeys(){return this.store[0].heldKeys}set heldKeys(e){this.store[1]({heldKeys:e})}releaseKey(e){this.store[1](Be(o=>o.heldKeys.delete(e)))}clearKeys(){this.store[1]({heldKeys:new Set})}pressKey(e){this.store[1](Be(o=>o.heldKeys.add(e)))}hasKeyPressed(e){return this.heldKeys.has(e)}isActionPressed(e){return!ne(le(this.heldKeys,e))}}var p=(t=>(t.Connector="connector",t.Node="node",t.Nodeflow="nodeflow",t.Connection="connection",t))(p||{});class D{constructor(e){f(this,"connectorsMap",new Y),f(this,"nodesMap",new Y),f(this,"connectionsMap",new Y),f(this,"nodeflowData"),f(this,"_hasSelectedNodeflow",!1),this.nodeflowData=e}static createHash(e){switch(e.type){case p.Connector:return`${e.connector.parentNode.id}-${e.connector.id}`;case p.Node:return`${e.node.id}`;case p.Connection:return`${e.connection.sourceConnector.parentNode.id}-${e.connection.sourceConnector.id}-${e.connection.destinationConnector.parentNode.id}-${e.connection.destinationConnector.id}`;default:return p.Nodeflow}}addNode(e){const o=D.createHash({node:e,type:p.Node});return this.nodesMap.set(o,e)}addConnector(e){const o=D.createHash({connector:e,type:p.Connector});return this.connectorsMap.set(o,e)}addConnection(e){const o=D.createHash(e);return this.connectionsMap.set(o,e)}addNodeflow(){return this._hasSelectedNodeflow=!0,this}add(e){switch(e.type){case p.Connector:return this.addConnector(e.connector);case p.Node:return this.addNode(e.node);case p.Connection:return this.addConnection(e);default:return this.addNodeflow()}}delete(e){const o=D.createHash(e);switch(e.type){case p.Connector:return this.connectorsMap.delete(o);case p.Node:return this.nodesMap.delete(o);case p.Connection:return this.connectionsMap.delete(o);default:return this._hasSelectedNodeflow=!1,this}}has(e){const o=D.createHash(e);switch(e.type){case p.Connector:return this.connectorsMap.has(o);case p.Node:return this.nodesMap.has(o);case p.Connection:return this.connectionsMap.has(o);default:return this._hasSelectedNodeflow}}get(e){const o=D.createHash(e);switch(e.type){case p.Connector:return this.connectorsMap.get(o);case p.Node:return this.nodesMap.get(o);case p.Connection:return this.connectionsMap.get(o);default:return this.nodeflowData}}static serialize(e){switch(e.type){case p.Connector:return{connectorId:e.connector.id,nodeId:e.connector.parentNode.id,type:p.Connector};case p.Node:return{nodeId:e.node.id,type:p.Node};case p.Connection:return{connection:{destinationConnectorId:e.connection.destinationConnector.id,destinationNodeId:e.connection.destinationConnector.parentSection.parentNode.id,sourceConnectorId:e.connection.sourceConnector.id,sourceNodeId:e.connection.sourceConnector.parentNode.id},type:p.Connection};default:return{type:p.Nodeflow}}}static deserialize(e,o){switch(e.type){case p.Connector:{const n=o.nodes.get(e.nodeId);if(!n)throw new Error("Node not found");const s=n.getConnector(e.connectorId);if(!s)throw new Error("Connector not found");return{connector:s,type:p.Connector}}case p.Node:{const n=o.nodes.get(e.nodeId);if(!n)throw new Error("Node not found");return{node:n,type:p.Node}}case p.Connection:{const n=o.nodes.get(e.connection.sourceNodeId);if(!n)throw new Error("Source node not found");const s=n.getConnector(e.connection.sourceConnectorId);if(!s)throw new Error("Source connector not found");const i=o.nodes.get(e.connection.destinationNodeId);if(!i)throw new Error("Destination node not found");const r=i.getConnector(e.connection.destinationConnectorId);if(!r)throw new Error("Destination connector not found");return{connection:{destinationConnector:r,sourceConnector:s},type:p.Connection}}default:return{type:p.Nodeflow}}}toObject(){const e={};return this.connectorsMap.forEach(o=>{e[D.createHash({connector:o,type:p.Connector})]=D.serialize({connector:o,type:p.Connector})}),this.nodesMap.forEach(o=>{e[D.createHash({node:o,type:p.Node})]=D.serialize({node:o,type:p.Node})}),this.connectionsMap.forEach(o=>{e[D.createHash(o)]=D.serialize(o)}),this._hasSelectedNodeflow&&(e[p.Nodeflow]={type:p.Nodeflow}),e}static fromObject(e,o){const n=new D(o);for(const s in e){const i=e[s];switch(i.type){case p.Connector:case p.Node:case p.Connection:n.add(D.deserialize(i,o));break;default:n._hasSelectedNodeflow=!0;break}}return n}get selectedConnectors(){return Array.from(this.connectorsMap.values())}get selectedNodes(){return Array.from(this.nodesMap.values())}get selectedNodesMap(){return this.nodesMap}get selectedConnections(){return Array.from(this.connectionsMap.values())}get selectedNodeflow(){return this._hasSelectedNodeflow}hasSelectedNodeflow(){return this._hasSelectedNodeflow}clearConnectors(){this.connectorsMap.clear()}clearNodes(){this.nodesMap.clear()}clearConnections(){this.connectionsMap.clear()}clearNodeflow(){this._hasSelectedNodeflow=!1}clear(){this.clearConnectors(),this.clearNodes(),this.clearConnections(),this.clearNodeflow()}isNodeSelected(e){return this.nodesMap.has(e)}isConnectorSelected(e,o){return this.connectorsMap.has(`${o}-${e}`)}isConnectionSelected(e,o,n,s){return this.connectionsMap.has(`${e}-${o}-${n}-${s}`)}deleteNodes(e){for(const o of this.nodesMap.values())e(o)&&this.nodesMap.delete(o.id)}deleteConnectors(e){for(const o of this.connectorsMap.values())e(o)&&this.connectorsMap.delete(`${o.parentNode.id}-${o.id}`)}deleteConnections(e){for(const o of this.connectionsMap.values())e(o)&&this.connectionsMap.delete(`${o.connection.sourceConnector.parentNode.id}-${o.connection.sourceConnector.id}-${o.connection.destinationConnector.parentNode.id}-${o.connection.destinationConnector.id}`)}get size(){return this.connectorsMap.size+this.nodesMap.size+this.connectionsMap.size+(this._hasSelectedNodeflow?1:0)}}class ${constructor(e,o,n,s){f(this,"position"),f(this,"size"),this.position=u.of(e,o),this.size=u.of(n,s)}static of(e,o){return new $(e.x,e.y,o.x,o.y)}static fromRect(e){return new $(e.position.x,e.position.y,e.size.x,e.size.y)}static fromPositions(e,o){return $.of(e,o.subtract(e))}copy(){return $.fromRect(this)}get center(){return this.position.add(this.size.divideBy(2))}intersects(e){return this.position.x<e.position.x+e.size.x&&this.position.x+this.size.x>e.position.x&&this.position.y<e.position.y+e.size.y&&this.position.y+this.size.y>e.position.y}startPosition(){return u.of(Math.min(this.position.x,this.position.x+this.size.x),Math.min(this.position.y,this.position.y+this.size.y))}endPosition(){return u.of(Math.max(this.position.x,this.position.x+this.size.x),Math.max(this.position.y,this.position.y+this.size.y))}}class tt{constructor(e){f(this,"store"),f(this,"nodeflowData"),this.nodeflowData=e,this.store=L({boundingBox:void 0,selections:new D(this.nodeflowData)})}get boundingBox(){return this.store[0].boundingBox}set boundingBox(e){if(this.store[1]({boundingBox:e}),!e){this.selections.selectedNodes.forEach(i=>{this.nodeflowData.mouseData.selections.add({type:p.Node,node:i})}),this.selections.clear();return}const o=$.of(e.position,e.size),n=$.fromPositions(this.nodeflowData.transformVec2ToCanvas(o.startPosition()),this.nodeflowData.transformVec2ToCanvas(o.endPosition())),s=this.nodeflowData.chunking.getNodesInRect(n);this.selections.clear(),s.forEach(i=>{this.selections.add({type:p.Node,node:i})})}get selections(){return this.store[0].selections}}class ao{constructor(e){f(this,"store"),f(this,"nodeflowData"),f(this,"selectNode",(o,n,s=!0)=>{if(!this.nodeflowData.nodes.has(o))return;const i=this.nodeflowData.nodes.get(o);this.hasSelectedNode(o)&&this.selections.delete({type:p.Node,node:i}),this.selections.addNode(i),this.update({pointerDown:s,mousePosition:n,clickStartPosition:n.divideBy(this.nodeflowData.zoomLevel).subtract(this.nodeflowData.nodes.get(o).position)})}),f(this,"clearSelections",()=>{this.selections.clear(),this.nodeflowData.resetMovement()}),f(this,"startCreatingConnection",(o,n,s)=>{if(!this.nodeflowData.settings.canCreateConnections)return;const i=this.nodeflowData.nodes.get(o);if(!i)return;const r=i.getConnector(s);if(!r)return;const a=new D(this.nodeflowData);a.add({connector:r,type:p.Connector}),this.update({pointerDown:!0,selections:a,mousePosition:n,clickStartPosition:n.divideBy(this.nodeflowData.zoomLevel).subtract(i.position)})}),f(this,"globalMousePosition",()=>this.nodeflowData.transformVec2ToCanvas(this.mousePosition)),this.nodeflowData=e,this.store=L({clickStartPosition:void 0,mousePosition:u.zero(),heldMouseButtons:new Set,pointerDown:!1,selections:new D(this.nodeflowData),selectionBox:new tt(this.nodeflowData)})}serialize(){var e;return{clickStartPosition:(e=this.clickStartPosition)==null?void 0:e.serialize(),selections:this.selections.toObject()}}deserialize(e){this.update({clickStartPosition:u.deserializeOrDefault(e.clickStartPosition),selections:D.fromObject(e.selections,this.nodeflowData)})}get clickStartPosition(){return this.store[0].clickStartPosition}get heldMouseButtons(){return this.store[0].heldMouseButtons}get selections(){return this.store[0].selections}get selectionBox(){return this.store[0].selectionBox}get mousePosition(){return this.store[0].mousePosition}get heldConnections(){return this.selections.selectedConnections}get heldConnectors(){return this.selections.selectedConnectors}get heldNodes(){return this.selections.selectedNodes}isHoldingButton(e){return this.heldMouseButtons.has(e)}deleteNodes(e){this.selections.deleteNodes(e)}deleteConnectors(e){this.selections.deleteConnectors(e)}deleteConnections(e){this.selections.deleteConnections(e)}set clickStartPosition(e){this.store[1]({clickStartPosition:e})}set mousePosition(e){this.store[1]({mousePosition:e})}set pointerDown(e){this.store[1]({pointerDown:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}reset(){this.update({clickStartPosition:void 0,pointerDown:!1,heldMouseButtons:new Set,selections:new D(this.nodeflowData),selectionBox:new tt(this.nodeflowData)})}selectNodeflow(){this.hasSelectedNodeflow()&&this.selections.clearNodeflow(),this.selections.addNodeflow()}hasSelectedNodeflow(){return this.selections.hasSelectedNodeflow()}hasSelectedNode(e){return this.selections.isNodeSelected(e)}hasSelectedConnector(e,o){return this.selections.isConnectorSelected(e,o)}hasSelectedConnection(e,o,n,s){return this.selections.isConnectionSelected(e,o,n,s)}}class co{constructor(e,o=2048){f(this,"store"),f(this,"nodeflowData"),this.nodeflowData=e,this.store=L({chunkSize:o,chunks:new Y})}get chunkSize(){return this.store[0].chunkSize}set chunkSize(e){this.store[1]({chunkSize:e})}get chunks(){return this.store[0].chunks}set chunks(e){this.store[1]({chunks:e})}addNodeToChunk(e,o){const n=this.calculateChunkPosition(o).hashCode(),s=this.chunks.get(n)||new Set;s.add(e),this.chunks.set(n,s)}removeNodeFromChunk(e,o){const n=this.calculateChunkPosition(o).hashCode(),s=this.chunks.get(n);s&&(s.delete(e),this.chunks.set(n,s))}updateNodeInChunk(e,o,n){const s=this.calculateChunkPosition(o).hashCode(),i=this.calculateChunkPosition(n).hashCode();if(s==i)return;const r=this.chunks.get(s),a=this.chunks.get(i)||new Set;r&&(r.delete(e),this.chunks.set(s,r),ne(r)&&this.chunks.delete(s)),a&&(a.add(e),this.chunks.set(i,a))}getChunk(e){return this.chunks.get(this.calculateChunkPosition(e).hashCode())||new Set}calculateChunkPosition(e){return u.of(Math.floor(e.x/this.chunkSize),Math.floor(e.y/this.chunkSize))}checkForCollisions(e){if(!this.nodeflowData.settings.allowCollision)return[];const o=this.nodeflowData.nodes.get(e),n=[];if(!o)return n;for(let s=-1;s<2;++s)for(let i=-1;i<2;++i){const r=this.getChunk(o.rectWithOffset.position.add(u.of(s*this.chunkSize,i*this.chunkSize)));r.size>0&&n.push(...r)}return n.filter(s=>{const i=this.nodeflowData.nodes.get(s);return i?.id==o.id?!1:i&&i.id!=o.id&&i.rectWithOffset.intersects(o.rectWithOffset)})}getNodesInRect(e){const o=[],n=e.startPosition(),s=e.endPosition(),i=this.calculateChunkPosition(n),r=this.calculateChunkPosition(s);for(let a=i.x;a<=r.x;++a)for(let c=i.y;c<=r.y;++c){const l=this.chunks.get(u.of(a,c).hashCode());l&&l.forEach(h=>{const d=this.nodeflowData.nodes.get(h);d&&e.intersects(d.rectWithOffset)&&o.push(d)})}return o}}const Te=(t,e,o)=>Math.min(Math.max(t,e),o);class Ge{constructor(e,o){f(this,"store"),f(this,"nodeflowData"),this.nodeflowData=e,this.store=L(o),this.nodeflowData.chunking.addNodeToChunk(this.id,this.getCenter()),he(()=>{const n=this.getCollidingNodes();n.length>0&&he(()=>{n.forEach(s=>{const i=this.nodeflowData.nodes.get(s);if(i){const r=i.rectWithOffset,a=this.rectWithOffset;if(r.intersects(a)){const c=r.center.subtract(a.center).magnitude,l=r.center.subtract(a.center).normalize();this.position=this.position.subtract(l.multiplyBy(c))}}})})})}get nodeflow(){return this.nodeflowData}get centered(){return this.store[0].centered}get connectorSections(){return this.store[0].connectorSections}get css(){return this.store[0].css}get customData(){return this.store[0].customData}get display(){return this.store[0].display}get id(){return this.store[0].id}get offset(){return this.store[0].offset}get position(){return this.store[0].position}get ref(){return this.store[0].ref}get resizeObserver(){return this.store[0].resizeObserver}get size(){return this.store[0].size}set centered(e){this.store[1]({centered:e})}set connectorSections(e){this.store[1]({connectorSections:e})}set css(e){this.store[1]({css:e})}set customData(e){this.store[1]({customData:e})}set display(e){this.store[1]({display:e})}set id(e){this.store[1]({id:e})}set offset(e){this.store[1]({offset:e})}set position(e){const o=this.position;this.store[1]({position:e}),this.nodeflowData.chunking.updateNodeInChunk(this.id,o,e)}set ref(e){this.store[1]({ref:e})}set resizeObserver(e){this.store[1]({resizeObserver:e})}set size(e){this.store[1]({size:e})}get sizeWithOffset(){return this.size.add(this.offset)}update(e){this.store[1](e)}serialize(){const e=Array.from(this.connectorSections.values()).reduce((o,n)=>(o[n.id]=n.serialize(),o),{});return{centered:this.centered,connectorSections:e,css:W(this.css),customData:W(this.customData),id:this.id,display:this.display,position:this.position.serialize()}}static deserialize(e,o,n=!0){const s=o.id??e.getNextFreeNodeId(),i=new Ge(e,{centered:o.centered??!1,connectorSections:new Y,css:W(o.css)??{},customData:W(o.customData)??{},display:o.display??(()=>{}),id:s,offset:u.zero(),position:u.deserializeOrDefault(o.position),ref:void 0,resizeObserver:void 0,size:u.zero()}),r=A.evaluateHistoryGroup(n);return Object.entries(o.connectorSections??[]).forEach(([a,c])=>{i.addConnectorSection({css:c.css,id:a,connectors:c.connectors},r)}),i}serializeConnections(){return Array.from(this.connectorSections.values()).flatMap(e=>Array.from(e.connectors.values()).flatMap(o=>o.serializeConnections()))}updateWithPrevious(e){this.store[1](e)}addConnectorSection(e,o=!0){const n=A.evaluateHistoryGroup(o),s=We.deserialize(e,this,n);if(this.connectorSections.has(s.id))return this.connectorSections.get(s.id);if(n){const i=s.serialize(),r=this.nodeflowData.id,a=this.id,c=i.id;this.nodeflowData.changes.addChange({type:"remove",source:"connector-section",applyChange:()=>{var l,h;(h=(l=S.get().getNodeflow(r))==null?void 0:l.nodes.get(a))==null||h.addConnectorSection(i,!1)},undoChange:()=>{var l,h;(h=(l=S.get().getNodeflow(r))==null?void 0:l.nodes.get(a))==null||h.removeConnectorSection(c,!1)},historyGroup:n})}return this.connectorSections.set(s.id,s),s}removeConnectorSection(e,o=!0){if(!this.connectorSections.has(e))return;const n=this.connectorSections.get(e),s=A.evaluateHistoryGroup(o);if(s){const i=n.serialize(),r=this.nodeflowData.id,a=this.id;this.nodeflowData.changes.addChange({type:"remove",source:"connector-section",applyChange:()=>{var c,l;(l=(c=S.get().getNodeflow(r))==null?void 0:c.nodes.get(a))==null||l.removeConnectorSection(e,!1)},undoChange:()=>{var c,l;(l=(c=S.get().getNodeflow(r))==null?void 0:c.nodes.get(a))==null||l.addConnectorSection(i,!1)},historyGroup:s})}this.connectorSections.delete(e)}getConnectorCount(){return Array.from(this.connectorSections.values()).reduce((e,o)=>e+o.connectors.size,0)}addConnector(e,o,n=!0){if(this.connectorSections.has(e))return this.connectorSections.get(e).addConnector(o,n)}removeConnector(e,o,n=!0){this.connectorSections.has(e)&&this.connectorSections.get(e).removeConnector(o,n)}getConnector(e){var o;return(o=this.getSectionFromConnector(e))==null?void 0:o.connectors.get(e)}getTotalConnectedInputs(e){var o;return((o=this.getConnector(e))==null?void 0:o.sources.length)??0}getAllConnectors(){return Array.from(this.connectorSections.values()).reduce((e,o)=>e.concat(Array.from(o.connectors.values())),[])}getNextFreeConnectorSectionId(){let e="0";for(let o=1;this.connectorSections.has(e);++o)e=o.toString();return e}getNextFreeConnectorId(){let e="0";for(let o=1;Array.from(this.connectorSections.values()).some(n=>n.connectors.has(e));++o)e=o.toString();return e}removeIncomingConnections(){this.connectorSections.forEach(e=>e.removeIncomingConnections())}removeOutgoingConnections(){this.connectorSections.forEach(e=>e.removeOutgoingConnections())}getAllSourceConnectors(){return Array.from(this.connectorSections.values()).reduce((e,o)=>e.concat(o.getSourceConnectors()),[])}getAllDestinationConnectors(){return Array.from(this.connectorSections.values()).reduce((e,o)=>e.concat(o.getDestinationConnectors()),[])}getAllSourceConnections(){return this.getAllSourceConnectors().map(e=>e.destinations.filter(o=>o.destinationConnector.parentNode.id===this.id).map(o=>({sourceNodeId:e.parentNode.id,sourceConnectorId:e.id,destinationNodeId:o.destinationConnector.parentNode.id,destinationConnectorId:o.destinationConnector.id,css:o.css}))).flat()}getAllDestinationConnections(){return this.getAllDestinationConnectors().map(e=>e.sources.filter(o=>o.sourceConnector.parentNode.id===this.id).map(o=>({sourceNodeId:o.sourceConnector.parentNode.id,sourceConnectorId:o.sourceConnector.id,destinationNodeId:e.parentNode.id,destinationConnectorId:e.id}))).flat()}getAllSourceNodes(){return this.getAllSourceConnectors().map(e=>e.parentNode)}getAllDestinationNodes(){return this.getAllDestinationConnectors().map(e=>e.parentNode)}getSectionFromConnector(e){return Array.from(this.connectorSections.values()).find(o=>o.connectors.get(e))}getCenter(){return this.position.add(this.offset,this.size.divideBy(2))}select(e){this.nodeflowData.selectNode(this.id,e)}get rect(){return $.of(this.position,this.size)}get rectWithOffset(){return $.of(this.position.subtract(this.offset),this.size.add(this.offset.multiplyBy(2)))}getCollidingNodes(){return this.nodeflowData.chunking.checkForCollisions(this.id)}isColliding(){return this.getCollidingNodes().length>0}}var K=(t=>(t[t.LEFT=0]="LEFT",t[t.MIDDLE=1]="MIDDLE",t[t.RIGHT=2]="RIGHT",t[t.BACK=3]="BACK",t[t.FORWARD=4]="FORWARD",t))(K||{}),y=(t=>(t.ALT_LEFT="AltLeft",t.ALT_RIGHT="AltRight",t.ARROW_DOWN="ArrowDown",t.ARROW_LEFT="ArrowLeft",t.ARROW_RIGHT="ArrowRight",t.ARROW_UP="ArrowUp",t.BACKQUOTE="Backquote",t.BACKSLASH="Backslash",t.BACKSPACE="Backspace",t.BRACKET_LEFT="BracketLeft",t.BRACKET_RIGHT="BracketRight",t.CAPS_LOCK="CapsLock",t.COMMA="Comma",t.CONTEXT_MENU="ContextMenu",t.CONTROL_LEFT="ControlLeft",t.CONTROL_RIGHT="ControlRight",t.DELETE="Delete",t.DIGIT_0="Digit0",t.DIGIT_1="Digit1",t.DIGIT_2="Digit2",t.DIGIT_3="Digit3",t.DIGIT_4="Digit4",t.DIGIT_5="Digit5",t.DIGIT_6="Digit6",t.DIGIT_7="Digit7",t.DIGIT_8="Digit8",t.DIGIT_9="Digit9",t.END="End",t.ENTER="Enter",t.EQUAL="Equal",t.ESCAPE="Escape",t.F1="F1",t.F10="F10",t.F11="F11",t.F12="F12",t.F2="F2",t.F3="F3",t.F4="F4",t.F5="F5",t.F6="F6",t.F7="F7",t.F8="F8",t.F9="F9",t.HOME="Home",t.INSERT="Insert",t.KEY_A="KeyA",t.KEY_B="KeyB",t.KEY_C="KeyC",t.KEY_D="KeyD",t.KEY_E="KeyE",t.KEY_F="KeyF",t.KEY_G="KeyG",t.KEY_H="KeyH",t.KEY_I="KeyI",t.KEY_J="KeyJ",t.KEY_K="KeyK",t.KEY_L="KeyL",t.KEY_M="KeyM",t.KEY_N="KeyN",t.KEY_O="KeyO",t.KEY_P="KeyP",t.KEY_Q="KeyQ",t.KEY_R="KeyR",t.KEY_S="KeyS",t.KEY_T="KeyT",t.KEY_U="KeyU",t.KEY_V="KeyV",t.KEY_W="KeyW",t.KEY_X="KeyX",t.KEY_Y="KeyY",t.KEY_Z="KeyZ",t.META_LEFT="MetaLeft",t.META_RIGHT="MetaRight",t.MINUS="Minus",t.NUMPAD_0="Numpad0",t.NUMPAD_1="Numpad1",t.NUMPAD_2="Numpad2",t.NUMPAD_3="Numpad3",t.NUMPAD_4="Numpad4",t.NUMPAD_5="Numpad5",t.NUMPAD_6="Numpad6",t.NUMPAD_7="Numpad7",t.NUMPAD_8="Numpad8",t.NUMPAD_9="Numpad9",t.NUMPAD_ADD="NumpadAdd",t.NUMPAD_COMMA="NumpadComma",t.NUMPAD_DECIMAL="NumpadDecimal",t.NUMPAD_DIVIDE="NumpadDivide",t.NUMPAD_ENTER="NumpadEnter",t.NUMPAD_EQUAL="NumpadEqual",t.NUMPAD_MULTIPLY="NumpadMultiply",t.NUMPAD_SUBTRACT="NumpadSubtract",t.NUM_LOCK="NumLock",t.PAGE_DOWN="PageDown",t.PAGE_UP="PageUp",t.PERIOD="Period",t.QUOTE="Quote",t.SCROLL_LOCK="ScrollLock",t.SEMICOLON="Semicolon",t.SHIFT_LEFT="ShiftLeft",t.SHIFT_RIGHT="ShiftRight",t.SLASH="Slash",t.SPACE="Space",t.TAB="Tab",t))(y||{});const wt=class Ct{constructor(e,o={},n){f(this,"store"),f(this,"changes"),f(this,"mouseData"),f(this,"keyboardData"),f(this,"curveFunctions"),f(this,"settingsStore"),f(this,"nodes"),f(this,"eventStore"),f(this,"chunking"),f(this,"id"),f(this,"keymap",{MOVE_DOWN:new Set([y.ARROW_DOWN,y.KEY_S]),MOVE_LEFT:new Set([y.ARROW_LEFT,y.KEY_A]),MOVE_RIGHT:new Set([y.ARROW_RIGHT,y.KEY_D]),MOVE_UP:new Set([y.ARROW_UP,y.KEY_W]),SELECT_MULTIPLE:new Set([y.CONTROL_LEFT,y.CONTROL_RIGHT]),CREATE_SELECTION_BOX:new Set([y.SHIFT_LEFT,y.SHIFT_RIGHT])}),f(this,"resetMovement",()=>{this.currentMoveSpeed=u.zero(),this.keymap.MOVE_LEFT.forEach(s=>this.keyboardData.releaseKey(s)),this.keymap.MOVE_RIGHT.forEach(s=>this.keyboardData.releaseKey(s)),this.keymap.MOVE_UP.forEach(s=>this.keyboardData.releaseKey(s)),this.keymap.MOVE_DOWN.forEach(s=>this.keyboardData.releaseKey(s))}),f(this,"updateZoom",(s,i)=>{const r=this.zoomLevel;if(s===0)return;const a=Number(Te(s>0?r+r*s*this.settings.zoomMultiplier:r/(1-s*this.settings.zoomMultiplier),this.settings.minZoom,this.settings.maxZoom).toFixed(4));this.mouseData.pointerDown=!1;const c=this.size,l=i.subtract(this.startPosition),h=c.multiplyBy(r),d=c.multiplyBy(a),g=l.subtract(h.divideBy(2)).divideBy(r),v=l.subtract(d.divideBy(2)).divideBy(a);this.updateWithPrevious(w=>({position:w.position.subtract(g).add(v),zoomLevel:a}))}),this.id=e,this.settingsStore=L({...Ct.DEFAULT_SETTINGS,...o}),this.curveFunctions=n?.(this)??new to(this),this.store=L({currentMoveSpeed:u.zero(),position:u.zero(),startPosition:u.zero(),size:u.zero(),zoomLevel:1,pinchDistance:0,intervalId:void 0}),this.changes=new A,this.mouseData=new ao(this),this.keyboardData=new ro(this),this.nodes=new Y,this.chunking=new co(this),this.eventStore={onKeyDownInNodeflow:new I(this),onKeyUpInNodeflow:new I(this),onMouseDownInConnector:new I(this),onMouseDownInNode:new I(this),onMouseDownInNodeflow:new I(this),onMouseMoveInNodeflow:new I(this),onNodeConnected:new I(this),onNodeDataChanged:new I(this),onPointerDownInNodeCurve:new I(this),onPointerUpInConnector:new I(this),onPointerUpInNode:new I(this),onPointerUpInNodeflow:new I(this),onTouchMoveInNodeflow:new I(this),onTouchStartInConnector:new I(this),onTouchStartInNode:new I(this),onTouchStartInNodeflow:new I(this),onWheelInNodeflow:new I(this)},this.setupDefaultEventHandlers()}handleMovement(){const e=!ne(le(this.keyboardData.heldKeys,this.keymap.MOVE_LEFT)),o=!ne(le(this.keyboardData.heldKeys,this.keymap.MOVE_RIGHT)),n=!ne(le(this.keyboardData.heldKeys,this.keymap.MOVE_UP)),s=!ne(le(this.keyboardData.heldKeys,this.keymap.MOVE_DOWN)),i=this.mouseData.heldNodes.length>0;this.currentMoveSpeed=u.of(this.calculateDirectionalMovementAmount(e||o,this.currentMoveSpeed.x,o,e,!i),this.calculateDirectionalMovementAmount(n||s,this.currentMoveSpeed.y,s,n,!i)),!(this.currentMoveSpeed.x===0&&this.currentMoveSpeed.y===0)&&(i?this.updateHeldNodePosition(this.currentMoveSpeed.divideBy(this.zoomLevel)):this.updateBackgroundPosition(this.currentMoveSpeed,!0))}serialize(){return{changes:this.changes.serialize(),connections:this.serializeConnections(),currentMoveSpeed:this.currentMoveSpeed.serialize(),mouseData:this.mouseData.serialize(),nodes:Object.fromEntries(Array.from(this.nodes.entries()).map(([e,o])=>[e,o.serialize()])),pinchDistance:this.pinchDistance,position:this.position.serialize(),size:this.size.serialize(),startPosition:this.startPosition.serialize(),zoomLevel:this.zoomLevel}}deserialize(e,o=!1){this.update({currentMoveSpeed:u.deserializeOrDefault(e.currentMoveSpeed),pinchDistance:e.pinchDistance,position:u.deserializeOrDefault(e.position),size:u.deserializeOrDefault(e.size),startPosition:u.deserializeOrDefault(e.startPosition),zoomLevel:e.zoomLevel});const n=A.evaluateHistoryGroup(o);this.nodes.clear(),Object.values(e.nodes).forEach(s=>{this.addNode(s,n)}),this.mouseData.deserialize(e.mouseData),e.connections.forEach(s=>{this.addConnection(s,n)}),this.changes.deserialize(e.changes)}serializeConnections(){return Array.from(this.nodes.values()).flatMap(e=>e.serializeConnections())}get settings(){return this.settingsStore[0]}updateSettings(e){this.settingsStore[1](e)}get currentMoveSpeed(){return this.store[0].currentMoveSpeed}get position(){return this.store[0].position}get startPosition(){return this.store[0].startPosition}get size(){return this.store[0].size}get zoomLevel(){return this.store[0].zoomLevel}get pinchDistance(){return this.store[0].pinchDistance}get intervalId(){return this.store[0].intervalId}set currentMoveSpeed(e){this.store[1]({currentMoveSpeed:e})}set position(e){this.store[1]({position:e})}set startPosition(e){this.store[1]({startPosition:e})}set size(e){this.store[1]({size:e})}set zoomLevel(e){this.store[1]({zoomLevel:e})}set pinchDistance(e){this.store[1]({pinchDistance:e})}set intervalId(e){this.store[1]({intervalId:e})}update(e){this.store[1](e)}updateWithPrevious(e){this.store[1](e)}center(){const e=this.size.divideBy(2);return this.startPosition.add(e).divideBy(this.zoomLevel).subtract(this.position)}calculateDirectionalMovementAmount(e,o,n,s,i=!1){let r=o;if(e){const a=this.settings.movementAcceleration*(i?-1:1);r=Te(r+(n?a:0)-(s?a:0),-this.settings.maxMovementSpeed,this.settings.maxMovementSpeed)}else r=Te(r*this.settings.movementDeceleration,-this.settings.maxMovementSpeed,this.settings.maxMovementSpeed);return Math.abs(r)<.1&&(r=0),r}updateBackgroundPosition(e,o=!1){!this.settings.canPan||!this.mouseData.hasSelectedNodeflow()||o===(this.mouseData.isHoldingButton(K.MIDDLE)||this.mouseData.isHoldingButton(K.LEFT))||this.mouseData.selectionBox.boundingBox||this.updateWithPrevious(n=>({position:n.position.add(e.divideBy(this.zoomLevel))}))}addNode(e,o=!0){const n=A.evaluateHistoryGroup(o),s=Ge.deserialize(this,e,n);if(this.nodes.set(s.id,s),n){const i=s.serializeConnections(),r=s.serialize(),a=this.id;this.changes.addChange({type:"add",source:"node",applyChange:()=>{const c=S.get().getNodeflow(a);c?.addNode(r,!1),i.forEach(l=>{c?.addConnection(l,!1)})},undoChange:()=>{var c;(c=S.get().getNodeflow(a))==null||c.removeNode(s.id,!1)},historyGroup:n})}return s}updateNode(e,o,n=!0){if(!this.nodes.has(e))return;const s=this.nodes.get(e),i=A.evaluateHistoryGroup(n);if(i){const r=this.nodes.get(e),a=r.serialize(),c=r.serializeConnections(),l=this.id,h=Object.entries(a).reduce((d,[g,v])=>(g in o&&Object.assign(d,{[g]:W(v)}),d),{});this.changes.addChange({type:"update",source:"node",applyChange:()=>{var d;(d=S.get().getNodeflow(l))==null||d.updateNode(e,o,!1)},undoChange:()=>{const d=S.get().getNodeflow(l);d?.updateNode(e,h,!1),c.forEach(g=>{d?.addConnection(g,!1)})},historyGroup:i})}s.updateWithPrevious(Be(r=>Object.assign(r,o))),this.eventStore.onNodeDataChanged.publish({nodeId:e,data:o})}removeNode(e,o=!0){if(!this.nodes.has(e))return;this.mouseData.selections.deleteNodes(s=>s.id===e);const n=A.evaluateHistoryGroup(o);if(n){const s=this.nodes.get(e),i=s.serializeConnections(),r=this.id;this.changes.addChange({type:"remove",source:"node",applyChange:()=>{var a;(a=S.get().getNodeflow(r))==null||a.removeNode(e,!1)},undoChange:()=>{const a=S.get().getNodeflow(r);a?.addNode(s.serialize(),!1),i.forEach(c=>{a?.addConnection(c,!1)})},historyGroup:n})}this.removeIncomingConnections(e),this.removeOutgoingConnections(e),this.nodes.delete(e)}removeIncomingConnections(e){this.nodes.has(e)&&this.nodes.get(e).connectorSections.forEach(o=>{o.connectors.forEach(n=>{n.sources.forEach(({sourceConnector:s})=>{s.destinations.filterInPlace(({destinationConnector:i})=>i.parentNode.id!==e)}),n.sources=new oe})})}removeOutgoingConnections(e){this.nodes.has(e)&&this.nodes.get(e).connectorSections.forEach(o=>{o.connectors.forEach(n=>{n.destinations.forEach(({destinationConnector:s})=>{s.sources.filterInPlace(({sourceConnector:i})=>i.parentNode.id!==e)}),n.destinations=new oe})})}getAllSourceConnectors(e){return this.nodes.has(e)?this.nodes.get(e).getAllSourceConnectors():[]}getAllDestinationConnectors(e){return this.nodes.has(e)?this.nodes.get(e).getAllDestinationConnectors():[]}getAllSourceConnections(e){return this.nodes.has(e)?this.nodes.get(e).getAllSourceConnections():[]}getAllDestinationConnections(e){return this.nodes.has(e)?this.nodes.get(e).getAllDestinationConnections():[]}getNextFreeNodeId(){let e="0";for(let o=1;this.nodes.has(e);++o)e=o.toString();return e}addConnection(e,o=!0){const{sourceNodeId:n,sourceConnectorId:s,destinationNodeId:i,destinationConnectorId:r,css:a}=e;if(!this.nodes.has(n)||!this.nodes.has(i))return;const c=this.nodes.get(n),l=this.nodes.get(i),h=c.getConnector(s),d=l.getConnector(r);if(!h||!d||h.destinations.some(v=>v.destinationConnector===d))return;const g=A.evaluateHistoryGroup(o);if(g){const v=this.id;this.changes.addChange({type:"add",source:"connection",applyChange:()=>this.addConnection(e,!1),undoChange:()=>{var w;return(w=S.get().getNodeflow(v))==null?void 0:w.removeConnection(n,s,i,r,!1)},historyGroup:g})}h.destinations.push(new oo({destinationConnector:d,css:a??{}})),d.sources.push(new io({sourceConnector:h}))}removeConnection(e,o,n,s,i=!0){var r;if(!this.nodes.has(e)||!this.nodes.has(n))return;const a=this.nodes.get(e),c=this.nodes.get(n),l=a.getConnector(o),h=c.getConnector(s);if(!l||!h)return;const d=A.evaluateHistoryGroup(i);if(d){const g=(r=l.destinations.find(k=>k.destinationConnector.parentNode.id===n))==null?void 0:r.css,v=this.id,w=()=>{var k;(k=S.get().getNodeflow(v))==null||k.addConnection({sourceNodeId:e,sourceConnectorId:o,destinationNodeId:n,destinationConnectorId:s,css:g},!1)},P=()=>{var k;(k=S.get().getNodeflow(v))==null||k.removeConnection(e,o,n,s,!1)};this.changes.addChange({type:"remove",source:"connection",applyChange:P,undoChange:w,historyGroup:d})}l.destinations.filterInPlace(g=>g.destinationConnector.parentNode.id!==n),h.sources.filterInPlace(g=>g.sourceConnector.parentNode.id!==e)}updateHeldNodePosition(e){!this.settings.canMoveNodes||this.mouseData.selectionBox.boundingBox||this.mouseData.heldNodes.forEach(o=>o.position=o.position.add(e))}setHeldNodePosition(e){!this.settings.canMoveNodes||this.mouseData.selectionBox.boundingBox||this.mouseData.heldNodes.forEach(o=>o.position=e)}setupDefaultEventHandlers(){this.eventStore.onNodeConnected.subscribeMultiple([{name:"nodeflow:create-connection",event:e=>this.addConnection({sourceNodeId:e.inputNodeId,sourceConnectorId:e.inputId,destinationNodeId:e.outputNodeId,destinationConnectorId:e.outputId})},{name:"nodeflow:reset-mouse-data",event:()=>this.mouseData.reset()}]),this.eventStore.onMouseMoveInNodeflow.subscribeMultiple([{name:"nodeflow:drag-node",event:({event:e})=>{this.mouseData.heldNodes.length===0||!this.mouseData.pointerDown&&!this.mouseData.isHoldingButton(K.LEFT)||this.mouseData.selectionBox.boundingBox||this.updateHeldNodePosition(u.of(e.movementX,e.movementY).divideBy(this.zoomLevel))}},{name:"nodeflow:update-background-position",event:({event:e})=>{const o=this.mouseData.heldNodes.length>0&&(this.mouseData.pointerDown||this.mouseData.isHoldingButton(K.LEFT));this.mouseData.selectionBox.boundingBox||o||this.updateBackgroundPosition(u.of(e.movementX,e.movementY))}},{name:"nodeflow:expand-selection-box",event:({event:e})=>{this.mouseData.selectionBox.boundingBox&&(this.mouseData.selectionBox.boundingBox=$.of(this.mouseData.selectionBox.boundingBox.position,this.mouseData.selectionBox.boundingBox.position.subtract(u.fromEvent(e)).negate()))}}]),this.eventStore.onPointerUpInNodeflow.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>{e.stopPropagation(),e.preventDefault()}},{name:"nodeflow:reset-mouse-data",event:({event:e})=>{this.mouseData.pointerDown=!1,this.mouseData.selectionBox.boundingBox=void 0,this.mouseData.heldMouseButtons.delete(e.button),this.mouseData.heldConnectors.length===1&&this.mouseData.selections.clearNodes(),this.mouseData.selections.clearConnectors()}}]),this.eventStore.onTouchStartInNodeflow.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()},{name:"nodeflow:clear-held-keys",event:({event:e})=>{e.touches.length===1&&this.keyboardData.clearKeys()}},{name:"nodeflow:handle-pinch",event:({event:e})=>{const{touches:o}=e;if(o.length!==2)return;const{pageX:n,pageY:s}=e.touches[0],{pageX:i,pageY:r}=e.touches[1];this.pinchDistance=Math.hypot(n-i,s-r)}},{name:"nodeflow:update-mouse-data",event:({event:e})=>{const{touches:o}=e;if(o.length!==1)return;const n=o[0],s=u.fromEvent(n);this.mouseData.selections.clearNodes(),this.mouseData.update({pointerDown:!0,mousePosition:s,clickStartPosition:u.of(s.x/this.zoomLevel-this.position.x,s.y/this.zoomLevel-this.position.y)})}}]),this.eventStore.onTouchMoveInNodeflow.subscribeMultiple([{name:"nodeflow:handle-pinch",event:({event:e})=>{const{touches:o}=e;if(o.length!==2)return;const{pageX:n,pageY:s}=o[0],{pageX:i,pageY:r}=o[1],a=Math.hypot(n-i,s-r),c=u.of((n+i)/2,(s+r)/2);this.settings.canZoom&&this.updateZoom(a-this.pinchDistance,c),this.pinchDistance=a}},{name:"nodeflow:update-mouse-data",event:({event:e})=>{const{touches:o}=e;o.length===1&&this.mouseData.updateWithPrevious(n=>{const s=u.fromEvent(o[0]);return this.updateBackgroundPosition(s.subtract(n.mousePosition)),{mousePosition:s}})}}]),this.eventStore.onKeyUpInNodeflow.subscribeMultiple([{name:"nodeflow:remove-held-key",event:({event:e})=>this.keyboardData.releaseKey(e.code)}]),this.eventStore.onKeyDownInNodeflow.subscribeMultiple([{name:"nodeflow:add-held-key",event:({event:e})=>this.keyboardData.pressKey(e.code),priority:10},{name:"nodeflow:handle-controls",event:({event:e})=>{switch(e.code){case y.DELETE:if(this.mouseData.heldNodes.length>0&&this.settings.canDeleteNodes){const o=A.evaluateHistoryGroup();this.mouseData.heldNodes.forEach(n=>this.removeNode(n.id,o))}else if(this.mouseData.heldConnections.length>0&&this.settings.canDeleteConnections){const o=A.evaluateHistoryGroup();this.mouseData.heldConnections.forEach(n=>this.removeConnection(n.connection.sourceConnector.parentNode.id,n.connection.sourceConnector.id,n.connection.destinationConnector.parentSection.parentNode.id,n.connection.destinationConnector.id,o))}break;case y.ESCAPE:this.mouseData.clearSelections();break;case y.SPACE:this.settings.debugMode&&(this.mouseData.selections.size>0?console.log(this.mouseData.selections):console.log(this.nodes));break;case y.EQUAL:case y.MINUS:if(e.ctrlKey){if(!this.settings.canZoom)return;e.preventDefault(),this.updateZoom(this.settings.keyboardZoomMultiplier*(e.code===y.EQUAL?1:-1),this.size.divideBy(2))}break;case y.KEY_Z:if(!e.ctrlKey)break;e.preventDefault(),e.shiftKey?this.changes.redo():this.changes.undo();break;case y.KEY_A:case y.KEY_S:case y.KEY_D:case y.KEY_W:case y.ARROW_UP:case y.ARROW_DOWN:case y.ARROW_LEFT:case y.ARROW_RIGHT:this.intervalId||(this.intervalId=setInterval(()=>this.handleMovement(),10))}}}]),this.eventStore.onWheelInNodeflow.subscribeMultiple([{name:"nodeflow:update-zoom",event:({event:e})=>{this.settings.canZoom&&this.updateZoom(-e.deltaY,u.fromEvent(e))}},{name:"nodeflow:prevent-scroll",event:({event:e})=>{e.preventDefault()}}]),this.eventStore.onMouseDownInNodeflow.subscribeMultiple([{name:"nodeflow:reset-movement",event:({event:e})=>{e.button===K.LEFT&&this.resetMovement()}},{name:"nodeflow:reset-mouse-data",event:({event:e})=>{e.button===K.LEFT&&this.mouseData.clearSelections(),this.mouseData.selectNodeflow(),this.mouseData.heldMouseButtons.add(e.button),this.mouseData.update({clickStartPosition:u.of(e.clientX/this.zoomLevel-this.position.x,e.clientY/this.zoomLevel-this.position.y),mousePosition:u.fromEvent(e)})}},{name:"nodeflow:create-selection-box",event:({event:e})=>{e.button!==K.LEFT||!this.keyboardData.isActionPressed(this.keymap.CREATE_SELECTION_BOX)||(this.mouseData.selectionBox.boundingBox=$.of(u.fromEvent(e),u.zero()))}},{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()}]),this.eventStore.onMouseDownInConnector.blacklist("nodeflow:allow-pan",(e,o)=>e.event.button!==K.LEFT&&o.startsWith("nodeflow")),this.eventStore.onMouseDownInConnector.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()},{name:"nodeflow:handle-click",event:({event:e})=>{this.mouseData.heldMouseButtons.add(e.button)}},{name:"nodeflow:start-creating-connection",event:({event:e,nodeId:o,connectorId:n})=>{this.mouseData.startCreatingConnection(o,u.fromEvent(e),n)}}]),this.eventStore.onTouchStartInConnector.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()},{name:"nodeflow:start-creating-connection",event:({event:e,nodeId:o,connectorId:n})=>{const{clientX:s,clientY:i}=e.touches[0];this.mouseData.startCreatingConnection(o,u.of(s,i),n)}}]),this.eventStore.onPointerUpInConnector.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>{e.preventDefault(),e.stopPropagation()},priority:2},{name:"nodeflow:connect-held-nodes",event:({event:e,nodeId:o,connectorId:n})=>{if(!this.settings.canCreateConnections||this.mouseData.heldConnectors.length!==1)return;const s=this.mouseData.heldConnectors[0],i=s?.parentNode;!s||!i||this.eventStore.onNodeConnected.publish({outputNodeId:i.id,outputId:s.id,inputNodeId:o,inputId:n,event:e})},priority:2},{name:"nodeflow:reset-mouse-data",event:()=>{this.mouseData.pointerDown=!1},priority:1}]),this.eventStore.onMouseDownInNode.blacklist("nodeflow:allow-pan",(e,o)=>e.event.button!==K.LEFT&&o.startsWith("nodeflow")),this.eventStore.onMouseDownInNode.subscribeMultiple([{name:"nodeflow:select-node",event:({event:e,nodeId:o})=>{this.keyboardData.isActionPressed(this.keymap.SELECT_MULTIPLE)||this.mouseData.clearSelections(),this.mouseData.selectNode(o,u.fromEvent(e),this.settings.canMoveNodes)}},{name:"nodeflow:handle-click",event:({event:e})=>{this.mouseData.heldMouseButtons.add(e.button)}},{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()}]),this.eventStore.onTouchStartInNode.subscribeMultiple([{name:"nodeflow:select-node",event:({event:e,nodeId:o})=>{const{clientX:n,clientY:s}=e.touches[0];this.keyboardData.isActionPressed(this.keymap.SELECT_MULTIPLE)||this.mouseData.clearSelections(),this.mouseData.selectNode(o,u.of(n,s),this.settings.canMoveNodes)}},{name:"nodeflow:stop-propagation",event:({event:e})=>e.stopPropagation()}]),this.eventStore.onPointerDownInNodeCurve.blacklist("nodeflow:allow-pan",(e,o)=>e.event.button!==K.LEFT&&o.startsWith("nodeflow")),this.eventStore.onPointerDownInNodeCurve.subscribeMultiple([{name:"nodeflow:stop-propagation",event:({event:e})=>{e.preventDefault(),e.stopPropagation()},priority:1},{name:"nodeflow:handle-click",event:({event:e})=>{this.mouseData.heldMouseButtons.add(e.button)}},{name:"nodeflow:update-mouse-data",event:({event:e,sourceConnector:o,destinationConnector:n})=>{this.mouseData.pointerDown=!0,this.mouseData.mousePosition=u.fromEvent(e),this.keyboardData.isActionPressed(this.keymap.SELECT_MULTIPLE)||this.mouseData.clearSelections(),this.mouseData.selections.add({type:p.Connection,connection:{sourceConnector:o,destinationConnector:n}})}}]),this.eventStore.onPointerUpInNode.subscribeMultiple([{name:"nodeflow:reset-mouse-data",event:()=>{this.mouseData.pointerDown=!1,this.mouseData.heldConnectors.length===1&&this.mouseData.selections.clearNodes(),this.mouseData.selections.clearConnectors()}}])}selectNode(e,o){this.mouseData.selectNode(e,o??u.zero(),!1)}transformVec2ToCanvas(e){return e.subtract(this.startPosition).divideBy(this.zoomLevel).subtract(this.position)}};f(wt,"DEFAULT_SETTINGS",{allowCollision:!1,canAddNodes:!0,canCreateConnections:!0,canDeleteConnections:!0,canDeleteNodes:!0,canMoveNodes:!0,canPan:!0,canZoom:!0,debugMode:!1,keyboardZoomMultiplier:15,maxMovementSpeed:15,maxZoom:200,minZoom:.02,movementAcceleration:1.5,movementDeceleration:.85,zoomMultiplier:.005});let lo=wt;const[ot,ho]=pe(u.of(window.innerWidth,window.innerHeight));he(()=>{const t=()=>ho(u.of(window.innerWidth,window.innerHeight));return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)});var uo=B("<div><p></p><p>");const fo=t=>(()=>{var e=uo(),o=e.firstChild,n=o.nextSibling;return e.style.setProperty("padding","1rem"),e.style.setProperty("padding-left","2rem"),T(o,()=>t.node.position.x.toFixed(2)),T(n,()=>t.node.position.y.toFixed(2)),e})(),po=(t,e=!1)=>{const o=crypto.randomUUID(),n=q.addNode({position:t,display:fo,centered:e},o),s=n.addConnectorSection({id:"inputs"},o),i=n.addConnectorSection({id:"outputs"},o),r=Math.random()*4;for(let c=0;c<r;c++)i.addConnector({},o);const a=Math.random()*4;for(let c=0;c<a;c++)s.addConnector({},o);return n},go=(t=50)=>{for(let e=0;e<t;e++)po(u.of(Math.random()*2e3,Math.random()*2e3))},vo=()=>{const t=q.nodes.size;for(let e=0;e<t;e++){const o=Math.floor(Math.random()*t),n=Math.floor(Math.random()*t);if(!q.nodes.has(o.toString())||!q.nodes.has(n.toString()))continue;const s=q.nodes.get(o.toString()),i=q.nodes.get(n.toString()),r=s.connectorSections.get("outputs").connectors,a=i.connectorSections.get("inputs").connectors,c=Array.from(r.values()),l=Array.from(a.values());if(c.length===0||l.length===0)continue;const h=c[Math.floor(Math.random()*c.length)],d=l[Math.floor(Math.random()*l.length)];o===n||i.getTotalConnectedInputs(d.toString())>0||q.addConnection({sourceNodeId:o.toString(),sourceConnectorId:h.id,destinationNodeId:n.toString(),destinationConnectorId:d.id})}};var yo=B("<div>");const[q,mo]=S.get().createCanvas("main"),wo=()=>(St(()=>{go(),vo()}),(()=>{var t=yo();return T(t,E(mo,{height:"100%",width:"100%"})),z(e=>{var o=`${ot().x}px`,n=`${ot().y}px`;return o!==e.e&&((e.e=o)!=null?t.style.setProperty("width",o):t.style.removeProperty("width")),n!==e.t&&((e.t=n)!=null?t.style.setProperty("height",n):t.style.removeProperty("height")),e},{e:void 0,t:void 0}),t})()),Co=document.getElementById("root");Ot(()=>E(wo,{}),Co);
